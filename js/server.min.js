(function(a,b){if(typeof define==="function"&&define.amd){define(["$"],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Query=b(window.Zepto||window.jQuery||$)}}})(this,function(b){var a={getQuery:function(d,m,l){var h=new RegExp("(^|&|#)"+d+"=([^&]*)(&|$|#)","i");l=l||window;var f=l.location.href;var n,k,j="";if(m=="#"){n=f.split("#")}else{n=f.split("?")}if(n.length==1){k=""}else{k=n[1]}if(k!=""){gg=k.split(/&|#/);var c=gg.length;str=arguments[0]+"=";for(i=0;i<c;i++){if(gg[i].indexOf(str)==0){j=gg[i].replace(str,"");break}}}return decodeURI(j)},getForm:function(g){var c={},d={};b(g).find("*[name]").each(function(p,l){var k,m=b(l).attr("name"),s=b.trim(b(l).val()),n=[];if(m==""||b(l).hasClass("getvalued")){return}if(b(l).data("type")=="money"){s=s.replace(/\,/gi,"")}if(b(l).attr("type")=="radio"){var q=null;b("input[name='"+m+"']:radio").each(function(){if(b(this).is(":checked")){q=b.trim(b(this).val())}});if(q){s=q}else{s=""}}if(b(l).attr("type")=="checkbox"){var q=[];b("input[name='"+m+"']:checkbox").each(function(){if(b(this).is(":checked")){q.push(b.trim(b(this).val()))}});if(q.length){s=q.join(",")}else{s=""}}if(b(l).attr("listvalue")){if(!c[b(l).attr("listvalue")]){c[b(l).attr("listvalue")]=[];b("input[listvalue='"+b(l).attr("listvalue")+"']").each(function(){if(b(this).val()!=""){var t=b(this).attr("name");var u={};if(b(this).data("type")=="json"){u[t]=JSON.parse(b(this).val())}else{u[t]=b.trim(b(this).val())}if(b(this).attr("paramquest")){var v=JSON.parse(b(this).attr("paramquest"));u=b.extend(u,v)}c[b(l).attr("listvalue")].push(u);b(this).addClass("getvalued")}})}}if(b(l).attr("arrayvalue")){if(!c[b(l).attr("arrayvalue")]){c[b(l).attr("arrayvalue")]=[];b("input[arrayvalue='"+b(l).attr("arrayvalue")+"']").each(function(){if(b(this).val()!=""){var t={};if(b(this).data("type")=="json"){t=JSON.parse(b(this).val())}else{t=b.trim(b(this).val())}if(b(this).attr("paramquest")){var u=JSON.parse(b(this).attr("paramquest"));t=b.extend(t,u)}c[b(l).attr("arrayvalue")].push(t)}})}}if(m==""||b(l).hasClass("getvalued")){return}if(m.match(/\./)){n=m.split(".");k=n[0];if(n.length==3){d[n[1]]=d[n[1]]||{};d[n[1]][n[2]]=s}else{if(b(l).data("type")=="json"){d[n[1]]=JSON.parse(s);if(b(l).attr("paramquest")){var r=JSON.parse(b(l).attr("paramquest"));d[n[1]]=b.extend(d[n[1]],r)}}else{d[n[1]]=s}}if(!c[k]){c[k]=d}else{c[k]=b.extend({},c[k],d)}}else{c[m]=s}});var h={};for(var j in c){var f=c[j];if(typeof f=="object"){h[j]=JSON.stringify(f)}else{h[j]=c[j]}}b(".getvalued").removeClass("getvalued");return h},setHash:function(f){var g="";f=b.extend(this.getHash(),f);var c=[];for(var d in f){if(f[d]!=""){c.push(d+"="+encodeURIComponent(f[d]))}}g+=c.join("&");location.hash=g;return this},getHash:function(g){if(typeof g==="string"){return this.getQuery(g,"#")}else{var k={};var j=location.hash;if(j.length>0){j=j.substr(1);var f=j.split("&");for(var h=0,d=f.length;h<d;h++){var c=f[h].split("=");if(c.length>0){k[c[0]]=decodeURI(c[1])||""}}}return k}}};return a});(function(a,b){if(typeof define==="function"&&define.amd){define(["$","query"],b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Paging=b(window.Zepto||window.jQuery||$,Query)}}})(this,function(c,b){c.fn.Paging=function(f){var d=[];c(this).each(function(){var g=c.extend({target:c(this)},f);var h=new a();h.init(g);d.push(h)});return d};function a(){var d=Math.random().toString().replace(".","");this.id="Paging_"+d}a.prototype={init:function(d){this.settings=c.extend({callback:null,pagesize:10,current:1,prevTpl:"上一页",nextTpl:"下一页",firstTpl:"首页",lastTpl:"末页",ellipseTpl:"...",toolbar:false,hash:true,pageSizeList:[5,10,15,20]},d);this.target=c(this.settings.target);this.container=c('<div id="'+this.id+'" class="ui-paging-container"/>');this.target.append(this.container);this.render(this.settings);this.format();this.bindEvent()},render:function(d){this.count=d.count||this.settings.count;this.pagesize=d.pagesize||this.settings.pagesize;this.current=d.current||this.settings.current;this.pagecount=Math.ceil(this.count/this.pagesize);this.format()},bindEvent:function(){var d=this;this.container.on("click","li.js-page-action,li.ui-pager",function(f){if(c(this).hasClass("ui-pager-disabled")||c(this).hasClass("focus")){return false}if(c(this).hasClass("js-page-action")){if(c(this).hasClass("js-page-first")){d.current=1}if(c(this).hasClass("js-page-prev")){d.current=Math.max(1,d.current-1)}if(c(this).hasClass("js-page-next")){d.current=Math.min(d.pagecount,d.current+1)}if(c(this).hasClass("js-page-last")){d.current=d.pagecount}}else{if(c(this).data("page")){d.current=parseInt(c(this).data("page"))}}d.go()})},go:function(d){var f=this;this.current=d||this.current;this.current=Math.max(1,f.current);this.current=Math.min(this.current,f.pagecount);this.format();if(this.settings.hash){b.setHash({page:this.current})}this.settings.callback&&this.settings.callback(this.current,this.pagesize,this.pagecount)},changePagesize:function(d){this.render({pagesize:d})},format:function(){var f="<ul>";
f+='<li class="js-page-first js-page-action ui-pager" >'+this.settings.firstTpl+"</li>";f+='<li class="js-page-prev js-page-action ui-pager">'+this.settings.prevTpl+"</li>";if(this.pagecount>6){f+='<li data-page="1" class="ui-pager">1</li>';if(this.current<=2){f+='<li data-page="2" class="ui-pager">2</li>';f+='<li data-page="3" class="ui-pager">3</li>';f+='<li class="ui-paging-ellipse">'+this.settings.ellipseTpl+"</li>"}else{if(this.current>2&&this.current<=this.pagecount-2){f+="<li>"+this.settings.ellipseTpl+"</li>";f+='<li data-page="'+(this.current-1)+'" class="ui-pager">'+(this.current-1)+"</li>";f+='<li data-page="'+this.current+'" class="ui-pager">'+this.current+"</li>";f+='<li data-page="'+(this.current+1)+'" class="ui-pager">'+(this.current+1)+"</li>";f+='<li class="ui-paging-ellipse" class="ui-pager">'+this.settings.ellipseTpl+"</li>"}else{f+='<li class="ui-paging-ellipse" >'+this.settings.ellipseTpl+"</li>";for(var d=this.pagecount-2;d<this.pagecount;d++){f+='<li data-page="'+d+'" class="ui-pager">'+d+"</li>"}}}f+='<li data-page="'+this.pagecount+'" class="ui-pager">'+this.pagecount+"</li>"}else{for(var d=1;d<=this.pagecount;d++){f+='<li data-page="'+d+'" class="ui-pager">'+d+"</li>"}}f+='<li class="js-page-next js-page-action ui-pager">'+this.settings.nextTpl+"</li>";f+='<li class="js-page-last js-page-action ui-pager">'+this.settings.lastTpl+"</li>";f+="</ul>";this.container.html(f);if(this.current==1){c(".js-page-prev",this.container).addClass("ui-pager-disabled");c(".js-page-first",this.container).addClass("ui-pager-disabled")}if(this.current==this.pagecount){c(".js-page-next",this.container).addClass("ui-pager-disabled");c(".js-page-last",this.container).addClass("ui-pager-disabled")}this.container.find('li[data-page="'+this.current+'"]').addClass("focus").siblings().removeClass("focus");if(this.settings.toolbar){this.bindToolbar()}},bindToolbar:function(){var k=this;var g=c('<li class="ui-paging-toolbar"><select class="ui-select-pagesize"></select><input type="text" class="ui-paging-count"/><a href="javascript:void(0)">跳转</a></li>');var h=c(".ui-select-pagesize",g);var j="";for(var f=0,d=this.settings.pageSizeList.length;f<d;f++){j+='<option value="'+this.settings.pageSizeList[f]+'">'+this.settings.pageSizeList[f]+"条/页</option>"}h.html(j);h.val(this.pagesize);c("input",g).val(this.current);c("input",g).click(function(){c(this).select()}).keydown(function(m){if(m.keyCode==13){var l=parseInt(c(this).val())||1;k.go(l)}});c("a",g).click(function(){var l=parseInt(c(this).prev().val())||1;k.go(l)});h.change(function(){k.changePagesize(c(this).val())});this.container.children("ul").append(g)}};return a});(function(c,b,a){function d(f){this._init(f)}a.extend(d.prototype,{_init:function(g){var f=this;f.options={dirSelector:"x",contSelector:"",barSelector:"",sliderSelector:"",wheelStep:"10"};a.extend(true,f.options,g||{});f._initDom();return f},_initDom:function(){this.$dir=this.options.dirSelector;this.$cont=this.options.contSelector;this.$bar=this.options.barSelector;this.$slider=this.options.sliderSelector;this.$wheelStep=this.options.wheelStep;this.$doc=a(b);if(this.$dir==="x"){this._initSliderDragEvent()._bindContScrollX()}if(this.$dir==="y"){this._initSliderDragEvent()._bindContScrollY()._bindMouseWheel()}},_initSliderDragEvent:function(){var r=this;var o=this.$doc;if(r.$dir==="x"&&r.$slider){var h;var m;var s;var p;var j;function k(t){t.preventDefault();m=t.pageX;j=p*(m-h)+s;r._scrollToX(j)}}if(r.$dir==="y"&&r.$slider){var g;var l;var q;var n;var f;function k(t){t.preventDefault();l=t.pageY;f=n*(l-g)+q;r._scrollToY(f)}}r.$slider.on("mousedown",function(t){t.preventDefault();h=t.pageX;s=r.$cont[0].scrollLeft;p=r._getContMaxScrollX()/r._getSliderMaxScrollX();g=t.pageY;q=r.$cont[0].scrollTop;n=r._getContMaxScrollY()/r._getSliderMaxScrollY();o.on("mousemove.slider",k).on("mouseup.slider",function(u){o.off(".slider")})});return r},_bindMouseWheel:function(){var f=this;f.$cont.on("mousewheel DOMMouseScroll",function(k){k.preventDefault();var h=k.originalEvent;var g=h.wheelDelta?-h.wheelDelta/120:(h.detail||0)/3;var j=f.$cont[0].scrollTop+g*f.$wheelStep;f._scrollToY(j)});return f},_bindContScrollX:function(){var f=this;f.$cont.on("scroll",function(){f.$slider.css({left:f._getSliderScrollX()})});return f},_bindContScrollY:function(){var f=this;f.$cont.on("scroll",function(){f.$slider.css({top:f._getSliderScrollY()})});return f},_getContMaxScrollX:function(){var g=this;var f=g.$cont[0].scrollWidth-g.$cont.width();return f},_getContMaxScrollY:function(){var g=this;var f=g.$cont[0].scrollHeight-g.$cont.height();return f},_getSliderMaxScrollX:function(){var f=this;return f.$bar.width()-f.$slider.width()},_getSliderMaxScrollY:function(){var f=this;return f.$bar.height()-f.$slider.height()},_getSliderScrollX:function(){var f=this;var g=Math.min(f._getSliderMaxScrollX(),f.$cont[0].scrollLeft*f._getSliderMaxScrollX()/f._getContMaxScrollX());return g},_getSliderScrollY:function(){var f=this;var g=Math.min(f._getSliderMaxScrollY(),f.$cont[0].scrollTop*f._getSliderMaxScrollY()/f._getContMaxScrollY());
return g},_scrollToX:function(g){var f=this;f.$cont.scrollLeft(g)},_scrollToY:function(g){var f=this;f.$cont.scrollTop(g)}});c.Scrollbar=d})(window,document,jQuery);(function(f,a,b,d){function c(g){this._init(g)}b.extend(c.prototype,{_init:function(h){var g=this;g.options={cssName:"facial",headerTitle:"视频分析",data:[]};b.extend(true,g.options,h||{});g._initDom(g.options.data);return g},_initDom:function(){var g=this;var h=b('<div id="js_create'+g.options.cssName+'Modal" class="create_'+g.options.cssName+'_modal">'+'<div class="fast_content">'+'<div class="fast_header" id="js_fast_header">'+'<span class="icojam_delete"></span>'+"<h4>视频分析</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12">'+'<div class="facial_box" id="js_facial_box">'+"</div>"+'<div class="facial_list_track">'+'<div class="facial_list_scroll"></div>'+"</div>"+"</div>"+'<div class="col-md-12 '+g.options.cssName+'_pagination">'+'<ul class="pager" id="js_'+g.options.cssName+'_pager">'+"</ul>"+"</div>"+"</div>"+'<div class="fast_footer">'+'<button type="button" class="fast_btn" id="js_'+g.options.cssName+'_cancel">关闭</button>'+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");h.insertAfter(b(".container-fluid"));g._initStyle();return g},_initStyle:function(){var g=this;g._initDrag();g._operateInit();return g},_initDrag:function(){var g=this;b("#js_fast_header").mousedown(function(n){var k=n.clientX;var j=n.clientY;var m;var l;var h=b("#js_create"+g.options.cssName+"Modal").position().left;var p=b("#js_create"+g.options.cssName+"Modal").position().top;b(body).css("cursor","move");function o(r){r.preventDefault();m=r.clientX;l=r.clientY;var q=m-k+h;var s=l-j+p;if(q<=0){q=0}if(q>=(b("#body").width()-b("#js_create"+g.options.cssName+"Modal").width())){q=b("#body").width()-b("#js_create"+g.options.cssName+"Modal").width()}if(s<=0){s=0}if(s>=(b("#body").height()-b("#js_create"+g.options.cssName+"Modal").height())){s=b("#body").height()-b("#js_create"+g.options.cssName+"Modal").height()}b("#js_create"+g.options.cssName+"Modal").css("left",q);b("#js_create"+g.options.cssName+"Modal").css("top",s)}b(d).on("mousemove",o).on("mouseup",function(q){b(d).off("mousemove");b(body).css("cursor","default")})})},_operateInit:function(){var g=this;b("#js_"+g.options.cssName+"_cancel, .icojam_delete").on("click",function(){b("#js_create"+g.options.cssName+"Modal").remove();b("#js_pageCover").hide();PLAYER.model=null});return g}});a.CreateFacialModal=c})(window,PLAYER,jQuery,document);$(document).ready(function(){$.ajaxSetup({type:"POST",dataType:"json",error:function(y,A,z){console.log("失败XMLHttpRequest",y);console.log("失败XMLHttpRequest",A);console.log("失败XMLHttpRequest",z)}});document.onselectstart=function(y){if(y.srcElement.tagName==="input"||y.srcElement.tagName==="INPUT"||y.srcElement.tagName==="textarea"||y.srcElement.tagName==="TEXTAREA"||y.srcElement.tagName==="span"||y.srcElement.tagName==="SPAN"){return true}else{return false}};var h=PLAYER.singelton(function(){var y=$('<div id="js_initProjectModal" class="init_pro_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+"<h4>打开工程</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12 left">'+'<ul class="project_list" id="js_init_project_list" onselectstart="return false">'+"</ul>"+'<div class="project_list_track">'+'<div class="project_list_scroll"></div>'+"</div>"+"</div>"+'<div class="col-md-12 project_pagination">'+'<ul class="pager" id="js_pro_pager">'+"</ul>"+"</div>"+"</div>"+'<div class="fast_footer">'+'<button type="button" class="fast_btn" id="js_modal_initOpenNew">打开</button>'+'<button type="button" class="fast_btn" id="js_modal_initNew">新建</button>'+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");y.insertAfter($(".container-fluid"));return y});var b=PLAYER.singelton(function(){var y=$('<div id="js_createProjectModal" class="create_pro_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+'<span class="icojam_delete"></span>'+"<h4>创建工程</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12 right">'+'<form id="js_create_form">'+'<div class="form-group">'+'<input type="text" class="form-control" name="name" placeholder="未命名" id="js_create_form_name">'+"</div>"+'<div class="form-group" id="js_create_pro_type">'+"</div>"+"</form>"+"</div>"+"</div>"+'<div class="fast_footer">'+'<button type="button" class="fast_btn" id="js_modal_createNew">新建</button>'+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");y.insertAfter($(".container-fluid"));return y});var j=PLAYER.singelton(function(){var y=$('<div id="js_editProjectModal" class="edit_pro_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+'<span class="icojam_delete"></span>'+"<h4>编辑工程</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12 left">'+'<ul class="project_list" id="js_edit_project_list">'+"</ul>"+'<div class="project_edit_list_track">'+'<div class="project_edit_list_scroll"></div>'+"</div>"+"</div>"+'<div class="col-md-12 project_edit_pagination">'+'<ul class="pager" id="js_pro_edit_pager">'+"</ul>"+"</div>"+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");
y.insertAfter($(".container-fluid"));return y});var l=PLAYER.singelton(function(){var y=$('<div id="js_saveProjectModal" class="save_pro_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+'<span class="icojam_delete"></span>'+"<h4>保存工程</h4>"+"</div>"+'<div class="fast_footer">'+'<button type="button" class="fast_btn" id="js_modal_savePro">确定</button>'+'<button type="button" class="fast_btn" id="js_modal_cancelPro">取消</button>'+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");y.insertAfter($(".container-fluid"));return y});var v=PLAYER.singelton(function(){var y=$('<div id="js_exportProjectModal" class="export_pro_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+'<span class="icojam_delete"></span>'+"<h4>合成打包</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12">'+'<form id="js_create_form" class="form-horizontal">'+'<div class="form-group">'+'<label for="schema" class="col-md-3 control-label">文件模板</label>'+'<div class="col-md-9">'+'<select class="form-control" name="schema" id="js_export_form_schema"></select>'+"</div>"+"</div>"+'<div class="form-group">'+'<label for="name" class="col-md-3 control-label">文件名称</label>'+'<div class="col-md-9" id="js_export_form_box">'+'<input type="text" class="form-control" name="name" placeholder="打包" id="js_export_form_name">'+"</div>"+"</div>"+'<div class="form-group">'+'<div class="col-md-offset-3 col-md-9">'+'<div class="checkbox">'+"<label>"+'<input type="checkbox" id="js_export_form_check">整个序列'+"</label>"+"</div>"+"</div>"+"</div>"+"</form>"+"</div>"+"</div>"+'<div class="fast_footer">'+'<div class="col-md-offset-3 col-md-9">'+'<button type="button" class="fast_btn" id="js_modal_export">打包</button>'+'<button type="button" class="fast_btn" id="js_export_modal_cancelPro">取消</button>'+"</div>"+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");y.insertAfter($(".container-fluid"));return y});var g=PLAYER.singelton(function(){var y=$('<div id="js_addProgramModal" class="add_pro_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+'<span class="icojam_delete"></span>'+"<h4>添加网络素材</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12">'+'<form id="js_create_form" class="form-horizontal">'+'<div class="form-group">'+'<label for="name" class="col-md-3 control-label">文件名称</label>'+'<div class="col-md-9">'+'<input type="text" class="form-control" name="name" placeholder="文件名称" id="js_add_form_name">'+"</div>"+"</div>"+'<div class="form-group">'+'<label for="name" class="col-md-3 control-label">URL</label>'+'<div class="col-md-9">'+'<input type="text" class="form-control" name="name" placeholder="http://" id="js_add_form_url">'+"</div>"+"</div>"+"</form>"+"</div>"+"</div>"+'<div class="fast_footer">'+'<div class="col-md-offset-3 col-md-9">'+'<button type="button" class="fast_btn" id="js_modal_add">添加</button>'+'<button type="button" class="fast_btn" id="js_add_modal_cancelPro">取消</button>'+"</div>"+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");y.insertAfter($(".container-fluid"));return y});var m=PLAYER.singelton(function(){var y=$('<div id="js_createVolumeModal" class="create_volume_modal">'+'<div class="fast_content">'+'<div class="fast_header">'+'<span class="icojam_delete"></span>'+"<h4>调节音量</h4>"+"</div>"+'<div class="fast_body row">'+'<div class="col-md-12 right">'+'<div class="volume_num" id="js_volume_num">'+"<span>0</span>"+"<span>100</span>"+"<span>400</span>"+"</div>"+'<form id="js_volume_form">'+'<div class="form-group">'+'<input type="range" class="form-control" name="range" min="0" max="400" step="10" value="" id="js_volume_form_range">'+"</div>"+'<div class="form-group">'+'<input type="text" class="form-control" name="name" placeholder="未命名" id="js_volume_form_name">'+"</div>"+"</form>"+"</div>"+"</div>"+'<div class="fast_footer">'+'<button type="button" class="fast_btn" id="js_volume_save">确定</button>'+'<button type="button" class="fast_btn" id="js_volume_cancel">取消</button>'+"</div>"+"</div>"+'<iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);">'+"</iframe>"+"</div>");y.insertAfter($(".container-fluid"));return y});h();b();j();m();PLAYER.observer.listen("webrtcPlayer",function(){if(window.location.search.length>0&&window.location.search.indexOf("tools")>-1){PLAYER.jobId=window.location.search.substring(7)}if(PLAYER.jobId!==""){$("#js_pageCover").hide();$("#tab_1 .carve_body_chooseBox").hide();$.ajax({url:serverUrl+"job/info",data:{jobId:PLAYER.jobId},success:function(B){var z=B.data.material;
PLAYER.observer.trigger("getProgramList",z);var A=B.data.projecthtml;if(A.rootBin.sequence[0].tracks.length===0){$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(D,E){var C={type:$(E).attr("data-type"),index:parseInt($(E).attr("data-index")),subclip:[]};A.rootBin.sequence[0].tracks.push(C)})}var y;if(A.height==="576"){y="SD"}else{if(A.height==="1080"){y="HD"}}PLAYER.OCX.sendProType(y);PLAYER.observer.trigger("projectData",JSON.stringify(A))}})}else{$("#tab_1 .carve_body_chooseBox").show();$("#js_initProjectModal").show();$("#js_pageCover").show();$.ajax({url:serverUrl+"proj/list",data:{currentPage:1,pageSize:20},success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("proList",y.data)}else{console.log("error")}}});$.ajax({url:serverUrl+"proj/template",success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("proTemplate",y.data)}else{console.log("error")}}});$("#js_modal_initOpenNew").on("click",function(){if(!$("#js_init_project_list li.active").length){alert("您必须选中一个")}else{$.ajax({url:serverUrl+"proj/info",data:{projectid:$("#js_init_project_list li.active").attr("data-id")},success:function(A){if(A.code===0&&A.data!==null){$("#js_initProjectModal").hide();$("#js_pageCover").hide();$(".player_title").html($("#js_init_project_list li.active .project_list_name").html());var z=JSON.parse(A.data.projectcontent);if(z.rootBin.sequence[0].tracks.length===0){$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(C,D){var B={type:$(D).attr("data-type"),index:parseInt($(D).attr("data-index")),subclip:[]};z.rootBin.sequence[0].tracks.push(B)})}var y;if(z.height==="576"){y="SD"}else{if(z.height==="1080"){y="HD"}}PLAYER.OCX.sendProType(y);PLAYER.observer.trigger("projectData",JSON.stringify(z))}else{console.log("error")}}})}});$("#js_modal_initNew").on("click",function(){$("#js_initProjectModal").hide();$("#js_createProjectModal").show();$("#js_modal_createNew").on("click",function(){if($("#js_create_form_name").val()===""){$("#js_create_form_name").val("未命名")}var y=$("#js_create_form_name").val();$.ajax({url:serverUrl+"proj/create",data:{name:y,templateid:$("#js_create_pro_type .form-control").val()},success:function(B){if(B.code===0&&B.data!==null){$("#js_createProjectModal").hide();$("#js_pageCover").hide();$(".player_title").html($("#js_create_form_name").val());var A=JSON.parse(B.data);$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(D,E){var C={type:$(E).attr("data-type"),index:parseInt($(E).attr("data-index")),subclip:[]};A.rootBin.sequence[0].tracks.push(C)});var z=parseInt($("#js_create_pro_type .form-control").val());if(z===1){z="SD"}else{if(z===2){z="HD"}}PLAYER.OCX.sendProType(z);PLAYER.observer.trigger("projectData",JSON.stringify(A))}else{console.log("error")}}})});$("#js_createProjectModal .icojam_delete").on("click",function(){$("#js_initProjectModal").show();$("#js_pageCover").show();$("#js_createProjectModal").hide()})});$.ajax({url:serverUrl+"program/list",data:{"currentPage":1,"pageSize":36,"name":($("#js_programForm_name .form-control").val()||""),"provider":($("#js_programForm_cpspcode .form-control").val()||""),"programType":($("#js_programForm_type .form-control").val()||""),"from":($("#js_programForm_stime .form-control").val()||""),"to":($("#js_programForm_etime .form-control").val()||"")},success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("getProgramList",y.data.list)}else{console.log("error")}}})}});$.ajax({url:serverUrl+"resource/listpage",data:{"currentPage":1,"pageSize":36,"name":"","from":"","to":""},success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("getPageList",y.data)}else{console.log("error")}}});$("#js_programForm_btn").on("click",function(){var y=$("#js_programForm_name .form-control").val()||"";var z=$("#js_programForm_cpspcode .form-control").val()||"";var A=$("#js_programForm_type .form-control").val()||"";var C=$("#js_programForm_stime .form-control").val()||"";var B=$("#js_programForm_etime .form-control").val()||"";$.ajax({url:serverUrl+"program/list",data:{"currentPage":1,"pageSize":36,"name":y,"provider":z,"programType":A,"from":C,"to":B},success:function(D){if(D.code===0&&D.data!==null){PLAYER.observer.trigger("getProgramList",D.data.list);PLAYER.observer.trigger("projectData",JSON.stringify(PLAYER.jsonObj),true)}else{console.log("error")}}})});$.ajax({url:serverUrl+"task/list",data:{"status":parseInt($("#js_status_select").val()),"currentPage":1,"pageSize":20},success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("packbagList",y.data)}else{console.log("error")}}});$("#js_status_btn").on("click",function(){$.ajax({url:serverUrl+"task/list",data:{"status":parseInt($("#js_status_select").val()),"currentPage":1,"pageSize":20},success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("packbagList",y.data)}else{console.log("error")}}})});$("#js_addProgram_btn").on("click",function(){g();$("#js_addProgramModal").show();$("#js_pageCover").show();
$("#js_add_modal_cancelPro, .icojam_delete").on("click",function(){$("#js_addProgramModal").hide();$("#js_pageCover").hide()})});$.ajax({url:serverUrl+"subtitle/list",success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("getSubtitleList",y.data)}else{alert("获取字幕失败")}}});$.ajax({url:serverUrl+"effect/list",success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("getEffectList",y.data)}else{alert("获取特技失败")}}});$("#js_finding").on("click",function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if(PLAYER.model===null&&PLAYER.dbClick&&$("#js_finding").attr("data-id")!==undefined){PLAYER.model=new PLAYER.CreateFacialModal();$.ajax({"url":faceUrl+"/service/getFaceResult","type":"GET","data":{"assetid":$("#js_finding").attr("data-id")},"success":function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("facialList",y.data.data)}else{alert("获取人脸失败")}}})}else{if($("#js_finding").attr("data-id")===undefined){alert("您必选先双击素材！")}else{if(PLAYER.model!==null){alert("您不能重复点击！")}}}});var w=(function(){PLAYER.observer.listen("proList",function(A){z(A.list);function z(C){$("#js_init_project_list").empty();var B='<li class="header">'+"<span>工程名称</span>"+"<span>上次编辑时间</span>"+"<span>版本</span>"+"<span></span>"+"</li>";$("#js_init_project_list").append(B);$.each(C,function(D,G){var F=$('<li data-id="'+G.projectid+'"></li>');var E=$('<span class="project_list_name">'+G.projectname+"</span><span>"+PLAYER.getLocalTime(G.createtime)+"</span><span>v-"+G.version+"</span></span>");F.append(E);$("#js_init_project_list").append(F)})}if(A.list.length>5){$(".project_list_track").show();var y=new Scrollbar({dirSelector:"y",contSelector:$("#js_init_project_list"),barSelector:$(".project_list_track"),sliderSelector:$(".project_list_scroll")})}$("#js_pro_pager").empty();$("#js_pro_pager").Paging({pagesize:20,count:A.totalLines,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(D,B,C){console.log("当前第 "+D+"页,每页 "+B+"条,总页数："+C+"页");$.ajax({url:serverUrl+"proj/list",data:{currentPage:D,pageSize:20},success:function(E){if(E.code===0&&E.data!==null){z(E.data)}else{console.log("error")}}})}})})})();var t=(function(){PLAYER.observer.listen("proTemplate",function(z){var y=$('<select class="form-control" name="templateid">');$.each(z,function(A,C){var B=$('<option value="'+C.templateid+'">'+C.name+"</option>");y.append(B)});$("#js_create_pro_type").append(y)})})();var q=(function(){PLAYER.observer.listen("projectData",function(D){var D=JSON.parse(D);var C;var B=document.getElementById("ocx");var z=B.currentStyle?B.currentStyle:window.getComputedStyle(B,null);var y=parseFloat(z.height);if(D.height==="576"&&D.width==="720"){C=parseFloat(1.25*y);$("#ocx").width(C)}else{C=parseFloat((16*y/9));$("#ocx").width(C)}var A=($(".player").width()-C)/2;if(A<0){A=0}$("#ocx").css("margin-left",A);$("#js_mask").width(C);$("#js_mask").css("left",A)})})();var f=(function(){PLAYER.observer.listen("getAllCpspcode",function(A){var z=$('<select class="form-control" name="cpspcode" >');var y=$('<option value="">全部</option>');z.append(y);$.each(A,function(B,D){var C=$('<option value="'+D.cpspcode+'">'+D.name+"</option>");z.append(C)});$(".program_cpspcode").append(z)})})();var c=(function(){PLAYER.observer.listen("getProgramType",function(A){var z=$('<select class="form-control" name="type">');var y=$('<option value="">全部</option>');z.append(y);$.each(A,function(B,D){var C=$('<option value="'+D.name+'">'+D.name+"</option>");z.append(C)});$(".program_type").append(z)})})();var k=(function(){PLAYER.observer.listen("getProgramList",function(A){z(A);function z(B){$(".meterial_thumbnail_box").empty();$.each(B,function(C,E){var D=$('<div class="col-md-3 col-sm-3 col-lg-3" draggable="true" data-id="'+E.assetid+'" data-test="m'+C+'"><a class="thumbnail"><img src="'+E.thumbnail+'" alt=""  draggable="false"><span class="thumbnail_name" style="bottom:22px;">'+E.name+"</span><span>"+PLAYER.getDurationToString(E.duration)+"</span></a></div>");$("#js_thumbnail_box").append(D)})}if(A.length>8){$(".meterial_thumbnail_box").show();$(".meterial_thumbnail_track").show();var y=new Scrollbar({dirSelector:"y",contSelector:$(".meterial_thumbnail_box"),barSelector:$(".meterial_thumbnail_track"),sliderSelector:$(".meterial_thumbnail_scroll")})}$("#js_pager").empty();$("#js_pager").Paging({pagesize:36,count:A.length,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(D,B,C){$.ajax({url:serverUrl+"program/list",data:{"currentPage":D,"pageSize":36},success:function(E){if(E.code===0&&E.data!==null){z(E.data.list);PLAYER.observer.trigger("projectData",PLAYER.json)}else{console.log("error")}}})}})})})();var s=(function(){PLAYER.observer.listen("getPageList",function(A){z(A);function z(B){$("#js_packageList_box").empty();$.each(B.list,function(C,E){var D=$('<div class="col-md-3 col-sm-3 col-lg-3" draggable="true" data-id="'+E.projid+'" data-test="m'+C+'"><a class="thumbnail"><img  alt=""  draggable="false"><span class="thumbnail_name" style="bottom:0px;">'+E.title+"</span></a></div>");
$("#js_packageList_box").append(D)})}if(A.totalLines>8){$(".packageList_thumbnail_box").show();$(".packageList_thumbnail_track").show();var y=new Scrollbar({dirSelector:"y",contSelector:$(".packageList_thumbnail_box"),barSelector:$(".packageList_thumbnail_track"),sliderSelector:$(".packageList_thumbnail_scroll")})}$("#js_pager2").empty();$("#js_pager2").Paging({pagesize:36,count:A.totalLines,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(D,B,C){$.ajax({url:serverUrl+"resource/listpage",data:{"currentPage":D,"pageSize":36,"name":"","from":"","to":""},success:function(E){if(E.code===0&&E.data!==null){z(E.data);PLAYER.observer.trigger("projectData",PLAYER.json)}else{console.log("error")}}})}})})})();var u=(function(){PLAYER.observer.listen("proList",function(A){z(A.list);function z(C){$("#js_edit_project_list").empty();var B='<li class="header">'+"<span>工程名称</span>"+"<span>上次编辑时间</span>"+"<span>状态</span>"+"<span></span>"+"</li>";$("#js_edit_project_list").append(B);$.each(C,function(D,G){var F=$('<li data-id="'+G.projectid+'"></li>');var E=$('<span class="project_list_name">'+G.projectname+"</span><span>"+PLAYER.getLocalTime(G.createtime)+"</span><span>↓"+G.version+'</span><span class="glyphicon glyphicon-remove project_delete" data-id="'+G.id+'"></span>');F.append(E);$("#js_edit_project_list").append(F)})}if(A.list.length>5){$(".project_edit_list_track").show();var y=new Scrollbar({dirSelector:"y",contSelector:$("#js_edit_project_list"),barSelector:$(".project_edit_list_track"),sliderSelector:$(".project_edit_list_scroll")})}$("#js_pro_edit_pager").empty();$("#js_pro_edit_pager").Paging({pagesize:20,count:A.totalLines,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(D,B,C){console.log("当前第 "+D+"页,每页 "+B+"条,总页数："+C+"页");$.ajax({url:serverUrl+"proj/list",data:{currentPage:D,pageSize:20},success:function(E){if(E.code===0&&E.data!==null){z(E.data)}else{console.log("error")}}})}})})})();var n=(function(){PLAYER.observer.listen("packbagList",function(A){y(A);function z(B){var B;if(B===0){B="待处理"}else{if(B===1){B="处理中"}else{if(B===2){B="完成"}else{if(B===3){B="出错"}}}}return B}function y(C){$("#js_export_list").empty();var B=$('<li class="header">'+"<span>名称</span>"+"<span>创建时间</span>"+"<span>结束时间</span>"+"<span>进度</span>"+"<span>状态</span>"+"<span>备注</span>"+"</li>");$("#js_export_list").append(B);$.each(C,function(E,G){var F=$("<li>");var D=$('<a href="javascript:;"  class="name"><span>'+G.title+"</span></a>"+'<a href="javascript:;"  class="createTime"><span>'+PLAYER.getLocalTime(G.createtime)+"</span></a>"+'<a href="javascript:;"  class="createTime"><span>'+PLAYER.getLocalTime(G.stoptime)+"</span></a>"+'<a href="javascript:;"  class="progressBox"><span><div class="progress progress-mini" title="当前进度'+G.progress+'%">'+'<div style="width:'+G.progress+'%;" class="progress-bar"></div>'+"</div></span></a>"+'<a href="javascript:;"  class="state"><span>'+z(G.flag)+"</span></a>"+'<a href="javascript:;" ><span>'+G.last_err+"</span></a>");F.append(D);$("#js_export_list").append(F)})}$("#js_pager_export").empty();$("#js_pager_export").Paging({pagesize:20,count:A.length,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(D,B,C){$.ajax({url:serverUrl+"program/list",data:{"currentPage":D,"pageSize":20,"status":parseInt($("#js_status_select").val())},success:function(E){if(E.code===0&&E.data!==null){y(E.data)}else{console.log("error")}}})}})})})();var d=(function(){PLAYER.observer.listen("facialList",function(A){if(A.length!==0){z(A);function z(B){$("#js_createfacialModal #js_facial_box").empty();$.each(B,function(C,E){var D=$('<div class="facial_list">'+"<img src="+E.httpPath+' data-frame="'+E.startTime+'"/>'+'<span class="facial_description">'+E.name+"</span>"+'<span class="pull-right">'+PLAYER.getDurationToString(E.startTime)+"</span>"+"</div>");$("#js_createfacialModal #js_facial_box").append(D)})}$(".facial_list_track").show();var y=new Scrollbar({dirSelector:"y",contSelector:$("#js_facial_box"),barSelector:$(".facial_list_track"),sliderSelector:$(".facial_list_scroll")});$(".facial_list").on("click",function(B){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if($(B.target).attr("data-frame")!==undefined){$(B.target).addClass("active");$(B.target).parent().siblings().children("img").removeClass("active");var C=parseInt($(B.target).attr("data-frame"));PLAYER.OCX.seek(C);PLAYER.PTR.fixArrowCurrentTime(C)}})}else{alert("视频分析失败！")}})})();var o=function(z){PLAYER.checkPlaying();var y=l();$("#js_modal_savePro").attr("data-type",z);y.show();$("#js_pageCover").show();$("#js_saveProjectModal #js_modal_cancelPro").off().click(function(){y.hide();$("#js_pageCover").hide()});$("#js_saveProjectModal .icojam_delete").off().click(function(){y.hide();$("#js_pageCover").hide()});$("#js_modal_savePro").off().click(function(){var A=PLAYER.operateJson.translateFfpToMS(JSON.stringify(PLAYER.jsonObj));$.ajax({url:serverUrl+"proj/update",data:{projectid:PLAYER.jsonObj.id,html:"",content:JSON.stringify(A)},success:function(B){if(B.code===0&&B.data!==null){$("#js_saveProjectModal").hide();
$("#js_pageCover").hide();PLAYER.observer.trigger("saveProModal",true,$("#js_modal_savePro").attr("data-type"))}else{console.log("error")}}})})};$("#js_saveProject").click(function(){o("savepro");PLAYER.observer.listen("saveProModal",function(z,y){if(z&&(y==="savepro")){$("#js_saveProjectModal").hide();$("#js_pageCover").hide();$("#js_modal_savePro").attr("data-type","")}})});$("#js_newProject").on("click",function(){o("newpro");PLAYER.observer.listen("saveProModal",function(z,y){if(z&&(y==="newpro")){$("#js_saveProjectModal").hide();$("#js_pageCover").hide();$("#js_modal_savePro").attr("data-type","");location.href=enterUrl}})});$("#js_openProject").on("click",function(){o("editpro");PLAYER.observer.listen("saveProModal",function(z,y){if(z&&(y==="editpro")){j();$("#js_modal_savePro").attr("data-type","");$("#js_saveProjectModal").hide();$("#js_pageCover").show();$("#js_editProjectModal").show();$("#js_editProjectModal .icojam_delete").on("click",function(){$("#js_editProjectModal").hide();$("#js_pageCover").hide()});$("#js_edit_project_list").delegate($("#js_edit_project_list").children(),"selectstart",function(){return false});$("#js_edit_project_list").delegate(".project_delete","click",function(){var A=confirm("确定删除吗?");if(A){var B=$(this).parent("li").attr("data-id");var C=$(this).parent("li").find(".project_list_name").html();if(B===PLAYER.jsonObj.id){alert("您不能删除当前工程！")}else{$(this).parent("li").remove();$.ajax({url:serverUrl+"proj/delete",data:{id:B},success:function(D){if(D.code===0&&D.data!==null){$.ajax({url:serverUrl+"proj/list",data:{currentPage:1,pageSize:20},success:function(E){if(E.code===0&&E.data!==null){alert("删除:"+C+"成功!");PLAYER.observer.trigger("proList",E.data)}else{console.log("error")}}})}else{console.log("error")}}})}}else{return false}})}})});$("#js_exportProject").on("click",function(){o("exportpro");PLAYER.observer.listen("saveProModal",function(z,y){if(z&&(y==="exportpro")){if($(".time_ruler_bar").children().length>0){$("#js_saveProjectModal").hide();$("#js_pageCover").show();v();PLAYER.TR.DragDrop.disable();PLAYER.PTR.DragDrop.disable();PLAYER.documentEvent.enable();$.ajax({url:serverUrl+"task/schema",success:function(A){if(A.code===0&&A.data!==null){$("#js_export_form_schema").empty();$.each(A.data,function(C,D){var B=$('<option value="'+D.name+'">'+D.name+"</option>");$("#js_export_form_schema").append(B)});$("#js_exportProjectModal").show()}else{console.log("error")}}});$("#js_exportProjectModal .icojam_delete").off().click(function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide();PLAYER.TR.DragDrop.enable();PLAYER.PTR.DragDrop.enable();PLAYER.documentEvent.enable()});$("#js_export_modal_cancelPro").off().click(function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide();PLAYER.TR.DragDrop.enable();PLAYER.PTR.DragDrop.enable();PLAYER.documentEvent.enable()});$("#js_modal_export").off().click(function(){var G=$("#js_export_form_schema").val();var B=$("#js_export_form_name").val()?$("#js_export_form_name").val():"打包文件";var E=$("#js_export_form_check").prop("checked");var F=C();var D=A();function C(){if(E){return parseInt(PLAYER.operateJson.getFirstFrame())}else{return parseInt(PLAYER.TR.trimInCurrTime)}}function A(){if(E){return parseInt(PLAYER.operateJson.getLastFrame())}else{return parseInt(PLAYER.TR.trimOutCurrTime)}}if(!D){alert("您必须打入出入点或者选择整个序列")}else{$.ajax({url:serverUrl+"task/send",data:{projectid:PLAYER.jsonObj.id,name:B,trimin:F*40,trimout:D*40,packschema:G},success:function(H){if(H.code===0&&H.data!==null){console.log("打包成功",H.data);$("#js_exportProjectModal").hide();$("#js_pageCover").hide();$.ajax({url:serverUrl+"task/list",data:{"status":parseInt($("#js_status_select").val()),"currentPage":1,"pageSize":20},success:function(I){if(I.code===0&&I.data!==null){PLAYER.observer.trigger("packbagList",I.data)}else{console.log("error")}}})}else{console.log("error")}}})}})}else{alert("没有任何素材供打包！")}}})});$("#js_status_select").on("change",function(){console.log("ggg",$(e.target).val());$.ajax({url:serverUrl+"task/list",data:{"status":parseInt($("#js_status_select").val()),"currentPage":1,"pageSize":20},success:function(y){if(y.code===0&&y.data!==null){PLAYER.observer.trigger("packbagList",y.data)}else{console.log("error")}}})});PLAYER.EventUtil.addHandler(document,"keydown",function(){var z=PLAYER.EventUtil.getEvent(z);var y=PLAYER.EventUtil.getKeyCode(z);if(z.ctrlKey&&y===83){PLAYER.EventUtil.preventDefault(z);o();PLAYER.observer.listen("saveProModal",function(A){if(A){$("#js_saveProjectModal").hide();$("#js_pageCover").hide()}})}else{if(z.ctrlKey&&y===78){PLAYER.EventUtil.preventDefault(z);o();PLAYER.observer.listen("saveProModal",function(A){if(A){$("#js_saveProjectModal").hide();$("#js_pageCover").hide();location.href=enterUrl}})}else{if(z.ctrlKey&&y===79){PLAYER.EventUtil.preventDefault(z);o();PLAYER.observer.listen("saveProModal",function(A){if(A){j();$("#js_saveProjectModal").hide();$("#js_pageCover").show();$("#js_editProjectModal").show();$("#js_editProjectModal .icojam_delete").on("click",function(){$("#js_editProjectModal").hide();
$("#js_pageCover").hide()});$("#js_edit_project_list").delegate($("#js_edit_project_list").children(),"selectstart",function(){return false});$("#js_edit_project_list").delegate(".project_delete","click",function(){var B=confirm("确定删除吗?");if(B){var C=$(this).parent("li").attr("data-id");var D=$(this).parent("li").find(".project_list_name").html();if(C===PLAYER.jsonObj.id){alert("您不能删除当前工程！")}else{$(this).parent("li").remove();$.ajax({url:serverUrl+"proj/delete",data:{id:C},success:function(E){if(E.code===0&&E.data!==null){$.ajax({url:serverUrl+"proj/list",data:{currentPage:1,pageSize:20},success:function(F){if(F.code===0&&F.data!==null){alert("删除:"+D+"成功!");PLAYER.observer.trigger("proList",F.data)}else{console.log("error")}}})}else{console.log("error")}}})}}else{return false}})}})}else{if(z.ctrlKey&&y===66){PLAYER.EventUtil.preventDefault(z);o();PLAYER.observer.listen("saveProModal",function(A){if(A){if($(".time_ruler_bar").children().length>0){$("#js_saveProjectModal").hide();$("#js_pageCover").show();v();PLAYER.TR.DragDrop.disable();PLAYER.PTR.DragDrop.disable();PLAYER.documentEvent.enable();$.ajax({url:serverUrl+"task/schema",success:function(B){if(B.code===0&&B.data!==null){$("#js_export_form_schema").empty();$.each(B.data,function(D,E){var C=$('<option value="'+E.name+'">'+E.name+"</option>");$("#js_export_form_schema").append(C)})}else{console.log("error")}}});$("#js_exportProjectModal").show();$("#js_exportProjectModal .icojam_delete").on("click",function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide();PLAYER.TR.DragDrop.enable();PLAYER.PTR.DragDrop.enable();PLAYER.documentEvent.enable()});$("#js_export_modal_cancelPro").on("click",function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide();PLAYER.TR.DragDrop.enable();PLAYER.PTR.DragDrop.enable();PLAYER.documentEvent.enable()});$("#js_modal_export").on("click",function(){var H=$("#js_export_form_schema").val();var C=$("#js_export_form_name").val()?$("#js_export_form_name").val():"打包文件";var F=$("#js_export_form_check").prop("checked");var G=D();var E=B();function D(){if(F){return parseInt(PLAYER.operateJson.getFirstFrame())}else{return parseInt(PLAYER.TR.trimInCurrTime)}}function B(){if(F){return parseInt(PLAYER.operateJson.getLastFrame())}else{return parseInt(PLAYER.TR.trimOutCurrTime)}}if(!E){alert("您必须打入出入点或者选择整个序列")}else{$.ajax({url:serverUrl+"task/send",data:{projectid:PLAYER.jsonObj.id,name:C,trimin:G,trimout:E,packschema:H},success:function(I){if(I.code===0&&I.data!==null){console.log("打包成功",I.data);$("#js_exportProjectModal").hide();$("#js_pageCover").hide();$.ajax({url:serverUrl+"task/list",data:{"status":parseInt($("#js_status_select").val()),"currentPage":1,"pageSize":20},success:function(J){if(J.code===0&&J.data!==null){PLAYER.observer.trigger("packbagList",J.data)}else{console.log("error")}}})}else{console.log("error")}}})}})}else{alert("没有任何素材供打包！")}}})}}}}});var a=(function(){PLAYER.observer.listen("projectData",function(C){document.onselectstart=function(E){if(E.srcElement.tagName==="input"||E.srcElement.tagName==="INPUT"||E.srcElement.tagName==="textarea"||E.srcElement.tagName==="TEXTAREA"){return true}else{return false}};var B,y,A;if(PLAYER.jsonObj===null){PLAYER.jsonObj=JSON.parse(C)}$("#js_effect_wrap").delegate(".effect_fadeInOut,.effect_flashBlack,.effect_flashWhite,.effect_mosaic","mousedown",function(E){E.preventDefault();PLAYER.checkPlaying();$(E.target).parent("li").siblings().children(".effect_list").removeClass("active");$(E.target).addClass("active");y=false;A=$(E.target).attr("data-effect");B=null;$(document)[0].onmousemove=function(F){var F=F||window.event;y=true;console.log("e",A);if(A==="mosaic"){PLAYER.observer.trigger("move_effect_mosaic",F)}else{PLAYER.observer.trigger("move_effect",F)}};$(document)[0].onmouseup=function(F){if(y){PLAYER.observer.trigger("up_effect",F,A);y=false}$(document)[0].onmousemove=null;B=null}});var D=(function(){var G,M,I,N,L,H,E,J;PLAYER.observer.listen("move_effect_mosaic",function(P){var O=P.clientX;var Q=P.clientY;K(O,Q)});PLAYER.observer.listen("move_effect",function(P){var O=P.clientX;var Q=P.clientY;F(O,Q)});function F(O,P){if($("#js_time_ruler_bar_box").find(".edit_box_v").length<=0){return false}$("#js_time_ruler_bar_box").find(".edit_box_v").each(function(R,S){var Q=$(this);G=Q.offset().left;M=Q.width();I=Q.height();N=Q.offset().top+3;L=parseInt(Q.attr("data-sequencetrimin"));H=parseInt(Q.attr("data-sequencetrimout"));if(O>=G&&O<=(G+15)&&P>=N&&P<=(P+I)){Q.addClass("effectActive");Q.prevSubclip=PLAYER.operateJson.checkPrevSubClip(L);if(!Q.prevSubclip){Q.effectPos="header"}else{Q.prevSubclip.addClass("effectActive");Q.effectPos="prev_middle"}B=Q}else{if(O>=(G+M-20)&&O<=(G+M)&&P>=N&&P<=(P+I)){Q.addClass("effectActive");Q.nextSubclip=PLAYER.operateJson.checkNextSubClip(H);if(!Q.nextSubclip){Q.effectPos="footer"}else{Q.nextSubclip.addClass("effectActive2");Q.effectPos="next_middle"}B=Q}else{Q.removeClass("effectActive");if(Q.prevSubclip){Q.prevSubclip.removeClass("effectActive")
}if(Q.nextSubclip){Q.nextSubclip.removeClass("effectActive2")}}}})}function K(O,P){if($("#js_time_ruler_bar_box").find(".edit_box_v").length<=0){return false}$("#js_time_ruler_bar_box").find(".edit_box_v").each(function(R,S){var Q=$(this);G=Q.offset().left;M=Q.width();I=Q.height();N=Q.offset().top+3;if(O>=G&&O<=(G+M)&&P>=N&&P<=(P+I)){if(Q.find(".effect_box_all").length>0){return false}else{Q.addClass("effectActive");Q.effectPos="all";B=Q}}else{Q.removeClass("effectActive")}})}})();var z=(function(){PLAYER.observer.listen("up_effect",function(G,F){if(B===null){return}B.removeClass("effectActive");if(B.prevSubclip){B.prevSubclip.removeClass("effectActive")}else{if(B.nextSubclip){B.nextSubclip.removeClass("effectActive2")}}E(B,F);console.log("增加特技",PLAYER.jsonObj.rootBin.sequence[0].tracks);PLAYER.operateJson.sendJson()});function E(H,J){var Z=parseInt(H.css("left"));var K=parseInt(H.width());var V=parseFloat(25/PLAYER.TR.config.framePerPixel);var M=parseInt(H.attr("data-trimin"));var W=parseInt(H.attr("data-trimout"));function I(ag,ak,af,aj,al){var ai={type:ag,trimIn:ak,trimOut:af,duration:aj,attr:{},pos:al};if(ag==="mosaic"){var ah={attr:{x1:0,y1:0,width:0.2*$("#ocx").width(),height:0.2*$("#ocx").height(),sizex:100,sizey:100}};$.extend(ai,ah)}return ai}if(J!=="mosaic"&&H.effectPos==="header"){if(H.find(".effect_box_l").length>0){return false}var U=$('<div class="effect_box effect_box_l"></div>');var X=M;var N=(M+25);U.attr("data-trimin",X);U.attr("data-type",J);U.attr("data-trimout",N);U.attr("data-duration",25);U.attr("data-pos","header");U.css("width",V);H.append(U);var L=H.attr("data-time");var ad=I(J,X,N,25,"header");PLAYER.operateJson.addEffectClip(L,ad)}else{if(J!=="mosaic"&&H.effectPos==="footer"){if(H.find(".effect_box_r").length>0){return false}var U=$('<div class="effect_box effect_box_r"></div>');var X=(W-25);var N=W;U.attr("data-trimin",X);U.attr("data-trimout",N);U.attr("data-duration",25);U.attr("data-pos","footer");U.css("width",V);U.attr("data-type",J);H.append(U);var L=H.attr("data-time");var ad=I(J,X,N,25,"footer");PLAYER.operateJson.addEffectClip(L,ad)}else{if(J!=="mosaic"&&H.effectPos==="prev_middle"){if(H.find(".effect_box_l").length>0){return false}if(H.prevSubclip.find(".effect_box_r").length>0){return false}var ab=parseInt(H.prevSubclip.attr("data-trimout"));var G=$('<div class="effect_box effect_box_l"></div>');var ae=$('<div class="effect_box effect_box_r"></div>');var ac=M;var T=M+25;var P=ab-25;var S=ab;var F=50;G.attr("data-trimin",ac);G.attr("data-trimout",T);G.attr("data-duration",F);G.css("width",V);G.attr("data-pos","header-middle");G.attr("data-type",J);ae.attr("data-trimin",P);ae.attr("data-trimout",S);ae.attr("data-duration",F);ae.css("width",V);ae.attr("data-pos","footer-middle");ae.attr("data-type",J);H.append(G);H.prevSubclip.append(ae);var aa=H.attr("data-time");var R=I(J,ac,T,F,"header-middle");PLAYER.operateJson.addEffectClip(aa,R);var Y=H.prevSubclip.attr("data-time");var O=I(J,P,S,F,"footer-middle");PLAYER.operateJson.addEffectClip(Y,O)}else{if(J!=="mosaic"&&H.effectPos==="next_middle"){if(H.find(".effect_box_r").length>0){return false}if(H.nextSubclip.find(".effect_box_l").length>0){return false}var Q=parseInt(H.nextSubclip.attr("data-trimin"));var G=$('<div class="effect_box effect_box_r"></div>');var ae=$('<div class="effect_box effect_box_l"></div>');console.log("effectBox1",G);var ac=(W-25);var T=W;var P=Q;var S=Q+25;var F=50;G.attr("data-trimin",ac);G.attr("data-trimout",T);G.attr("data-duration",F);G.css("width",V);G.attr("data-pos","footer-middle");G.attr("data-type",J);ae.attr("data-trimin",P);ae.attr("data-trimout",S);ae.attr("data-duration",F);ae.css("width",V);ae.attr("data-pos","header-middle");ae.attr("data-type",J);H.append(G);H.nextSubclip.append(ae);var aa=H.attr("data-time");var R=I(J,ac,T,F,"footer-middle");PLAYER.operateJson.addEffectClip(aa,R);var Y=H.nextSubclip.attr("data-time");var O=I(J,P,S,F,"header-middle");PLAYER.operateJson.addEffectClip(Y,O)}else{if(J==="mosaic"&&H.effectPos==="all"){var U=$('<div class="effect_box effect_box_all"></div>');var X=M;var N=W;U.attr("data-trimin",X);U.attr("data-trimout",N);U.attr("data-duration",(W-M));U.css("width",K);U.attr("data-pos","all");U.attr("data-type",J);H.append(U);var L=H.attr("data-time");var ad=I(J,X,N,(W-M),"all");PLAYER.operateJson.addEffectClip(L,ad)}}}}}return H}})()})})();var p=(function(){PLAYER.observer.listen("projectData",function(D,F){if(!F){if(JSON.parse(D).reference.material.length===0){return false}else{var D=PLAYER.operateJson.translateMsToFfp(D);var C=document.getElementById("ocx");var J=C.currentStyle?C.currentStyle:window.getComputedStyle(C,null);var z=parseFloat(J.height);var B;if(D.height==="576"&&D.width==="720"){B=parseFloat(1.25*z);$("#ocx").width(B)}else{B=parseFloat((16*z/9));$("#ocx").width(B)}var y=($(".player").width()-B)/2;if(y<0){y=0}$("#ocx").css("margin-left",y);PLAYER.jsonObj=PLAYER.operateJson.checkNewWindow(JSON.stringify(D),z,B);PLAYER.jsonObj.pHeight=z;PLAYER.jsonObj.pWidth=B;
console.log("重新打开工程",PLAYER.jsonObj);PLAYER.TR.config.maxTime=PLAYER.jsonObj.rootBin.sequence[0].maxDuration;PLAYER.TR.updateEvent(PLAYER.jsonObj.rootBin.sequence[0].maxDuration,true);for(var E=0;E<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;E++){var A=PLAYER.jsonObj.rootBin.sequence[0].tracks[E];var I=A.type;var G=A.index;PLAYER.operateJson.sortClipAttr();var H=PLAYER.operateJson.getTrack(I,G);if(A.subclip.length!==0){$.each(A.subclip,function(Q,N){var O;var L;var U=N.assetID||N.id;PLAYER.operateJson.getMaterialDuration(U,function(W){O=parseInt(W.duration);L=W.name});var K=(N.trimOut-N.trimIn)/PLAYER.TR.config.framePerPixel;var V=N.sequenceTrimIn/PLAYER.TR.config.framePerPixel;var M=$('<div class="edit_box draggable" data-trimin="'+N.trimIn+'" data-trimout="'+N.trimOut+'" data-sequencetrimin="'+N.sequenceTrimIn+'" data-sequencetrimout="'+N.sequenceTrimOut+'">'+L+"</div>");M.attr("data-duration",O||2000);M.attr("data-name",L);M.attr("data-id",N.assetID||N.id);M.attr("data-type",N.type);M.attr("data-interleaved",N.interleaved);M.attr("data-time",N.createTime);M.css("width",K);M.css("left",V);M.attr("data-intid",N.interleaved_id);var S="edit_box_"+H.attr("data-type");M.addClass(S);if(N.effect&&N.effect.length!==0){var R;var P;var T;$.each(N.effect,function(W,X){P=$('<div class="effect_box"></div>');P.attr("data-duration",X.duration);P.attr("data-trimin",X.trimIn);P.attr("data-trimout",X.trimOut);T=(X.trimOut-X.trimIn)/PLAYER.TR.config.framePerPixel;P.width(T);if(X.type==="mosaic"){P.addClass("effect_box_all")}else{if(X.trimOut===N.trimOut){P.addClass("effect_box_r")}else{if(X.trimIn===N.trimIn){P.addClass("effect_box_l")}}}M.append(P)})}H.append(M)})}}PLAYER.operateJson.sendJson()}}})})();var x=(function(){PLAYER.observer.listen("projectData",function(z){var y=null;if(PLAYER.jsonObj===null){PLAYER.jsonObj=JSON.parse(z)}$("#js_add_groupProgram").on("click",function(){PLAYER.checkPlaying();var D=[];for(var B=0;B<PLAYER.chooseArray.length;B++){$.ajax({url:serverUrl+"program/info",async:false,data:{assetId:PLAYER.chooseArray[B],jobId:PLAYER.jobId},success:function(F){if(F.code===0&&F.data!==null){F.data.assetId=PLAYER.chooseArray[B];F.data.duration=parseInt(F.data.duration);D.push(F.data);if(D.length===PLAYER.chooseArray.length){E(D);A()}}else{console.log("error")}}})}function C(J){var G=this;var I;for(var H=0,F;F=PLAYER.jsonObj.rootBin.sequence[0].tracks[H++];){if(F.subclip.length===0){PLAYER.TR.config.maxTime=J+15000;PLAYER.TR.updateEvent(J+15000,true);I=J/PLAYER.TR.config.framePerPixel}else{I=J/PLAYER.TR.config.framePerPixel}}return I}function E(W){var U,V=1,I,G,H,S,M,N,P=PLAYER.TR.currTime,R,F,O;console.log("program_info",W);for(var T=0;T<W.length;T++){F="video_"+T+PLAYER.genNonDuplicateID(12);O="audio_"+T+PLAYER.genNonDuplicateID(12);G="interleaved_id_"+T+PLAYER.genNonDuplicateID(12);S=0;M=W[T].duration;P+=W[T].duration;N=P-W[T].duration;H=W[T].duration;R=W[T].name;U=N/PLAYER.TR.config.framePerPixel;_id=W[T].assetId;I=W[T].duration/PLAYER.TR.config.framePerPixel;var L=$('<div class="edit_box edit_box_v draggable" data-trimin="'+S+'" data-trimout="'+M+'" data-sequencetrimin="'+N+'" data-sequencetrimout="'+P+'">'+R+"</div>");var J=$('<div class="edit_box edit_box_a draggable" data-trimin="'+S+'" data-trimout="'+M+'" data-sequencetrimin="'+N+'" data-sequencetrimout="'+P+'">'+R+"</div>");L.attr("data-time",F);L.attr("data-interleaved","true");L.attr("data-type","video_and_audio");L.attr("data-intid",G);L.attr("data-duration",H);L.attr("data-id",_id);L.attr("data-name",R);L.css("left",U);L.css("width",I);J.attr("data-time",O);J.attr("data-interleaved","true");J.attr("data-type","video_and_audio");J.attr("data-intid",G);J.attr("data-duration",H);J.attr("data-id",_id);J.attr("data-name",R);J.css("left",U);J.css("width",I);$('.bar_v[data-index="1"]').append(L);$('.bar_a[data-index="1"]').append(J);var Q={"assetID":_id,"name":R,"trimIn":S,"trimOut":M,"sequenceTrimIn":N,"sequenceTrimOut":P,"createTime":F,"interleaved":true,"interleaved_id":G,"effect":[]};var K={"assetID":_id,"name":R,"trimIn":S,"trimOut":M,"createTime":O,"sequenceTrimIn":N,"sequenceTrimOut":P,"interleaved":true,"interleaved_id":G,"volume":100};if($(".bar_v").children().length>=1){PLAYER.operateJson.checkCoverEvent(L)}if($(".bar_a").children().length>=1){PLAYER.operateJson.checkCoverEvent(J)}PLAYER.operateJson.addVideoClipAttr(Q,V);PLAYER.operateJson.addAudioClipAttr(K,V);PLAYER.operateJson.addProjectMaterial(W[T])}}function A(){$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()));var F=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15000);PLAYER.TR.updateEvent(F);PLAYER.TR.fixClipWidth();PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame();PLAYER.PTR.updateEvent(PLAYER.PTR.config);PLAYER.operateJson.sendJson();PLAYER.chooseArray=[];$("#js_thumbnail_box .col-md-3").removeClass("active")}})})})();(function(B,A,z){function y(C){this._init(C)}z.extend(y.prototype,{_init:function(D){var C=this;
C.options={type:"",cont:""};z.extend(true,C.options,D||{});C._initDom();return C},_initDom:function(){var C=this;this.$type=this.options.type;this.$cont=this.options.cont;this.$doc=z(A);this._initSliderDragEvent();if(this.$type===""){throw new Error("您必须输入拖拽的素材类型")}if(this.$cont===""){throw new Error("您必须输入拖拽的素材")}if(this.$type==="video_and_audio"){this._down_video_and_audio()._move_video_and_audio()._up_video_and_audio()}else{if(this.$type==="video"){this._down_video()._move_video()._up_video()}else{if(this.$type==="audio"){this._down_audio()._move_audio()._up_audio()}else{if(this.$type==="subtitle"){this._down_subtitle()._move_subtitle()._up_subtitle()}}}}},_initSliderDragEvent:function(){var D=this;var E=this.$doc;var C=false;if(D.$cont){D.$cont.delegate(D.$cont.children(),"mousedown",function(I){I.preventDefault();PLAYER.checkPlaying();PLAYER.hideSubititleEdit();PLAYER.hideEffectEdit();if(z("#js_time_ruler_bar_box").find(".edit_box").length===0){PLAYER.initDrag=true}else{PLAYER.initDrag=false}C=false;if(D.$type==="video_and_audio"){if(!z(I.target).parents().hasClass("col-md-3")){return false}var H=z(I.target).parents(".col-md-3");var G=H.attr("data-id");z.ajax({url:serverUrl+"program/info",data:{assetId:G,jobId:PLAYER.jobId},success:function(K){if(K.code===0&&K.data!==null){materialAttr=K.data;materialAttr.assetId=G;materialAttr.duration=parseInt(K.data.duration);PLAYER.observer.trigger("_down_"+D.$type,I,materialAttr)}else{console.log("error")}}})}else{if(D.$type==="video"){var H=z(I.target);H.addClass("active");H.siblings().removeClass("active");materialAttr={assetId:"e"+Math.random(),duration:50,filePath:H.attr("data-http"),name:H.siblings("span").html()};PLAYER.observer.trigger("_down_"+D.$type,I,materialAttr)}else{if(D.$type==="audio"){var H=z(I.target);H.addClass("active");H.siblings().removeClass("active");materialAttr={assetId:"e"+Math.random(),duration:1000,filePath:H.attr("data-http"),name:H.siblings("span").html()};PLAYER.observer.trigger("_down_"+D.$type,I,materialAttr)}else{if(D.$type==="subtitle"){var H=z(I.target);H.addClass("active");H.siblings().removeClass("active");var G=H.attr("data-temid");var F=JSON.parse(PLAYER.operateJson.getSubtitleTemp(G));if(F){PLAYER.observer.trigger("_down_"+D.$type,I,F)}}}}}E.on("mousemove.slider",J).on("mouseup.slider",function(K){E.off(".slider");PLAYER.observer.trigger("_up_"+D.$type,K,C);C=false});function J(K){C=true;PLAYER.observer.trigger("_move_"+D.$type,K,C)}})}return D},_down_video_and_audio:function(){var C=this;PLAYER.observer.listen("_down_video_and_audio",function(F,E){C.materialAttr=E;var D=function(){C._addVideoClip(F,E);C._addAudioClip(F,E)};PLAYER.singelton(D)()});return C},_move_video_and_audio:function(){var C=this;PLAYER.observer.listen("_move_video_and_audio",function(F,E){var D=F.clientX;var G=F.clientY;C.moveObj=C._calTimerRulerRrea(D,G,"video_and_audio")});return C},_up_video_and_audio:function(){var C=this;PLAYER.observer.listen("_up_video_and_audio",function(I,E){if(!E){z("#js_time_ruler_bar_box .draghelper").remove();return false}else{var G="interleaved_id_"+PLAYER.genNonDuplicateID(12);var H="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);if(C.$type==="video_and_audio"){var F=C._updateVideoClip(I,"video_and_audio",G,H);var D=C._updateAudioClip(I,"video_and_audio",G,H);if(F&&D){PLAYER.operateJson.addVideoClipAttr(F.clipAttr,F._index);PLAYER.operateJson.addAudioClipAttr(D.clipAttr,D._index);C._updateJsonAttr()}}}});return C},_down_video:function(){var C=this;PLAYER.observer.listen("_down_video",function(G,E){C.materialAttr=E;var D=function(){C._addVideoClip(G,E)};var F=PLAYER.singelton(D)()});return C},_move_video:function(){var C=this;PLAYER.observer.listen("_move_video",function(E){var D=E.clientX;var F=E.clientY;C.moveObj=C._calTimerRulerRrea(D,F,"video")});return C},_up_video:function(){var C=this;PLAYER.observer.listen("_up_video",function(G,D){if(!D){z("#js_time_ruler_bar_box .draghelper").remove();return false}else{if(C.$type==="video"){var F="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);var E=C._updateVideoClip(G,"video","",F);if(E){PLAYER.operateJson.addVideoClipAttr(E.clipAttr,E._index);C._updateJsonAttr()}}}});return C},_down_audio:function(){var C=this;PLAYER.observer.listen("_down_audio",function(G,E){C.materialAttr=E;var D=function(){C._addAudioClip(G,E)};var F=PLAYER.singelton(D)()});return C},_move_audio:function(){var C=this;PLAYER.observer.listen("_move_audio",function(E){var D=E.clientX;var F=E.clientY;C.moveObj=C._calTimerRulerRrea(D,F,"audio")});return C},_up_audio:function(){var C=this;PLAYER.observer.listen("_up_audio",function(G,E){if(!E){z("#js_time_ruler_bar_box .draghelper").remove();return false}else{if(C.$type==="audio"){var F="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);var D=C._updateAudioClip(G,"audio","",F);if(D){PLAYER.operateJson.addAudioClipAttr(D.clipAttr,D._index);C._updateJsonAttr()}}}});return C},_down_subtitle:function(){var C=this;PLAYER.observer.listen("_down_subtitle",function(G,E){C.materialAttr=E;
var D=function(){C._addSubtitleClip(G,E)};var F=PLAYER.singelton(D)()});return C},_move_subtitle:function(){var C=this;PLAYER.observer.listen("_move_subtitle",function(E){var D=E.clientX;var F=E.clientY;C.moveObj=C._calTimerRulerRrea(D,F,"subtitle")});return C},_up_subtitle:function(){var C=this;PLAYER.observer.listen("_up_subtitle",function(F,D){if(!D){z("#js_time_ruler_bar_box .draghelper").remove();return false}else{if(C.$type==="subtitle"){var E="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);var G=C._updateSubtitleClip(F,"subtitle",E);if(G){PLAYER.operateJson.addSubtitleClipAttr(G.clipAttr,G._index);C._updateJsonAttr()}}}});return C},_addVideoClip:function(E,K){var J=this;var I;var F=0;var H=K.duration;var C=parseInt(E.clientX*PLAYER.TR.config.framePerPixel);var D=K.duration+C;var G=J._calculateWidth(K.duration);z.each(z("#js_time_ruler_bar_box .bar_v"),function(L,M){I=z('<div class="edit_box edit_box_v draggable draghelper">'+K.name+"</div>");I.attr("data-duration",K.duration);I.attr("data-name",K.name);I.attr("data-id",K.assetId);I.css("left",E.clientX);I.css("width",G);I.attr("data-trimin",F);I.attr("data-trimout",H);I.attr("data-sequencetrimin",C);I.attr("data-sequencetrimout",D);z(M).append(I);_duration=parseInt(z(M).children(".draghelper").attr("data-duration"));_left=parseInt(z(M).children(".draghelper").css("left"))});return J},_addAudioClip:function(E,K){var J=this;var I;var F=0;var H=K.duration;var C=parseInt(E.clientX*PLAYER.TR.config.framePerPixel);var D=K.duration+C;var G=J._calculateWidth(K.duration);z.each(z("#js_time_ruler_bar_box .bar_a"),function(L,M){I=z('<div class="edit_box edit_box_a draggable draghelper">'+K.name+"</div>");I.attr("data-duration",K.duration);I.attr("data-name",K.name);I.attr("data-id",K.assetId);I.css("left",E.clientX);I.css("width",G);I.attr("data-trimin",F);I.attr("data-trimout",H);I.attr("data-sequencetrimin",C);I.attr("data-sequencetrimout",D);z(M).append(I)});return J},_addSubtitleClip:function(F,K){var J=this;var C;var G=0;var I=K.duration;var D=parseInt(F.clientX*PLAYER.TR.config.framePerPixel);var E=K.duration+D;var H=J._calculateWidth(K.duration);z.each(z("#js_time_ruler_bar_box .bar_t"),function(L,M){C=z('<div class="edit_box edit_box_t draggable draghelper">'+K.name+"</div>");C.attr("data-duration",K.duration);C.attr("data-name",K.name);C.attr("data-id",K.id);C.css("left",F.clientX);C.css("width",H);C.attr("data-trimin",G);C.attr("data-trimout",I);C.attr("data-sequencetrimin",D);C.attr("data-sequencetrimout",E);z(M).append(C)});return J},_calculateWidth:function(E){var C=this;var D;if(PLAYER.initDrag){PLAYER.TR.config.maxTime=E+15000;PLAYER.TR.updateEvent(E+15000,true);D=E/PLAYER.TR.config.framePerPixel;PLAYER.initDrag=true}else{D=E/PLAYER.TR.config.framePerPixel}return D},_calTimerRulerRrea:function(K,I,H){var O=this;var J;var D=PLAYER.TR.config;var G=Math.abs(parseInt(z("#js_time_ruler_bar_box").css("marginLeft")));if(H==="video_and_audio"){var N;var C;var E;var M;z(".bar_v").each(function(Q,V){var U=parseInt(z(this).offset().top);var R=parseInt(z(this).offset().left);that=z(this);J=that.attr("data-index");if(I>=U&&I<=U+35&&(K>=R||Math.abs(K-R)<=15)){that.addClass("overActive");that.siblings(".bar_v").removeClass("overActive");z('.bar_a[data-index="'+J+'"]').addClass("overActive");z('.bar_a[data-index="'+J+'"]').siblings(".bar_a").removeClass("overActive");that.children(".draghelper").show();M=that.children(".draghelper");N=K-R;if(N-G<=0){N=G}N=parseInt(N*D.framePerPixel)/D.framePerPixel;C=Math.round(N*D.framePerPixel);E=C+(M.attr("data-trimout")-M.attr("data-trimin"));if(M.siblings().length!==0){var S=PLAYER.operateJson.getAllsequenceTrimIn(M);console.log("adhere_point",S);var T=Math.abs(C-S)/D.framePerPixel;if(T<=5){N=S/D.framePerPixel;C=S;var P=M.attr("data-trimout")-M.attr("data-trimin");E=C+P;L(M,"forward")}else{F(M)}}that.children(".draghelper").css("left",N);that.children(".draghelper").attr("data-sequencetrimin",C);that.children(".draghelper").attr("data-sequencetrimout",E);z('.bar_a[data-index="'+J+'"]').children(".draghelper").show();z('.bar_a[data-index="'+J+'"]').children(".draghelper").css("left",N);z('.bar_a[data-index="'+J+'"]').children(".draghelper").attr("data-sequencetrimin",C);z('.bar_a[data-index="'+J+'"]').children(".draghelper").attr("data-sequencetrimout",E)}else{that.children(".draghelper").hide();z('.bar_a[data-index="'+J+'"]').children(".draghelper").hide();that.removeClass("overActive");z('.bar_a[data-index="'+J+'"]').removeClass("overActive")}})}else{if(H==="video"){var N;var C;var E;var M;z(".bar_v").each(function(Q,V){var U=parseInt(z(this).offset().top);var R=parseInt(z(this).offset().left);that=z(this);J=that.attr("data-index");if(I>=U&&I<=U+35&&(K>=R||Math.abs(K-R)<=15)){that.addClass("overActive");that.siblings(".bar_v").removeClass("overActive");M=that.children(".draghelper");N=K-R;if(N-G<=0){N=G}N=parseInt(N*D.framePerPixel)/D.framePerPixel;C=Math.round(N*D.framePerPixel);E=C+(M.attr("data-trimout")-M.attr("data-trimin"));
if(M.siblings().length!==0){var S=PLAYER.operateJson.getAllsequenceTrimIn(M);var T=Math.abs(C-S)/D.framePerPixel;if(T<=5){N=S/D.framePerPixel;C=Math.round(N*D.framePerPixel);var P=M.attr("data-trimout")-M.attr("data-trimin");E=C+P;L(M,"forward")}else{F(M)}}that.children(".draghelper").show();that.children(".draghelper").css("left",N);that.children(".draghelper").attr("data-sequencetrimin",C);that.children(".draghelper").attr("data-sequencetrimout",E)}else{that.children(".draghelper").hide();that.removeClass("overActive")}})}else{if(H==="audio"){var N;var C;var E;var M;z(".bar_a").each(function(Q,V){var U=parseInt(z(this).offset().top);var R=parseInt(z(this).offset().left);that=z(this);J=that.attr("data-index");if(I>=U&&I<=U+35&&(K>=R||Math.abs(K-R)<=15)){that.addClass("overActive");that.siblings(".bar_a").removeClass("overActive");that.children(".draghelper").show();M=that.children(".draghelper");N=K-R;if(N-G<=0){N=G}N=parseInt(N*D.framePerPixel)/D.framePerPixel;C=Math.round(N*D.framePerPixel);E=C+(M.attr("data-trimout")-M.attr("data-trimin"));if(M.siblings().length!==0){var S=PLAYER.operateJson.getAllsequenceTrimIn(M);var T=Math.abs(C-S)/D.framePerPixel;if(T<=5){N=S/D.framePerPixel;C=Math.round(N*D.framePerPixel);var P=M.attr("data-trimout")-M.attr("data-trimin");E=C+P;L(M,"forward")}else{F(M)}}that.children(".draghelper").css("left",N);that.children(".draghelper").attr("data-sequencetrimin",C);that.children(".draghelper").attr("data-sequencetrimout",E)}else{that.children(".draghelper").hide();that.removeClass("overActive")}})}else{if(H==="subtitle"){var N;var C;var E;var M;z(".bar_t").each(function(Q,V){var U=parseInt(z(this).offset().top);var R=parseInt(z(this).offset().left);that=z(this);J=that.attr("data-index");if(I>=U&&I<=U+35&&(K>=R||Math.abs(K-R)<=15)){that.addClass("overActive");that.siblings(".bar_a").removeClass("overActive");that.children(".draghelper").show();that.children(".draghelper").css("background","pink");M=that.children(".draghelper");N=K-R;if(N-G<=0){N=G}N=parseInt(N*D.framePerPixel)/D.framePerPixel;C=Math.round(N*D.framePerPixel);E=C+(M.attr("data-trimout")-M.attr("data-trimin"));if(M.siblings().length!==0){var S=PLAYER.operateJson.getAllsequenceTrimIn(M);var T=Math.abs(C-S)/D.framePerPixel;if(T<=5){N=S/D.framePerPixel;C=Math.round(N*D.framePerPixel);var P=M.attr("data-trimout")-M.attr("data-trimin");E=C+P;L(M,"forward")}else{F(M)}}that.children(".draghelper").css("left",N);that.children(".draghelper").attr("data-sequencetrimin",C);that.children(".draghelper").attr("data-sequencetrimout",E)}else{that.children(".draghelper").hide();that.removeClass("overActive")}})}}}}function L(Q,P){PLAYER.operateJson.showAdhere(Q,P)}function F(P){PLAYER.operateJson.hideAdhere(P)}return J},_updateVideoClip:function(G,F,C,E){var D=this;var I;var H;z.each(z(".bar_v"),function(N,J){if(z(J).hasClass("overActive")){H=parseInt(z(J).attr("data-index"));var S=F+"_"+PLAYER.genNonDuplicateID(12);var T,Q,R,M,O,P,K,L;Q=z(J).children(".draghelper").attr("data-id");R=z(J).children(".draghelper").attr("data-name");M=parseInt(z(J).children(".draghelper").attr("data-duration"));O=parseInt(z(J).children(".draghelper").attr("data-trimin"));P=parseInt(z(J).children(".draghelper").attr("data-trimout"));K=parseInt(z(J).children(".draghelper").attr("data-sequencetrimin"));L=parseInt(z(J).children(".draghelper").attr("data-sequencetrimout"));z(J).children(".draghelper").css("background","#33bbff");z(J).children(".draghelper").attr("data-type",F);z(J).children(".draghelper").attr("data-time",S);I={"assetID":Q,"trimIn":O,"trimOut":P,"sequenceTrimIn":K,"sequenceTrimOut":L,"effect":[],"type":F,"createTime":S};if(F==="video_and_audio"){z(J).children(".draghelper").attr("data-interleaved",true);I.interleaved=true;z(J).children(".draghelper").attr("data-intid",C);I.interleaved_id=C}else{if(F==="video"){var Q="no_interleaved_id_"+PLAYER.genNonDuplicateID(12);z(J).children(".draghelper").attr("data-interleaved",false);I.interleaved=false;z(J).children(".draghelper").attr("data-intid",Q);I.interleaved_id=Q}}if(z(J).children().length>=2){PLAYER.operateJson.checkCoverEvent(z(J).children(".draghelper"),E)}z(J).removeClass("overActive");z(J).children(".draghelper").removeClass("draghelper")}else{z(J).children(".draghelper").remove();return}PLAYER.operateJson.hideAdhere(z(J))});if(I){return{clipAttr:I,_index:H}}},_updateAudioClip:function(G,F,C,E){var D=this;var I;var H;z.each(z(".bar_a"),function(N,J){if(z(J).hasClass("overActive")){H=parseInt(z(J).attr("data-index"));var S=F+"_"+PLAYER.genNonDuplicateID(12);var T,Q,R,M,O,P,K,L;Q=z(J).children(".draghelper").attr("data-id");R=z(J).children(".draghelper").attr("data-name");M=parseInt(z(J).children(".draghelper").attr("data-duration"));O=parseInt(z(J).children(".draghelper").attr("data-trimin"));P=parseInt(z(J).children(".draghelper").attr("data-trimout"));K=parseInt(z(J).children(".draghelper").attr("data-sequencetrimin"));L=parseInt(z(J).children(".draghelper").attr("data-sequencetrimout"));
z(J).children(".draghelper").css("background","#33bbff");z(J).children(".draghelper").attr("data-type",F);z(J).children(".draghelper").attr("data-time",S);I={"assetID":Q,"trimIn":O,"trimOut":P,"sequenceTrimIn":K,"sequenceTrimOut":L,"volume":100,"type":F,"createTime":S};if(F==="video_and_audio"){z(J).children(".draghelper").attr("data-interleaved",true);I.interleaved=true;z(J).children(".draghelper").attr("data-intid",C);I.interleaved_id=C}else{if(F==="audio"){var Q="no_interleaved_id_"+PLAYER.genNonDuplicateID(12);z(J).children(".draghelper").attr("data-interleaved",false);I.interleaved=false;z(J).children(".draghelper").attr("data-intid",Q);I.interleaved_id=Q}}if(z(J).children().length>=2){PLAYER.operateJson.checkCoverEvent(z(J).children(".draghelper"),E)}z(J).removeClass("overActive");z(J).children(".draghelper").removeClass("draghelper")}else{z(J).children(".draghelper").remove();return}PLAYER.operateJson.hideAdhere(z(J))});if(I){return{clipAttr:I,_index:H}}},_updateSubtitleClip:function(F,E,D){var C=this;var H;var G;z.each(z(".bar_t"),function(O,K){if(z(K).hasClass("overActive")){G=parseInt(z(K).attr("data-index"));var U,R,T,N,I,P,Q,L,M;R=z(K).children(".draghelper").attr("data-id");T=z(K).children(".draghelper").attr("data-name");N=parseInt(z(K).children(".draghelper").attr("data-duration"));I=E+"_"+PLAYER.genNonDuplicateID(12);P=parseInt(z(K).children(".draghelper").attr("data-trimin"));Q=parseInt(z(K).children(".draghelper").attr("data-trimout"));L=parseInt(z(K).children(".draghelper").attr("data-sequencetrimin"));M=parseInt(z(K).children(".draghelper").attr("data-sequencetrimout"));z(K).children(".draghelper").attr("data-time",I);z(K).children(".draghelper").css("background","#ea3af5");z(K).children(".draghelper").attr("data-type",E);z(K).children(".draghelper").attr("data-interleaved",false);var J="no_interleaved_id_"+PLAYER.genNonDuplicateID(12);z(K).children(".draghelper").attr("data-intid",J);H=JSON.parse(PLAYER.operateJson.getSubtitleTemp(R));var S={"trimIn":0,"trimOut":2000,"sequenceTrimIn":L,"sequenceTrimOut":M,"createTime":I,"type":E,"interleaved":false,"interleaved_id":J};z.extend(H,S);if(z(K).children().length>=2){PLAYER.operateJson.checkCoverEvent(z(K).children(".draghelper"),D)}}else{z(K).children(".draghelper").remove();return}PLAYER.operateJson.hideAdhere(z(K))});if(H){return{clipAttr:H,_index:G}}},_updateJsonAttr:function(){var C=this;z(".time_ruler_bar").removeClass("overActive");z(".time_ruler_bar").children().removeClass("onselected");z(".time_ruler_bar").children(".draghelper").removeClass("draghelper");z("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()));var D=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15000||0);PLAYER.TR.updateEvent(D);PLAYER.TR.fixClipWidth();PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame();PLAYER.PTR.updateEvent(PLAYER.PTR.config);PLAYER.operateJson.addProjectMaterial(C.materialAttr);PLAYER.operateJson.sendJson()}});B.DragObj=y})(window,document,jQuery);var r=(function(){var y={};return{create:function(A,z){if(y[A]){return y[A]}return y[A]=new DragObj({type:A,cont:z})}}})();PLAYER.observer.listen("projectData",function(y){if(PLAYER.jsonObj===null){PLAYER.jsonObj=JSON.parse(y)}r.create("video_and_audio",$("#js_thumbnail_box"));r.create("subtitle",$("#js_subtitle_wrap"));r.create("video",$("#js_images_wrap"));r.create("audio",$("#js_audio_wrap"))})});