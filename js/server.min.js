(function(a,m){"function"===typeof define&&define.amd?define(["$"],m):"object"===typeof exports?module.exports=m():a.Query=m(window.Zepto||window.jQuery||$)})(this,function(a){return{getQuery:function(a,e,h){h=h||window;var g=h.location.href;h="";e="#"==e?g.split("#"):g.split("?");e=1==e.length?"":e[1];if(""!=e)for(gg=e.split(/&|#/),e=gg.length,str=a+"=",i=0;i<e;i++)if(0==gg[i].indexOf(str)){h=gg[i].replace(str,"");break}return decodeURI(h)},getForm:function(m){var e={},h={};a(m).find("*[name]").each(function(g,
q){var m;m=a(q).attr("name");var c=a.trim(a(q).val());g=[];if(""!=m&&!a(q).hasClass("getvalued")){"money"==a(q).data("type")&&(c=c.replace(/\,/gi,""));if("radio"==a(q).attr("type")){var u=null;a("input[name='"+m+"']:radio").each(function(){a(this).is(":checked")&&(u=a.trim(a(this).val()))});c=u?u:""}"checkbox"==a(q).attr("type")&&(u=[],a("input[name='"+m+"']:checkbox").each(function(){a(this).is(":checked")&&u.push(a.trim(a(this).val()))}),c=u.length?u.join(","):"");a(q).attr("listvalue")&&!e[a(q).attr("listvalue")]&&
(e[a(q).attr("listvalue")]=[],a("input[listvalue='"+a(q).attr("listvalue")+"']").each(function(){if(""!=a(this).val()){var b=a(this).attr("name"),c={};"json"==a(this).data("type")?c[b]=JSON.parse(a(this).val()):c[b]=a.trim(a(this).val());a(this).attr("paramquest")&&(b=JSON.parse(a(this).attr("paramquest")),c=a.extend(c,b));e[a(q).attr("listvalue")].push(c);a(this).addClass("getvalued")}}));a(q).attr("arrayvalue")&&!e[a(q).attr("arrayvalue")]&&(e[a(q).attr("arrayvalue")]=[],a("input[arrayvalue='"+
a(q).attr("arrayvalue")+"']").each(function(){if(""!=a(this).val()){var b;b="json"==a(this).data("type")?JSON.parse(a(this).val()):a.trim(a(this).val());if(a(this).attr("paramquest")){var c=JSON.parse(a(this).attr("paramquest"));b=a.extend(b,c)}e[a(q).attr("arrayvalue")].push(b)}}));""==m||a(q).hasClass("getvalued")||(m.match(/\./)?(g=m.split("."),m=g[0],3==g.length?(h[g[1]]=h[g[1]]||{},h[g[1]][g[2]]=c):"json"==a(q).data("type")?(h[g[1]]=JSON.parse(c),a(q).attr("paramquest")&&(c=JSON.parse(a(q).attr("paramquest")),
h[g[1]]=a.extend(h[g[1]],c))):h[g[1]]=c,e[m]=e[m]?a.extend({},e[m],h):h):e[m]=c)}});m={};for(var g in e){var q=e[g];m[g]="object"==typeof q?JSON.stringify(q):e[g]}a(".getvalued").removeClass("getvalued");return m},setHash:function(m){var e="";m=a.extend(this.getHash(),m);var h=[],g;for(g in m)""!=m[g]&&h.push(g+"="+encodeURIComponent(m[g]));e+=h.join("&");location.hash=e;return this},getHash:function(a){if("string"===typeof a)return this.getQuery(a,"#");a={};var e=location.hash;if(0<e.length)for(var e=
e.substr(1),e=e.split("&"),h=0,g=e.length;h<g;h++){var q=e[h].split("=");0<q.length&&(a[q[0]]=decodeURI(q[1])||"")}return a}}});
(function(a,m){"function"===typeof define&&define.amd?define(["$","query"],m):"object"===typeof exports?module.exports=m():a.Paging=m(window.Zepto||window.jQuery||$,Query)})(this,function(a,m){function e(){this.id="Paging_"+Math.random().toString().replace(".","")}a.fn.Paging=function(h){var g=[];a(this).each(function(){var q=a.extend({target:a(this)},h),m=new e;m.init(q);g.push(m)});return g};e.prototype={init:function(h){this.settings=a.extend({callback:null,pagesize:10,current:1,prevTpl:"\u4e0a\u4e00\u9875",
nextTpl:"\u4e0b\u4e00\u9875",firstTpl:"\u9996\u9875",lastTpl:"\u672b\u9875",ellipseTpl:"...",toolbar:!1,hash:!0,pageSizeList:[5,10,15,20]},h);this.target=a(this.settings.target);this.container=a('<div id="'+this.id+'" class="ui-paging-container"/>');this.target.append(this.container);this.render(this.settings);this.format();this.bindEvent()},render:function(a){this.count=a.count||this.settings.count;this.pagesize=a.pagesize||this.settings.pagesize;this.current=a.current||this.settings.current;this.pagecount=
Math.ceil(this.count/this.pagesize);this.format()},bindEvent:function(){var h=this;this.container.on("click","li.js-page-action,li.ui-pager",function(g){if(a(this).hasClass("ui-pager-disabled")||a(this).hasClass("focus"))return!1;a(this).hasClass("js-page-action")?(a(this).hasClass("js-page-first")&&(h.current=1),a(this).hasClass("js-page-prev")&&(h.current=Math.max(1,h.current-1)),a(this).hasClass("js-page-next")&&(h.current=Math.min(h.pagecount,h.current+1)),a(this).hasClass("js-page-last")&&(h.current=
h.pagecount)):a(this).data("page")&&(h.current=parseInt(a(this).data("page")));h.go()})},go:function(a){this.current=a||this.current;this.current=Math.max(1,this.current);this.current=Math.min(this.current,this.pagecount);this.format();this.settings.hash&&m.setHash({page:this.current});this.settings.callback&&this.settings.callback(this.current,this.pagesize,this.pagecount)},changePagesize:function(a){this.render({pagesize:a})},format:function(){var e;e="<ul>"+('<li class="js-page-first js-page-action ui-pager" >'+
this.settings.firstTpl+"</li>");e+='<li class="js-page-prev js-page-action ui-pager">'+this.settings.prevTpl+"</li>";if(6<this.pagecount){e+='<li data-page="1" class="ui-pager">1</li>';if(2>=this.current)e=e+'<li data-page="2" class="ui-pager">2</li><li data-page="3" class="ui-pager">3</li>'+('<li class="ui-paging-ellipse">'+this.settings.ellipseTpl+"</li>");else if(2<this.current&&this.current<=this.pagecount-2)e+="<li>"+this.settings.ellipseTpl+"</li>",e+='<li data-page="'+(this.current-1)+'" class="ui-pager">'+
(this.current-1)+"</li>",e+='<li data-page="'+this.current+'" class="ui-pager">'+this.current+"</li>",e+='<li data-page="'+(this.current+1)+'" class="ui-pager">'+(this.current+1)+"</li>",e+='<li class="ui-paging-ellipse" class="ui-pager">'+this.settings.ellipseTpl+"</li>";else{e+='<li class="ui-paging-ellipse" >'+this.settings.ellipseTpl+"</li>";for(var g=this.pagecount-2;g<this.pagecount;g++)e+='<li data-page="'+g+'" class="ui-pager">'+g+"</li>"}e+='<li data-page="'+this.pagecount+'" class="ui-pager">'+
this.pagecount+"</li>"}else for(g=1;g<=this.pagecount;g++)e+='<li data-page="'+g+'" class="ui-pager">'+g+"</li>";e+='<li class="js-page-next js-page-action ui-pager">'+this.settings.nextTpl+"</li>";e+='<li class="js-page-last js-page-action ui-pager">'+this.settings.lastTpl+"</li>";this.container.html(e+"</ul>");1==this.current&&(a(".js-page-prev",this.container).addClass("ui-pager-disabled"),a(".js-page-first",this.container).addClass("ui-pager-disabled"));this.current==this.pagecount&&(a(".js-page-next",
this.container).addClass("ui-pager-disabled"),a(".js-page-last",this.container).addClass("ui-pager-disabled"));this.container.find('li[data-page="'+this.current+'"]').addClass("focus").siblings().removeClass("focus");this.settings.toolbar&&this.bindToolbar()},bindToolbar:function(){for(var e=this,g=a('<li class="ui-paging-toolbar"><select class="ui-select-pagesize"></select><input type="text" class="ui-paging-count"/><a href="javascript:void(0)">\u8df3\u8f6c</a></li>'),q=a(".ui-select-pagesize",g),
m="",v=0,x=this.settings.pageSizeList.length;v<x;v++)m+='<option value="'+this.settings.pageSizeList[v]+'">'+this.settings.pageSizeList[v]+"\u6761/\u9875</option>";q.html(m);q.val(this.pagesize);a("input",g).val(this.current);a("input",g).click(function(){a(this).select()}).keydown(function(c){13==c.keyCode&&(c=parseInt(a(this).val())||1,e.go(c))});a("a",g).click(function(){var c=parseInt(a(this).prev().val())||1;e.go(c)});q.change(function(){e.changePagesize(a(this).val())});this.container.children("ul").append(g)}};
return e});
(function(a,m,e){function h(a){this._init(a)}e.extend(h.prototype,{_init:function(a){this.options={dirSelector:"x",contSelector:"",barSelector:"",sliderSelector:"",wheelStep:"10"};e.extend(!0,this.options,a||{});this._initDom();return this},_initDom:function(){this.$dir=this.options.dirSelector;this.$cont=this.options.contSelector;this.$bar=this.options.barSelector;this.$slider=this.options.sliderSelector;this.$wheelStep=this.options.wheelStep;this.$doc=e(m);"x"===this.$dir&&this._initSliderDragEvent()._bindContScrollX();"y"===
this.$dir&&this._initSliderDragEvent()._bindContScrollY()._bindMouseWheel()},_initSliderDragEvent:function(){var a=this,e=this.$doc;a.$slider.on("mousedown",function(g){g.preventDefault();a._getContMaxScrollX();a._getSliderMaxScrollX();a._getContMaxScrollY();a._getSliderMaxScrollY();e.on("mousemove.slider",mousemoveHandler).on("mouseup.slider",function(a){e.off(".slider")})});return a},_bindMouseWheel:function(){var a=this;a.$cont.on("mousewheel DOMMouseScroll",function(e){e.preventDefault();e=e.originalEvent;
a._scrollToY(a.$cont[0].scrollTop+(e.wheelDelta?-e.wheelDelta/120:(e.detail||0)/3)*a.$wheelStep)});return a},_bindContScrollX:function(){var a=this;a.$cont.on("scroll",function(){a.$slider.css({left:a._getSliderScrollX()})});return a},_bindContScrollY:function(){var a=this;a.$cont.on("scroll",function(){a.$slider.css({top:a._getSliderScrollY()})});return a},_getContMaxScrollX:function(){return this.$cont[0].scrollWidth-this.$cont.width()},_getContMaxScrollY:function(){return this.$cont[0].scrollHeight-
this.$cont.height()},_getSliderMaxScrollX:function(){return this.$bar.width()-this.$slider.width()},_getSliderMaxScrollY:function(){return this.$bar.height()-this.$slider.height()},_getSliderScrollX:function(){return Math.min(this._getSliderMaxScrollX(),this.$cont[0].scrollLeft*this._getSliderMaxScrollX()/this._getContMaxScrollX())},_getSliderScrollY:function(){return Math.min(this._getSliderMaxScrollY(),this.$cont[0].scrollTop*this._getSliderMaxScrollY()/this._getContMaxScrollY())},_scrollToX:function(a){this.$cont.scrollLeft(a)},
_scrollToY:function(a){this.$cont.scrollTop(a)}});a.Scrollbar=h})(window,document,jQuery);
(function(a,m,e,h){function g(a){this._init(a)}e.extend(g.prototype,{_init:function(a){this.options={cssName:"facial",headerTitle:"\u89c6\u9891\u5206\u6790",data:[]};e.extend(!0,this.options,a||{});this._initDom(this.options.data);return this},_initDom:function(){e('<div id="js_create'+this.options.cssName+'Modal" class="create_'+this.options.cssName+'_modal"><div class="fast_content"><div class="fast_header" id="js_fast_header"><span class="icojam_delete"></span><h4>\u89c6\u9891\u5206\u6790</h4></div><div class="fast_body row"><div class="col-md-12"><div class="facial_box" id="js_facial_box"></div><div class="facial_list_track"><div class="facial_list_scroll"></div></div></div><div class="col-md-12 '+this.options.cssName+
'_pagination"><ul class="pager" id="js_'+this.options.cssName+'_pager"></ul></div></div><div class="fast_footer"><button type="button" class="fast_btn" id="js_'+this.options.cssName+'_cancel">\u5173\u95ed</button></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>').insertAfter(e(".container-fluid"));this._initStyle();return this},_initStyle:function(){this._initDrag();this._operateInit();
return this},_initDrag:function(){var a=this;e("#js_fast_header").mousedown(function(g){var m=g.clientX,q=g.clientY,c,u,b=e("#js_create"+a.options.cssName+"Modal").position().left,A=e("#js_create"+a.options.cssName+"Modal").position().top;e(body).css("cursor","move");e(h).on("mousemove",function(d){d.preventDefault();c=d.clientX;u=d.clientY;d=c-m+b;var t=u-q+A;0>=d&&(d=0);d>=e("#body").width()-e("#js_create"+a.options.cssName+"Modal").width()&&(d=e("#body").width()-e("#js_create"+a.options.cssName+
"Modal").width());0>=t&&(t=0);t>=e("#body").height()-e("#js_create"+a.options.cssName+"Modal").height()&&(t=e("#body").height()-e("#js_create"+a.options.cssName+"Modal").height());e("#js_create"+a.options.cssName+"Modal").css("left",d);e("#js_create"+a.options.cssName+"Modal").css("top",t)}).on("mouseup",function(b){e(h).off("mousemove");e(body).css("cursor","default")})})},_operateInit:function(){var a=this;e("#js_"+a.options.cssName+"_cancel, .icojam_delete").on("click",function(){e("#js_create"+
a.options.cssName+"Modal").remove();e("#js_pageCover").hide();PLAYER.model=null});return a}});m.CreateFacialModal=g})(window,PLAYER,jQuery,document);
$(document).ready(function(){document.onselectstart=function(c){console.log("e",c.srcElement);return"input"===c.srcElement.tagName||"INPUT"===c.srcElement.tagName||"textarea"===c.srcElement.tagName||"TEXTAREA"===c.srcElement.tagName||"span"===c.srcElement.tagName||"SPAN"===c.srcElement.tagName?!0:!1};var a=PLAYER.singelton(function(){var c=$('<div id="js_initProjectModal" class="init_pro_modal"><div class="fast_content"><div class="fast_header"><h4>\u6253\u5f00\u5de5\u7a0b</h4></div><div class="fast_body row"><div class="col-md-12 left"><ul class="project_list" id="js_init_project_list" onselectstart="return false"></ul><div class="project_list_track"><div class="project_list_scroll"></div></div></div><div class="col-md-12 project_pagination"><ul class="pager" id="js_pro_pager"></ul></div></div><div class="fast_footer"><button type="button" class="fast_btn" id="js_modal_initOpenNew">\u6253\u5f00</button><button type="button" class="fast_btn" id="js_modal_initNew">\u65b0\u5efa</button></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');c.insertAfter($(".container-fluid"));
return c}),m=PLAYER.singelton(function(){var c=$('<div id="js_createProjectModal" class="create_pro_modal"><div class="fast_content"><div class="fast_header"><span class="icojam_delete"></span><h4>\u521b\u5efa\u5de5\u7a0b</h4></div><div class="fast_body row"><div class="col-md-12 right"><form id="js_create_form"><div class="form-group"><input type="text" class="form-control" name="name" placeholder="\u672a\u547d\u540d" id="js_create_form_name"></div><div class="form-group" id="js_create_pro_type"></div></form></div></div><div class="fast_footer"><button type="button" class="fast_btn" id="js_modal_createNew">\u65b0\u5efa</button></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');
c.insertAfter($(".container-fluid"));return c}),e=PLAYER.singelton(function(){var c=$('<div id="js_editProjectModal" class="edit_pro_modal"><div class="fast_content"><div class="fast_header"><span class="icojam_delete"></span><h4>\u7f16\u8f91\u5de5\u7a0b</h4></div><div class="fast_body row"><div class="col-md-12 left"><ul class="project_list" id="js_edit_project_list"></ul><div class="project_edit_list_track"><div class="project_edit_list_scroll"></div></div></div><div class="col-md-12 project_edit_pagination"><ul class="pager" id="js_pro_edit_pager"></ul></div></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');
c.insertAfter($(".container-fluid"));return c}),h=PLAYER.singelton(function(){var c=$('<div id="js_saveProjectModal" class="save_pro_modal"><div class="fast_content"><div class="fast_header"><span class="icojam_delete"></span><h4>\u4fdd\u5b58\u5de5\u7a0b</h4></div><div class="fast_footer"><button type="button" class="fast_btn" id="js_modal_savePro">\u786e\u5b9a</button><button type="button" class="fast_btn" id="js_modal_cancelPro">\u53d6\u6d88</button></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');
c.insertAfter($(".container-fluid"));return c}),g=PLAYER.singelton(function(){var c=$('<div id="js_exportProjectModal" class="export_pro_modal"><div class="fast_content"><div class="fast_header"><span class="icojam_delete"></span><h4>\u5408\u6210\u6253\u5305</h4></div><div class="fast_body row"><div class="col-md-12"><form id="js_create_form" class="form-horizontal"><div class="form-group"><label for="schema" class="col-md-3 control-label">\u6587\u4ef6\u6a21\u677f</label><div class="col-md-9"><select class="form-control" name="schema" id="js_export_form_schema"></select></div></div><div class="form-group"><label for="name" class="col-md-3 control-label">\u6587\u4ef6\u540d\u79f0</label><div class="col-md-9"><input type="text" class="form-control" name="name" placeholder="\u6253\u5305" id="js_export_form_name"></div></div><div class="form-group"><div class="col-md-offset-3 col-md-9"><div class="checkbox"><label><input type="checkbox" id="js_export_form_check">\u6574\u4e2a\u5e8f\u5217</label></div></div></div></form></div></div><div class="fast_footer"><div class="col-md-offset-3 col-md-9"><button type="button" class="fast_btn" id="js_modal_export">\u6253\u5305</button><button type="button" class="fast_btn" id="js_export_modal_cancelPro">\u53d6\u6d88</button></div></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');
c.insertAfter($(".container-fluid"));return c}),q=PLAYER.singelton(function(){var c=$('<div id="js_addProgramModal" class="add_pro_modal"><div class="fast_content"><div class="fast_header"><span class="icojam_delete"></span><h4>\u6dfb\u52a0\u7f51\u7edc\u7d20\u6750</h4></div><div class="fast_body row"><div class="col-md-12"><form id="js_create_form" class="form-horizontal"><div class="form-group"><label for="name" class="col-md-3 control-label">\u6587\u4ef6\u540d\u79f0</label><div class="col-md-9"><input type="text" class="form-control" name="name" placeholder="\u6587\u4ef6\u540d\u79f0" id="js_add_form_name"></div></div><div class="form-group"><label for="name" class="col-md-3 control-label">URL</label><div class="col-md-9"><input type="text" class="form-control" name="name" placeholder="http://" id="js_add_form_url"></div></div></form></div></div><div class="fast_footer"><div class="col-md-offset-3 col-md-9"><button type="button" class="fast_btn" id="js_modal_add">\u6dfb\u52a0</button><button type="button" class="fast_btn" id="js_add_modal_cancelPro">\u53d6\u6d88</button></div></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');
c.insertAfter($(".container-fluid"));return c}),z=PLAYER.singelton(function(){var c=$('<div id="js_createVolumeModal" class="create_volume_modal"><div class="fast_content"><div class="fast_header"><span class="icojam_delete"></span><h4>\u8c03\u8282\u97f3\u91cf</h4></div><div class="fast_body row"><div class="col-md-12 right"><div class="volume_num" id="js_volume_num"><span>0</span><span>100</span><span>400</span></div><form id="js_volume_form"><div class="form-group"><input type="range" class="form-control" name="range" min="0" max="400" step="10" value="" id="js_volume_form_range"></div><div class="form-group"><input type="text" class="form-control" name="name" placeholder="\u672a\u547d\u540d" id="js_volume_form_name"></div></form></div></div><div class="fast_footer"><button type="button" class="fast_btn" id="js_volume_save">\u786e\u5b9a</button><button type="button" class="fast_btn" id="js_volume_cancel">\u53d6\u6d88</button></div></div><iframe  src="" frameBorder="0" style="position: absolute;top: 0px; left: 0px; width: 100%; height: 100%; z-index: -1; filter: alpha(opacity = 0);"></iframe></div>');
c.insertAfter($(".container-fluid"));return c});PLAYER.createEffectModal=PLAYER.singelton(function(){});a();m();e();z();$.ajaxSetup({type:"POST",dataType:"json",error:function(c,a,b){alert("\u5931\u8d25XMLHttpRequest",c);alert("\u5931\u8d25XMLHttpRequest",a);alert("\u5931\u8d25XMLHttpRequest",b)}});$.ajax({url:serverUrl+"proj/list",data:{currentPage:1,pageSize:20},success:function(c){0===c.code&&null!==c.data?PLAYER.observer.trigger("proList",c.data):console.log("error")}});$.ajax({url:serverUrl+
"proj/template",success:function(c){0===c.code&&null!==c.data?PLAYER.observer.trigger("proTemplate",c.data):console.log("error")}});$.ajax({url:serverUrl+"program/list",data:{currentPage:1,pageSize:36,name:$("#js_programForm_name .form-control").val()||"",provider:$("#js_programForm_cpspcode .form-control").val()||"",programType:$("#js_programForm_type .form-control").val()||"",from:$("#js_programForm_stime .form-control").val()||"",to:$("#js_programForm_etime .form-control").val()||""},success:function(c){0===
c.code&&null!==c.data?PLAYER.observer.trigger("getProgramList",c.data):console.log("error")}});$("#js_programForm_btn").on("click",function(){var c=$("#js_programForm_name .form-control").val()||"",a=$("#js_programForm_cpspcode .form-control").val()||"",b=$("#js_programForm_type .form-control").val()||"",e=$("#js_programForm_stime .form-control").val()||"",d=$("#js_programForm_etime .form-control").val()||"";$.ajax({url:serverUrl+"program/list",data:{currentPage:1,pageSize:36,name:c,provider:a,programType:b,
from:e,to:d},success:function(b){0===b.code&&null!==b.data?(PLAYER.observer.trigger("getProgramList",b.data),PLAYER.observer.trigger("projectData",JSON.stringify(PLAYER.jsonObj),!0)):console.log("error")}})});$("#js_modal_initOpenNew").on("click",function(){$("#js_init_project_list li.active").length?$.ajax({url:serverUrl+"proj/info",data:{projectid:$("#js_init_project_list li.active").attr("data-id")},success:function(c){if(0===c.code&&null!==c.data){$("#js_initProjectModal").hide();$("#js_pageCover").hide();
$(".player_title").html($("#js_init_project_list li.active .project_list_name").html());var a=JSON.parse(c.data.projectcontent);0===a.rootBin.sequence[0].tracks.length&&$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(b,d){b={type:$(d).attr("data-type"),index:parseInt($(d).attr("data-index")),subclip:[]};a.rootBin.sequence[0].tracks.push(b)});PLAYER.observer.trigger("projectData",JSON.stringify(a));var b;"576"===a.height?b="SD":"1080"===a.height&&(b="HD");PLAYER.OCX.sendProType(b)}else console.log("error")}}):
alert("\u60a8\u5fc5\u987b\u9009\u4e2d\u4e00\u4e2a")});$("#js_modal_initNew").on("click",function(){$("#js_initProjectModal").hide();$("#js_createProjectModal").show();$("#js_modal_createNew").on("click",function(){""===$("#js_create_form_name").val()&&$("#js_create_form_name").val("\u672a\u547d\u540d");var c=$("#js_create_form_name").val();$.ajax({url:serverUrl+"proj/create",data:{name:c,templateid:$("#js_create_pro_type .form-control").val()},success:function(c){if(0===c.code&&null!==c.data){$("#js_createProjectModal").hide();
$("#js_pageCover").hide();$(".player_title").html($("#js_create_form_name").val());var b=JSON.parse(c.data);$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(c,d){c={type:$(d).attr("data-type"),index:parseInt($(d).attr("data-index")),subclip:[]};b.rootBin.sequence[0].tracks.push(c)});PLAYER.observer.trigger("projectData",JSON.stringify(b));c=parseInt($("#js_create_pro_type .form-control").val());1===c?c="SD":2===c&&(c="HD");PLAYER.OCX.sendProType(c)}else console.log("error")}})});$("#js_createProjectModal .icojam_delete").on("click",
function(){$("#js_initProjectModal").show();$("#js_pageCover").show();$("#js_createProjectModal").hide()})});$.ajax({url:serverUrl+"task/list",data:{status:parseInt($("#js_status_select").val()),currentPage:1,pageSize:20},success:function(c){0===c.code&&null!==c.data?PLAYER.observer.trigger("packbagList",c.data):console.log("error")}});$("#js_status_btn").on("click",function(){$.ajax({url:serverUrl+"task/list",data:{status:parseInt($("#js_status_select").val()),currentPage:1,pageSize:20},success:function(c){0===
c.code&&null!==c.data?PLAYER.observer.trigger("packbagList",c.data):console.log("error")}})});$("#js_addProgram_btn").on("click",function(){q();$("#js_addProgramModal").show();$("#js_pageCover").show();$("#js_add_modal_cancelPro, .icojam_delete").on("click",function(){$("#js_addProgramModal").hide();$("#js_pageCover").hide()})});$.ajax({url:serverUrl+"subtitle/list",success:function(c){0===c.code&&null!==c.data?PLAYER.observer.trigger("getSubtitleList",c.data):alert("\u83b7\u53d6\u5b57\u5e55\u5931\u8d25")}});
$.ajax({url:serverUrl+"effect/list",success:function(c){0===c.code&&null!==c.data?PLAYER.observer.trigger("getEffectList",c.data):alert("\u83b7\u53d6\u7279\u6280\u5931\u8d25")}});$("#js_finding").on("click",function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));null===PLAYER.model&&PLAYER.dbClick&&void 0!==$("#js_finding").attr("data-id")?(PLAYER.model=new PLAYER.CreateFacialModal,$.ajax({url:faceUrl+"/service/getFaceResult",
type:"GET",data:{assetid:$("#js_finding").attr("data-id")},success:function(c){0===c.code&&null!==c.data?PLAYER.observer.trigger("facialList",c.data.data):alert("\u83b7\u53d6\u4eba\u8138\u5931\u8d25")}})):void 0===$("#js_finding").attr("data-id")?alert("\u60a8\u5fc5\u9009\u5148\u53cc\u51fb\u7d20\u6750\uff01"):null!==PLAYER.model&&alert("\u60a8\u4e0d\u80fd\u91cd\u590d\u70b9\u51fb\uff01")});(function(){PLAYER.observer.listen("proList",function(c){function a(b){$("#js_init_project_list").empty();$("#js_init_project_list").append('<li class="header"><span>\u5de5\u7a0b\u540d\u79f0</span><span>\u4e0a\u6b21\u7f16\u8f91\u65f6\u95f4</span><span>\u7248\u672c</span><span></span></li>');
$.each(b.list,function(b,d){b=$('<li data-id="'+d.projectid+'"></li>');d=$('<span class="project_list_name">'+d.projectname+"</span><span>"+PLAYER.getLocalTime(d.createtime)+"</span><span>v-"+d.version+"</span></span>");b.append(d);$("#js_init_project_list").append(b)})}a(c);5<c.totalLines&&($(".project_list_track").show(),new Scrollbar({dirSelector:"y",contSelector:$("#js_init_project_list"),barSelector:$(".project_list_track"),sliderSelector:$(".project_list_scroll")}));$("#js_pro_pager").empty();
$("#js_pro_pager").Paging({pagesize:20,count:c.totalLines,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(b,c,d){console.log("\u5f53\u524d\u7b2c "+b+"\u9875,\u6bcf\u9875 "+c+"\u6761,\u603b\u9875\u6570\uff1a"+d+"\u9875");$.ajax({url:serverUrl+"proj/list",data:{currentPage:b,pageSize:20},success:function(b){0===b.code&&null!==b.data?a(b.data):console.log("error")}})}})})})();(function(){PLAYER.observer.listen("proTemplate",function(c){var a=$('<select class="form-control" name="templateid">');
$.each(c,function(b,c){b=$('<option value="'+c.templateid+'">'+c.name+"</option>");a.append(b)});$("#js_create_pro_type").append(a)})})();(function(){PLAYER.observer.listen("projectData",function(c){c=JSON.parse(c);c="576"===c.height&&"720"===c.width?parseFloat(1.25*$("#ocx").height()):parseFloat(16*$("#ocx").height()/9);$("#ocx").width(c);var a=($(".player").width()-c)/2;0>a&&(a=0);$("#ocx").css("margin-left",a);$("#js_mask").width(c);$("#js_mask").css("left",a)})})();(function(){PLAYER.observer.listen("getAllCpspcode",
function(c){var a=$('<select class="form-control" name="cpspcode" >'),b=$('<option value="">\u5168\u90e8</option>');a.append(b);$.each(c,function(b,d){b=$('<option value="'+d.cpspcode+'">'+d.name+"</option>");a.append(b)});$(".program_cpspcode").append(a)})})();(function(){PLAYER.observer.listen("getProgramType",function(c){var a=$('<select class="form-control" name="type">'),b=$('<option value="">\u5168\u90e8</option>');a.append(b);$.each(c,function(b,d){b=$('<option value="'+d.name+'">'+d.name+
"</option>");a.append(b)});$(".program_type").append(a)})})();(function(){PLAYER.observer.listen("getProgramList",function(c){function a(b){$(".meterial_thumbnail_box").empty();$.each(b.list,function(b,d){b=$('<div class="col-md-3 col-sm-3 col-lg-3" draggable="true" data-id="'+d.assetid+'" data-test="m'+b+'"><a class="thumbnail"><img src="'+d.thumbnail+'" alt=""  draggable="false"><span class="thumbnail_name" style="bottom:22px;">'+d.name+"</span><span>"+PLAYER.getDurationToString(d.duration)+"</span></a></div>");
$("#js_thumbnail_box").append(b)})}a(c);8<c.totalLines&&($(".meterial_thumbnail_box").show(),$(".meterial_thumbnail_track").show(),new Scrollbar({dirSelector:"y",contSelector:$(".meterial_thumbnail_box"),barSelector:$(".meterial_thumbnail_track"),sliderSelector:$(".meterial_thumbnail_scroll")}));$("#js_pager").empty();$("#js_pager").Paging({pagesize:36,count:c.totalLines,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(b,c,d){$.ajax({url:serverUrl+"program/list",data:{currentPage:b,pageSize:36},
success:function(b){0===b.code&&null!==b.data?(a(b.data),PLAYER.observer.trigger("projectData",PLAYER.json)):console.log("error")}})}})})})();(function(){PLAYER.observer.listen("proList",function(a){function c(b){$("#js_edit_project_list").empty();$("#js_edit_project_list").append('<li class="header"><span>\u5de5\u7a0b\u540d\u79f0</span><span>\u4e0a\u6b21\u7f16\u8f91\u65f6\u95f4</span><span>\u72b6\u6001</span><span></span></li>');$.each(b.list,function(b,d){b=$('<li data-id="'+d.projectid+'"></li>');
d=$('<span class="project_list_name">'+d.projectname+"</span><span>"+PLAYER.getLocalTime(d.createtime)+"</span><span>\u2193"+d.version+'</span><span class="glyphicon glyphicon-remove project_delete" data-id="'+d.id+'"></span>');b.append(d);$("#js_edit_project_list").append(b)})}c(a);5<a.totalLines&&($(".project_edit_list_track").show(),new Scrollbar({dirSelector:"y",contSelector:$("#js_edit_project_list"),barSelector:$(".project_edit_list_track"),sliderSelector:$(".project_edit_list_scroll")}));$("#js_pro_edit_pager").empty();
$("#js_pro_edit_pager").Paging({pagesize:20,count:a.totalLines,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(b,a,d){console.log("\u5f53\u524d\u7b2c "+b+"\u9875,\u6bcf\u9875 "+a+"\u6761,\u603b\u9875\u6570\uff1a"+d+"\u9875");$.ajax({url:serverUrl+"proj/list",data:{currentPage:b,pageSize:20},success:function(b){0===b.code&&null!==b.data?c(b.data):console.log("error")}})}})})})();(function(){PLAYER.observer.listen("packbagList",function(a){function c(b){$("#js_export_list").empty();var a=$('<li class="header"><span>\u540d\u79f0</span><span>\u521b\u5efa\u65f6\u95f4</span><span>\u8fdb\u5ea6</span><span>\u72b6\u6001</span><span>\u5907\u6ce8</span></li>');
$("#js_export_list").append(a);$.each(b,function(b,a){b=$("<li>");a=$('<a href="javascript:;"  class="name"><span>'+a.title+'</span></a><a href="javascript:;"  class="createTime"><span>'+PLAYER.getLocalTime(a.createtime)+'</span></a><a href="javascript:;"  class="progressBox"><span><div class="progress progress-mini" title="\u5f53\u524d\u8fdb\u5ea6'+a.progress+'%"><div style="width:'+a.progress+'%;" class="progress-bar"></div></div></span></a><a href="javascript:;"  class="state"><span>'+a.flag+'</span></a><a href="javascript:;" ><span>'+
a.last_err+"</span></a>");b.append(a);$("#js_export_list").append(b)})}c(a);$("#js_pager_export").empty();$("#js_pager_export").Paging({pagesize:20,count:a.length,prevTpl:"&laquo;",nextTpl:"&raquo;",callback:function(b,a,d){$.ajax({url:serverUrl+"program/list",data:{currentPage:b,pageSize:20,status:parseInt($("#js_status_select").val())},success:function(b){0===b.code&&null!==b.data?c(b.data):console.log("error")}})}})})})();(function(){PLAYER.observer.listen("facialList",function(a){0!==a.length?
(function(a){$("#js_createfacialModal #js_facial_box").empty();$.each(a,function(b,a){b=$('<div class="facial_list"><img src='+a.httpPath+' data-frame="'+a.startTime+'"/><span class="facial_description">'+a.name+'</span><span class="pull-right">'+PLAYER.getDurationToString(a.startTime)+"</span></div>");$("#js_createfacialModal #js_facial_box").append(b)})}(a),$(".facial_list_track").show(),new Scrollbar({dirSelector:"y",contSelector:$("#js_facial_box"),barSelector:$(".facial_list_track"),sliderSelector:$(".facial_list_scroll")}),
$(".facial_list").on("click",function(a){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));void 0!==$(a.target).attr("data-frame")&&($(a.target).addClass("active"),$(a.target).parent().siblings().children("img").removeClass("active"),a=parseInt($(a.target).attr("data-frame")),PLAYER.OCX.seek(a),PLAYER.PTR.fixArrowCurrentTime(a))})):alert("\u89c6\u9891\u5206\u6790\u5931\u8d25\uff01")})})();var v=function(a){PLAYER.checkPlaying();
var c=h();$("#js_modal_savePro").attr("data-type",a);c.show();$("#js_pageCover").show();$("#js_saveProjectModal #js_modal_cancelPro").off().click(function(){c.hide();$("#js_pageCover").hide()});$("#js_saveProjectModal .icojam_delete").off().click(function(){c.hide();$("#js_pageCover").hide()});$("#js_modal_savePro").off().click(function(){var b=PLAYER.operateJson.translateFfpToMS(JSON.stringify(PLAYER.jsonObj));$.ajax({url:serverUrl+"proj/update",data:{projectid:PLAYER.jsonObj.id,html:"",content:JSON.stringify(b)},
success:function(b){0===b.code&&null!==b.data?($("#js_saveProjectModal").hide(),$("#js_pageCover").hide(),PLAYER.observer.trigger("saveProModal",!0,$("#js_modal_savePro").attr("data-type"))):console.log("error")}})})};$("#js_saveProject").click(function(){v("savepro");PLAYER.observer.listen("saveProModal",function(a,e){a&&"savepro"===e&&($("#js_saveProjectModal").hide(),$("#js_pageCover").hide(),$("#js_modal_savePro").attr("data-type",""))})});$("#js_newProject").on("click",function(){v("newpro");
PLAYER.observer.listen("saveProModal",function(a,e){a&&"newpro"===e&&($("#js_saveProjectModal").hide(),$("#js_pageCover").hide(),$("#js_modal_savePro").attr("data-type",""),location.href=enterUrl)})});$("#js_openProject").on("click",function(){v("editpro");PLAYER.observer.listen("saveProModal",function(a,g){a&&"editpro"===g&&(e(),$("#js_modal_savePro").attr("data-type",""),$("#js_saveProjectModal").hide(),$("#js_pageCover").show(),$("#js_editProjectModal").show(),$("#js_editProjectModal .icojam_delete").on("click",
function(){$("#js_editProjectModal").hide();$("#js_pageCover").hide()}),$("#js_edit_project_list").delegate($("#js_edit_project_list").children(),"selectstart",function(){return!1}),$("#js_edit_project_list").delegate(".project_delete","click",function(){if(confirm("\u786e\u5b9a\u5220\u9664\u5417?")){var b=$(this).parent("li").attr("data-id"),a=$(this).parent("li").find(".project_list_name").html();b===PLAYER.jsonObj.id?alert("\u60a8\u4e0d\u80fd\u5220\u9664\u5f53\u524d\u5de5\u7a0b\uff01"):($(this).parent("li").remove(),
$.ajax({url:serverUrl+"proj/delete",data:{id:b},success:function(b){0===b.code&&null!==b.data?$.ajax({url:serverUrl+"proj/list",data:{currentPage:1,pageSize:20},success:function(b){0===b.code&&null!==b.data?(alert("\u5220\u9664:"+a+"\u6210\u529f!"),PLAYER.observer.trigger("proList",b.data)):console.log("error")}}):console.log("error")}}))}else return!1}))})});$("#js_exportProject").on("click",function(){v("exportpro");PLAYER.observer.listen("saveProModal",function(a,e){a&&"exportpro"===e&&(0<$(".time_ruler_bar").children().length?
($("#js_saveProjectModal").hide(),$("#js_pageCover").show(),g(),$.ajax({url:serverUrl+"task/schema",success:function(b){0===b.code&&null!==b.data?$.each(b.data,function(b,a){b=$('<option value="'+a.name+'">'+a.name+"</option>");$("#js_export_form_schema").append(b)}):console.log("error")}}),$("#js_exportProjectModal").show(),$("#js_exportProjectModal .icojam_delete").off().click(function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide()}),$("#js_export_modal_cancelPro").off().click(function(){$("#js_exportProjectModal").hide();
$("#js_pageCover").hide()}),$("#js_modal_export").off().click(function(){var b=$("#js_export_form_schema").val(),a=$("#js_export_form_name").val()?$("#js_export_form_name").val():"\u6253\u5305\u6587\u4ef6",d=$("#js_export_form_check").prop("checked"),c;c=d?parseInt(PLAYER.operateJson.getFirstFrame()):parseInt(PLAYER.TR.trimInCurrTime);d=d?parseInt(PLAYER.operateJson.getLastFrame()):parseInt(PLAYER.TR.trimOutCurrTime);d?$.ajax({url:serverUrl+"task/send",data:{projectid:PLAYER.jsonObj.id,name:a,trimin:40*
c,trimout:40*d,packschema:b},success:function(b){0===b.code&&null!==b.data?(console.log("\u6253\u5305\u6210\u529f",b.data),$("#js_exportProjectModal").hide(),$("#js_pageCover").hide(),$.ajax({url:serverUrl+"task/list",data:{status:parseInt($("#js_status_select").val()),currentPage:1,pageSize:20},success:function(b){0===b.code&&null!==b.data?PLAYER.observer.trigger("packbagList",b.data):console.log("error")}})):console.log("error")}}):alert("\u60a8\u5fc5\u987b\u6253\u5165\u51fa\u5165\u70b9\u6216\u8005\u9009\u62e9\u6574\u4e2a\u5e8f\u5217")})):
alert("\u6ca1\u6709\u4efb\u4f55\u7d20\u6750\u4f9b\u6253\u5305\uff01"))})});PLAYER.EventUtil.addHandler(document,"keydown",function(){var a=PLAYER.EventUtil.getEvent(a),u=PLAYER.EventUtil.getKeyCode(a);a.ctrlKey&&83===u?(PLAYER.EventUtil.preventDefault(a),v(),PLAYER.observer.listen("saveProModal",function(b){b&&($("#js_saveProjectModal").hide(),$("#js_pageCover").hide())})):a.ctrlKey&&78===u?(PLAYER.EventUtil.preventDefault(a),v(),PLAYER.observer.listen("saveProModal",function(b){b&&($("#js_saveProjectModal").hide(),
$("#js_pageCover").hide(),location.href=enterUrl)})):a.ctrlKey&&79===u?(PLAYER.EventUtil.preventDefault(a),v(),PLAYER.observer.listen("saveProModal",function(b){b&&(e(),$("#js_saveProjectModal").hide(),$("#js_pageCover").show(),$("#js_editProjectModal").show(),$("#js_editProjectModal .icojam_delete").on("click",function(){$("#js_editProjectModal").hide();$("#js_pageCover").hide()}),$("#js_edit_project_list").delegate($("#js_edit_project_list").children(),"selectstart",function(){return!1}),$("#js_edit_project_list").delegate(".project_delete",
"click",function(){if(confirm("\u786e\u5b9a\u5220\u9664\u5417?")){var b=$(this).parent("li").attr("data-id"),a=$(this).parent("li").find(".project_list_name").html();b===PLAYER.jsonObj.id?alert("\u60a8\u4e0d\u80fd\u5220\u9664\u5f53\u524d\u5de5\u7a0b\uff01"):($(this).parent("li").remove(),$.ajax({url:serverUrl+"proj/delete",data:{id:b},success:function(b){0===b.code&&null!==b.data?$.ajax({url:serverUrl+"proj/list",data:{currentPage:1,pageSize:20},success:function(b){0===b.code&&null!==b.data?(alert("\u5220\u9664:"+
a+"\u6210\u529f!"),PLAYER.observer.trigger("proList",b.data)):console.log("error")}}):console.log("error")}}))}else return!1}))})):a.ctrlKey&&66===u&&(PLAYER.EventUtil.preventDefault(a),v(),PLAYER.observer.listen("saveProModal",function(b){b&&(0<$(".time_ruler_bar").children().length?($("#js_saveProjectModal").hide(),$("#js_pageCover").show(),g(),$.ajax({url:serverUrl+"task/schema",success:function(b){0===b.code&&null!==b.data?$.each(b.data,function(b,a){b=$('<option value="'+a.name+'">'+a.name+"</option>");
$("#js_export_form_schema").append(b)}):console.log("error")}}),$("#js_exportProjectModal").show(),$("#js_exportProjectModal .icojam_delete").on("click",function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide()}),$("#js_export_modal_cancelPro").on("click",function(){$("#js_exportProjectModal").hide();$("#js_pageCover").hide()}),$("#js_modal_export").on("click",function(){var b=$("#js_export_form_schema").val(),a=$("#js_export_form_name").val()?$("#js_export_form_name").val():"\u6253\u5305\u6587\u4ef6",
c=$("#js_export_form_check").prop("checked"),f;f=c?parseInt(PLAYER.operateJson.getFirstFrame()):parseInt(PLAYER.TR.trimInCurrTime);c=c?parseInt(PLAYER.operateJson.getLastFrame()):parseInt(PLAYER.TR.trimOutCurrTime);c?$.ajax({url:serverUrl+"task/send",data:{projectid:PLAYER.jsonObj.id,name:a,trimin:f,trimout:c,packschema:b},success:function(b){0===b.code&&null!==b.data?(console.log("\u6253\u5305\u6210\u529f",b.data),$("#js_exportProjectModal").hide(),$("#js_pageCover").hide(),$.ajax({url:serverUrl+
"task/list",data:{status:parseInt($("#js_status_select").val()),currentPage:1,pageSize:20},success:function(b){0===b.code&&null!==b.data?PLAYER.observer.trigger("packbagList",b.data):console.log("error")}})):console.log("error")}}):alert("\u60a8\u5fc5\u987b\u6253\u5165\u51fa\u5165\u70b9\u6216\u8005\u9009\u62e9\u6574\u4e2a\u5e8f\u5217")})):alert("\u6ca1\u6709\u4efb\u4f55\u7d20\u6750\u4f9b\u6253\u5305\uff01"))}))});(function(){PLAYER.observer.listen("projectData",function(a){document.onselectstart=
function(b){return"input"===b.srcElement.tagName||"INPUT"===b.srcElement.tagName||"textarea"===b.srcElement.tagName||"TEXTAREA"===b.srcElement.tagName?!0:!1};var c,b,e;null===PLAYER.jsonObj&&(PLAYER.jsonObj=JSON.parse(a));$("#js_effect_wrap").delegate(".effect_fadeInOut,.effect_flashBlack,.effect_flashWhite,.effect_mosaic","mousedown",function(a){a.preventDefault();PLAYER.checkPlaying();$(a.target).parent("li").siblings().children(".effect_list").removeClass("active");$(a.target).addClass("active");
b=!1;e=$(a.target).attr("data-effect");c=null;$(document)[0].onmousemove=function(a){a=a||window.event;b=!0;console.log("e",e);"mosaic"===e?PLAYER.observer.trigger("move_effect_mosaic",a):PLAYER.observer.trigger("move_effect",a)};$(document)[0].onmouseup=function(a){b&&(PLAYER.observer.trigger("up_effect",a,e),b=!1);c=$(document)[0].onmousemove=null}});(function(){function b(b,a){if(0>=$("#js_time_ruler_bar_box").find(".edit_box_v").length)return!1;$("#js_time_ruler_bar_box").find(".edit_box_v").each(function(d,
t){d=$(this);f=d.offset().left;e=d.width();w=d.height();y=d.offset().top+3;n=parseInt(d.attr("data-sequencetrimin"));p=parseInt(d.attr("data-sequencetrimout"));b>=f&&b<=f+15&&a>=y&&a<=a+w?(d.addClass("effectActive"),d.prevSubclip=PLAYER.operateJson.checkPrevSubClip(n),d.prevSubclip?(d.prevSubclip.addClass("effectActive"),d.effectPos="prev_middle"):d.effectPos="header",c=d):b>=f+e-20&&b<=f+e&&a>=y&&a<=a+w?(d.addClass("effectActive"),d.nextSubclip=PLAYER.operateJson.checkNextSubClip(p),d.nextSubclip?
(d.nextSubclip.addClass("effectActive2"),d.effectPos="next_middle"):d.effectPos="footer",c=d):(d.removeClass("effectActive"),d.prevSubclip&&d.prevSubclip.removeClass("effectActive"),d.nextSubclip&&d.nextSubclip.removeClass("effectActive2"))})}function a(b,a){if(0>=$("#js_time_ruler_bar_box").find(".edit_box_v").length)return!1;$("#js_time_ruler_bar_box").find(".edit_box_v").each(function(d,t){d=$(this);f=d.offset().left;e=d.width();w=d.height();y=d.offset().top+3;if(b>=f&&b<=f+e&&a>=y&&a<=a+w){if(0<
d.find(".effect_box_all").length)return!1;d.addClass("effectActive");d.effectPos="all";c=d}else d.removeClass("effectActive")})}var f,e,w,y,n,p;PLAYER.observer.listen("move_effect_mosaic",function(b){a(b.clientX,b.clientY)});PLAYER.observer.listen("move_effect",function(a){b(a.clientX,a.clientY)})})();(function(){function b(b,a){function d(b,a,d,c,e){a={type:b,trimIn:a,trimOut:d,duration:c,attr:{},pos:e};"mosaic"===b&&(b={attr:{x1:0,y1:0,width:.2*$("#ocx").width(),height:.2*$("#ocx").height(),sizex:100,
sizey:100}},$.extend(a,b));return a}parseInt(b.css("left"));var c=parseInt(b.width()),e=parseFloat(25/PLAYER.TR.config.framePerPixel),f=parseInt(b.attr("data-trimin")),t=parseInt(b.attr("data-trimout"));if("mosaic"!==a&&"header"===b.effectPos){if(0<b.find(".effect_box_l").length)return!1;var k=$('<div class="effect_box effect_box_l"></div>'),l=f,r=f+25;k.attr("data-trimin",l);k.attr("data-type",a);k.attr("data-trimout",r);k.attr("data-duration",25);k.attr("data-pos","header");k.css("width",e);b.append(k);
e=b.attr("data-time");a=d(a,l,r,25,"header");PLAYER.operateJson.addEffectClip(e,a)}else if("mosaic"!==a&&"footer"===b.effectPos){if(0<b.find(".effect_box_r").length)return!1;k=$('<div class="effect_box effect_box_r"></div>');l=t-25;r=t;k.attr("data-trimin",l);k.attr("data-trimout",r);k.attr("data-duration",25);k.attr("data-pos","footer");k.css("width",e);k.attr("data-type",a);b.append(k);e=b.attr("data-time");a=d(a,l,r,25,"footer");PLAYER.operateJson.addEffectClip(e,a)}else if("mosaic"!==a&&"prev_middle"===
b.effectPos){if(0<b.find(".effect_box_l").length||0<b.prevSubclip.find(".effect_box_r").length)return!1;var k=parseInt(b.prevSubclip.attr("data-trimout")),r=$('<div class="effect_box effect_box_l"></div>'),c=$('<div class="effect_box effect_box_r"></div>'),l=f,t=f+25,f=k-25,g=50;r.attr("data-trimin",l);r.attr("data-trimout",t);r.attr("data-duration",g);r.css("width",e);r.attr("data-pos","header-middle");r.attr("data-type",a);c.attr("data-trimin",f);c.attr("data-trimout",k);c.attr("data-duration",
g);c.css("width",e);c.attr("data-pos","footer-middle");c.attr("data-type",a);b.append(r);b.prevSubclip.append(c);e=b.attr("data-time");l=d(a,l,t,g,"header-middle");PLAYER.operateJson.addEffectClip(e,l);e=b.prevSubclip.attr("data-time");a=d(a,f,k,g,"footer-middle");PLAYER.operateJson.addEffectClip(e,a)}else if("mosaic"!==a&&"next_middle"===b.effectPos){if(0<b.find(".effect_box_r").length||0<b.nextSubclip.find(".effect_box_l").length)return!1;k=parseInt(b.nextSubclip.attr("data-trimin"));r=$('<div class="effect_box effect_box_r"></div>');
c=$('<div class="effect_box effect_box_l"></div>');console.log("effectBox1",r);l=t-25;f=k;k+=25;g=50;r.attr("data-trimin",l);r.attr("data-trimout",t);r.attr("data-duration",g);r.css("width",e);r.attr("data-pos","footer-middle");r.attr("data-type",a);c.attr("data-trimin",f);c.attr("data-trimout",k);c.attr("data-duration",g);c.css("width",e);c.attr("data-pos","header-middle");c.attr("data-type",a);b.append(r);b.nextSubclip.append(c);e=b.attr("data-time");l=d(a,l,t,g,"footer-middle");PLAYER.operateJson.addEffectClip(e,
l);e=b.nextSubclip.attr("data-time");a=d(a,f,k,g,"header-middle");PLAYER.operateJson.addEffectClip(e,a)}else"mosaic"===a&&"all"===b.effectPos&&(k=$('<div class="effect_box effect_box_all"></div>'),l=f,r=t,k.attr("data-trimin",l),k.attr("data-trimout",r),k.attr("data-duration",t-f),k.css("width",c),k.attr("data-pos","all"),k.attr("data-type",a),b.append(k),e=b.attr("data-time"),a=d(a,l,r,t-f,"all"),PLAYER.operateJson.addEffectClip(e,a));return b}PLAYER.observer.listen("up_effect",function(a,d){null!==
c&&(c.removeClass("effectActive"),c.prevSubclip?c.prevSubclip.removeClass("effectActive"):c.nextSubclip&&c.nextSubclip.removeClass("effectActive2"),b(c,d),console.log("\u589e\u52a0\u7279\u6280",PLAYER.jsonObj.rootBin.sequence[0].tracks),PLAYER.operateJson.sendJson())})})()})})();(function(){PLAYER.observer.listen("projectData",function(a,e){if(!e){if(0===JSON.parse(a).reference.material.length)return!1;a=PLAYER.operateJson.translateMsToFfp(a);PLAYER.jsonObj=a;e=0;for(var b;b=a.rootBin.sequence[0].tracks[e++];){var c=
b.type,d=b.index;PLAYER.operateJson.sortClipAttr();var t=PLAYER.operateJson.getTrack(c,d);0!==b.subclip.length&&$.each(b.subclip,function(b,a){var d,c;PLAYER.operateJson.getMaterialDuration(a.assetID||a.id,function(b){d=b.duration;c=b.name});b=(a.trimOut-a.trimIn)/PLAYER.TR.config.framePerPixel;var e=a.sequenceTrimIn/PLAYER.TR.config.framePerPixel,f=$('<div class="edit_box draggable" data-trimin="'+a.trimIn+'" data-trimout="'+a.trimOut+'" data-sequencetrimin="'+a.sequenceTrimIn+'" data-sequencetrimout="'+
a.sequenceTrimOut+'">'+c+"</div>");f.attr("data-duration",d||2E3);f.attr("data-name",c);f.attr("data-id",a.assetID||a.id);f.attr("data-type",a.type);f.attr("data-interleaved",a.interleaved);f.attr("data-time",a.createTime);f.css("width",b);f.css("left",e);f.attr("data-intid",a.interleaved_id);b="edit_box_"+t.attr("data-type");f.addClass(b);if(a.effect&&0!==a.effect.length){var k,l;$.each(a.effect,function(b,d){k=$('<div class="effect_box"></div>');k.attr("data-duration",d.duration);k.attr("data-trimin",
d.trimIn);k.attr("data-trimout",d.trimOut);l=(d.trimOut-d.trimIn)/PLAYER.TR.config.framePerPixel;k.width(l);"mosaic"===d.type?k.addClass("effect_box_all"):d.trimOut===a.trimOut?k.addClass("effect_box_r"):d.trimIn===a.trimIn&&k.addClass("effect_box_l");f.append(k)})}t.append(f)})}PLAYER.operateJson.sendJson()}})})();(function(){PLAYER.observer.listen("projectData",function(a){null===PLAYER.jsonObj&&(PLAYER.jsonObj=JSON.parse(a));$("#js_add_groupProgram").on("click",function(){PLAYER.checkPlaying();
for(var a=[],b=0;b<PLAYER.chooseArray.length;b++)$.ajax({url:serverUrl+"program/info",async:!1,data:{assetId:PLAYER.chooseArray[b]},success:function(c){if(0===c.code&&null!==c.data){if(c.data.data.assetId=PLAYER.chooseArray[b],a.push(c.data.data),a.length===PLAYER.chooseArray.length){var d,e,f,g,w,m;c=PLAYER.TR.currTime;var n,p,k;console.log("program_info",a);for(var l=0;l<a.length;l++){p="video_"+l+PLAYER.genNonDuplicateID(12);k="audio_"+l+PLAYER.genNonDuplicateID(12);f="interleaved_id_"+l+PLAYER.genNonDuplicateID(12);
w=a[l].duration;c+=a[l].duration;m=c-a[l].duration;g=a[l].duration;n=a[l].name;d=m/PLAYER.TR.config.framePerPixel;_id=a[l].assetId;e=a[l].duration/PLAYER.TR.config.framePerPixel;var r=$('<div class="edit_box edit_box_v draggable" data-trimin="0" data-trimout="'+w+'" data-sequencetrimin="'+m+'" data-sequencetrimout="'+c+'">'+n+"</div>"),h=$('<div class="edit_box edit_box_a draggable" data-trimin="0" data-trimout="'+w+'" data-sequencetrimin="'+m+'" data-sequencetrimout="'+c+'">'+n+"</div>");r.attr("data-time",
p);r.attr("data-interleaved","true");r.attr("data-type","video_and_audio");r.attr("data-intid",f);r.attr("data-duration",g);r.attr("data-id",_id);r.attr("data-name",n);r.css("left",d);r.css("width",e);h.attr("data-time",k);h.attr("data-interleaved","true");h.attr("data-type","video_and_audio");h.attr("data-intid",f);h.attr("data-duration",g);h.attr("data-id",_id);h.attr("data-name",n);h.css("left",d);h.css("width",e);$('.bar_v[data-index="1"]').append(r);$('.bar_a[data-index="1"]').append(h);d={assetID:_id,
name:n,trimIn:0,trimOut:w,sequenceTrimIn:m,sequenceTrimOut:c,createTime:p,interleaved:!0,interleaved_id:f,effect:[]};f={assetID:_id,name:n,trimIn:0,trimOut:w,createTime:k,sequenceTrimIn:m,sequenceTrimOut:c,interleaved:!0,interleaved_id:f,volume:100};1<=$(".bar_v").children().length&&PLAYER.operateJson.checkCoverEvent(r);1<=$(".bar_a").children().length&&PLAYER.operateJson.checkCoverEvent(h);PLAYER.operateJson.addVideoClipAttr(d,1);PLAYER.operateJson.addAudioClipAttr(f,1);PLAYER.operateJson.addProjectMaterial(a[l])}$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()));
c=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15E3);PLAYER.TR.updateEvent(c);PLAYER.TR.fixClipWidth();PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame();PLAYER.PTR.updateEvent(PLAYER.PTR.config);PLAYER.operateJson.sendJson();PLAYER.chooseArray=[];$("#js_thumbnail_box .col-md-3").removeClass("active")}}else console.log("error")}})})})})();(function(a,e,b){function c(a){this._init(a)}b.extend(c.prototype,{_init:function(a){this.options={type:"",cont:""};b.extend(!0,
this.options,a||{});this._initDom();return this},_initDom:function(){this.$type=this.options.type;this.$cont=this.options.cont;this.$doc=b(e);this._initSliderDragEvent();if(""===this.$type)throw Error("\u60a8\u5fc5\u987b\u8f93\u5165\u62d6\u62fd\u7684\u7d20\u6750\u7c7b\u578b");if(""===this.$cont)throw Error("\u60a8\u5fc5\u987b\u8f93\u5165\u62d6\u62fd\u7684\u7d20\u6750");"video_and_audio"===this.$type?this._down_video_and_audio()._move_video_and_audio()._up_video_and_audio():"video"===this.$type?this._down_video()._move_video()._up_video():
"audio"===this.$type?this._down_audio()._move_audio()._up_audio():"subtitle"===this.$type&&this._down_subtitle()._move_subtitle()._up_subtitle()},_initSliderDragEvent:function(){var a=this,c=this.$doc,e=!1;a.$cont&&a.$cont.delegate(a.$cont.children(),"mousedown",function(d){d.preventDefault();PLAYER.checkPlaying();PLAYER.hideSubititleEdit();PLAYER.hideEffectEdit();0===b("#js_time_ruler_bar_box").find(".edit_box").length?PLAYER.initDrag=!0:PLAYER.initDrag=!1;e=!1;if("video_and_audio"===a.$type){var f=
b(d.target).parents(".col-md-3"),t=f.attr("data-id");b.ajax({url:serverUrl+"program/info",data:{assetId:t},success:function(b){0===b.code&&null!==b.data?(materialAttr=b.data.data,materialAttr.assetId=t,PLAYER.observer.trigger("_down_"+a.$type,d,materialAttr)):console.log("error")}})}else"video"===a.$type?(f=b(d.target),f.addClass("active"),f.siblings().removeClass("active"),materialAttr={assetId:"e"+Math.random(),duration:50,filePath:f.attr("data-http"),name:f.siblings("span").html()},PLAYER.observer.trigger("_down_"+
a.$type,d,materialAttr)):"audio"===a.$type?(f=b(d.target),f.addClass("active"),f.siblings().removeClass("active"),materialAttr={assetId:"e"+Math.random(),duration:1E3,filePath:f.attr("data-http"),name:f.siblings("span").html()},PLAYER.observer.trigger("_down_"+a.$type,d,materialAttr)):"subtitle"===a.$type&&(f=b(d.target),f.addClass("active"),f.siblings().removeClass("active"),t=f.attr("data-temid"),(f=JSON.parse(PLAYER.operateJson.getSubtitleTemp(t)))&&PLAYER.observer.trigger("_down_"+a.$type,d,f));
c.on("mousemove.slider",function(b){e=!0;PLAYER.observer.trigger("_move_"+a.$type,b,e)}).on("mouseup.slider",function(b){c.off(".slider");PLAYER.observer.trigger("_up_"+a.$type,b,e);e=!1})});return a},_down_video_and_audio:function(){var a=this;PLAYER.observer.listen("_down_video_and_audio",function(b,c){a.materialAttr=c;PLAYER.singelton(function(){a._addVideoClip(b,c);a._addAudioClip(b,c)})()});return a},_move_video_and_audio:function(){var a=this;PLAYER.observer.listen("_move_video_and_audio",function(b,
c){a.moveObj=a._calTimerRulerRrea(b.clientX,b.clientY,"video_and_audio")});return a},_up_video_and_audio:function(){var a=this;PLAYER.observer.listen("_up_video_and_audio",function(c,d){if(d){var e="interleaved_id_"+PLAYER.genNonDuplicateID(12),f="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);"video_and_audio"===a.$type&&(d=a._updateVideoClip(c,"video_and_audio",e,f),c=a._updateAudioClip(c,"video_and_audio",e,f),d&&c&&(PLAYER.operateJson.addVideoClipAttr(d.clipAttr,d._index),PLAYER.operateJson.addAudioClipAttr(c.clipAttr,
c._index),a._updateJsonAttr()))}else return b("#js_time_ruler_bar_box .draghelper").remove(),!1});return a},_down_video:function(){var a=this;PLAYER.observer.listen("_down_video",function(b,c){a.materialAttr=c;PLAYER.singelton(function(){a._addVideoClip(b,c)})()});return a},_move_video:function(){var a=this;PLAYER.observer.listen("_move_video",function(b){a.moveObj=a._calTimerRulerRrea(b.clientX,b.clientY,"video")});return a},_up_video:function(){var a=this;PLAYER.observer.listen("_up_video",function(c,
d){if(!d)return b("#js_time_ruler_bar_box .draghelper").remove(),!1;"video"===a.$type&&(d="check_interleaved_id_"+PLAYER.genNonDuplicateID(12),c=a._updateVideoClip(c,"video","",d))&&(PLAYER.operateJson.addVideoClipAttr(c.clipAttr,c._index),a._updateJsonAttr())});return a},_down_audio:function(){var a=this;PLAYER.observer.listen("_down_audio",function(b,c){a.materialAttr=c;PLAYER.singelton(function(){a._addAudioClip(b,c)})()});return a},_move_audio:function(){var a=this;PLAYER.observer.listen("_move_audio",
function(b){a.moveObj=a._calTimerRulerRrea(b.clientX,b.clientY,"audio")});return a},_up_audio:function(){var a=this;PLAYER.observer.listen("_up_audio",function(c,d){if(!d)return b("#js_time_ruler_bar_box .draghelper").remove(),!1;"audio"===a.$type&&(d="check_interleaved_id_"+PLAYER.genNonDuplicateID(12),c=a._updateAudioClip(c,"audio","",d))&&(PLAYER.operateJson.addAudioClipAttr(c.clipAttr,c._index),a._updateJsonAttr())});return a},_down_subtitle:function(){var a=this;PLAYER.observer.listen("_down_subtitle",
function(b,c){a.materialAttr=c;PLAYER.singelton(function(){a._addSubtitleClip(b,c)})()});return a},_move_subtitle:function(){var a=this;PLAYER.observer.listen("_move_subtitle",function(b){a.moveObj=a._calTimerRulerRrea(b.clientX,b.clientY,"subtitle")});return a},_up_subtitle:function(){var a=this;PLAYER.observer.listen("_up_subtitle",function(c,d){if(!d)return b("#js_time_ruler_bar_box .draghelper").remove(),!1;"subtitle"===a.$type&&(d="check_interleaved_id_"+PLAYER.genNonDuplicateID(12),c=a._updateSubtitleClip(c,
"subtitle",d))&&(PLAYER.operateJson.addSubtitleClipAttr(c.clipAttr,c._index),a._updateJsonAttr())});return a},_addVideoClip:function(a,c){var d,e=c.duration,g=parseInt(a.clientX*PLAYER.TR.config.framePerPixel),t=c.duration+g,n=this._calculateWidth(c.duration);b.each(b("#js_time_ruler_bar_box .bar_v"),function(f,k){d=b('<div class="edit_box edit_box_v draggable draghelper">'+c.name+"</div>");d.attr("data-duration",c.duration);d.attr("data-name",c.name);d.attr("data-id",c.assetId);d.css("left",a.clientX);
d.css("width",n);d.attr("data-trimin",0);d.attr("data-trimout",e);d.attr("data-sequencetrimin",g);d.attr("data-sequencetrimout",t);b(k).append(d);_duration=parseInt(b(k).children(".draghelper").attr("data-duration"));_left=parseInt(b(k).children(".draghelper").css("left"))});return this},_addAudioClip:function(a,c){var d,e=c.duration,g=parseInt(a.clientX*PLAYER.TR.config.framePerPixel),t=c.duration+g,n=this._calculateWidth(c.duration);b.each(b("#js_time_ruler_bar_box .bar_a"),function(f,k){d=b('<div class="edit_box edit_box_a draggable draghelper">'+
c.name+"</div>");d.attr("data-duration",c.duration);d.attr("data-name",c.name);d.attr("data-id",c.assetId);d.css("left",a.clientX);d.css("width",n);d.attr("data-trimin",0);d.attr("data-trimout",e);d.attr("data-sequencetrimin",g);d.attr("data-sequencetrimout",t);b(k).append(d)});return this},_addSubtitleClip:function(a,c){var d,e=c.duration,g=parseInt(a.clientX*PLAYER.TR.config.framePerPixel),h=c.duration+g,n=this._calculateWidth(c.duration);b.each(b("#js_time_ruler_bar_box .bar_t"),function(p,k){d=
b('<div class="edit_box edit_box_t draggable draghelper">'+c.name+"</div>");d.attr("data-duration",c.duration);d.attr("data-name",c.name);d.attr("data-id",c.id);d.css("left",a.clientX);d.css("width",n);d.attr("data-trimin",0);d.attr("data-trimout",e);d.attr("data-sequencetrimin",g);d.attr("data-sequencetrimout",h);b(k).append(d)});return this},_calculateWidth:function(a){PLAYER.initDrag?(PLAYER.TR.config.maxTime=a+15E3,PLAYER.TR.updateEvent(a+15E3,!0),a/=PLAYER.TR.config.framePerPixel,PLAYER.initDrag=
!0):a/=PLAYER.TR.config.framePerPixel;return a},_calTimerRulerRrea:function(a,c,e){var d,g=PLAYER.TR.config,f=Math.abs(parseInt(b("#js_time_ruler_bar_box").css("marginLeft")));if("video_and_audio"===e){var n,p,k,l;b(".bar_v").each(function(e,h){e=parseInt(b(this).offset().top);h=parseInt(b(this).offset().left);that=b(this);d=that.attr("data-index");c>=e&&c<=e+35&&(a>=h||15>=Math.abs(a-h))?(that.addClass("overActive"),that.siblings(".bar_v").removeClass("overActive"),b('.bar_a[data-index="'+d+'"]').addClass("overActive"),
b('.bar_a[data-index="'+d+'"]').siblings(".bar_a").removeClass("overActive"),that.children(".draghelper").show(),l=that.children(".draghelper"),n=a-h,0>=n-f&&(n=f),n=parseInt(n*g.framePerPixel)/g.framePerPixel,p=Math.round(n*g.framePerPixel),k=p+(l.attr("data-trimout")-l.attr("data-trimin")),0!==l.siblings().length&&(e=PLAYER.operateJson.getAllsequenceTrimIn(l),console.log("adhere_point",e),5>=Math.abs(p-e)/g.framePerPixel?(n=e/g.framePerPixel,p=e,e=l.attr("data-trimout")-l.attr("data-trimin"),k=
p+e,PLAYER.operateJson.showAdhere(l,"forward")):PLAYER.operateJson.hideAdhere(l)),that.children(".draghelper").css("left",n),that.children(".draghelper").attr("data-sequencetrimin",p),that.children(".draghelper").attr("data-sequencetrimout",k),b('.bar_a[data-index="'+d+'"]').children(".draghelper").show(),b('.bar_a[data-index="'+d+'"]').children(".draghelper").css("left",n),b('.bar_a[data-index="'+d+'"]').children(".draghelper").attr("data-sequencetrimin",p),b('.bar_a[data-index="'+d+'"]').children(".draghelper").attr("data-sequencetrimout",
k)):(that.children(".draghelper").hide(),b('.bar_a[data-index="'+d+'"]').children(".draghelper").hide(),that.removeClass("overActive"),b('.bar_a[data-index="'+d+'"]').removeClass("overActive"))})}else"video"===e?b(".bar_v").each(function(e,h){e=parseInt(b(this).offset().top);h=parseInt(b(this).offset().left);that=b(this);d=that.attr("data-index");c>=e&&c<=e+35&&(a>=h||15>=Math.abs(a-h))?(that.addClass("overActive"),that.siblings(".bar_v").removeClass("overActive"),l=that.children(".draghelper"),n=
a-h,0>=n-f&&(n=f),n=parseInt(n*g.framePerPixel)/g.framePerPixel,p=Math.round(n*g.framePerPixel),k=p+(l.attr("data-trimout")-l.attr("data-trimin")),0!==l.siblings().length&&(e=PLAYER.operateJson.getAllsequenceTrimIn(l),5>=Math.abs(p-e)/g.framePerPixel?(n=e/g.framePerPixel,p=Math.round(n*g.framePerPixel),e=l.attr("data-trimout")-l.attr("data-trimin"),k=p+e,PLAYER.operateJson.showAdhere(l,"forward")):PLAYER.operateJson.hideAdhere(l)),that.children(".draghelper").show(),that.children(".draghelper").css("left",
n),that.children(".draghelper").attr("data-sequencetrimin",p),that.children(".draghelper").attr("data-sequencetrimout",k)):(that.children(".draghelper").hide(),that.removeClass("overActive"))}):"audio"===e?b(".bar_a").each(function(e,h){e=parseInt(b(this).offset().top);h=parseInt(b(this).offset().left);that=b(this);d=that.attr("data-index");c>=e&&c<=e+35&&(a>=h||15>=Math.abs(a-h))?(that.addClass("overActive"),that.siblings(".bar_a").removeClass("overActive"),that.children(".draghelper").show(),l=
that.children(".draghelper"),n=a-h,0>=n-f&&(n=f),n=parseInt(n*g.framePerPixel)/g.framePerPixel,p=Math.round(n*g.framePerPixel),k=p+(l.attr("data-trimout")-l.attr("data-trimin")),0!==l.siblings().length&&(e=PLAYER.operateJson.getAllsequenceTrimIn(l),5>=Math.abs(p-e)/g.framePerPixel?(n=e/g.framePerPixel,p=Math.round(n*g.framePerPixel),e=l.attr("data-trimout")-l.attr("data-trimin"),k=p+e,PLAYER.operateJson.showAdhere(l,"forward")):PLAYER.operateJson.hideAdhere(l)),that.children(".draghelper").css("left",
n),that.children(".draghelper").attr("data-sequencetrimin",p),that.children(".draghelper").attr("data-sequencetrimout",k)):(that.children(".draghelper").hide(),that.removeClass("overActive"))}):"subtitle"===e&&b(".bar_t").each(function(e,h){e=parseInt(b(this).offset().top);h=parseInt(b(this).offset().left);that=b(this);d=that.attr("data-index");c>=e&&c<=e+35&&(a>=h||15>=Math.abs(a-h))?(that.addClass("overActive"),that.siblings(".bar_a").removeClass("overActive"),that.children(".draghelper").show(),
that.children(".draghelper").css("background","pink"),l=that.children(".draghelper"),n=a-h,0>=n-f&&(n=f),n=parseInt(n*g.framePerPixel)/g.framePerPixel,p=Math.round(n*g.framePerPixel),k=p+(l.attr("data-trimout")-l.attr("data-trimin")),0!==l.siblings().length&&(e=PLAYER.operateJson.getAllsequenceTrimIn(l),5>=Math.abs(p-e)/g.framePerPixel?(n=e/g.framePerPixel,p=Math.round(n*g.framePerPixel),e=l.attr("data-trimout")-l.attr("data-trimin"),k=p+e,PLAYER.operateJson.showAdhere(l,"forward")):PLAYER.operateJson.hideAdhere(l)),
that.children(".draghelper").css("left",n),that.children(".draghelper").attr("data-sequencetrimin",p),that.children(".draghelper").attr("data-sequencetrimout",k)):(that.children(".draghelper").hide(),that.removeClass("overActive"))});return d},_updateVideoClip:function(a,c,e,g){var d,f;b.each(b(".bar_v"),function(a,p){if(b(p).hasClass("overActive")){f=parseInt(b(p).attr("data-index"));a=c+"_"+PLAYER.genNonDuplicateID(12);var k,l,h,n,m;k=b(p).children(".draghelper").attr("data-id");b(p).children(".draghelper").attr("data-name");
parseInt(b(p).children(".draghelper").attr("data-duration"));l=parseInt(b(p).children(".draghelper").attr("data-trimin"));h=parseInt(b(p).children(".draghelper").attr("data-trimout"));n=parseInt(b(p).children(".draghelper").attr("data-sequencetrimin"));m=parseInt(b(p).children(".draghelper").attr("data-sequencetrimout"));b(p).children(".draghelper").css("background","#33bbff");b(p).children(".draghelper").attr("data-type",c);b(p).children(".draghelper").attr("data-time",a);d={assetID:k,trimIn:l,trimOut:h,
sequenceTrimIn:n,sequenceTrimOut:m,effect:[],type:c,createTime:a};"video_and_audio"===c?(b(p).children(".draghelper").attr("data-interleaved",!0),d.interleaved=!0,b(p).children(".draghelper").attr("data-intid",e),d.interleaved_id=e):"video"===c&&(k="no_interleaved_id_"+PLAYER.genNonDuplicateID(12),b(p).children(".draghelper").attr("data-interleaved",!1),d.interleaved=!1,b(p).children(".draghelper").attr("data-intid",k),d.interleaved_id=k);2<=b(p).children().length&&PLAYER.operateJson.checkCoverEvent(b(p).children(".draghelper"),
g);b(p).removeClass("overActive");b(p).children(".draghelper").removeClass("draghelper");PLAYER.operateJson.hideAdhere(b(p))}else b(p).children(".draghelper").remove()});if(d)return{clipAttr:d,_index:f}},_updateAudioClip:function(a,c,e,g){var d,h;b.each(b(".bar_a"),function(a,f){if(b(f).hasClass("overActive")){h=parseInt(b(f).attr("data-index"));a=c+"_"+PLAYER.genNonDuplicateID(12);var k,l,n,p,m;k=b(f).children(".draghelper").attr("data-id");b(f).children(".draghelper").attr("data-name");parseInt(b(f).children(".draghelper").attr("data-duration"));
l=parseInt(b(f).children(".draghelper").attr("data-trimin"));n=parseInt(b(f).children(".draghelper").attr("data-trimout"));p=parseInt(b(f).children(".draghelper").attr("data-sequencetrimin"));m=parseInt(b(f).children(".draghelper").attr("data-sequencetrimout"));b(f).children(".draghelper").css("background","#33bbff");b(f).children(".draghelper").attr("data-type",c);b(f).children(".draghelper").attr("data-time",a);d={assetID:k,trimIn:l,trimOut:n,sequenceTrimIn:p,sequenceTrimOut:m,volume:100,type:c,
createTime:a};"video_and_audio"===c?(b(f).children(".draghelper").attr("data-interleaved",!0),d.interleaved=!0,b(f).children(".draghelper").attr("data-intid",e),d.interleaved_id=e):"audio"===c&&(k="no_interleaved_id_"+PLAYER.genNonDuplicateID(12),b(f).children(".draghelper").attr("data-interleaved",!1),d.interleaved=!1,b(f).children(".draghelper").attr("data-intid",k),d.interleaved_id=k);2<=b(f).children().length&&PLAYER.operateJson.checkCoverEvent(b(f).children(".draghelper"),g);b(f).removeClass("overActive");
b(f).children(".draghelper").removeClass("draghelper");PLAYER.operateJson.hideAdhere(b(f))}else b(f).children(".draghelper").remove()});if(d)return{clipAttr:d,_index:h}},_updateSubtitleClip:function(a,c,e){var d,g;b.each(b(".bar_t"),function(a,f){if(b(f).hasClass("overActive")){g=parseInt(b(f).attr("data-index"));var h,k,l;a=b(f).children(".draghelper").attr("data-id");b(f).children(".draghelper").attr("data-name");parseInt(b(f).children(".draghelper").attr("data-duration"));h=c+"_"+PLAYER.genNonDuplicateID(12);
parseInt(b(f).children(".draghelper").attr("data-trimin"));parseInt(b(f).children(".draghelper").attr("data-trimout"));k=parseInt(b(f).children(".draghelper").attr("data-sequencetrimin"));l=parseInt(b(f).children(".draghelper").attr("data-sequencetrimout"));b(f).children(".draghelper").attr("data-time",h);b(f).children(".draghelper").css("background","#ea3af5");b(f).children(".draghelper").attr("data-type",c);b(f).children(".draghelper").attr("data-interleaved",!1);var m="no_interleaved_id_"+PLAYER.genNonDuplicateID(12);
b(f).children(".draghelper").attr("data-intid",m);d=JSON.parse(PLAYER.operateJson.getSubtitleTemp(a));b.extend(d,{trimIn:0,trimOut:2E3,sequenceTrimIn:k,sequenceTrimOut:l,createTime:h,type:c,interleaved:!1,interleaved_id:m});2<=b(f).children().length&&PLAYER.operateJson.checkCoverEvent(b(f).children(".draghelper"),e);PLAYER.operateJson.hideAdhere(b(f))}else b(f).children(".draghelper").remove()});if(d)return{clipAttr:d,_index:g}},_updateJsonAttr:function(){b(".time_ruler_bar").removeClass("overActive");
b(".time_ruler_bar").children().removeClass("onselected");b(".time_ruler_bar").children(".draghelper").removeClass("draghelper");b("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()));var a=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15E3||0);PLAYER.TR.updateEvent(a);PLAYER.TR.fixClipWidth();PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame();PLAYER.PTR.updateEvent(PLAYER.PTR.config);PLAYER.operateJson.addProjectMaterial(this.materialAttr);
PLAYER.operateJson.sendJson()}});a.DragObj=c})(window,document,jQuery);var x=function(){var a={};return{create:function(c,b){return a[c]?a[c]:a[c]=new DragObj({type:c,cont:b})}}}();PLAYER.observer.listen("projectData",function(a){null===PLAYER.jsonObj&&(PLAYER.jsonObj=JSON.parse(a));x.create("video_and_audio",$("#js_thumbnail_box"));x.create("subtitle",$("#js_subtitle_wrap"));x.create("video",$("#js_images_wrap"));x.create("audio",$("#js_audio_wrap"))})});