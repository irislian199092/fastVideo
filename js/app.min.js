$(function(){function m(){$("#js_effect_h_form").empty();var a=$('<div class="form-group"><label class="col-md-4 control-label" for="name" >\u5de6\u8fb9\u8ddd</label><div class="col-md-8"><input type="range" class="form-control" id="js_effect_left" min="0" step="0.5" ></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_effect_left_value"  disabled="disabled"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" >\u4e0a\u8fb9\u8ddd</label><div class="col-md-8"><input type="range" class="form-control" id="js_effect_top" min="0" step="0.5"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_effect_top_value" disabled="disabled"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" >\u5bbd\u5ea6</label><div class="col-md-8"><input type="range" class="form-control" id="js_effect_width" min="0" step="0.5"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_effect_width_value" disabled="disabled"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" >\u9ad8\u5ea6</label><div class="col-md-8"><input type="range" class="form-control" id="js_effect_height" min="0" step="0.5" ></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_effect_height_value" disabled="disabled"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><button type="button" class="btn btn-sm pull-right" id="js_effect_btn">\u5173\u95ed</button></div></div>');
$("#js_effect_h_form").append(a);0<$("#ocx").find("#move_box").length?$("#move_box").remove():(a=$('<div id="move_box"></div>'),$("#ocx").append(a))}function n(a,c,h,d,b){$("#js_carve").removeClass("col-md-6").addClass("col-md-4");$("#js_carve_edit").show();$("#js_carve_edit .list li").eq(1).trigger("click");(function(a){$("#js_effect_h_form").height()>$(".effect_h_form_wrap").height()&&($(".effect_edit_track").show(),new Scrollbar({dirSelector:"y",contSelector:$(".effect_h_form_wrap"),barSelector:$(".effect_edit_track"),
sliderSelector:$(".effect_edit_scroll")}));a=JSON.parse(a);$("#move_box").css("left",a.x1);$("#move_box").css("top",a.y1);$("#move_box").css("width",a.width);$("#move_box").css("height",a.height);$("#js_effect_left").attr("max",$("#ocx").width());$("#js_effect_width").attr("max",$("#ocx").width());$("#js_effect_top").attr("max",$("#ocx").height());$("#js_effect_height").attr("max",$("#ocx").height());$("#js_effect_left,#js_effect_left_value").val(a.x1);$("#js_effect_top,#js_effect_top_value").val(a.y1);
$("#js_effect_width,#js_effect_width_value").val(a.width);$("#js_effect_height,#js_effect_height_value").val(a.height)})(a);(function(a){function e(a){PLAYER.OCX.adjustEffect(a);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime));PLAYER.operateJson.updateEffectClip(c,a.attr)}var f={trackType:d,trackIndex:h,subClipId:c,name:b,attr:JSON.parse(a)};f.attr.x1=parseFloat($("#js_effect_left").val());f.attr.y1=parseFloat($("#js_effect_top").val());f.attr.x2=f.attr.x1+parseFloat($("#js_effect_width").val());f.attr.y2=
f.attr.y1+parseFloat($("#js_effect_height").val());$("#js_effect_left")[0].oninput=function(a){a=parseFloat($(a.target).val());$("#js_effect_left_value").val(a);f.attr.x1=a;$("#move_box").css("left",a);e(f)};$("#js_effect_top")[0].oninput=function(a){a=parseFloat($(a.target).val());$("#js_effect_top_value").val(a);f.attr.y1=a;$("#move_box").css("top",a);e(f)};$("#js_effect_width")[0].oninput=function(a){a=parseFloat($(a.target).val());$("#js_effect_width_value").val(a);f.attr.width=a;$("#move_box").css("width",
a);e(f)};$("#js_effect_height")[0].oninput=function(a){a=parseFloat($(a.target).val());$("#js_effect_height_value").val(a);f.attr.height=a;$("#move_box").css("height",a);e(f)};$("#js_effect_btn").on("click",function(){PLAYER.hideEffectEdit()})})(a)}PLAYER.player=new PLAYER.playerFunction;PLAYER.documentEvent.enable();$("#js_initProjectModal").show();$("#js_pageCover").show();$("#js_loginout").on("click",function(){PLAYER.checkPlaying();location.href=loginUrl});$(".date_picker").date_input();var p=
document.getElementById("js_voCanvas");p.width="70";p.height=$("#js_time_ruler_voiceBox").height()-21;$("#js_logo_toggle").on("click",function(){$(".slider_context").animate({left:"-1080px"},"slow")});$("#js_notifications .header_box li").on("click",function(){$(this).addClass("active");$(this).siblings().removeClass("active");var a=$(this).index();$("#js_tab_content").children().eq(a).show();$("#js_tab_content").children().eq(a).siblings().hide()});$("#js_init_project_list").delegate('li:not(".header")',
"click",function(){$(this).addClass("active");$(this).siblings("li").removeClass("active")});$("#js_edit_project_list").delegate('li:not(".header")',"click",function(){$(this).addClass("active");$(this).siblings("li").removeClass("active")});$("#js_carve_edit .list li").on("click",function(){$(this).addClass("active");$(this).siblings("li").removeClass("active");var a=$(this).index();$(".carve_edit_body").children().eq(a).show();$(".carve_edit_body").children().eq(a).siblings().hide()});$("#js_toolbar_icon_ungroup").mousemove(function(){$(this).addClass("active")}).mouseout(function(){$(this).removeClass("active")});
$("#js_toolbar_icon_group").mousemove(function(){$(this).addClass("active")}).mouseout(function(){$(this).removeClass("active")});var k=2;$("#js_add_audio_track").on("click",function(){k++;if(9===k)return alert("\u60a8\u6700\u591a\u80fd\u6dfb\u52a08\u8f68\u9053"),!1;var a=$('<div class="time_ruler_bar bar_a" data-type="a" data-index="'+k+'"></div>'),c=$('<div class="time_ruler_title_list" data-type="a'+k+'">A'+k+"</div>");$("#js_time_ruler_bar_box").append(a);$("#js_time_ruler_title_box").append(c);
35*$("#js_time_ruler_title_box").children(".time_ruler_title_list").size()>=$("#js_time_ruler_track_box").height()&&($(".time_ruler_track").show(),new Scrollbar({dirSelector:"y",contSelector:$("#js_time_ruler_track_box"),barSelector:$(".time_ruler_track"),sliderSelector:$(".time_ruler_scroll")}));PLAYER.jsonObj.rootBin.sequence[0].tracks.push({type:"a",index:k,subclip:[]})});$("#js_thumbnail_box").delegate($("#js_thumbnail_box").children(),"click",function(a){if($(a.target).parent().hasClass("thumbnail")){var c=
$(a.target).parent().parent(".col-md-3");c.hasClass("active")?(c.removeClass("active"),$.each(PLAYER.chooseArray,function(a,d){d===c.attr("data-id")&&PLAYER.chooseArray.splice(a,1)})):(c.addClass("active"),PLAYER.chooseArray.push(c.attr("data-id")));console.log("PLAYER.chooseArray",PLAYER.chooseArray)}});$(".carve").delegate($(".carve").children(),"click",function(a){$(".carve").addClass("choose");$(".time_ruler_wrap").removeClass("choose");$(".player_box").removeClass("choose");$(".time_ruler_toolbar").removeClass("choose");
$(".time_ruler_voiceBox").removeClass("choose");PLAYER.PTR.DragDrop.disable();PLAYER.TR.DragDrop.disable();$(a.target).parent("li").hasClass("subtitle")&&($(a.target).addClass("active"),$(a.target).parent().siblings().children(".subtitle_list").removeClass("active"));"js_logo"===a.target.id&&$(".slider_context").animate({left:"0"},"slow");"js_style_list"===a.target.id&&($(".meterial_list_box").show(),$(".meterial_list_track").show(),$(".meterial_thumbnail_box").hide(),$(".meterial_thumbnail_track").hide(),
$("#js_style_list").parent("li").addClass("active"),$("#js_style_list").parent("li").siblings().removeClass("active"));"js_style_thumbnail"===a.target.id&&($(".meterial_list_box").hide(),$(".meterial_list_track").hide(),$(".meterial_thumbnail_box").show(),$(".meterial_thumbnail_track").show(),$("#js_style_thumbnail").parent("li").addClass("active"),$("#js_style_thumbnail").parent("li").siblings().removeClass("active"));"tab_material"===a.target.id&&($("#tab_material").parent("li").addClass("active"),
$("#tab_material").parent("li").siblings().removeClass("active"),$("#tab_1").show(),$("#tab_1").siblings(".js_tab").hide());"tab_subtitle"===a.target.id&&($("#tab_subtitle").parent("li").addClass("active"),$("#tab_subtitle").parent("li").siblings().removeClass("active"),$("#tab_2").show(),$("#tab_2").siblings(".js_tab").hide(),$(".subtitle_list_box").show(),$(".subtitle_list_track").show());"tab_effect"===a.target.id&&($("#tab_effect").parent("li").addClass("active"),$("#tab_effect").parent("li").siblings().removeClass("active"),
$("#tab_3").show(),$("#tab_3").siblings(".js_tab").hide());"tab_images"===a.target.id&&($("#tab_images").parent("li").addClass("active"),$("#tab_images").parent("li").siblings().removeClass("active"),$("#tab_4").show(),$("#tab_4").siblings(".js_tab").hide());"tab_audio"===a.target.id&&($("#tab_audio").parent("li").addClass("active"),$("#tab_audio").parent("li").siblings().removeClass("active"),$("#tab_5").show(),$("#tab_5").siblings(".js_tab").hide())});$(".player_toolbar_list").css("marginLeft",
($(".player_toolbar").width()-324)/2);$(".player_box").delegate($(".player_box").children(),"click",function(a){$(".player_box").addClass("choose");$(".time_ruler_wrap").removeClass("choose");$(".carve").removeClass("choose");$(".time_ruler_toolbar").removeClass("choose");$(".time_ruler_voiceBox").removeClass("choose");PLAYER.PTR.DragDrop.enable();PLAYER.TR.DragDrop.disable();if("js_play"===a.target.id){var c=PLAYER.operateJson.getLastFrame();if(PLAYER.TR.currTime>=c)return!1;PLAYER.player.play()}"js_setInterval"===
a.target.id&&($(a.target).parent("li").hasClass("active")?$(a.target).parent("li").removeClass("active"):$(a.target).parent("li").addClass("active"),PLAYER.player.setIntervalPlay());"js_setTrimIn"===a.target.id&&PLAYER.player.setTrimIn();"js_setTrimOut"===a.target.id&&PLAYER.player.setTrimOut();"js_moveTrimIn"===a.target.id&&PLAYER.player.moveTrimIn();"js_moveTrimOut"===a.target.id&&PLAYER.player.moveTrimOut();"js_prevFrame"===a.target.id&&PLAYER.player.prevFrame();"js_nextFrame"===a.target.id&&PLAYER.player.nextFrame();
"js_toFirstFrame"===a.target.id&&PLAYER.player.toFirstFrame();"js_toLastFrame"===a.target.id&&PLAYER.player.toLastFrame()});$("#js_carve_edit").delegate($("#js_carve_edit").children(),"click",function(a){PLAYER.PTR.DragDrop.disable();PLAYER.TR.DragDrop.disable()});$(".time_ruler_wrap").delegate($(".time_ruler_wrap").children(),"click",function(a){(-1<a.target.className.indexOf("time_ruler_bar")||-1<a.target.className.indexOf("time_ruler_edit_box"))&&$(".time_ruler_bar").children().removeClass("onselected");
var c=a.clientX-$(".time_ruler_edit_box").offset().left-parseInt($("#js_time_ruler_bar_box").css("marginLeft"));parseInt($("#js_time_ruler_bar_box").css("marginLeft"));7100===PLAYER.keyNum&&$.each($(".time_ruler_bar").children(),function(a,d){a=parseInt($(d).css("left"));var b=$(d).width(),b=a+b;a>=c&&$(d).addClass("onselected");a<c&&b>=c&&$(d).addClass("onselected")});71===PLAYER.keyNum&&$.each($(".time_ruler_bar").children(),function(a,d){a=parseInt($(d).css("left"));var b=$(d).width(),b=a+b;b<
c&&$(d).addClass("onselected");a<c&&b>=c&&$(d).addClass("onselected")});PLAYER.TR.DragDrop.enable();PLAYER.PTR.DragDrop.disable();PLAYER.documentEvent.enable();$(".time_ruler_wrap").addClass("choose");$(".player_box").removeClass("choose");$(".carve").removeClass("choose");$(".time_ruler_toolbar").removeClass("choose");$(".time_ruler_voiceBox").removeClass("choose")});$(".time_ruler_toolbar").delegate($(".time_ruler_toolbar span"),"click",function(a){$(".carve").removeClass("choose");$(".time_ruler_wrap").removeClass("choose");
$(".player_box").removeClass("choose");$(".time_ruler_toolbar").addClass("choose");$(".time_ruler_voiceBox").removeClass("choose");switch(a.target.id){case "js_toolbar_select":PLAYER.player.toolbar_choose();break;case "js_toolbar_select_pre":PLAYER.player.toolbar_preSelect();break;case "js_toolbar_select_back":PLAYER.player.toolbar_nextSelect();break;case "js_toolbar_cut":PLAYER.player.toolbar_cut();break;case "js_toolbar_uCut":PLAYER.player.toolbar_uCut();break;case "js_toolbar_zoom_plus":PLAYER.player.toolbar_zoom_plus();
break;case "js_toolbar_zoom_minus":PLAYER.player.toolbar_zoom_minus();break;default:return!1}});$("#js_toolbar_icon_ungroup").on("click",function(){PLAYER.player.toolbar_ungroup()});$("#js_toolbar_icon_group").on("click",function(){PLAYER.player.toolbar_group()});var l=!0;$("#js_toolbar_icon_volume").click(function(){var a=$(".onselected.edit_box_a").length;l?0<a&&l&&($("#js_toolbar_icon_volume_track").show(),l=!1):($("#js_toolbar_icon_volume_track").hide(),l=!0)});$("#js_toolbar_icon_volume_track")[0].onchange=
function(a){$.each($(".onselected.edit_box_a"),function(c,h){c=$(h).attr("data-time");h=parseInt($(a.target).val());$(a.target).attr("title",h);PLAYER.operateJson.updateAudioClipVolume(c,h);PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime));console.log("\u66f4\u65b0\u97f3\u91cf",PLAYER.jsonObj.rootBin.sequence[0])})};(function(){var a,c,h,d=PLAYER.singelton(function(){var a=$('<ul id="js_contextElem" class="contextElem"><li id="js_edit_effect">\u7f16\u8f91\u9a6c\u8d5b\u514b</li><li id="js_remove_effect">\u79fb\u9664\u9a6c\u8d5b\u514b</li><ul>');
$("body").append(a);return a});$("#js_time_ruler_bar_box").delegate(".edit_box.onselected","contextmenu",function(b){b.preventDefault();a=$(b.target).attr("data-time");c=parseInt($(b.target).parent().attr("data-index"));h=$(b.target).parent().attr("data-type");$("#js_effect_btn").attr("data-time",a);var g=d();g.css("left",b.clientX);g.css("top",b.clientY);0<$(b.target).children(".effect_box_all").length?(g.attr("data-edit",!0),g.children("#js_edit_effect,#js_remove_effect").css("background","#212121"),
g.children("#js_edit_effect,#js_remove_effect").css("color","#fff")):(g.attr("data-edit",!1),g.children("#js_edit_effect,#js_remove_effect").css("background","#eee"),g.children("#js_edit_effect,#js_remove_effect").css("color","#999"));g.show()});PLAYER.EventUtil.addHandler($(document)[0],"click",function(b){if("js_edit_effect"===b.target.id){if("false"===$(b.target).parent("ul").attr("data-edit"))return b=d(),b.hide(),!1;b=JSON.parse(PLAYER.operateJson.getEffectClip(a));for(var g=null,e=0;e<b.length;e++)if("mosaic"===
b[e].type||"2D"===b[e].type)g=b[e].attr;m();n(JSON.stringify(g),a,c,h,"mosaic")}else if("js_remove_effect"===b.target.id){if("false"===$(b.target).parent("ul").attr("data-edit"))return b=d(),b.hide(),!1;PLAYER.operateJson.removeOtherEffectClip(a,"mosaic","all");$(".edit_box_v.onselected").children(".effect_box_all").remove();PLAYER.operateJson.sendJson()}b=d();b.hide()})})();$("#js_zoom").on("click",function(){if(0===$(".onselected").size())return!1;var a=$(".edit_box_v.onselected").attr("data-time"),
c=parseInt($(".edit_box_v.onselected").parent().attr("data-index")),h=$(".edit_box_v.onselected").parent().attr("data-type"),d=parseInt($(".edit_box_v.onselected").attr("data-duration")),b=parseInt($(".edit_box_v.onselected").attr("data-trimin")),g=parseInt($(".edit_box_v.onselected").attr("data-trimout")),e=null;if(0===JSON.parse(PLAYER.operateJson.getEffectClip(a)).length)e={duration:d,trimIn:b,trimOut:g,type:"2D",pos:"all",attr:{x1:0,y1:0,width:.2*$("#ocx").width(),height:.2*$("#ocx").height(),
sizex:100,sizey:100}},PLAYER.operateJson.addEffectClip(a,e);else for(var f=0;f<e.length;f++)"2D"===e[f].type?e=e[f].attr:(e={duration:d,trimIn:b,trimOut:g,type:"2D",pos:"all",attr:{x1:0,y1:0,width:.2*$("#ocx").width(),height:.2*$("#ocx").height(),sizex:100,sizey:100}},PLAYER.operateJson.addEffectClip(a,e));m();n(JSON.stringify(e.attr),a,c,h,"2D")})});