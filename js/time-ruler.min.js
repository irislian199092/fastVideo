PLAYER.playerFunction=function(){function a(){this.config={targetObj:"time_ruler",hasTrack:!0},this.playerConfig={targetObj:"player_time_ruler",hasTrack:!1,rulerHeight:35,trimHeight:15},PLAYER.TR=new PLAYER.timeRuler(this.config),PLAYER.PTR=new PLAYER.timeRuler2(this.playerConfig),PLAYER.OCX=new PLAYER.ocxFunction,PLAYER.documentEvent.addHandler("keydown",d),setInterval(function(){var b,a=PLAYER.TR.config.seekComandTimesMonitor.length;0!==a&&(b=PLAYER.TR.config.seekComandTimesMonitor[a-1],PLAYER.TR.config.seekComandTimesMonitor=[],PLAYER.TR.currTime=b,PLAYER.TR.fixArrowCurrentTime(b),PLAYER.OCX.seek(b),b>=PLAYER.PTR.config.maxTime&&(b=PLAYER.PTR.config.maxTime),PLAYER.PTR.currTime=b,PLAYER.PTR.fixArrowCurrentTime(b))},10),setInterval(function(){var b,a=PLAYER.PTR.config.seekComandTimesMonitor.length;0!==a&&(b=PLAYER.PTR.config.seekComandTimesMonitor[a-1],PLAYER.PTR.config.seekComandTimesMonitor=[],PLAYER.dbClick||(PLAYER.TR.currTime=b,PLAYER.TR.fixArrowCurrentTime(b),b>=PLAYER.PTR.config.maxTime&&(b=PLAYER.PTR.config.maxTime)),PLAYER.OCX.seek(b),PLAYER.PTR.currTime=b,PLAYER.PTR.fixArrowCurrentTime(b))},10)}function b(){var a=setInterval(function(){var c,b=PLAYER.operateJson.getLastFrame();PLAYER.loadState&&PLAYER.isPlaying&&(c=PLAYER.OCX.getPosition(),c>b&&(c=0),c===b&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放"),clearInterval(a)),PLAYER.TR.fixArrowCurrentTime(c),PLAYER.TR.currTime=c,PLAYER.PTR.fixArrowCurrentTime(c),PLAYER.PTR.currTime=c,$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(PLAYER.TR.currTime)))},40)}function c(){function a(a,b){var e,f,g,h,i,c=document.getElementById("js_voCanvas"),d=$("#js_time_ruler_voiceBox").height()-21;if(c.getContext("2d")&&(e=c.getContext("2d"),e.clearRect(0,0,100,500),b))for(f=0,g=d,h=3,f=0;f<parseInt(a[0]);f++)i=parseFloat(a[f+1]/100)+.99,canvasGradient=e.createLinearGradient(h,g,h,0),canvasGradient.addColorStop(0,"#33FF00"),canvasGradient.addColorStop(.4,"#33FF00"),canvasGradient.addColorStop(1,"red"),e.fillStyle=canvasGradient,e.fillRect(h,g*(1-i),30,g*i),e.fillRect(h,g*(1-i),30,g*i),h+=35}setTimeout(function(){var b=PLAYER.OCX.getVUMeterInfo();b&&a(b.split(","),!0),PLAYER.loadState&&PLAYER.isPlaying&&(""!=b?setTimeout(arguments.callee,100):a("",!1))},100)}function d(a){var d,b=a.code,c=a.target;if("INPUT"!==c.nodeName&&"input"!==c.nodeName&&"TEXTAREA"!==c.nodeName&&"textarea"!==c.nodeName)if(16===b&&a.shift)PLAYER.keyNum=1600;else if(86!==b||a.shift)if(71!==b||a.shift)if(71===b&&a.shift)PLAYER.player.toolbar_nextSelect();else if(85!==b||a.shift)if(85===b&&a.shift)PLAYER.player.toolbar_uCut();else if(73===b&&a.shift)PLAYER.player.moveTrimIn();else if(79===b&&a.shift)PLAYER.player.moveTrimOut();else if(32!==b||a.shift)36!==b||a.shift?35!==b||a.shift?39!==b||a.shift?37!==b||a.shift?73!==b||a.shift?79!==b||a.shift?49===b&&a.shift?(PLAYER.keyNum=4900,PLAYER.player.toolbar_group()):50===b&&a.shift&&(PLAYER.keyNum=5e3,PLAYER.player.toolbar_ungroup()):(PLAYER.keyNum=79,PLAYER.player.setTrimOut()):(PLAYER.keyNum=73,PLAYER.player.setTrimIn()):PLAYER.player.prevFrame():PLAYER.player.nextFrame():PLAYER.player.toLastFrame():PLAYER.player.toFirstFrame();else{if(d=PLAYER.operateJson.getLastFrame(),PLAYER.TR.currTime>=d)return!1;PLAYER.player.play()}else PLAYER.player.toolbar_cut();else PLAYER.player.toolbar_preSelect();else PLAYER.player.toolbar_choose()}return a.prototype={play:function(){PLAYER.isPlaying?(PLAYER.OCX.doPause(),$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放"),PLAYER.isPlaying=!1):(PLAYER.OCX.doPlay(40*parseInt(PLAYER.PTR.currTime),1e11),$("#js_play").addClass("stop"),$("#js_play").attr("title","停止"),PLAYER.isPlaying=!0,b(),c())},setIntervalPlay:function(){var a=parseInt(PLAYER.TR.trimInCurrTime),b=parseInt(PLAYER.TR.trimOutCurrTime);$("#js_setInterval").parent("li").hasClass("active"),PLAYER.isPlaying?(PLAYER.OCX.doPause(),$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放"),PLAYER.isPlaying=!1):(PLAYER.OCX.seek(a),PLAYER.OCX.doPlay(),$("#js_play").addClass("stop"),$("#js_play").attr("title","停止"),PLAYER.isPlaying=!0,setTimeout(function(){var c=PLAYER.OCX.getPosition();console.log("s",c),PLAYER.TR.fixArrowCurrentTime(c),PLAYER.TR.currTime=c,PLAYER.PTR.fixArrowCurrentTime(c),PLAYER.PTR.currTime=c,$("#js_player_nowTime").html(PLAYER.getDurationToString(c)),$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(c)),PLAYER.loadState&&PLAYER.isPlaying&&(console.log("trimoutFrame",b),c!==b?(console.log("没有到出点"),setTimeout(arguments.callee,40)):(console.log("到出点",a),PLAYER.OCX.doPause(),PLAYER.OCX.seek(a),PLAYER.OCX.doPlay(),PLAYER.isPlaying=!0,$("#js_play").addClass("stop"),$("#js_play").attr("title","停止"),setTimeout(arguments.callee,40)))},40))},setTrimIn:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),PLAYER.dbClick||PLAYER.TR.fixTrimInByCurrentTime(parseInt(PLAYER.TR.currTime)),PLAYER.PTR.fixTrimInByCurrentTime(parseInt(PLAYER.PTR.currTime))},setTrimOut:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),PLAYER.dbClick||PLAYER.TR.fixTrimOutByCurrentTime(parseInt(PLAYER.TR.currTime)),PLAYER.PTR.fixTrimOutByCurrentTime(parseInt(PLAYER.PTR.currTime))},moveTrimIn:function(){return PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),$(".time_ruler_trimInOut").width()?(PLAYER.dbClick||PLAYER.TR.fixArrowCurrentTime(parseInt(PLAYER.TR.trimInCurrTime)),PLAYER.PTR.fixArrowCurrentTime(parseInt(PLAYER.PTR.trimInCurrTime)),PLAYER.OCX.seek(parseInt(PLAYER.PTR.trimInCurrTime)),void 0):!1},moveTrimOut:function(){return PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),$(".time_ruler_trimInOut").width()?(PLAYER.dbClick||PLAYER.TR.fixArrowCurrentTime(parseInt(PLAYER.TR.trimOutCurrTime)),PLAYER.PTR.fixArrowCurrentTime(parseInt(PLAYER.PTR.trimOutCurrTime)),PLAYER.OCX.seek(parseInt(PLAYER.PTR.trimOutCurrTime)),void 0):!1},prevFrame:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),PLAYER.dbClick||PLAYER.TR.moveToPrevFrame(),PLAYER.PTR.moveToPrevFrame(),PLAYER.OCX.seek(parseInt(PLAYER.PTR.currTime))},nextFrame:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),PLAYER.dbClick||PLAYER.TR.moveToNextFrame(),PLAYER.PTR.moveToNextFrame(),PLAYER.OCX.seek(parseInt(PLAYER.PTR.currTime))},toFirstFrame:function(){if(PLAYER.dbClick)return!1;PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放"));var a=PLAYER.operateJson.getFirstFrame();console.log("time",a),PLAYER.TR.fixArrowCurrentTime(a),PLAYER.PTR.fixArrowCurrentTime(a),PLAYER.OCX.seek(parseInt(a))},toLastFrame:function(){if(PLAYER.dbClick)return!1;if(PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),$(".time_ruler_bar").children().length){var a=PLAYER.operateJson.getLastFrame();PLAYER.TR.fixArrowCurrentTime(a),PLAYER.PTR.fixArrowCurrentTime(a),PLAYER.OCX.seek(a)}},toolbar_choose:function(){PLAYER.dbClick||(PLAYER.keyNum=86,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_select").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"default"}))},toolbar_preSelect:function(){PLAYER.dbClick||(console.log("向前选择","A"),PLAYER.keyNum=71,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_select_pre").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/select_back.cur),default"}))},toolbar_nextSelect:function(){PLAYER.dbClick||(console.log("向后选择","shift+A"),PLAYER.keyNum=7100,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_select_back").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/select_pre.cur),default"}))},toolbar_cut:function(){PLAYER.dbClick||(PLAYER.keyNum=85,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_cut").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/cut_disable.cur),default"}),PLAYER.TR.config.$clipTrackBar.find(".edit_box").css({cursor:"url(images/cur/cut.cur),default"}))},toolbar_uCut:function(){if(!PLAYER.dbClick){if(PLAYER.keyNum=8500,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_uCut").addClass("active"),0===PLAYER.TR.currTime)return;PLAYER.TR.cutArrowCurrentTime()}},toolbar_zoom_plus:function(){PLAYER.dbClick||(PLAYER.keyNum=187,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_plus").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/zoom_plus.cur),default"}))},toolbar_zoom_minus:function(){PLAYER.dbClick||(PLAYER.keyNum=189,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_minus").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/zoom_minus.cur),default"}))},toolbar_ungroup:function(){var a=$("#js_time_ruler_bar_box .onselected").length;return 0===a?!1:($("#js_time_ruler_bar_box .onselected").each(function(a,b){var c,d;$(b).attr("data-interleaved",!1),c=$(b).attr("data-time"),d={interleaved:!1},PLAYER.operateJson.updateClipAttr(d,c)}),console.log("解组",PLAYER.jsonObj.rootBin.sequence[0].tracks),void 0)},toolbar_group:function(){var a=$("#js_time_ruler_bar_box .onselected").length;return 0===a?!1:($(".edit_box_v.onselected").attr("data"),$(".edit_box_v.onselected").each(function(a,b){var e,f,g,c=$(b).attr("data-time"),d={interleaved:!0};PLAYER.operateJson.updateClipAttr(d,c),$(b).attr("data-interleaved",!0),e=$(b).attr("data-intid"),f=$(b).parent().siblings().children('.edit_box_a[data-intid="'+e+'"]'),g=f.attr("data-time"),PLAYER.operateJson.updateClipAttr(d,g),f.attr("data-interleaved",!0)}),console.log("编组",PLAYER.jsonObj.rootBin.sequence[0].tracks),void 0)}},a}(),PLAYER.ocxFunction=function(){function a(){var a=this;a.positionValue=0}return a.prototype={updateProjectJson:function(a){var c,d,b=PLAYER.operateJson.translateFfpToMS(JSON.stringify(a));try{c={command:"updateproject",params:{projectInfo:b}},d=JSON.stringify(c),webrtc.sendDataChannelMessageToPeer(targetId,d),PLAYER.loadState=!0}catch(e){return console.log("拖拽轨道更新json文件失败",e),!1}},adjustEffect:function(a){var b={command:"adjustEffect",params:a},c=JSON.stringify(b);webrtc.sendDataChannelMessageToPeer(targetId,c)},updateFileJson:function(a){var b=JSON.stringify(a);try{form1.TestActiveX.UpdateFileJson(b),PLAYER.loadState=!0,console.log("双击素材更新json文件成功",a)}catch(c){return console.log("双击素材更新json文件失败",c),!1}},unloadPlayer:function(){try{form1.TestActiveX.Close()}catch(b){console.log("关闭播放器时出错！")}},doPlay:function(a,b){var c,d;try{c={command:"play",params:{from:a,to:b}},d=JSON.stringify(c),webrtc.sendDataChannelMessageToPeer(targetId,d)}catch(e){return console.log("播放失败！",e),!1}},doPause:function(){var b,c,a=PLAYER.ffToNm(PLAYER.TR.currTime);try{b={command:"pause",params:{pos:a}},c=JSON.stringify(b),webrtc.sendDataChannelMessageToPeer(targetId,c)}catch(d){return console.log("暂停失败！"),!1}},doStop:function(){try{form1.TestActiveX.Seek(0)}catch(a){return console.log("停止失败！"),void 0}},getPosition:function(){try{return PLAYER.nmToFf(PLAYER.currentTime)}catch(a){console.log("获取当前时码时出错！")}},seek:function(a){var b,c;try{console.log("seek-point",a),a=PLAYER.ffToNm(a),b={command:"seek",params:{pos:a}},c=JSON.stringify(b),webrtc.sendDataChannelMessageToPeer(targetId,c)}catch(d){console.log("seek当前时码时出错！")}},getVUMeterInfo:function(){try{return PLAYER.VUMeterInfo}catch(a){return}},coverStationLogo:function(a){try{console.log("提交声音",a);var b=form1.TestActiveX.CoverStationLogo(JSON.stringify(a));return console.log("s1",b),b}catch(c){return console.log("error"),void 0}},clearWindow:function(){try{form1.TestActiveX.ClearWindow()}catch(a){return console.log("error","ClearWindow"),void 0}},getImageBase64:function(){try{var a=form1.TestActiveX.GetImageBase64(4);return console.log("获取画面成功！",a),a}catch(b){return console.log("error","获取画面失败"),void 0}},sendProType:function(a){var b,c;try{b={command:"setProjectType",params:{type:a}},c=JSON.stringify(b),webrtc.sendDataChannelMessageToPeer(targetId,c)}catch(d){return console.log("播放失败！",d),!1}}},a}(),PLAYER.operateJson={sendJson:function(){PLAYER.operateJson.sortClipAttr(),PLAYER.operateJson.updateRulerMaxTime(),PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]),PLAYER.OCX.updateProjectJson(PLAYER.jsonObj),PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime))},translateFfpToMS:function(a){var b,d,c,e,f,g,h;for(a=JSON.parse(a),a.rootBin.sequence[0].maxDuration=40*a.rootBin.sequence[0].maxDuration,c=0;d=a.rootBin.sequence[0].tracks[c++];)$.each(d.subclip,function(a,b){b&&(b.trimIn=40*b.trimIn,b.trimOut=40*b.trimOut,b.sequenceTrimIn=40*b.sequenceTrimIn,b.sequenceTrimOut=40*b.sequenceTrimOut,b.effect&&0!==b.effect.length&&$.each(b.effect,function(a,b){b.trimIn=40*b.trimIn,b.trimOut=40*b.trimOut,b.duration=40*b.duration}))});for(c=0;e=a.reference.material[c++];)e.duration=40*e.duration;return f=document.getElementById("ocx"),g=f.currentStyle?f.currentStyle:window.getComputedStyle(f,null),h=parseFloat(g.height),b="576"===a.height&&"720"===a.width?parseFloat(1.25*h):parseFloat(16*h/9),a.pHeight=h,a.pWidth=b,a},translateMsToFfp:function(a){var c,b,d;for(a=JSON.parse(a),a.rootBin.sequence[0].maxDuration=a.rootBin.sequence[0].maxDuration/40,b=0;c=a.rootBin.sequence[0].tracks[b++];)$.each(c.subclip,function(a,b){b&&(b.trimIn=b.trimIn/40,b.trimOut=b.trimOut/40,b.sequenceTrimIn=b.sequenceTrimIn/40,b.sequenceTrimOut=b.sequenceTrimOut/40,b.effect&&0!==b.effect.length&&$.each(b.effect,function(a,b){b.trimIn=b.trimIn/40,b.trimOut=b.trimOut/40,b.duration=b.duration/40}))});for(b=0;d=a.reference.material[b++];)d.duration=d.duration/40;return a},addVideoClipAttr:function(a,b){for(var d,c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)"v"===d.type&&d.index===b&&d.subclip.push(a)},addAudioClipAttr:function(a,b){for(var d,c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)"a"===d.type&&d.index===b&&d.subclip.push(a)},updateAudioClipVolume:function(a,b){for(var d,c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)$.each(d.subclip,function(c,e){e&&e.createTime===a&&$.extend(d.subclip[c],{volume:b})})},addSubtitleClipAttr:function(a,b){for(var d,c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)"t"===d.type&&d.index===b&&d.subclip.push(a)},getSubtitleClip:function(a,b){var e,d,c=null;for(d=0;e=PLAYER.jsonObj.rootBin.sequence[0].tracks[d++];)"t"===e.type&&e.index===b&&$.each(e.subclip,function(b,d){d&&d.createTime===a&&(c=d)});return JSON.stringify(c)},updateSubtitleClip:function(a,b,c){var g,f,d=a.trackIndex,e=a.subClipId;for(f=0;g=PLAYER.jsonObj.rootBin.sequence[0].tracks[f++];)"t"===g.type&&g.index===d&&$.each(g.subclip,function(d,f){f&&f.createTime===e&&(f.abs.left_value=b,f.abs.top_value=c,$.extend(f.pixel,a.attr),$.extend(f.pixel,a.attr))});console.log("更新字幕",PLAYER.jsonObj.rootBin.sequence[0].tracks)},sortClipAttr:function(){function a(a){return function(b,c){var d=b[a],e=c[a];return e>d?-1:d>e?1:0}}for(var c,b=0;c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b++];)c.subclip.sort(a("sequenceTrimIn"))},addProjectMaterial:function(a){0===PLAYER.jsonObj.reference.material.length?PLAYER.jsonObj.reference.material.push(a):$.each(PLAYER.jsonObj.reference.material,function(b,c){a.assetId!==c.assetId&&PLAYER.jsonObj.reference.material.push(a)})},pushCancelArray:function(a){var b=JSON.stringify(a);PLAYER.goBackJson.push(b)},updateClipAttr:function(a,b,c){for(var e,d=0;e=PLAYER.jsonObj.rootBin.sequence[0].tracks[d++];)$.each(e.subclip,function(d,f){f&&f.createTime===b&&($.extend(e.subclip[d],a||{}),c&&(e.subclip[d].effect=c))});console.log("更新切片",PLAYER.jsonObj.rootBin.sequence[0].tracks)},changeIndexClipAttr:function(a,b,c){var f,e,d=null;for(e=0;f=PLAYER.jsonObj.rootBin.sequence[0].tracks[e++];)$.each(f.subclip,function(a,b){b&&b.createTime===c&&(d=JSON.stringify(f.subclip[a]),f.subclip.splice(a,1))});for(e=0;f=PLAYER.jsonObj.rootBin.sequence[0].tracks[e++];)f.type===a&&f.index===b&&f.subclip.push(JSON.parse(d))},deleteClipAttr:function(a){for(var c,b=0;c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b++];)$.each(c.subclip,function(b,d){d&&d.createTime===a&&c.subclip.splice(b,1)});console.log("删除切片",PLAYER.jsonObj.rootBin.sequence[0])},checkCoverEvent:function(a,b){var d,e,k,c=PLAYER.TR.config,f=parseInt(a.attr("data-sequencetrimin")),g=parseInt(a.attr("data-sequencetrimout"));parseInt(a.attr("data-trimin")),parseInt(a.attr("data-trimout")),a.attr("data-time"),k=[],$.each(a.siblings(),function(a,b){$(b).hasClass("onselected")||$(b).hasClass("changeHelp")||k.push($(b))}),$.each(k,function(h,i){var n,o,p,q,r,s,t,u,v,w,x,j=parseInt($(i).attr("data-sequencetrimin")),k=parseInt($(i).attr("data-sequencetrimout")),l=parseInt($(i).attr("data-trimin")),m=parseInt($(i).attr("data-trimout"));j>=f&&g>j?(k>g?(n=$(i).attr("data-time"),$(i).attr("data-sequencetrimin",g),$(i).attr("data-sequencetrimout",k),$(i).attr("data-trimout",m),$(i).attr("data-trimin",m-k+g),$(i).css("left",g/c.framePerPixel),$(i).width((k-g)/c.framePerPixel),$(i).find(".effect_box_l")&&$(i).find(".effect_box_l").remove(),subClipAttr={sequenceTrimIn:g,sequenceTrimOut:k,trimIn:m-k+g,trimOut:m},o=PLAYER.operateJson.getCoverOldEffectClip(n,m-k+g,m),PLAYER.operateJson.updateClipAttr(subClipAttr,n,o)):(n=$(i).attr("data-time"),PLAYER.operateJson.deleteClipAttr(n),$(i).remove()),PLAYER.operateJson.sortClipAttr()):f>=j&&k>f?($(i).attr("data-sequencetrimin",j),$(i).attr("data-sequencetrimout",f),$(i).attr("data-trimout",l+f-j),$(i).attr("data-trimin",l),$(i).width((f-j)/c.framePerPixel),p=$(i).attr("data-id"),q=$(i).attr("data-time"),r=$(i).attr("data-interleaved"),s=$(i).attr("data-type"),t=parseInt($(i).parent(".time_ruler_bar").attr("data-index")),$(i).find(".effect_box_r")&&$(i).find(".effect_box_r").remove(),$(i).find(".effect_box_all")&&($(i).find(".effect_box_all").attr("data-trimin",l),$(i).find(".effect_box_all").attr("data-trimout",l+f-j),$(i).find(".effect_box_all").attr("data-duration",f-j)),subClipAttr={trimIn:l,trimOut:l+f-j,sequenceTrimIn:j,sequenceTrimOut:f},o=PLAYER.operateJson.getCutOldEffectClip(q,l,l+f-j),PLAYER.operateJson.updateClipAttr(subClipAttr,q,o),k>g&&(u=s+"_"+PLAYER.genNonDuplicateID(12),vcut_sequenceTrimIn=g,vcut_sequenceTrimOut=k,vcut_trimIn=m-k+g,vcut_trimOut=m,vcut_width=(k-g)/c.framePerPixel,vcut_left=g/c.framePerPixel,d=$(i).clone(),d.find(".effect_box_l")&&d.find(".effect_box_l").remove(),d.find(".effect_box_all")&&(d.find(".effect_box_all").attr("data-trimin",vcut_trimIn),d.find(".effect_box_all").attr("data-trimout",vcut_trimOut),d.find(".effect_box_all").attr("data-duration",vcut_trimOut-vcut_trimIn)),d.removeClass("onselected"),d.attr("data-trimin",vcut_trimIn),d.attr("data-trimout",vcut_trimOut),d.attr("data-sequencetrimin",vcut_sequenceTrimIn),d.attr("data-sequencetrimout",vcut_sequenceTrimOut),d.attr("data-time",u),d.attr("data-intid",b),d.attr("width",vcut_width),d.attr("left",vcut_left),$(i).parent(".time_ruler_bar").append(d),$(i).parent(".time_ruler_bar").hasClass("bar_v")?(v=PLAYER.operateJson.getCutNewEffectClip(q,vcut_trimIn,vcut_trimOut),0!==v.length&&$.each(v,function(a,b){"mosaic"===$(b).type&&($(b).trimIn=vcut_trimIn,$(b).trimOut=vcut_trimOut)}),e={assetID:p,trimIn:vcut_trimIn,trimOut:vcut_trimOut,sequenceTrimIn:vcut_sequenceTrimIn,sequenceTrimOut:vcut_sequenceTrimOut,effect:v,type:s,createTime:u,interleaved_id:b},e.interleaved="true"===a.attr("data-interleaved")&&"true"===r?!0:!1,PLAYER.operateJson.addVideoClipAttr(e,t)):$(i).parent(".time_ruler_bar").hasClass("bar_a")?(e={assetID:p,trimIn:vcut_trimIn,trimOut:vcut_trimOut,sequenceTrimIn:vcut_sequenceTrimIn,sequenceTrimOut:vcut_sequenceTrimOut,volume:100,type:s,createTime:u,interleaved_id:b},e.interleaved="true"===a.attr("data-interleaved")&&"true"===r?!0:!1,PLAYER.operateJson.addAudioClipAttr(e,t)):$(i).parent(".time_ruler_bar").hasClass("bar_t")&&(w=JSON.parse(PLAYER.operateJson.getSubtitleClip(q,t)),x={trimIn:vcut_trimIn,trimOut:vcut_trimOut,sequenceTrimIn:vcut_sequenceTrimIn,sequenceTrimOut:vcut_sequenceTrimOut,type:s,createTime:u,interleaved:!1,interleaved_id:b},$.extend(w,x),PLAYER.operateJson.addSubtitleClipAttr(w,t)))):console.log("不重合")})},getAllsequenceTrimIn:function(a,b,c){var d,e,f;return e=c?c:parseInt(a.attr("data-sequencetrimin")),f=a.siblings(),b&&$.each(f,function(a,c){$(c).attr("data-time")===b&&f.splice(a,1)}),f.each(function(){var a=Math.abs(e-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,b=Math.abs(e-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;10>=a&&(d=parseInt($(this).attr("data-sequencetrimin"))),10>=b&&(d=parseInt($(this).attr("data-sequencetrimout")))}),d},getAllsequenceTrimOut:function(a,b,c){var d,e,f;return e=c?c:parseInt(a.attr("data-sequencetrimout")),f=a.siblings(),b&&$.each(f,function(a,c){$(c).attr("data-time")===b&&f.splice(a,1)}),f.each(function(){var a=Math.abs(e-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,b=Math.abs(e-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;10>=a&&(d=parseInt($(this).attr("data-sequencetrimin"))),10>=b&&(d=parseInt($(this).attr("data-sequencetrimout")))}),d},showAdhere:function(a,b){a.find(".point")&&a.find(".point").remove();var c=$('<div class="point"></div>');"forward"===b&&c.css("left",-5),"backward"===b&&c.css("left",a.width()-5),c.appendTo(a),console.log("point",a.find(".point").length)},hideAdhere:function(a){a.find(".point")&&a.find(".point").remove()},chooseInterleavedElem:function(a){var d,b=null;return a.attr("data-time"),d=a.attr("data-intid"),$.each(a.parent(".time_ruler_bar").siblings().children(".edit_box"),function(a,c){"true"!==$(c).attr("data-interleaved")||$(c).attr("data-intid")!==d||$(c).hasClass("changeHelp")||(b=$(c))}),b},chooseGroupElem:function(a){var b=null,c=[],d=a.attr("data-time"),e=a.attr("data-group");return $.each($(".edit_box"),function(){$(this).attr("data-group")===e&&(b=$(this),c.push(b))}),c.forEach(function(a,b){c[b].attr("data-time")===d&&c.splice(b,1)}),c},chooseSelectedElem:function(a){var c=[],d=a.attr("data-time");return $.each($("#js_time_ruler_bar_box .onselected"),function(){c.push($(this))}),c.forEach(function(a,b){c[b].attr("data-time")===d&&c.splice(b,1)}),c},mouseDownState:function(a){console.log("PLAYER.keyNum",PLAYER.keyNum),17!==PLAYER.keyNum&&71!==PLAYER.keyNum&&7100!==PLAYER.keyNum&&$("#js_time_ruler_bar_box .draggable").removeClass("onselected"),a.addClass("onselected"),"true"===a.attr("data-interleaved")&&PLAYER.operateJson.chooseInterleavedElem(a).addClass("onselected")},mouseMoveState:function(a,b){a.css("z-index",50),"middle"===b?(a.css("cursor","url(images/cur/resize.cur),default"),a.css("boxShadow","4px 4px 2px #888888"),a.removeClass("onselected"),a.css("opacity","0.6")):"left"===b?a.addClass("zoomLeft"):"right"===b&&a.addClass("zoomRight")},mouseUpState:function(){},checkCorsorhasClip:function(a){var d,c,b=!1;for(c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)"a"===d.type&&d.subclip.length>0&&$.each(d.subclip,function(c,d){return console.log("currTime",a),d.sequenceTrimIn<a&&d.sequenceTrimOut>a?b=!0:void 0});return b},checkNoClip:function(){for(var b,a=0;b=PLAYER.jsonObj.rootBin.sequence[0].tracks[a++];)return 0===b.subclip.length?!0:!1},checkPrevSubClip:function(a){var b=null;return $("#js_time_ruler_bar_box .edit_box_v").each(function(c,d){parseInt($(d).attr("data-sequencetrimout"))===a&&(b=$(d))}),b},checkNextSubClip:function(a){var b=null;return $(".edit_box_v").each(function(c,d){parseInt($(d).attr("data-sequencetrimin"))===a&&(b=$(d))}),b},addEffectClip:function(a,b){for(var d,c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)"v"===d.type&&$.each(d.subclip,function(c,e){e&&e.createTime===a&&d.subclip[c].effect.push(b)})},getEffectClip:function(a){var d,c,b=null;for(c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)$.each(d.subclip,function(c,d){d&&d.createTime===a&&d.effect&&(b=JSON.stringify(d.effect))});return b},getCutNewEffectClip:function(a,b,c){var e,f,d=JSON.parse(PLAYER.operateJson.getEffectClip(a));if(d&&0!==d.length){for(e=d.filter(function(a){return"header"!==a.pos&&"header-middle"!==a.pos}),f=0;f<e.length;f++)"all"===e[f].pos&&(e[f].trimIn=b,e[f].trimOut=c,e[f].duration=c-b);d=e}return console.log("cut后新加切片特技",d),d},getCutOldEffectClip:function(a,b,c){var e,f,d=JSON.parse(PLAYER.operateJson.getEffectClip(a));if(d&&0!==d.length){for(e=d.filter(function(a){return"footer"!==a.pos&&"footer-middle"!==a.pos}),f=0;f<e.length;f++)"all"===e[f].pos&&(e[f].trimIn=b,e[f].trimOut=c,e[f].duration=c-b);d=e}return d?d:void 0},getCoverOldEffectClip:function(a,b,c){var e,f,d=JSON.parse(PLAYER.operateJson.getEffectClip(a));if(d&&0!==d.length){for(e=d.filter(function(a){return"header"!==a.pos&&"header-middle"!==a.pos}),f=0;f<e.length;f++)"all"===e[f].pos&&(e[f].trimIn=b,e[f].trimOut=c,e[f].duration=c-b);d=e}return d?d:void 0},updateEffectClip:function(a,b){for(var d,c=0;d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c++];)$.each(d.subclip,function(c,d){d&&d.createTime===a&&d.effect&&$.each(d.effect,function(a,c){"mosaic"===c.type?$.extend(c.attr,b):"2D"===c.type&&$.extend(c.attr,b)})});console.log("更新特技",PLAYER.jsonObj.rootBin.sequence[0].tracks)},removeOtherEffectClip:function(a,b,c){for(var e,d=0;e=PLAYER.jsonObj.rootBin.sequence[0].tracks[d++];)$.each(e.subclip,function(d,e){e&&e.createTime===a&&e.effect&&e.effect.forEach(function(a,d){a.type===b&&a.pos===c&&e.effect.splice(d,1)})});console.log("删除淡入淡出等的切片",PLAYER.jsonObj.rootBin.sequence[0].tracks)},emptyTrack:function(a,b){$.each($(".time_ruler_bar"),function(c,d){$(d).attr("data-type")===a&&parseInt($(d).attr("data-index"))===b&&$(d).empty()})},getTrack:function(a,b){var c;return $.each($(".time_ruler_bar"),function(d,e){return $(e).attr("data-type")===a&&parseInt($(e).attr("data-index"))===b?c=$(e):void 0}),c},getMaterialDuration:function(a,b){$.ajax({url:serverUrl+"program/info",data:{assetId:a},async:!1,success:function(a){0===a.code&&null!==a.data?b(a.data.data):console.log("error")}})},getSubtitleDuration:function(a,b){var c=PLAYER.subJsonTem[a];b(c)},getFirstFrame:function(){var c,b,d,a=[];for(b=0;c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b++];)$.each(c.subclip,function(b,d){d&&a.push(c.subclip[b].sequenceTrimIn)});return 0===a.length?0:d=Math.min.apply(null,a)},getLastFrame:function(){var c,b,a=[];for(b=0;c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b++];)0!==c.subclip.length&&$.each(c.subclip,function(b,c){a.push(c.sequenceTrimOut)});return 0!==a.length?Math.max.apply(null,a):void 0},updateMaxDuration:function(a){PLAYER.jsonObj.rootBin.sequence[0].maxDuration=a},updateRulerMaxTime:function(){var a=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15e3||1e3);PLAYER.TR.updateEvent(a),PLAYER.TR.fixClipWidth(),PLAYER.operateJson.updateMaxDuration(a),PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame()||1e3,$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||1e3)),PLAYER.PTR.updateEvent(PLAYER.PTR.config)},getAudioIndex:function(a){var b=0;return $.each(PLAYER.jsonObj.rootBin.sequence[0].track[1].subclip,function(c,d){d.createTime===a&&(b=c)}),b},addDraggingInfo:function(a,b){var f,c=a.attr("data-time"),d="helpElem_"+PLAYER.genNonDuplicateID(12),e=a.clone().addClass("changeHelp");e.removeClass("onselected"),e.attr("data-time",d),a.parent().append(e),e.hide(),f={id:c,initAttr:b,helpElem:e},PLAYER.storeDraggingInfo.push(f)},getDraggingAttr:function(a){var b=null;return $.each(PLAYER.storeDraggingInfo,function(c,d){d.id===a&&(b=d.initAttr)}),b},getDraggingHelp:function(a){var b=null;return $.each(PLAYER.storeDraggingInfo,function(c,d){d.id===a&&(b=d.helpElem)}),b},removeDraggingInfo:function(a){for(var c=0;c<PLAYER.storeDraggingInfo.length;c++)PLAYER.storeDraggingInfo[c].id===a&&PLAYER.storeDraggingInfo.splice(c,1);console.log("删除help",PLAYER.storeDraggingInfo)},getSubtitleTemp:function(a){var b=$("#ocx").width(),c=$("#ocx").height(),d=PLAYER.jsonObj.width,e=PLAYER.jsonObj.height;return PLAYER.subJsonTem={subtitle_01:{id:"subtitle_01",name:"subtitle_01",duration:2e3,trimIn:0,trimOut:2e3,abs:{left_value:parseInt(1400/d*b),top_value:parseInt(40/e*c)},pixel:[{x1:parseInt(1400/d*b),y1:parseInt(40/e*c),width:parseInt(300/d*b),height:parseInt(285/e*c),attr:{type:"images",url:"http://112.126.71.150:82/FastCarve/s1_01.png"},attrID:"attrID_"+PLAYER.genNonDuplicateID(12)},{x1:parseInt(1400/d*b),y1:parseInt(360/e*c),attr:{type:"fade",text:"NAME",fontFamily:"PingFang Heavy",fontSize:parseInt(54/e*c),fillStyle:"#ffffff",textAlign:"left",fadeInTime:1e3,fadeOutTime:1e3},attrID:"attrID_"+PLAYER.genNonDuplicateID(12)},{x1:parseInt(1400/d*b),y1:parseInt(410/e*c),attr:{type:"fade",text:"hellp",fontFamily:"PingFang Regular",fontSize:parseInt(40/e*c),fillStyle:"#ffffff",textAlign:"left",fadeInTime:1e3,fadeOutTime:1e3},attrID:"attrID_"+PLAYER.genNonDuplicateID(12)}]}},JSON.stringify(PLAYER.subJsonTem[a])}},PLAYER.EventTarget=function(){function a(){this.handlers={}}return a.prototype={addHandler:function(a,b){"undefined"==typeof this.handlers[a]&&(this.handlers[a]=[]),this.handlers[a].push(b)},fire:function(a){var b,c,d;if(a.target||(a.target=this),this.handlers[a.type]instanceof Array)for(b=this.handlers[a.type],c=0,d=b.length;d>c;c++)b[c](a)},removeHandler:function(a,b){var c,d,e;if(this.handlers[a]instanceof Array){for(c=this.handlers[a],d=0,e=c.length;e>d&&c[d]!==b;d++);c.splice(d,1)}}},a}(),PLAYER.timeRuler=function(){function C(a){r=this,r.config=$.extend(B,a),r.targetObj=r.config.targetObj,r.trimInCurrTime=0,r.trimOutCurrTime=0,r.currTime=0,D(),I(),this.config.$rulerWrap.addEventListener("mousedown",N),this.config.$rulerWrap.addEventListener("mousemove",O),this.config.$trimIn.addEventListener("mousemove",lb),this.config.$trimOut.addEventListener("mousemove",mb),this.DragDrop.addHandler("clipDragstart",R),this.DragDrop.addHandler("clipDrag",T),this.DragDrop.addHandler("clipDragend",V),this.DragDrop.addHandler("clipClick",W),this.DragDrop.addHandler("clipCheckDir",X),this.DragDrop.addHandler("clipDblclick",_),this.DragDrop.addHandler("sequenceClick",Y),this.DragDrop.addHandler("effectClick",Z),this.DragDrop.addHandler("keydown",fb),window.addEventListener("resize",J),PLAYER.EventUtil.addHandler($(".time_ruler_edit_box")[0],"click",gb)}function D(){var c,a=r.config,b=r.targetObj;a.$header=$('<div class="'+b+'_header"></div>'),a.$headerLeft=$('<div class="'+b+'_header_left fl">'+'<div class="time_ruler_title_nowTime" id="js_time_ruler_title_nowTime">00:00:00:00</div>'+'<div class="time_ruler_title_toolbar">'+'<span class="toolbar_insert_model add_audio_track" title="添加音频轨道" id="js_add_audio_track">'+'<a class="fa fa-plus"></a>'+"</span>"+"</div>"+"</div>"),a.$headerRight=$('<div class="'+b+'_header_right fr"></div>'),a.$rulerWrap=$('<div class="'+b+'_canvas_wrap"></div>'),a.$ruler=$('<canvas class="'+b+'_canvas"></canvas>'),a.$ruler.attr("width",a.$headerRight.width()),a.$rulerWrap.append(a.$ruler),a.$headerRight.append(a.$rulerWrap),a.$header.append(a.$headerLeft),a.$header.append(a.$headerRight),p=a.$headerRight.width(),a.$trimInOut=$('<div class="'+b+'_trimInOut"></div>'),a.$trimInOut.css("height",a.trimHeight-2),a.$trimInOut.css("width","0px"),a.$trimInOut.appendTo(a.$rulerWrap),a.$trimIn=$('<div class="'+b+'_trimIn"></div>'),a.$trimIn.css("height",a.trimHeight-2),a.$trimIn.appendTo(a.$trimInOut),a.$trimOut=$('<div class="'+b+'_trimOut"></div>'),a.$trimOut.css("height",a.trimHeight-2),a.$trimOut.appendTo(a.$trimInOut),a.$cursor=$('<div class="'+b+'_cursor"></div>'),a.$cursor.css("height",$("."+b).height()-70),a.$cursor.appendTo(a.$rulerWrap),c=$('<div class="'+b+'_cursor_top"></div>'),c.appendTo(a.$cursor),a.$header.appendTo($("."+b)),a.$body=$('<div class="'+b+'_body"></div>'),a.$clipTrackContainer=$('<div class="'+b+'_track_box" id="js_'+b+'_track_box">'),a.$clipTrackLeft=$('<div class="time_ruler_title_box fl" id="js_time_ruler_title_box"></div>'),a.$clipTrackLeft.html('<div class="time_ruler_title_list" data-type="t1">T1</div><div class="time_ruler_title_list" data-type="t2">T2</div><div class="time_ruler_title_list" data-type="v2">V2</div><div class="time_ruler_title_list" data-type="v1">V1</div><div class="time_ruler_title_list" data-type="a1">A1</div><div class="time_ruler_title_list" data-type="a2">A2</div>'),a.$clipTrackLeftRight=$('<div class="time_ruler_edit_box fr"></div>'),a.$clipTrackBar=$('<div class="time_ruler_bar_box" id="js_time_ruler_bar_box"></div>'),a.$clipTrackBar.html('<div class="'+b+'_bar bar_t"data-type="t" data-index="1"></div>'+'<div class="'+b+'_bar bar_t"data-type="t" data-index="2"></div>'+'<div class="'+b+'_bar bar_v"data-type="v" data-index="2"></div>'+'<div class="'+b+'_bar bar_v"data-type="v" data-index="1"></div>'+'<div class="'+b+'_bar bar_a"data-type="a" data-index="1"></div>'+'<div class="'+b+'_bar bar_a"data-type="a" data-index="2"></div>'),a.$line=$('<div class="'+b+'_line">'),a.$clipTrackLeftRight.append(a.$clipTrackBar),a.$clipTrackLeftRight.append(a.$line),a.$clipTrackContainer.append(a.$clipTrackLeft),a.$clipTrackContainer.append(a.$clipTrackLeftRight),a.$scrollBar=$('<div class="'+b+'_track">'+'<div class="'+b+'_scroll"></div>'+"</div>"),a.$body.append(a.$clipTrackContainer),a.$body.append(a.$scrollBar),a.$footer=$('<div class="'+b+'_footer">'),a.$sliderTrack=$('<div class="'+b+'_slider_track">'),a.$sliderBar=$('<div class="'+b+'_slider_scroll_total">'),a.$sliderBarLeft=$('<div class="'+b+'_slider_scroll_left">'),a.$sliderBarMiddle=$('<div class="'+b+'_slider_scroll_middle">'),a.$sliderBarRight=$('<div class="'+b+'_slider_scroll_right">'),a.$sliderBarLeft.appendTo(a.$sliderBar),a.$sliderBarMiddle.appendTo(a.$sliderBar),a.$sliderBarRight.appendTo(a.$sliderBar),a.$sliderBar.appendTo(a.$sliderTrack),a.$footer.append(a.$sliderTrack),$("."+b).append(a.$header),$("."+b).append(a.$body),$("."+b).append(a.$footer),E(),H(0),G()
}function E(){var a=r.config;r.targetObj,q=a.$headerRight.width(),a.framePerPixel=a.maxTime/q,a.smallScaleFrame=F(a.framePerPixel).smallScaleFrame,a.smallScaleNumsPerLargeScale=F(a.framePerPixel).smallScaleNumsPerLargeScale,a.smallScaleWidth=a.smallScaleFrame/a.framePerPixel,a.largeScaleWidth=a.smallScaleWidth*a.smallScaleNumsPerLargeScale,a.largeScaleMillisecondInterval=40*a.smallScaleFrame*a.smallScaleNumsPerLargeScale,a.max_fpp=Math.min(a.maxTime/q,11250)}function F(a){var c,d,e,f;for(r.config,c=[],d={},e=0;e<A.length;e++)f=A[e].smallScaleFrame*A[e].smallScaleNumsPerLargeScale/80,f>=a&&c.push(e);return d.smallScaleFrame=A[c[0]].smallScaleFrame,d.smallScaleNumsPerLargeScale=A[c[0]].smallScaleNumsPerLargeScale,d}function G(){var c,a=r.config;r.targetObj,l=a.$sliderBarLeft.width(),m=a.$sliderBarRight.width(),c=a.$headerRight.width()*a.$sliderTrack.width()/a.$rulerWrap.width(),j=parseInt(a.$sliderTrack.width()-c),k=parseInt(a.$rulerWrap.width()-a.$headerRight.width()),c>=a.$sliderTrack.width()&&(c=a.$sliderTrack.width()),a.$sliderBar.css("width",c),a.$sliderBar.css("left",0),a.$sliderBarMiddle.css("width",c-l-m),a.$sliderBarMiddle.css("left",l),a.$sliderBarLeft.css("left",0),a.$sliderBarRight.css("left",c-m)}function H(a){var d,e,f,g,h,i,j,k,l,m,n,b=r.config;for(r.targetObj,a=parseInt(a),d=b.$headerRight.width(),e=b.$headerRight.height(),b.$ruler.attr("width",d),b.$ruler.attr("height",e),f=b.$ruler[0].getContext("2d"),f.clearRect(0,0,d,e),f.fillStyle=b.backgroundColor,f.fillRect(0,0,d,e),g=e,f.lineWidth=1,f.strokeStyle=b.scaleColor,f.fillStyle=b.fontColor,f.font=b.fontSize+"px "+b.fontFamily,f.textAlign="center",f.beginPath(),h=parseInt(a/b.largeScaleWidth)*b.largeScaleMillisecondInterval,i=parseInt(a/b.smallScaleWidth)+1,j=i*b.smallScaleWidth-a,k=i%b.smallScaleNumsPerLargeScale,l=0,m=0;d>l;)l=m*b.smallScaleWidth+.3+j,0==k%b.smallScaleNumsPerLargeScale?(f.moveTo(l,g-1),f.lineTo(l,g-b.largeScaleHeight),h+=b.largeScaleMillisecondInterval,n=PLAYER.$millisecondsToTimeFrame(h),f.fillText(n,l,g-b.largeScaleHeight-3)):(f.moveTo(l,g-1),f.lineTo(l,g-b.smallScaleHeight)),m++,k++;f.stroke()}function I(){K(),ib(),nb()}function J(){var a=r.config;r.targetObj,a.$headerRight.width(a.$headerRight.parent().width()-151),r.updateEvent(r.config.maxTime,!0)}function K(){var a=r.config;a.$rulerWrap.addEventListener=function(b,c){if("mousedown"==b)a.$rulerWrap.mousedown(function(a){function b(a){M(a.clientX,a.clientY,c)}function d(){this.onmousemove=null,this.onmouseup=null}a.stopPropagation(),M(a.clientX,a.clientY,c),document.onmousemove=b,document.onmouseup=d});else if("click"==b){if(e.stopPropagation(),$(this)!=a.$ruler)return;M(e.clientX,e.clientY,c)}else"mousemove"==b&&L(a.$cursor,c)}}function L(a,b){function g(a){a=a||event,window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),M(a.clientX,a.clientY,b)}function h(){this.onmousemove=null,this.onmouseup=null}var c,d,e,f;a.mousedown(function(b){b.stopPropagation(),b=b||event,c=b.clientX,d=b.clientY,e=a.offsetLeft,f=a.offsetTop,this.ondragstart=function(){return!1},document.onmousemove=g,document.onmouseup=h})}function M(a,b,c){var d,f,i,l,m;PLAYER.checkPlaying(),d=r.config,r.targetObj,f=q,i=a-d.$headerRight.offset().left,l=Math.abs(parseFloat(d.$rulerWrap.css("margin-left"))),g=i+l,g=parseFloat(g*d.framePerPixel)/d.framePerPixel,0>=g&&(g=0),g>=d.$rulerWrap.width()&&(g=d.$rulerWrap.width()),g-l>f&&(o=g-f,j=parseFloat(d.$sliderTrack.width()-d.$sliderBar.width()),k=parseFloat(d.$rulerWrap.width()-f),h=o*j/k,d.$sliderBar.css("left",h),d.$rulerWrap.css("margin-left",-o),d.$ruler.css("left",o),H(o),d.$sliderBar.css("left",h),d.$rulerWrap.css("margin-left",-o),d.$ruler.css("left",o),d.$clipTrackBar.css("margin-left",-o),H(o)),l>g&&(o=g,h=o*d.$sliderTrack.width()/d.$rulerWrap.width(),d.$sliderBar.css("left",h),d.$rulerWrap.css("margin-left",-o),d.$ruler.css("left",o),H(o),d.$sliderBar.css("left",h),d.$rulerWrap.css("margin-left",-o),d.$ruler.css("left",o),d.$clipTrackBar.css("margin-left",-o),H(o)),d.$cursor.css("left",g),d.$line.css("left",g),m=r.currTime,r.currTime=Math.round(g*d.framePerPixel),null!==c&&m!==r.currTime&&c(r.currTime)}function N(a){var b,c,d;PLAYER.checkPlaying(),r.currTime=a,r.fixArrowCurrentTime(a),PLAYER.OCX.seek(a),a>=PLAYER.PTR.config.maxTime&&(a=PLAYER.PTR.config.maxTime),PLAYER.PTR.currTime=a,PLAYER.PTR.fixArrowCurrentTime(a),b=PLAYER.operateJson.checkCorsorhasClip(r.currTime),b||(c=document.getElementById("js_voCanvas"),d=c.getContext("2d"),d.clearRect(0,0,100,500))}function O(a){PLAYER.checkPlaying();var b=r.config;b.seekComandTimesMonitor.push(a)}function P(a,b){var c={};return c.clipInitTime=a.attr("data-time"),c.clipInitWidth=parseInt(a.outerWidth()),c.clipInitLeft=parseInt(a.position().left),c.clipInitClientX=b.x,c.clipInitOffsetLeft=parseInt(a.parent().offset().left),c.clipInitTop=parseInt(a.position().top),c.clipInitClientY=b.y,c.clipInitOffsetTop=parseInt(a.parent().offset().top),c.clipInitIndex=parseInt(a.parent().attr("data-index")),c.clipInitType=a.parent().attr("data-type"),c.clipInitTrimIn=parseInt(a.attr("data-trimin")),c.clipInitTrimOut=parseInt(a.attr("data-trimout")),c.clipInitSequenceTrimIn=parseInt(a.attr("data-sequencetrimin")),c.clipInitSequenceTrimOut=parseInt(a.attr("data-sequencetrimout")),c.clipMaxFrame=parseInt(a.attr("data-duration"))||0,a.find(".effect_box_r").length>=1&&PLAYER.operateJson.checkNextSubClip(c.clipInitSequenceTrimOut)&&(c.nextClip=PLAYER.operateJson.checkNextSubClip(c.clipInitSequenceTrimOut).attr("data-time")),a.find(".effect_box_l").length>=1&&PLAYER.operateJson.checkPrevSubClip(c.clipInitSequenceTrimIn)&&(c.prevClip=PLAYER.operateJson.checkPrevSubClip(c.clipInitSequenceTrimIn).attr("data-time")),JSON.stringify(c)}function Q(a){var b=a.clipInitWidth,c=a.clipInitLeft,d=a.clipInitClientX,e=a.clipInitOffsetLeft,f="";return f=c+e+8>=d?"left":d>=c+e+b-8?"right":"middle"}function R(a){r.config,dragging=a.target,PLAYER.checkPlaying(),0!==$(".space").size()&&$(".space").remove()}function T(a){function o(a){var b,c,d;return $.each(g.siblings(),function(c,d){var e,f;$(d).hasClass("onselected")||$(d).hasClass("changeHelp")||(e=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,f=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,Math.abs(e)<=10&&(b=parseInt($(this).attr("data-sequencetrimin"))),Math.abs(f)<=10&&(b=parseInt($(this).attr("data-sequencetrimout"))))}),b||(c=g.attr("data-intid"),$.each(g.parent().siblings().children(".changeHelp"),function(e,f){$(f).attr("data-intid")===c&&(d=$(f),$.each(d.siblings(),function(c,d){var e,f;$(d).hasClass("onselected")||$(d).hasClass("changeHelp")||(e=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,f=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,Math.abs(e)<=10&&(b=parseInt($(this).attr("data-sequencetrimin"))),Math.abs(f)<=10&&(b=parseInt($(this).attr("data-sequencetrimout"))))}))})),b}function p(a){var b,c,d;return $.each(g.siblings(),function(c,d){var e,f;$(d).hasClass("onselected")||$(d).hasClass("changeHelp")||(e=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,f=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,Math.abs(e)<=10&&(b=parseInt($(this).attr("data-sequencetrimin"))),Math.abs(f)<=10&&(b=parseInt($(this).attr("data-sequencetrimout"))))}),b||(c=g.attr("data-intid"),$.each(g.parent().siblings().children(".changeHelp"),function(e,f){$(f).attr("data-intid")===c&&(d=$(f),$.each(d.siblings(),function(c,d){var e,f;$(d).hasClass("onselected")||$(d).hasClass("changeHelp")||(e=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,f=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,Math.abs(e)<=10&&(b=parseInt($(this).attr("data-sequencetrimin"))),Math.abs(f)<=10&&(b=parseInt($(this).attr("data-sequencetrimout"))))}))})),b}function q(c,d){var e,f,g,h;j>0?(e=a.max_out+d,f=o(e),g=Math.abs(e-f)/b.framePerPixel,Math.abs(g)<=10?(e=f,v=clipInitSequenceTrimOut+e-a.max_out,u=v-(c.attr("data-trimout")-c.attr("data-trimin")),m=Math.round(u/b.framePerPixel),PLAYER.operateJson.showAdhere(c,"backward")):PLAYER.operateJson.hideAdhere(c)):(h=a.min_in+d,f=p(h),console.log("adhere_point",f),g=Math.abs(h-f)/b.framePerPixel,Math.abs(g)<=10?(h=f,u=clipInitSequenceTrimIn+h-a.min_in,v=u+(c.attr("data-trimout")-c.attr("data-trimin")),m=Math.round(u/b.framePerPixel),PLAYER.operateJson.showAdhere(c,"forward")):PLAYER.operateJson.hideAdhere(c))}function w(c,d){var e=a.min_in+d,f=p(e),g=Math.abs(e-f)/b.framePerPixel;Math.abs(g)<=10?(e=f,u=clipInitSequenceTrimIn+e-a.min_in,s=clipInitTrimIn+e-a.min_in,m=Math.round(u/b.framePerPixel),l=(clipInitSequenceTrimOut-u)/b.framePerPixel,PLAYER.operateJson.showAdhere(c,"forward")):PLAYER.operateJson.hideAdhere(c)}function x(c,d){var e=a.max_out+d,f=o(e),g=(e-f)/b.framePerPixel;Math.abs(g)<=10?(e=f,v=clipInitSequenceTrimOut+e-a.max_out,t=clipInitTrimOut+(v-clipInitSequenceTrimOut),l=Math.round((v-clipInitSequenceTrimIn)/b.framePerPixel),PLAYER.operateJson.showAdhere(c,"backward")):PLAYER.operateJson.hideAdhere(c)}var e,g,h,i,j,k,l,m,n,b=r.config,c=$(a.target);b.$header.width(),e=c.attr("data-time"),g=PLAYER.operateJson.getDraggingHelp(e),g.show(),h=JSON.parse(PLAYER.operateJson.getDraggingAttr(e)),clipInitWidth=h.clipInitWidth,clipInitLeft=h.clipInitLeft,clipInitClientX=h.clipInitClientX,clipInitOffsetLeft=h.clipInitOffsetLeft,clipInitTop=h.clipInitTop,clipInitClientY=h.clipInitClientY,clipInitOffsetTop=h.clipInitOffsetTop,clipInitIndex=h.clipInitIndex,clipInitType=h.clipInitType,clipInitTrimIn=h.clipInitTrimIn,clipInitTrimOut=h.clipInitTrimOut,clipInitSequenceTrimIn=h.clipInitSequenceTrimIn,clipInitSequenceTrimOut=h.clipInitSequenceTrimOut,clipMaxFrame=h.clipMaxFrame,i=c.attr("data-clipdir"),PLAYER.operateJson.mouseMoveState(g,i),"middle"===i?(j=a.x-clipInitClientX,k=Math.floor((a.x-clipInitClientX)*b.framePerPixel),u=clipInitSequenceTrimIn+k,a.min_in+k<=0&&(k=-a.min_in,u=clipInitSequenceTrimIn-a.min_in),0>=u&&(u=0),v=u+(g.attr("data-trimout")-g.attr("data-trimin")),m=u/b.framePerPixel,q(g,k),PLAYER.help_index=a.cal_index,PLAYER.help_index&&PLAYER.help_index>=1&&U(g,clipInitType,PLAYER.help_index),g.attr("data-sequencetrimin",u),g.attr("data-sequencetrimout",v),g.css("left",m)):"left"===i?(l=clipInitWidth-(a.x-clipInitClientX),m=clipInitLeft+(a.x-clipInitClientX),n=(a.x-clipInitClientX)*b.framePerPixel/b.framePerPixel,k=Math.round(n*b.framePerPixel),s=clipInitTrimIn+k,u=clipInitSequenceTrimOut-clipInitTrimOut+s,"subtitle"!==c.attr("data-type")&&"video"!==c.attr("data-type")&&0>=s&&(s=0,u=clipInitSequenceTrimOut-clipInitTrimOut,k=s-clipInitTrimIn,n=k/b.framePerPixel,m=clipInitLeft+n,l=clipInitWidth-n),s>=clipInitTrimOut-1&&(s=clipInitTrimOut-1,u=clipInitSequenceTrimOut-1,k=s-clipInitTrimIn,n=k/b.framePerPixel,m=clipInitLeft+n,l=clipInitWidth-n),0>=m&&(m=0,u=0,s=clipInitTrimOut-clipInitSequenceTrimOut,l=clipInitWidth+clipInitLeft),w(g,k),g.attr("data-trimin",s),g.attr("data-sequencetrimin",u),g.css("width",l),g.css("left",m)):"right"===i&&(l=clipInitWidth+(a.x-clipInitClientX),n=(a.x-clipInitClientX)*b.framePerPixel/b.framePerPixel,k=Math.round(n*b.framePerPixel),t=clipInitTrimOut+k,v=clipInitSequenceTrimIn+t-clipInitTrimIn,"subtitle"!==c.attr("data-type")&&"video"!==c.attr("data-type")&&t>=clipMaxFrame&&(t=clipMaxFrame,v=clipInitSequenceTrimIn+t-clipInitTrimIn,k=t-clipInitTrimOut,n=k/b.framePerPixel,l=clipInitWidth+n),clipInitTrimIn+1>=t&&(t=clipInitTrimIn+1,v=clipInitSequenceTrimIn+t-clipInitTrimIn,k=t-clipInitTrimOut,n=k/b.framePerPixel,l=clipInitWidth+n),l+clipInitLeft>=b.$rulerWrap.width()&&(l=b.$rulerWrap.width()-clipInitLeft,n=l-clipInitWidth,k=Math.round(n*b.framePerPixel),t=clipInitTrimOut+k,v=clipInitSequenceTrimIn+t-clipInitTrimIn),x(g,k),g.attr("data-trimout",t),g.attr("data-sequencetrimout",v),g.css("width",l))}function U(a,b,c){return $.each($('.time_ruler_bar[data-type="'+b+'"]'),function(b,d){parseInt($(d).attr("data-index"))===c&&$(this).append(a)}),a}function V(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,s,t,u;r.config,c=a.target,d=c.attr("data-time"),e=JSON.parse(PLAYER.operateJson.getDraggingAttr(d)),f=c.attr("data-clipdir"),g=PLAYER.operateJson.getDraggingHelp(d),h=parseInt(g.attr("data-sequencetrimin")),i=parseInt(g.attr("data-sequencetrimout")),j=parseInt(g.attr("data-trimin")),k=parseInt(g.attr("data-trimout")),l=g.css("left"),m=g.width(),n={sequenceTrimIn:h,sequenceTrimOut:i,trimIn:j,trimOut:k},c.attr("data-sequencetrimin",h),c.attr("data-sequencetrimout",i),c.attr("data-trimin",j),c.attr("data-trimout",k),c.css("left",l),c.css("width",m),"left"!==f&&e.nextClip?(o=c.find(".effect_box_r").attr("data-type"),p=c.find(".effect_box_r").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(d,o,p),$(".edit_box_v").each(function(a,b){var c,d;$(b).attr("data-time")===e.nextClip&&(c=$(b).find(".effect_box_l").attr("data-type"),d=$(b).find(".effect_box_l").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(e.nextClip,c,d),$(b).find(".effect_box_l").remove())}),c.find(".effect_box_r").remove()):"right"!==f&&e.prevClip&&(o=c.find(".effect_box_l").attr("data-type"),p=c.find(".effect_box_l").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(d,o,p),$(".edit_box_v").each(function(a,b){var c,d;$(b).attr("data-time")===e.prevClip&&(c=$(b).find(".effect_box_r").attr("data-type"),d=$(b).find(".effect_box_r").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(e.prevClip,c,d),$(b).find(".effect_box_r").remove())}),c.find(".effect_box_l").remove()),q=g.parent().attr("data-type"),s=parseInt(g.parent().attr("data-index")),U(c,q,s),t=[],$.each(g.siblings(),function(a,b){$(b).hasClass("onselected")||$(b).hasClass("changeHelp")||t.push($(b))}),t.length>=1&&PLAYER.operateJson.checkCoverEvent(g,g.attr("data-intid")),u=parseInt(g.parent().attr("data-index")),o=g.parent().attr("data-type"),PLAYER.operateJson.updateClipAttr(n,d),PLAYER.operateJson.changeIndexClipAttr(o,u,d),PLAYER.operateJson.removeDraggingInfo(d),g.remove()}function W(a){function f(a,c){var t,u,v,w,x,y,z,A,B,C,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=a.attr("data-id"),m=a.attr("data-time"),n=a.attr("data-interleaved"),o=parseInt(a.parent(".time_ruler_bar").attr("data-index")),p=a.attr("data-type"),q=p+"_"+PLAYER.genNonDuplicateID(12),r=parseInt(a.offset().left),s=parseInt(a.width());return c.x<=r?!1:c.x>=r+s?!1:(v=parseInt((c.x-r)*b.framePerPixel)/b.framePerPixel,f=parseInt(a.attr("data-trimin")),g=parseInt(f+Math.round(v*b.framePerPixel)),d=parseInt(a.attr("data-sequencetrimin")),e=parseInt(d+Math.round(v*b.framePerPixel)),j=g,k=parseInt(a.attr("data-trimout")),h=e,i=parseInt(a.attr("data-sequencetrimout")),t=a.clone(),t.find(".effect_box_l")&&t.find(".effect_box_l").remove(),t.find(".effect_box_r")&&a.find(".effect_box_r").remove(),t.removeClass("onselected"),t.attr("data-trimin",j),t.attr("data-trimout",k),t.attr("data-sequencetrimin",h),t.attr("data-sequencetrimout",i),t.attr("data-time",q),t.attr("data-intid",c.intId),w=c.x-a.parent().offset().left,x=a.outerWidth()-(c.x-r),t.css("left",w),t.css("width",x),a.parent(".time_ruler_bar").append(t),a.parent(".time_ruler_bar").hasClass("bar_v")?(y=PLAYER.operateJson.getCutNewEffectClip(m,j,k),u={assetID:l,trimIn:j,trimOut:k,sequenceTrimIn:h,sequenceTrimOut:i,effect:y,createTime:q,type:p,interleaved_id:c.intId},u.interleaved="true"===n?!0:!1,PLAYER.operateJson.addVideoClipAttr(u,o)):a.parent(".time_ruler_bar").hasClass("bar_a")?(u={assetID:l,trimIn:j,trimOut:k,sequenceTrimIn:h,sequenceTrimOut:i,volume:100,createTime:q,type:p,interleaved_id:c.intId},u.interleaved="true"===n?!0:!1,PLAYER.operateJson.addAudioClipAttr(u,o)):a.parent(".time_ruler_bar").hasClass("bar_t")&&(z=JSON.parse(PLAYER.operateJson.getSubtitleClip(m,o)),A={trimIn:j,trimOut:k,sequenceTrimIn:h,sequenceTrimOut:i,createTime:q,type:p,interleaved_id:c.intId},$.extend(z,A),PLAYER.operateJson.addSubtitleClipAttr(z,o)),a.attr("data-trimout",g),a.attr("data-sequencetrimout",e),a.width(c.x-r),B={trimIn:f,trimOut:g,sequenceTrimIn:d,sequenceTrimOut:e},C=PLAYER.operateJson.getCutOldEffectClip(m,f,g),PLAYER.operateJson.updateClipAttr(B,m,C),void 0)}var b=r.config,c=a.target,d=c.attr("data-time"),e=PLAYER.operateJson.getDraggingHelp(d);PLAYER.operateJson.removeDraggingInfo(d),e.remove(),85===PLAYER.keyNum&&(PLAYER.checkPlaying(),c.removeClass("onselected"),c.css("cursor","url(images/cur/cut.cur),default"),f(c,a))}function X(a){var b=a.target,c=parseInt(b.position().left),d=parseInt(b.outerWidth()),e=b.parent(".time_ruler_bar").offset().left,f=a.x;85===PLAYER.keyNum?b.css({cursor:"url(images/cur/cut.cur),default"}):71===PLAYER.keyNum?b.css({cursor:"url(images/cur/select_back.cur),default"}):7100===PLAYER.keyNum?b.css({cursor:"url(images/cur/select_pre.cur),default"}):187===PLAYER.keyNum?b.css({cursor:"url(images/cur/zoom_plus.cur),default"}):189===PLAYER.keyNum?b.css({cursor:"url(images/cur/zoom_minus.cur),default"}):Math.abs(e+c-f)<=8?b.css({cursor:"url(images/cur/cursor1.cur),default"}):Math.abs(e+c+d-f)<=8?b.css({cursor:"url(images/cur/cursor2.cur),default"}):b.css({cursor:"default"})}function Y(a){var d,e,f,g,h,i,j,k,l,m,n,o,q,s,t,u,v,b=r.config;if(r.targetObj,d=a.target.children().length,0!==d){if(0!==$(".space").size()&&$(".space").remove(),e=a.x-a.target.parent().offset().left,f=parseInt(e*b.framePerPixel)/b.framePerPixel,g=Math.round(f*b.framePerPixel),h=[],i=[],j=[],k=[],n=$('<div class="space"></div>'),$.each(a.target.children(".edit_box"),function(a,b){parseInt($(b).attr("data-sequencetrimin"))>g&&i.push(parseInt($(b).attr("data-sequencetrimin"))),$(b).attr("data-sequencetrimout")<g&&h.push(parseInt($(b).attr("data-sequencetrimout")))}),0===i.length)return!1;if(0===h.length&&h.push(0),l=Math.min.apply(null,i),m=Math.max.apply(null,h),o=a.target.children('.edit_box[data-sequencetrimin="'+l+'"]'),a.target.children('.edit_box[data-sequencetrimout="'+m+'"]'),n.attr("data-sequencetrimin",m),n.attr("data-sequencetrimout",l),n.css("left",m/b.framePerPixel),n.css("width",(l-m)/b.framePerPixel),n.insertBefore(o),"true"===o.attr("data-interleaved")&&(q=PLAYER.operateJson.chooseInterleavedElem(o),k.push(parseInt(q.attr("data-sequencetrimin"))),parseInt(q.siblings().attr("data-sequencetrimout"))<=parseInt(q.attr("data-sequencetrimin"))&&j.push(parseInt(q.siblings().attr("data-sequencetrimout")))),s=0===j.length?0:Math.max.apply(null,j),0===k.length)return!1;t=Math.min.apply(null,k),u=t-s,v=l-m,v>=u&&n.attr("data-offset",u)}}function Z(a){var d,e,f,g;r.config,r.targetObj,d=a.target,d.toggleClass("onEffect"),"footer-middle"===d.attr("data-pos")&&(e=parseInt(d.parent().attr("data-sequencetrimout")),f=PLAYER.operateJson.checkNextSubClip(e),f.children(".effect_box_l").toggleClass("onEffect")),"header-middle"===d.attr("data-pos")&&(g=parseInt(d.parent().attr("data-sequencetrimin")),f=PLAYER.operateJson.checkPrevSubClip(g),f.children(".effect_box_r").toggleClass("onEffect"))}function _(a){var d,e,g,h,i;PLAYER.hideSubititleEdit(),r.config,r.targetObj,d=a.target,e=d.attr("data-time"),parseInt(d.attr("data-sequencetrimin")),g=parseInt(d.parent().attr("data-index")),h=d.parent().attr("data-type"),i=JSON.parse(PLAYER.operateJson.getSubtitleClip(e,g)),PLAYER.showSubititleEdit(),ab(i),bb(i,i.id,h),cb(i,e,g,h,"subtitle"),d.hasClass&&d.hasClass("draggable")&&PLAYER.operateJson.mouseUpState(d)}function ab(a){var c,d,f;$("#js_subtitle_h_form").empty(),a.id,c=$('<div class="form-group"><label class="col-md-4 control-label" for="fontsize">左边距</label><div class="col-md-8"><input type="range" class="form-control" id="js_subtitle_left" step="0.5"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_subtitle_left_value" disabled="disabled"></div></div><div class="form-group"><label class="col-md-4 control-label" for="fontsize">上边距</label><div class="col-md-8"><input type="range" class="form-control" id="js_subtitle_top" step="0.5"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_subtitle_top_value" disabled="disabled"></div></div>'),$("#js_subtitle_h_form").append(c),d=a.pixel.filter(function(a){return"images"!==a.attr.type}),a.pixel.filter(function(a){return"images"===a.attr.type}),$.each(d,function(a,b){var c=$('<div class="form-group"><label class="col-md-4 control-label" for="name" >字体'+(a+1)+"</label>"+'<div class="col-md-8">'+'<input type="text" class="form-control subtitle_text" id="js_subtitle_text'+(a+1)+'" placeholder="字体'+(a+1)+'" data-id="'+b.attrID+'">'+"</div>"+"</div>"),d=$('<div class="form-group"><label class="col-md-4 control-label" for="fontcolor">字体'+(a+1)+"颜色</label>"+'<div class="col-md-8">'+'<input type="text" class="form-control subtitle_color" id="js_subtitle_color'+(a+1)+'" data-control="hue" value="#ffffff" data-id="'+b.attrID+'">'+"</div>"+"</div>"),e=$('<div class="form-group"><label class="col-md-4 control-label" for="fontsize">字体'+(a+1)+"字号</label>"+'<div class="col-md-8">'+'<input type="number" class="form-control subtitle_fontsize" id="js_subtitle_fontsize'+(a+1)+'" data-id="'+b.attrID+'">'+"</div>"+"</div>");$("#js_subtitle_h_form").append(c),$("#js_subtitle_h_form").append(d),$("#js_subtitle_h_form").append(e)}),f=$('<div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><button type="button" class="btn btn-sm pull-right" id="js_subtitle_btn">关闭</button></div></div>'),$("#js_subtitle_h_form").append(f)}function bb(a,b){var d=a.pixel.filter(function(a){return"images"!==a.attr.type});$("#js_subtitle_h_form").height()>$(".subtitle_h_form_wrap").height()&&($(".subtitle_edit_track").show(),new Scrollbar({dirSelector:"y",contSelector:$(".subtitle_h_form_wrap"),barSelector:$(".subtitle_edit_track"),sliderSelector:$(".subtitle_edit_scroll")})),("subtitle_01"===b||"subtitle_02"===b||"subtitle_03"===b||"subtitle_05"===b||"subtitle_06"===b||"subtitle_07"===b)&&($("#js_subtitle_left").attr("max",$("#ocx").width()),$("#js_subtitle_top").attr("max",$("#ocx").height()),$("#js_subtitle_left").attr("min",0),$("#js_subtitle_top").attr("min",0),$("#js_subtitle_left,#js_subtitle_left_value").val(a.abs.left_value),$("#js_subtitle_top,#js_subtitle_top_value").val(a.abs.top_value),$("#js_subtitle_text1").val(d[0].attr.text),$("#js_subtitle_text2").val(d[1].attr.text),$("#js_subtitle_fontsize1").val(d[0].attr.fontSize),$("#js_subtitle_fontsize2").val(d[1].attr.fontSize),$("#js_subtitle_color1").val(d[0].attr.fillStyle),$("#js_subtitle_color2").val(d[1].attr.fillStyle),$("#js_subtitle_color1").minicolors({control:$(this).attr("data-control")||"hue",defaultValue:$(this).attr("data-defaultValue")||"",inline:"true"===$(this).attr("data-inline"),letterCase:$(this).attr("data-letterCase")||"lowercase",opacity:$(this).attr("data-opacity"),position:$(this).attr("data-position")||"bottom left",change:function(a,b){if(a){b&&(a+=", "+b);try{$("#js_subtitle_color1").val(a)}catch(c){console.log(c)}}},theme:"bootstrap"}),$("#js_subtitle_color2").minicolors({control:$(this).attr("data-control")||"hue",defaultValue:$(this).attr("data-defaultValue")||"",inline:"true"===$(this).attr("data-inline"),letterCase:$(this).attr("data-letterCase")||"lowercase",opacity:$(this).attr("data-opacity"),position:$(this).attr("data-position")||"bottom left",change:function(a,b){if(a){b&&(a+=", "+b);try{$("#js_subtitle_color2").val(a)}catch(c){console.log(c)}}},theme:"bootstrap"}))}function cb(a,b,c,d,f){function o(a,b,c){$.each(a.attr,function(a,d){d.attrID===b&&$.extend(d.attr,c)})}function p(a){var b,c;PLAYER.OCX.adjustEffect(a),PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime)),b=parseInt($("#js_subtitle_left_value").val()),c=parseInt($("#js_subtitle_top_value").val()),PLAYER.operateJson.updateSubtitleClip(a,b,c)}var k,l,g=JSON.stringify(a.pixel),h=JSON.parse(JSON.stringify(a.pixel)),i=[],j=[];for(k=0;k<h.length;k++)i[k]=h[k].x1-JSON.parse(JSON.stringify(a.abs.left_value));for(k=0;k<h.length;k++)j[k]=h[k].y1-JSON.parse(JSON.stringify(a.abs.top_value));l={trackType:d,trackIndex:c,subClipId:b,name:f,attr:JSON.parse(g)},$("#js_subtitle_left")[0].oninput=function(a){$("#js_subtitle_left_value").val($(a.target).val());for(var b=0;b<l.attr.length;b++)l.attr[b].x1=i[b]+parseInt($(a.target).val());p(l)},$("#js_subtitle_top")[0].oninput=function(a){$("#js_subtitle_top_value").val($(a.target).val());for(var b=0;b<l.attr.length;b++)l.attr[b].y1=j[b]+parseInt($(a.target).val());p(l)},$("#js_subtitle_h_form .subtitle_text").on("change",function(a){var b=$(a.target).attr("data-id"),c={text:$(a.target).val()};o(l,b,c),p(l)}),$("#js_subtitle_h_form .subtitle_color").on("change",function(a){var b=$(a.target).attr("data-id"),c={fillStyle:$(a.target).val()};o(l,b,c),p(l)}),$("#js_subtitle_h_form .subtitle_fontsize").on("change",function(a){var b=$(a.target).attr("data-id"),c={fontSize:$(a.target).val()};o(l,b,c),p(l)}),$("#js_subtitle_btn").on("click",function(){PLAYER.hideSubititleEdit()})}function fb(a){function A(a){var c=a.attr("data-time");w=parseInt(a.attr("data-sequencetrimin")),x=parseInt(a.attr("data-sequencetrimout")),console.log("spaceFrame",v),console.log("v0_sequencetrimin",w),y=w-v,z=x-v,a.attr("data-sequencetrimin",y),a.attr("data-sequencetrimout",z),a.css("left",y/b.framePerPixel),q={sequenceTrimIn:y,sequenceTrimOut:z},PLAYER.operateJson.updateClipAttr(q,c)}function K(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w,x,y,z;v_initId=a.attr("data-intid"),intId=v_initId+1,h=a.attr("data-id"),i=a.attr("data-type"),j=a.attr("data-interleaved"),k=parseInt(c.attr("data-index")),t=i+"_"+PLAYER.genNonDuplicateID(12),n=parseInt(a.attr("data-trimin")),o=parseInt(a.attr("data-trimout")),l=parseInt(a.attr("data-sequencetrimin")),m=parseInt(a.attr("data-sequencetrimout")),r=n,s=o,p=l-e+u,q=p+o-n,f=a.clone(),f.css("left",p/b.framePerPixel),f.attr("data-sequencetrimin",p),f.attr("data-sequencetrimout",q),f.attr("data-time",t),f.attr("data-intid",intId),c.append(f),PLAYER.operateJson.checkCoverEvent(f,d),c.hasClass("bar_v")?(v=a.attr("data-time"),w=JSON.parse(PLAYER.operateJson.getEffectClip(v)),w&&0!==w.length?$.each(w,function(){"all"===$(this).pos&&($(this).trimIn=r,$(this).trimOut=s)}):w=[],g={assetID:h,trimIn:r,trimOut:s,sequenceTrimIn:p,sequenceTrimOut:q,effect:w,createTime:t,type:i},"true"===j?(g.interleaved=!0,g.interleaved_id=intId):(g.interleaved=!1,x="interleaved_id_"+PLAYER.genNonDuplicateID(12),g.interleaved_id=x),PLAYER.operateJson.addVideoClipAttr(g,k)):c.hasClass("bar_a")?(g={assetID:h,trimIn:r,trimOut:s,sequenceTrimIn:p,sequenceTrimOut:q,volume:100,createTime:t,type:i,interleaved_id:intId},"true"===j?(g.interleaved=!0,g.interleaved_id=intId):(g.interleaved=!1,x="interleaved_id_"+PLAYER.genNonDuplicateID(12),g.interleaved_id=x),PLAYER.operateJson.addAudioClipAttr(g,k)):c.hasClass("bar_t")&&(add_subclip.css("background","pink"),y=JSON.parse(PLAYER.subtitleAttr[h]),x="interleaved_id_"+PLAYER.genNonDuplicateID(12),z={trimIn:r,trimOut:s,sequenceTrimIn:p,sequenceTrimOut:q,createTime:t,type:i,interleaved_id:x},$.extend(y,z),PLAYER.operateJson.addSubtitleClipAttr(y,k))}var d,e,f,g,h,q,t,u,v,w,x,y,z,B,C,D,E,F,G,H,I,J,b=r.config;if(r.targetObj,d=b.$sliderBar.width(),e=b.$sliderBar.position().left,f=Math.abs(parseFloat(b.$rulerWrap.css("marginLeft"))),g=b.framePerPixel,h=a.code,q=null,189===h){if(d===b.$headerRight.width())return;ob(10,g,d,e,f)}else if(187===h){if(d===2*m+8)return;ob(-10,g,d,e,f)}else if(46===h||8===h)h=0,a.returnValue=!1,PLAYER.checkPlaying(),a.target.hasClass("form-control")||($("#js_time_ruler_bar_box .onselected").length>0&&($.each($(".onselected"),function(a,b){var f,g,h,i,c=$(b).attr("data-time"),d=parseInt($(b).attr("data-sequencetrimin")),e=parseInt($(b).attr("data-sequencetrimout"));$(b).find(".effect_box_r").length>=1&&PLAYER.operateJson.checkNextSubClip(e)&&(f=PLAYER.operateJson.checkNextSubClip(e).attr("data-time"),g=$('.edit_box_v[data-time="'+f+'"]').find(".effect_box_l").attr("data-type"),h=$('.edit_box_v[data-time="'+f+'"]').find(".effect_box_l").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(f,g,h),$('.edit_box_v[data-time="'+f+'"]').find(".effect_box_l").remove()),$(b).find(".effect_box_l").length>=1&&PLAYER.operateJson.checkPrevSubClip(d)&&(i=PLAYER.operateJson.checkPrevSubClip(d).attr("data-time"),g=$('.edit_box_v[data-time="'+i+'"]').find(".effect_box_r").attr("data-type"),h=$('.edit_box_v[data-time="'+i+'"]').find(".effect_box_r").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(i,g,h),$('.edit_box_v[data-time="'+i+'"]').find(".effect_box_r").remove()),PLAYER.operateJson.deleteClipAttr(c),$(b).remove()}),PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]),PLAYER.OCX.updateProjectJson(PLAYER.jsonObj),PLAYER.OCX.seek(parseInt(r.currTime)),PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame()||1e3,$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||0)),PLAYER.PTR.updateEvent(PLAYER.PTR.config)),$("#js_time_ruler_bar_box .space").length>0&&(b=r.config,r.targetObj,t=$(".space").siblings(".draggable"),u=parseInt($(".space").attr("data-sequencetrimin")),w=0,x=0,y=0,z=0,v=$(".space").attr("data-offset")?parseInt($(".space").attr("data-offset")):parseInt($(".space").attr("data-sequencetrimout"))-parseInt($(".space").attr("data-sequencetrimin")),$.each(t,function(a,b){if($(b).attr("data-sequencetrimin")>=u&&(A($(b)),"true"===$(b).attr("data-interleaved"))){var c=PLAYER.operateJson.chooseInterleavedElem($(b));A(c)}}),$(".space").remove(),PLAYER.operateJson.sendJson()),$("#js_time_ruler_bar_box .onEffect").length>0&&($.each($(".onEffect"),function(a,b){var c=$(b).parent(".edit_box_v").attr("data-time"),d=$(b).attr("data-type"),e=$(b).attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(c,d,e),$(b).remove()}),PLAYER.operateJson.sendJson()));else if(a.ctrl&&65===h)0!==$("#js_time_ruler_bar_box").find(".draggable").length&&$("#js_time_ruler_bar_box").find(".draggable").addClass("onselected");else if(a.ctrl&&17===h)PLAYER.keyNum=17;else if(a.ctrl&&67===h)PLAYER.copyOrcut="copy";else if(a.ctrl&&88===h)PLAYER.checkPlaying(),PLAYER.copyOrcut="cut",B=[],$.each($(".onselected"),function(a,b){B.push(parseInt($(this).attr("data-sequencetrimin"))),PLAYER.clipboard.push($(this)),PLAYER.clipboard.parent.push($(this).parent(".time_ruler_bar")),$(b).remove();var c=$(b).attr("data-time");PLAYER.operateJson.deleteClipAttr(c)}),PLAYER.cut_min_sIn=Math.min.apply(null,B),PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]),PLAYER.OCX.updateProjectJson(PLAYER.jsonObj),PLAYER.OCX.seek(parseInt(r.currTime)),PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame()||1e3,$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||0)),PLAYER.PTR.updateEvent(PLAYER.PTR.config);else if(a.ctrl&&86===h&&"copy"===PLAYER.copyOrcut)PLAYER.checkPlaying(),b=r.config,r.targetObj,u=r.currTime,C="check_interleaved_id_"+PLAYER.genNonDuplicateID(12),B=[],$(".onselected").each(function(a,b){B.push(parseInt($(b).attr("data-sequencetrimin")))}),D=Math.min.apply(null,B),$(".onselected").each(function(a,b){K($(b),$(b).parent(".time_ruler_bar"),C,D)}),PLAYER.operateJson.sendJson();else if(a.ctrl&&86===h&&"cut"===PLAYER.copyOrcut){if(PLAYER.checkPlaying(),b=r.config,r.targetObj,u=r.currTime,C="check_interleaved_id_"+PLAYER.genNonDuplicateID(12),PLAYER.clipboard){for(E=0;E<PLAYER.clipboard.length;E++)K(PLAYER.clipboard[E],PLAYER.clipboard.parent[E],C,PLAYER.cut_min_sIn);PLAYER.operateJson.sendJson()}PLAYER.clipboard=[],PLAYER.clipboard.parent=[]}else if(a.ctrl&&90===h){if(PLAYER.goBackJson.length-1<=0)return $(".time_ruler_bar").empty(),PLAYER.goBackJson=[],$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(a,b){var c={type:$(b).attr("data-type"),index:parseInt($(b).attr("data-index")),subclip:[]};
PLAYER.jsonObj.rootBin.sequence[0].tracks.push(c)}),PLAYER.operateJson.checkNoClip()&&PLAYER.OCX.clearWindow(),!1;for(F=PLAYER.goBackJson[PLAYER.goBackJson.length-2],PLAYER.jsonObj.rootBin.sequence[0]=JSON.parse(F),$(".time_ruler_bar").empty(),E=0;G=PLAYER.jsonObj.rootBin.sequence[0].tracks[E++];)H=G.type,I=G.index,0===G.subclip.length?PLAYER.operateJson.emptyTrack(H,I):(J=PLAYER.operateJson.getTrack(H,I),$.each(G.subclip,function(a,b){var c,d,g,h,i,j,l,m,e=b.assetID,f=b.id;e&&PLAYER.operateJson.getMaterialDuration(e,function(a){c=a.duration,d=a.name}),f&&PLAYER.operateJson.getSubtitleDuration(f,function(a){c=a.duration,d=a.name}),g=(b.trimOut-b.trimIn)/PLAYER.TR.config.framePerPixel,h=b.sequenceTrimIn/PLAYER.TR.config.framePerPixel,i=$('<div class="edit_box draggable" data-trimin="'+b.trimIn+'" data-trimout="'+b.trimOut+'" data-sequencetrimin="'+b.sequenceTrimIn+'" data-sequencetrimout="'+b.sequenceTrimOut+'">'+d+"</div>"),i.attr("data-duration",c||2e3),i.attr("data-name",d),i.attr("data-id",b.assetID||b.id),i.attr("data-type",b.type),i.attr("data-interleaved",b.interleaved),i.attr("data-time",b.createTime),i.attr("data-intid",b.interleaved_id),i.css("width",g),i.css("left",h),j="edit_box_"+J.attr("data-type"),i.addClass(j),b.effect&&0!==b.effect.length&&$.each(b.effect,function(a,c){l=$('<div class="effect_box"></div>'),l.attr("data-duration",c.duration),l.attr("data-trimin",c.trimIn),l.attr("data-trimout",c.trimOut),l.attr("data-pos",c.pos),l.attr("data-type",c.type),m=(c.trimOut-c.trimIn)/PLAYER.TR.config.framePerPixel,l.width(m),"mosaic"===c.type?l.addClass("effect_box_all"):c.trimOut===b.trimOut?l.addClass("effect_box_r"):c.trimIn===b.trimIn&&l.addClass("effect_box_l"),i.append(l)}),J.append(i)}),$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame())),PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame(),PLAYER.PTR.updateEvent(PLAYER.PTR.config));PLAYER.goBackJson.pop(),PLAYER.OCX.updateProjectJson(PLAYER.jsonObj),console.log("PLAYER.jsonObj",PLAYER.jsonObj),PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime))}}function gb(a){var b,d,e,f,g;if(a=PLAYER.EventUtil.getEvent(a),PLAYER.EventUtil.preventDefault(a),b=r.config,r.targetObj,d=b.$sliderBar.width(),e=b.$sliderBar.position().left,f=Math.abs(parseFloat(b.$rulerWrap.css("marginLeft"))),g=b.framePerPixel,187===PLAYER.keyNum){if($(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_plus").addClass("active"),d===2*m+8)return;ob(-10,g,d,e,f)}if(189===PLAYER.keyNum){if($(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_minus").addClass("active"),d===b.$headerRight.width())return;ob(10,g,d,e,f)}}function ib(){var e=r.config;e.$trimIn.addEventListener=function(b,d){function g(a){jb(a.clientX,a.clientY,d)}function h(){this.onmousemove=null}"mousemove"==b&&e.$trimIn.mousedown(function(b){b.stopPropagation(),f=b.clientX,a=c,document.onmousemove=g,document.onmouseup=h})},e.$trimOut.addEventListener=function(a,c){function g(a){kb(a.clientX,a.clientY,c)}function h(){this.onmousemove=null}"mousemove"==a&&e.$trimOut.mousedown(function(a){a.stopPropagation(),f=a.clientX,b=d,document.onmousemove=g,document.onmouseup=h})}}function jb(b,e,g){var j,k,l,h=r.targetObj,i=r.config;b<$("."+h).offset().left&&(b=$("."+h).offset().left),j=b-f,a+j>d-3||(c=0>a+j?0:a+j,c=parseInt(c*i.framePerPixel)/i.framePerPixel,r.trimInCurrTime=Math.round(c*i.framePerPixel),k=d-c,i.$trimInOut.css("left",c),i.$trimInOut.css("width",k),null!=g&&(l=r.trimInCurrTime,g(l)))}function kb(a,e,g){var i,j,k,l;r.targetObj,i=r.config,a<i.$headerRight.offset().left&&(a=i.$headerRight.offset().left),j=a-f,c+3>b+j||(d=b+j>i.maxTime*i.perMsecWidth?i.maxTime*i.perMsecWidth:b+j,d=parseInt(d*i.framePerPixel)/i.framePerPixel,r.trimOutCurrTime=Math.round(d*i.framePerPixel),k=d-c,i.$trimInOut.css("width",k),null!=g&&(l=r.trimOutCurrTime,g(l)))}function lb(a){r.trimInCurrTime=a,PLAYER.PTR.trimInCurrTime=a,PLAYER.PTR.fixTrimInByCurrentTime(a)}function mb(a){r.trimOutCurrTime=a,PLAYER.PTR.trimOutCurrTime=a,PLAYER.PTR.fixTrimOutByCurrentTime(a)}function nb(){var b,c,d,e,f,g,n;r.targetObj,b=r.config,b.$sliderBarLeft.mousedown(function(a){var a=a||window.event;b.$sliderBarMiddle.addClass("now"),f=a.clientX,d=b.$sliderBar.width(),c=parseInt(b.$sliderBar.position().left),g=Math.abs(parseInt(b.$rulerWrap.css("marginLeft"))),n=b.framePerPixel,$(document)[0].onmousemove=function(a){var a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),a.preventDefault(),$("body").css({cursor:"url(images/cur/hand_move.cur),default"}),diff_move=f-a.clientX,ob(diff_move,n,d,c,g)},$(document)[0].onmouseup=function(){$("body").css({cursor:"default"}),$(document)[0].onmousemove=null}}),b.$sliderBarRight.mousedown(function(a){var a=a||window.event;b.$sliderBarMiddle.addClass("now"),f=a.clientX,d=b.$sliderBar.width(),c=parseInt(b.$sliderBar.position().left),g=Math.abs(parseInt(b.$rulerWrap.css("marginLeft"))),n=b.framePerPixel,$(document)[0].onmousemove=function(a){var a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),a.preventDefault(),$("body").css({cursor:"url(images/cur/hand_move.cur),default"}),diff_move=a.clientX-f,ob(diff_move,n,d,c,g)},$(document)[0].onmouseup=function(){$("body").css({cursor:"default"}),$(document)[0].onmousemove=null}}),b.$sliderBarMiddle.mousedown(function(a){var a=a||window.event;b.$sliderBarMiddle.addClass("now"),f=a.clientX,d=b.$sliderBar.width(),c=parseInt(b.$sliderBar.position().left),$(document)[0].onmousemove=function(a){return $("body").css({cursor:"move"}),e=a.clientX-f,h=c+e,i=d,0>h&&(h=0),h>j&&(h=j),b.$sliderBar.css("left",h),b.$sliderBarMiddle.addClass("now"),i!=b.$sliderTrack.width()?(j=parseInt(b.$sliderTrack.width()-i),k=parseInt(b.$rulerWrap.width()-q),o=Math.floor(parseInt(k*h/j))):o=0,b.$rulerWrap.css("margin-left",parseInt(-o)),b.$ruler.css("left",o),b.$clipTrackBar.css("margin-left",parseInt(-o)),b.$line.css("margin-left",parseInt(-o)+1),H(o),!1},$(document)[0].onmouseup=function(){b.$sliderBarMiddle.removeClass("now"),$("body").css({cursor:"default"}),$(document)[0].onmousemove=null}})}function ob(a,b,c,d){var n,q,s,t,f=r.config;r.targetObj,n=f.$headerRight.width()/2,a>0?(f.max_fpp===b?s=0:(q=(f.$sliderTrack.width()-c)/(f.max_fpp/b-1),s=a/q),h=d-a,i=c+2*a,f.framePerPixel=b*(s+1),0>=h&&(h=0),d+c+a>=f.$headerRight.width()&&(h=d-a,i=f.$sliderTrack.width()-h),i>=f.$sliderTrack.width()&&(i=f.$sliderTrack.width(),f.framePerPixel=f.maxTime/f.$headerRight.width()),pb(f.framePerPixel)):0>a?(f.min_fpp===b?s=0:(q=(c-(2*m+8))/(b/f.min_fpp-1),s=a/q),h=d-a,i=c+2*a,f.framePerPixel=b/(-s+1),2*m+8>=i&&(i=2*m+8,s=0,h=d-(2*m+8-c/2),f.framePerPixel=f.min_fpp),pb(f.framePerPixel)):(f.framePerPixel=b,pb(f.framePerPixel)),n=Math.floor(f.$headerRight.width()/2),t=F(f.framePerPixel),qb(t.smallScaleFrame,t.smallScaleNumsPerLargeScale,f.framePerPixel),p=Math.floor(f.maxTime/f.framePerPixel),p<=f.$headerRight.width()&&(p=f.$headerRight.width()),j=parseInt(f.$sliderTrack.width()-i),k=parseInt(p-f.$headerRight.width()),0!=r.currTime?(g=Math.floor(parseInt(r.currTime/f.framePerPixel)),o=g-n,h=o*j/k,h>=j&&(h=j,o=k),isNaN(h)&&(o=0,h=0)):o=Math.floor(k*h/j),(isNaN(o)||0>=o)&&(o=0,h=0),f.$sliderBar.css("width",i),f.$sliderBar.css("left",h),f.$sliderBarMiddle.css("width",i-2*m),f.$sliderBarRight.css("left",i-m),f.$rulerWrap.css("margin-left",-o),f.$rulerWrap.css("width",p),f.$ruler.css("left",o),f.$clipTrackBar.css("margin-left",-o),f.$line.css("margin-left",parseInt(-o)+1),H(o),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime),r.fixClipWidth()}function pb(a){var d,e,f,b=r.config;r.targetObj,d=11250,e=b.maxTime/$("."+r.targetObj).width(),f=Math.min(d,e),a<b.min_fpp?a=b.min_fpp:a>f&&(a=f)}function qb(a,b,c){var d=r.config;d.smallScaleFrame=a,d.smallScaleNumsPerLargeScale=b,d.framePerPixel=c,r.updateRuler(d)}var i,j,k,q,a=0,b=0,c=0,d=0,f=0,g=0,h=0,l=0,m=0,o=0,p=0,r=this,s=0,t=0,u=0,v=0,A=[{smallScaleFrame:1,smallScaleNumsPerLargeScale:1},{smallScaleFrame:1,smallScaleNumsPerLargeScale:2},{smallScaleFrame:1,smallScaleNumsPerLargeScale:5},{smallScaleFrame:1,smallScaleNumsPerLargeScale:10},{smallScaleFrame:5,smallScaleNumsPerLargeScale:5},{smallScaleFrame:5,smallScaleNumsPerLargeScale:10},{smallScaleFrame:10,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25,smallScaleNumsPerLargeScale:10},{smallScaleFrame:75,smallScaleNumsPerLargeScale:10},{smallScaleFrame:150,smallScaleNumsPerLargeScale:10},{smallScaleFrame:300,smallScaleNumsPerLargeScale:10},{smallScaleFrame:750,smallScaleNumsPerLargeScale:10},{smallScaleFrame:1500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:4500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9e3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:45e3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9e4,smallScaleNumsPerLargeScale:10}],B={hasTrack:!0,maxTime:1e3,min_largeScaleWidth:80,framePerPixel:0,max_fpp:0,min_fpp:.125,smallScaleNumsPerLargeScale:10,smallScaleFrame:0,smallScaleWidth:0,largeScaleWidth:0,largeScaleMillisecondInterval:0,seekComandTimesMonitor:[],largeScaleHeight:30,smallScaleHeight:12.5,backgroundColor:"#262626",trimHeight:67,scaleColor:"#929293",fontColor:"#929293",fontSize:12,fontFamily:"微软雅黑",$container:null,$ruler:null,$cursor:null,$trimInOut:null,$trimIn:null,$trimOut:null,$sliderTrack:null,$sliderBar:null,$sliderBarLeft:null,$sliderBarMiddle:null,$sliderBarRight:null,$clipTrackContainer:null,$clipTrack:null,$clipVideo:null,$clipAudio1:null,$clipAudio2:null,$clipSubTitle:null,$clipEffect:null,targetObj:"time_rule"};return C.prototype={updateRuler:function(a){var b=r.config;r.targetObj,b.framePerPixel=a.framePerPixel,b.smallScaleFrame=a.smallScaleFrame,b.smallScaleNumsPerLargeScale=a.smallScaleNumsPerLargeScale,b.smallScaleWidth=b.smallScaleFrame/b.framePerPixel,b.largeScaleWidth=b.smallScaleWidth*b.smallScaleNumsPerLargeScale,b.largeScaleMillisecondInterval=40*b.smallScaleFrame*b.smallScaleNumsPerLargeScale,b.max_fpp=Math.min(b.maxTime/$("."+r.targetObj).width(),11250)},updateEvent:function(a,b){var e,c=r.config;r.targetObj,c.maxTime=a,c.max_fpp=Math.min(c.maxTime/c.$headerRight.width(),11250),b?(p=2*c.$headerRight.width(),c.framePerPixel=c.maxTime/p,e=F(c.framePerPixel),pb(c.framePerPixel),qb(e.smallScaleFrame,e.smallScaleNumsPerLargeScale,c.framePerPixel),i=.5*c.$sliderTrack.width(),h=0,o=0,c.$rulerWrap.width(p),c.$sliderBar.css("width",i),c.$sliderBar.css("left",h),c.$sliderBarMiddle.css("width",i-2*m),c.$sliderBarMiddle.css("left",m),c.$sliderBarLeft.css("left",0),c.$sliderBarRight.css("left",i-m)):(p=c.maxTime/c.framePerPixel,o=Math.abs(parseInt(c.$rulerWrap.css("marginLeft"))),i=c.$sliderBar.width(),i===c.$sliderTrack.width()&&(i=c.$headerRight.width()*c.$sliderTrack.width()/p),j=parseInt(c.$sliderTrack.width()-i),k=parseInt(p-c.$headerRight.width()),h=o*j/k,c.$rulerWrap.width(p),c.$sliderBar.css("width",i),c.$sliderBar.css("left",h),c.$sliderBarMiddle.css("width",i-2*m),c.$sliderBarMiddle.css("left",m),c.$sliderBarLeft.css("left",0),c.$sliderBarRight.css("left",i-m)),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime),H(o)},fixArrowCurrentTime:function(a){var d,e,b=this.config;this.targetObj,g=a/b.framePerPixel,d=Math.abs(parseFloat(b.$rulerWrap.css("margin-left"))),e=b.$headerRight.width(),0>=g&&(g=0),g>=b.$rulerWrap.width()&&(g=b.$rulerWrap.width()),g-d>e&&(o=g-e,j=parseFloat(b.$sliderTrack.width()-b.$sliderBar.width()),k=parseFloat(b.$rulerWrap.width()-e),h=o*j/k,b.$sliderBar.css("left",h),b.$rulerWrap.css("margin-left",-o),b.$ruler.css("left",o),b.$clipTrackBar.css("margin-left",-o),b.$line.css("margin-left",-o),H(o)),r.currTime=a,$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(r.currTime)),b.$cursor.css("left",g),b.$line.css("left",g)},fixTrimInByCurrentTime:function(a){var e,b=this.config;this.trimInCurrTime=a,c=this.trimInCurrTime/b.framePerPixel,d=this.trimOutCurrTime/b.framePerPixel,c>d&&(d=b.maxTime/b.framePerPixel,this.trimOutCurrTime=b.maxTime,d=parseInt(d*b.framePerPixel)/b.framePerPixel),b.$trimInOut.css("left",c),b.$trimInOut.css("width",d+2-c),e=PLAYER.getDurationToString(parseInt(r.trimOutCurrTime)-parseInt(r.trimInCurrTime)),$("#js_player_trimInOutTime").html(e)},initTime:function(){var a=this.config;this.targetObj,a.$sliderBar.css("left",0),a.$sliderBarMiddle.css("width",i-l-m),a.$sliderBarMiddle.css("left",l),a.$sliderBarLeft.css("left",0),a.$sliderBarRight.css("left",i-m),a.$rulerWrap.css("margin-left",0),a.$ruler.css("left",0),a.$clipTrackBar.css("margin-left",0),H(0),r.fixArrowCurrentTime(0)},fixTrimOutByCurrentTime:function(a){var e,b=this.config;this.trimOutCurrTime=a,c=this.trimInCurrTime/b.framePerPixel,d=this.trimOutCurrTime/b.framePerPixel,c>d&&(c=0,this.trimInCurrTime=0),b.$trimInOut.css("left",c),b.$trimInOut.css("width",d+2-c),e=PLAYER.getDurationToString(parseInt(r.trimOutCurrTime)-parseInt(r.trimInCurrTime)),$("#js_player_trimInOutTime").html(e)},cutArrowCurrentTime:function(){var c,a=r.config;r.targetObj,c=r.currTime,"interleaved_id_"+PLAYER.genNonDuplicateID(12),PLAYER.checkPlaying(),PLAYER.cutIndex++,$.each($(".onselected"),function(b,d){function e(b){var n,p,q,r,t,v,w,x,y,z,A,B,C,D,d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=b.attr("data-id");b.attr("data-name"),n=b.attr("data-time"),parseInt(b.attr("data-duration")),p=b.attr("data-interleaved"),q=b.attr("data-intid"),r=parseInt(b.parent(".time_ruler_bar").attr("data-index")),b.attr("class"),t=b.attr("data-type"),parseInt(b.offset().left),x=t+"_"+PLAYER.genNonDuplicateID(12),PLAYER.checkPlaying(),b.css("cursor","url(images/cur/cut.cur),default"),b.removeClass("onselected"),d=parseInt(b.attr("data-sequencetrimin")),e=parseInt(c),f=parseInt(b.attr("data-trimin")),g=f+e-d,j=g,h=c,i=parseInt(b.attr("data-sequencetrimout")),k=parseInt(b.attr("data-trimout")),v=b.clone(),v.find(".effect_box_l")&&v.find(".effect_box_l").remove(),v.find(".effect_box_r")&&b.find(".effect_box_r").remove(),y=q+"_"+PLAYER.cutIndex,v.removeClass("onselected"),v.attr("data-trimin",j),v.attr("data-trimout",k),v.attr("data-sequencetrimin",h),v.attr("data-sequencetrimout",i),v.attr("data-time",x),v.attr("data-intid",y),v.css("width",(i-h)/a.framePerPixel),v.css("left",h/a.framePerPixel),b.parent(".time_ruler_bar").append(v),b.parent(".time_ruler_bar").hasClass("bar_v")?(z=PLAYER.operateJson.getCutNewEffectClip(n,j,k),w={assetID:l,trimIn:j,trimOut:k,sequenceTrimIn:h,sequenceTrimOut:i,effect:z,createTime:x,type:t,interleaved_id:y},w.interleaved="true"===p?!0:!1,PLAYER.operateJson.addVideoClipAttr(w,r)):b.parent(".time_ruler_bar").hasClass("bar_a")?(w={assetID:l,trimIn:j,trimOut:k,sequenceTrimIn:h,sequenceTrimOut:i,volume:100,createTime:x,type:t,interleaved_id:y},w.interleaved="true"===p?!0:!1,PLAYER.operateJson.addAudioClipAttr(w,r)):b.parent(".time_ruler_bar").hasClass("bar_t")&&(A=JSON.parse(PLAYER.operateJson.getSubtitleClip(n,r)),B={trimIn:j,trimOut:k,sequenceTrimIn:h,sequenceTrimOut:i,createTime:x,type:t,interleaved_id:y},$.extend(A,B),PLAYER.operateJson.addSubtitleClipAttr(A,r)),b.attr("data-trimout",g),b.attr("data-sequencetrimout",e),b.width((e-d)/a.framePerPixel),C={trimIn:f,trimOut:g,sequenceTrimIn:d,sequenceTrimOut:e},D=PLAYER.operateJson.getCutOldEffectClip(n,f,g),PLAYER.operateJson.updateClipAttr(C,n,D)}v0_sequenceTrimIn=parseInt($(d).attr("data-sequencetrimin")),v0_sequenceTrimOut=parseInt($(d).attr("data-sequencetrimout")),c>v0_sequenceTrimIn&&v0_sequenceTrimOut>c&&e($(d))}),PLAYER.operateJson.sendJson()},fixEffectWidth:function(a){a.children(".effect_box")&&$.each(a.children(".effect_box"),function(a,b){var c=($(b).attr("data-trimout")-$(b).attr("data-trimin"))/PLAYER.TR.config.framePerPixel;$(b).width(c)})},fixClipWidth:function(){var a=r.config;$.each($(".edit_box_v"),function(b,c){var d=($(c).attr("data-trimout")-$(c).attr("data-trimin"))/a.framePerPixel;newLeft=parseInt($(c).attr("data-sequencetrimin"))/a.framePerPixel,$(c).width(d),$(c).css("left",newLeft),r.fixEffectWidth($(c))}),$.each($(".edit_box_a"),function(b,c){var d=($(c).attr("data-trimout")-$(c).attr("data-trimin"))/a.framePerPixel;newLeft=parseInt($(c).attr("data-sequencetrimin"))/a.framePerPixel,$(c).width(d),$(c).css("left",newLeft)}),$.each($(".edit_box_t"),function(b,c){var d=($(c).attr("data-trimout")-$(c).attr("data-trimin"))/a.framePerPixel;newLeft=parseInt($(c).attr("data-sequencetrimin"))/a.framePerPixel,$(c).width(d),$(c).css("left",newLeft)})},moveToNextFrame:function(){PLAYER.keyNum=39;var a=r.config;r.currTime+=1,r.currTime>=a.maxTime&&(r.currTime=a.maxTime),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime)},moveToPrevFrame:function(){PLAYER.keyNum=37,r.config,r.currTime-=1,r.currTime<=0&&(r.currTime=0),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime)},DragDrop:function(){function v(a,b){var c=Q(JSON.parse(b));return a.attr("data-clipdir",c),c}function w(a){var b=JSON.parse(a).clipInitLeft;return b}function x(a){var b=JSON.parse(a).clipInitLeft+JSON.parse(a).clipInitWidth;return b}function y(a){var b=JSON.parse(a).clipInitSequenceTrimIn;return b}function z(a){var b=JSON.parse(a).clipInitSequenceTrimOut;return b}function A(a,b){var g,c=JSON.parse(a).clipInitType,d=JSON.parse(a).clipInitOffsetTop,e=JSON.parse(a).clipInitIndex,f=JSON.parse(a).clipInitClientY;return"v"===c?e>=1&&-10>b-f?g=e+Math.ceil((d-b)/70):e>=2&&b-f>10?g=e-Math.ceil((b-f)/70):Math.abs(b-f)<5&&(g=e):("t"===c||"a"===c)&&(e>=1&&b-f>10?g=e+Math.ceil((b-d)/70):e>=2&&-10>b-f?g=e-Math.ceil((f-b)/70):Math.abs(b-f)<5&&(g=e)),g?g:void 0}function B(a){var d,e,g,i,j,B,C,D,E,F;switch(a=PLAYER.EventUtil.getEvent(a),d=PLAYER.EventUtil.getTarget(a),a.type){case"mousedown":if(d.className.indexOf("draggable")>-1){if(PLAYER.EventUtil.preventDefault(a),PLAYER.clickOrMove=!1,c=$(d),h=a.clientX,PLAYER.operateJson.mouseDownState(c),t=P(c,a),s=v(c,t),PLAYER.operateJson.addDraggingInfo(c,t),k.push(w(t)),l.push(x(t)),m.push(y(t)),n.push(z(t)),b.fire({type:"clipDragstart",target:c,x:a.clientX,y:a.clientY}),"middle"===s){if(e=PLAYER.operateJson.chooseSelectedElem(c),0!==e.length)for(g=0;g<e.length;g++)i=e[g],u=P(i,a),i.attr("data-clipdir",s),PLAYER.operateJson.addDraggingInfo(i,u),k.push(w(u)),l.push(x(u)),m.push(y(u)),n.push(z(u)),b.fire({type:"clipDragstart",target:i,x:a.clientX,y:a.clientY})}else("left"===s||"right"===s)&&(i=PLAYER.operateJson.chooseInterleavedElem(c),i&&(u=P(i,a),i.attr("data-clipdir",s),PLAYER.operateJson.addDraggingInfo(i,u),k.push(w(u)),l.push(x(u)),m.push(y(u)),n.push(z(u)),b.fire({type:"clipDragstart",target:i,x:a.clientX,y:a.clientY})));o=Math.min.apply(null,k),p=Math.max.apply(null,l),q=Math.min.apply(null,m),r=Math.max.apply(null,n)}break;case"mousemove":if(null!==c)if(j=Math.abs(a.clientX-h),1>=j)PLAYER.clickOrMove=!1;else if(PLAYER.clickOrMove=!0,B=A(t,a.clientY),b.fire({type:"clipDrag",target:c,x:a.clientX,y:a.clientY,min_left:o,max_right:p,min_in:q,max_out:r,cal_index:B}),"middle"===s){if(e=PLAYER.operateJson.chooseSelectedElem(c),0!==e.length)for(g=0;g<e.length;g++)i=e[g],b.fire({type:"clipDrag",target:i,x:a.clientX,y:a.clientY,min_left:o,max_right:p,min_in:q,max_out:r,cal_index:B})}else("left"===s||"right"===s)&&(i=PLAYER.operateJson.chooseInterleavedElem(c),i&&b.fire({type:"clipDrag",target:i,x:a.clientX,y:a.clientY,min_left:o,max_right:p,min_in:q,max_out:r,cal_index:B}));d.className.indexOf("draggable")>-1&&(f=$(d),f.css({cursor:"default"}),b.fire({type:"clipCheckDir",target:f,x:a.clientX,y:a.clientY}),f=null);break;case"mouseup":if(j=Math.abs(a.clientX-h),PLAYER.clickOrMove=3>=j?!1:!0,PLAYER.clickOrMove&&c&&(c.hasClass("draggable")||c.hasClass("time_ruler_bar"))){if(b.fire({type:"clipDragend",target:c,x:a.clientX,y:a.clientY}),"middle"===s){if(e=PLAYER.operateJson.chooseSelectedElem(c),0!==e.length)for(g=0;g<e.length;g++)i=e[g],b.fire({type:"clipDragend",target:i,x:a.clientX,y:a.clientY})}else("left"===s||"right"===s)&&(i=PLAYER.operateJson.chooseInterleavedElem(c),i&&b.fire({type:"clipDragend",target:i,x:a.clientX,y:a.clientY}));PLAYER.operateJson.sendJson()}if(!PLAYER.clickOrMove&&c&&c.hasClass("draggable")){if(C="interleaved_id"+PLAYER.genNonDuplicateID(12),b.fire({type:"clipClick",target:c,x:a.clientX,y:a.clientY,intId:C}),"middle"===s){if(e=PLAYER.operateJson.chooseSelectedElem(c),0!==e.length)for(g=0;g<e.length;g++)i=e[g],b.fire({type:"clipClick",target:i,x:a.clientX,y:a.clientY,intId:C})}else("left"===s||"right"===s)&&(i=PLAYER.operateJson.chooseInterleavedElem(c),i&&b.fire({type:"clipClick",target:i,x:a.clientX,y:a.clientY,intId:C}));85===PLAYER.keyNum&&PLAYER.operateJson.sendJson()}c=null,i=null,o=0,p=0,q=0,r=0,k=[],l=[],m=[],n=[];break;case"click":(d.className.indexOf("effect_box_l")>-1||d.className.indexOf("effect_box_r")>-1)&&(D=$(d),b.fire({type:"effectClick",target:D,x:a.clientX,y:a.clientY}));break;case"dblclick":d.className.indexOf("time_ruler_bar")>-1&&(D=$(d),b.fire({type:"sequenceClick",target:D,x:a.clientX,y:a.clientY})),d.className.indexOf("edit_box_t")>-1&&(f=$(d),b.fire({type:"clipDblclick",target:f,x:a.clientX,y:a.clientY}));break;case"mousewheel":E=$(d),b.fire({type:"mousewheel",target:E,wheelDelta:a.wheelDelta});break;case"keydown":F=$(d),PLAYER.EventUtil.preventDefault(a),b.fire({type:"keydown",target:F,code:a.keyCode,shift:a.shiftKey,ctrl:a.ctrlKey})}}var b,c,f,h,k,l,m,n,o,p,q,r,s,t,u;return this.targetObj,b=new PLAYER.EventTarget,c=null,f=null,h=0,k=[],l=[],m=[],n=[],o=0,p=0,q=0,r=0,b.enable=function(){PLAYER.EventUtil.addHandler(document,"mousedown",B),PLAYER.EventUtil.addHandler(document,"mousemove",B),PLAYER.EventUtil.addHandler(document,"mouseup",B),PLAYER.EventUtil.addHandler(document,"click",B),PLAYER.EventUtil.addHandler(document,"dblclick",B),PLAYER.EventUtil.addHandler(document,"mousewheel",B),PLAYER.EventUtil.addHandler(document,"keydown",B)},b.disable=function(){PLAYER.EventUtil.removeHandler(document,"mousedown",B),PLAYER.EventUtil.removeHandler(document,"mousemove",B),PLAYER.EventUtil.removeHandler(document,"mouseup",B),PLAYER.EventUtil.removeHandler(document,"click",B),PLAYER.EventUtil.removeHandler(document,"dblclick",B),PLAYER.EventUtil.removeHandler(document,"mouseover",B),PLAYER.EventUtil.removeHandler(document,"mouseout",B),PLAYER.EventUtil.removeHandler(document,"mousewheel",B),PLAYER.EventUtil.removeHandler(document,"keydown",B)},b}()},C}(),PLAYER.timeRuler2=function(){function u(a){r=this,r.config=$.extend(t,a),r.targetObj=r.config.targetObj,r.trimInCurrTime=0,r.trimOutCurrTime=0,r.currTime=0,q=$("."+this.targetObj).width(),v(),A(),this.config.$container.addEventListener("mousedown",F),this.config.$container.addEventListener("mousemove",G),this.config.$trimIn.addEventListener("mousemove",M),this.config.$trimOut.addEventListener("mousemove",N),this.DragDrop.addHandler("mousewheel",I),this.DragDrop.addHandler("keydown",H),window.addEventListener("resize",B)}function v(){var a=r.config,b=r.targetObj;a.framePerPixel=a.maxTime/$("."+b).width(),a.smallScaleFrame=w(a.framePerPixel).smallScaleFrame,a.smallScaleNumsPerLargeScale=w(a.framePerPixel).smallScaleNumsPerLargeScale,a.smallScaleWidth=a.smallScaleFrame/a.framePerPixel,a.largeScaleWidth=a.smallScaleWidth*a.smallScaleNumsPerLargeScale,a.largeScaleMillisecondInterval=40*a.smallScaleFrame*a.smallScaleNumsPerLargeScale,a.max_fpp=Math.min(a.maxTime/$("."+b).width(),11250),p=$("."+b).width(),x()}function w(a){var c,d,e,f;for(r.config,c=[],d={},e=0;e<s.length;e++)f=s[e].smallScaleFrame*s[e].smallScaleNumsPerLargeScale/80,f>=a&&c.push(e);return d.smallScaleFrame=s[c[0]].smallScaleFrame,d.smallScaleNumsPerLargeScale=s[c[0]].smallScaleNumsPerLargeScale,d}function x(){var c,a=r.config,b=r.targetObj;a.$container=$('<div class="'+b+'_container"></div>'),a.$container.css("width",p),a.$container.css("height",a.rulerHeight),a.$ruler=$('<canvas class="'+b+'_canvas"></canvas>'),a.$ruler.attr("width",$("."+b).width()),a.$ruler.attr("height",a.rulerHeight-2),a.$ruler.css("height",a.rulerHeight-2),a.$ruler.appendTo(a.$container),a.$trimInOut=$('<div class="'+b+'_trimInOut"></div>'),a.$trimInOut.css("height",a.trimHeight-2),a.$trimInOut.css("width","0px"),a.$trimInOut.appendTo(a.$container),a.$trimIn=$('<div class="'+b+'_trimIn"></div>'),a.$trimIn.css("height",a.trimHeight-2),a.$trimIn.appendTo(a.$trimInOut),a.$trimOut=$('<div class="'+b+'_trimOut"></div>'),a.$trimOut.css("height",a.trimHeight-2),a.$trimOut.appendTo(a.$trimInOut),a.$cursor=$('<div class="'+b+'_cursor"></div>'),a.$cursor.css("height",$("."+b).height()-66),a.$cursor.appendTo(a.$container),c=$('<div class="'+b+'_cursor_top"></div>'),c.appendTo(a.$cursor),a.$container.appendTo($("."+b)),a.$sliderTrack=$('<div class="'+b+'_slider_track">'),a.$sliderBar=$('<div class="'+b+'_slider_scroll_total">'),a.$sliderBarLeft=$('<div class="'+b+'_slider_scroll_left">'),a.$sliderBarMiddle=$('<div class="'+b+'_slider_scroll_middle">'),a.$sliderBarRight=$('<div class="'+b+'_slider_scroll_right">'),a.$sliderBarLeft.appendTo(a.$sliderBar),a.$sliderBarMiddle.appendTo(a.$sliderBar),a.$sliderBarRight.appendTo(a.$sliderBar),a.$sliderBar.appendTo(a.$sliderTrack),a.$sliderTrack.appendTo($("."+b)),z(0),y()}function y(){var c,a=r.config,b=r.targetObj;l=a.$sliderBarLeft.width(),m=a.$sliderBarRight.width(),c=$("."+b).width()*a.$sliderTrack.width()/a.$container.width(),j=parseInt(a.$sliderTrack.width()-c),k=parseInt(a.$container.width()-$("."+r.targetObj).width()),c>=a.$sliderTrack.width()&&(c=a.$sliderTrack.width()),a.$sliderBar.css("width",c),a.$sliderBar.css("left",0),a.$sliderBarMiddle.css("width",c-l-m),a.$sliderBarMiddle.css("left",l),a.$sliderBarLeft.css("left",0),a.$sliderBarRight.css("left",c-m)}function z(a){var d,e,f,g,h,i,j,k,l,m,b=r.config,c=r.targetObj;for(a=parseInt(a),d=$("."+c).width(),b.$ruler.attr("width",d),e=b.$ruler[0].getContext("2d"),e.clearRect(0,0,d,b.$ruler.height()),e.fillStyle=b.backgroundColor,e.fillRect(0,0,d,b.$ruler.height()),f=b.rulerHeight,e.lineWidth=1,e.strokeStyle=b.scaleColor,e.fillStyle=b.fontColor,e.font=b.fontSize+"px "+b.fontFamily,e.textAlign="center",e.beginPath(),e.moveTo(0,f),e.lineTo(d,f),g=parseInt(a/b.largeScaleWidth)*b.largeScaleMillisecondInterval,h=parseInt(a/b.smallScaleWidth)+1,i=h*b.smallScaleWidth-a,j=h%b.smallScaleNumsPerLargeScale,k=0,l=0;d>k;)k=l*b.smallScaleWidth+.3+i,0==j%b.smallScaleNumsPerLargeScale?(e.moveTo(k,f-1),e.lineTo(k,f-b.largeScaleHeight),g+=b.largeScaleMillisecondInterval,m=PLAYER.$millisecondsToTimeFrame(g),e.fillText(m,k,f-b.largeScaleHeight-3)):(e.moveTo(k,f-1),e.lineTo(k,f-b.smallScaleHeight)),l++,j++;e.stroke()}function A(){C(),J(),O()}function B(){r.config,r.targetObj,$("."+r.targetObj).width($("."+r.targetObj).parent().width()),r.updateEvent(r.config)}function C(){var a=r.config;a.$container.addEventListener=function(b,c){if("mousedown"==b)a.$container.mousedown(function(a){function b(a){E(a.clientX,a.clientY,c)}function d(){this.onmousemove=null,this.onmouseup=null}a.stopPropagation(),E(a.clientX,a.clientY,c),document.onmousemove=b,document.onmouseup=d});else if("click"==b){if(e.stopPropagation(),$(this)!=a.$ruler)return;E(e.clientX,e.clientY,c)}else"mousemove"==b&&D(a.$cursor,c)}}function D(a,b){function g(a){a=a||event,window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),E(a.clientX,a.clientY,b)}function h(){this.onmousemove=null,this.onmouseup=null}var c,d,e,f;a.mousedown(function(b){b.stopPropagation(),b=b||event,c=b.clientX,d=b.clientY,e=a.offsetLeft,f=a.offsetTop,this.ondragstart=function(){return!1},document.onmousemove=g,document.onmouseup=h})}function E(a,b,c){var d,e,f,i,l,m;PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),d=r.config,e=r.targetObj,f=$("."+e).width(),i=a-$("."+e).offset().left,l=Math.abs(parseFloat(d.$container.css("margin-left"))),g=i+l,g=parseFloat(g*d.framePerPixel)/d.framePerPixel,0>=g&&(g=0),g>=d.$container.width()&&(g=d.$container.width()),g-l>f&&(o=g-f,j=parseFloat(d.$sliderTrack.width()-d.$sliderBar.width()),k=parseFloat(d.$container.width()-f),h=o*j/k,d.$sliderBar.css("left",h),d.$container.css("margin-left",-o),d.$ruler.css("left",o),z(o),d.$sliderBar.css("left",h),d.$container.css("margin-left",-o),d.$ruler.css("left",o),z(o)),l>g&&(o=g,h=o*d.$sliderTrack.width()/d.$container.width(),d.$sliderBar.css("left",h),d.$container.css("margin-left",-o),d.$ruler.css("left",o),z(o),d.$sliderBar.css("left",h),d.$container.css("margin-left",-o),d.$ruler.css("left",o),z(o)),d.$cursor.css("left",g),m=r.currTime,r.currTime=Math.round(g*d.framePerPixel),null!==c&&m!==r.currTime&&c(r.currTime)}function F(a){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放")),a>=r.config.maxTime&&(a=r.config.maxTime),r.currTime=a,r.fixArrowCurrentTime(a),PLAYER.dbClick||(PLAYER.TR.currTime=a,PLAYER.TR.fixArrowCurrentTime(a)),PLAYER.OCX.seek(a)}function G(a){var b=r.config;console.log("time",a),b.seekComandTimesMonitor.push(a)}function H(a){var d,e,f,g,h,b=r.config;if(r.targetObj,d=b.$sliderBar.width(),e=b.$sliderBar.position().left,f=Math.abs(parseInt(b.$container.css("marginLeft"))),g=b.framePerPixel,h=a.code,189===h){if(189===PLAYER.keyNum,d===$("."+r.targetObj).width())return;P(10,g,d,e,f)}else if(187===h){if(187===PLAYER.keyNum,d===2*m+8)return;P(-10,g,d,e,f)}}function I(a){var c,d,e;return r.targetObj,c=r.config,d=parseInt(c.$sliderBar.position().left),e=2,j=parseInt(c.$sliderTrack.width()-c.$sliderBar.width()),k=parseInt(c.$container.width()-$("."+r.targetObj).width()),Math.floor(c.$sliderBar.width())===Math.floor(c.$sliderTrack.width())?!1:-120===a.wheelDelta?(h=d+e,h>=j?(h=j,o=k,console.log("乡下滚动",o)):o=h*k/j,c.$sliderBar.css("left",h),c.$container.css("margin-left",-o),c.$ruler.css("left",o),z(o),!1):120===a.wheelDelta?(h=d-e,0>=h?(h=0,o=0):o=h*k/j,c.$sliderBar.css("left",h),c.$container.css("margin-left",-o),c.$ruler.css("left",o),z(o),!1):!1}function J(){var e=r.config;e.$trimIn.addEventListener=function(b,d){function g(a){K(a.clientX,a.clientY,d)}function h(){this.onmousemove=null}"mousemove"==b&&e.$trimIn.mousedown(function(b){b.stopPropagation(),f=b.clientX,a=c,document.onmousemove=g,document.onmouseup=h})},e.$trimOut.addEventListener=function(a,c){function g(a){L(a.clientX,a.clientY,c)}function h(){this.onmousemove=null}"mousemove"==a&&e.$trimOut.mousedown(function(a){a.stopPropagation(),f=a.clientX,b=d,document.onmousemove=g,document.onmouseup=h})}}function K(b,e,h){var k,l,m,i=r.targetObj,j=r.config;console.log("trimInOrginPos",a),b<$("."+i).offset().left&&(b=$("."+i).offset().left),k=b-f,a+k>d-3||(c=0>a+k?0:a+k,c=parseInt(c*j.framePerPixel)/j.framePerPixel,r.trimInCurrTime=Math.round(g*j.framePerPixel),l=d-c,j.$trimInOut.css("left",c),j.$trimInOut.css("width",l),null!=h&&(m=r.trimInCurrTime,h(m)))}function L(a,e,g){var j,k,l,h=r.targetObj,i=r.config;a<$("."+h).offset().left&&(a=$("."+h).offset().left),j=a-f,c+3>b+j||(d=b+j>i.maxTime*i.perMsecWidth?i.maxTime*i.perMsecWidth:b+j,d=parseInt(d*i.framePerPixel)/i.framePerPixel,r.trimOutCurrTime=Math.round(d*i.framePerPixel),k=d-c,i.$trimInOut.css("width",k),null!=g&&(l=r.trimOutCurrTime,g(l)))}function M(a){r.trimInCurrTime=a,PLAYER.TR.trimInCurrTime=a,PLAYER.TR.fixTrimInByCurrentTime(a)}function N(a){r.trimOutCurrTime=a,PLAYER.TR.trimOutCurrTime=a,PLAYER.TR.fixTrimOutByCurrentTime(a)}function O(){var b,c,d,e,f,g,n;r.targetObj,b=r.config,b.$sliderBarLeft.mousedown(function(a){var a=a||window.event;b.$sliderBarMiddle.addClass("now"),f=a.clientX,d=b.$sliderBar.width(),c=parseInt(b.$sliderBar.position().left),g=Math.abs(parseInt(b.$container.css("marginLeft"))),n=b.framePerPixel,$(document)[0].onmousemove=function(a){var a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),a.preventDefault(),$("body").css({cursor:"url(images/cur/hand_move.cur),default"}),diff_move=f-a.clientX,P(diff_move,n,d,c,g)
},$(document)[0].onmouseup=function(){$("body").css({cursor:"default"}),$(document)[0].onmousemove=null}}),b.$sliderBarRight.mousedown(function(a){var a=a||window.event;b.$sliderBarMiddle.addClass("now"),f=a.clientX,d=b.$sliderBar.width(),c=parseInt(b.$sliderBar.position().left),g=Math.abs(parseInt(b.$container.css("marginLeft"))),n=b.framePerPixel,$(document)[0].onmousemove=function(a){var a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),a.preventDefault(),$("body").css({cursor:"url(images/cur/hand_move.cur),default"}),diff_move=a.clientX-f,P(diff_move,n,d,c,g)},$(document)[0].onmouseup=function(){$("body").css({cursor:"default"}),$(document)[0].onmousemove=null}}),b.$sliderBarMiddle.mousedown(function(a){var a=a||window.event;b.$sliderBarMiddle.addClass("now"),f=a.clientX,d=b.$sliderBar.width(),c=parseInt(b.$sliderBar.position().left),$(document)[0].onmousemove=function(a){return $("body").css({cursor:"move"}),e=a.clientX-f,h=c+e,i=d,0>h&&(h=0),h>j&&(h=j),b.$sliderBar.css("left",h),b.$sliderBarMiddle.addClass("now"),i!=b.$sliderTrack.width()?(j=parseInt(b.$sliderTrack.width()-i),k=parseInt(b.$container.width()-$("."+r.targetObj).width()),o=Math.floor(parseInt(k*h/j))):o=0,b.$container.css("margin-left",parseInt(-o)),b.$ruler.css("left",o),z(o),!1},$(document)[0].onmouseup=function(){b.$sliderBarMiddle.removeClass("now"),$("body").css({cursor:"default"}),$(document)[0].onmousemove=null}})}function P(a,b,c,d){var n,q,s,t,f=r.config;r.targetObj,n=$("."+r.targetObj).width()/2,a>0?(f.max_fpp===b?s=0:(q=(f.$sliderTrack.width()-c)/(f.max_fpp/b-1),s=a/q),h=d-a,i=c+2*a,f.framePerPixel=b*(s+1),0>=h&&(h=0),d+c+a>=$("."+r.targetObj).width()&&(h=d-a,i=f.$sliderTrack.width()-h),i>=f.$sliderTrack.width()&&(i=f.$sliderTrack.width(),f.framePerPixel=f.max_fpp),Q(f.framePerPixel)):0>a?(f.min_fpp===b?s=0:(q=(c-(2*m+8))/(b/f.min_fpp-1),s=a/q),h=d-a,i=c+2*a,f.framePerPixel=b/(-s+1),2*m+8>=i&&(i=2*m+8,s=0,h=d-(2*m+8-c/2),f.framePerPixel=f.min_fpp),Q(f.framePerPixel)):(f.framePerPixel=b,Q(f.framePerPixel)),n=Math.floor($("."+r.targetObj).width()/2),t=w(f.framePerPixel),R(t.smallScaleFrame,t.smallScaleNumsPerLargeScale,f.framePerPixel),p=Math.floor(f.maxTime/f.framePerPixel),p<=$("."+r.targetObj).width()&&(p=$("."+r.targetObj).width()),0!=r.currTime?(g=Math.floor(parseInt(r.currTime/f.framePerPixel)),o=g-n,h=o*j/k,h>=j&&(h=j,o=k),isNaN(h)&&(o=0,h=0)):o=Math.floor(k*h/j),(isNaN(o)||0>=o)&&(o=0,h=0),f.$sliderBar.css("width",i),f.$sliderBar.css("left",h),f.$sliderBarMiddle.css("width",i-2*m),f.$sliderBarRight.css("left",i-m),f.$container.css("margin-left",-o),f.$container.css("width",p),f.$ruler.css("left",o),z(o),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime)}function Q(a){var d,e,f,b=r.config;r.targetObj,d=11250,e=b.maxTime/$("."+r.targetObj).width(),f=Math.min(d,e),a<b.min_fpp?a=b.min_fpp:a>f&&(a=f)}function R(a,b,c){var d=r.config;d.smallScaleFrame=a,d.smallScaleNumsPerLargeScale=b,d.framePerPixel=c,r.updateRuler(d)}var i,j,k,q,a=0,b=0,c=0,d=0,f=0,g=0,h=0,l=0,m=0,o=0,p=0,r=this,s=[{smallScaleFrame:1,smallScaleNumsPerLargeScale:1},{smallScaleFrame:1,smallScaleNumsPerLargeScale:2},{smallScaleFrame:1,smallScaleNumsPerLargeScale:5},{smallScaleFrame:1,smallScaleNumsPerLargeScale:10},{smallScaleFrame:5,smallScaleNumsPerLargeScale:5},{smallScaleFrame:5,smallScaleNumsPerLargeScale:10},{smallScaleFrame:10,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25,smallScaleNumsPerLargeScale:10},{smallScaleFrame:75,smallScaleNumsPerLargeScale:10},{smallScaleFrame:150,smallScaleNumsPerLargeScale:10},{smallScaleFrame:300,smallScaleNumsPerLargeScale:10},{smallScaleFrame:750,smallScaleNumsPerLargeScale:10},{smallScaleFrame:1500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:4500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9e3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:45e3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9e4,smallScaleNumsPerLargeScale:10}],t={hasTrack:!0,maxTime:1e3,min_largeScaleWidth:80,framePerPixel:0,max_fpp:0,min_fpp:.125,smallScaleNumsPerLargeScale:10,smallScaleFrame:0,smallScaleWidth:0,largeScaleWidth:0,largeScaleMillisecondInterval:0,seekComandTimesMonitor:[],largeScaleHeight:20,smallScaleHeight:12.5,backgroundColor:"#262626",rulerHeight:35,trimHeight:45,scaleColor:"#929293",fontColor:"#929293",fontSize:12,fontFamily:"微软雅黑",$header:null,$ruler:null,$cursor:null,$trimInOut:null,$trimIn:null,$trimOut:null,$sliderTrack:null,$sliderBar:null,$sliderBarLeft:null,$sliderBarMiddle:null,$sliderBarRight:null,targetObj:"player_time_ruler"};return u.prototype={updateRuler:function(a){var b=r.config;r.targetObj,b.framePerPixel=a.framePerPixel,b.smallScaleFrame=a.smallScaleFrame,b.smallScaleNumsPerLargeScale=a.smallScaleNumsPerLargeScale,b.smallScaleWidth=b.smallScaleFrame/b.framePerPixel,b.largeScaleWidth=b.smallScaleWidth*b.smallScaleNumsPerLargeScale,b.largeScaleMillisecondInterval=40*b.smallScaleFrame*b.smallScaleNumsPerLargeScale,b.max_fpp=Math.min(b.maxTime/$("."+r.targetObj).width(),11250)},updateEvent:function(a){var e,c=$.extend(r.config,a);r.targetObj,c.max_fpp=Math.min(c.maxTime/$("."+r.targetObj).width(),11250),i=parseInt(c.$sliderTrack.width()),p=$("."+r.targetObj).width(),c.framePerPixel=c.maxTime/p,e=w(c.framePerPixel),R(e.smallScaleFrame,e.smallScaleNumsPerLargeScale,c.framePerPixel),c.$container.width(p),c.$sliderBar.css("width",i),c.$sliderBar.css("left",0),c.$sliderBarMiddle.css("width",i-2*m),c.$sliderBarMiddle.css("left",m),c.$sliderBarLeft.css("left",0),c.$sliderBarRight.css("left",i-m),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime),z(0)},fixArrowCurrentTime:function(a){var d,e,b=this.config,c=this.targetObj;g=a/b.framePerPixel,d=Math.abs(parseFloat(b.$container.css("margin-left"))),e=$("."+c).width(),0>=g&&(g=0),g>=b.$container.width()&&(g=b.$container.width()),g-d>e&&(o=g-e,j=parseFloat(b.$sliderTrack.width()-b.$sliderBar.width()),k=parseFloat(b.$container.width()-e),h=o*j/k,b.$sliderBar.css("left",h),b.$container.css("margin-left",-o),b.$ruler.css("left",o),z(o),b.$sliderBar.css("left",h),b.$container.css("margin-left",-o),b.$ruler.css("left",o),z(o)),d>g&&(o=g,h=o*b.$sliderTrack.width()/b.$container.width(),b.$sliderBar.css("left",h),b.$container.css("margin-left",-o),b.$ruler.css("left",o),z(o),b.$sliderBar.css("left",h),b.$container.css("margin-left",-o),b.$ruler.css("left",o),z(o)),a>=b.maxTime&&(a=b.maxTime),r.currTime=a,b.$cursor.css("left",g)},fixTrimInByCurrentTime:function(a){var b=this.config;this.trimInCurrTime=a,c=this.trimInCurrTime/b.framePerPixel,d=this.trimOutCurrTime/b.framePerPixel,c>d&&(d=b.maxTime/b.framePerPixel,this.trimOutCurrTime=b.maxTime,d=parseInt(d*b.framePerPixel)/b.framePerPixel),b.$trimInOut.css("left",c),b.$trimInOut.css("width",d+2-c)},fixTrimOutByCurrentTime:function(a){var b=this.config;this.trimOutCurrTime=a,c=this.trimInCurrTime/b.framePerPixel,d=this.trimOutCurrTime/b.framePerPixel,c>d&&(c=0,this.trimInCurrTime=0),b.$trimInOut.css("left",c),b.$trimInOut.css("width",d+2-c)},initTime:function(){var a=this.config;this.targetObj,a.$sliderBar.css("left",0),a.$sliderBarMiddle.css("width",i-l-m),a.$sliderBarMiddle.css("left",l),a.$sliderBarLeft.css("left",0),a.$sliderBarRight.css("left",i-m),a.$container.css("margin-left",0),a.$ruler.css("left",0),z(0),r.fixArrowCurrentTime(0)},moveToNextFrame:function(){PLAYER.keyNum=39;var a=r.config;r.currTime+=1,r.currTime>=a.maxTime&&(r.currTime=a.maxTime),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime)},moveToPrevFrame:function(){PLAYER.keyNum=37,r.config,r.currTime-=1,r.currTime<=0&&(r.currTime=0),r.fixArrowCurrentTime(r.currTime),r.fixTrimInByCurrentTime(r.trimInCurrTime),r.fixTrimOutByCurrentTime(r.trimOutCurrTime)},DragDrop:function(){function g(b){var c,d,e;switch(b=PLAYER.EventUtil.getEvent(b),c=PLAYER.EventUtil.getTarget(b),b.type){case"mousewheel":d=$(c),a.fire({type:"mousewheel",target:d,wheelDelta:b.wheelDelta});case"keydown":e=$(c),a.fire({type:"keydown",target:e,code:b.keyCode,shift:b.shiftKey,ctrl:b.ctrlKey})}}var a=new PLAYER.EventTarget;return this.targetObj,a.enable=function(){PLAYER.EventUtil.addHandler(document,"mousewheel",g),PLAYER.EventUtil.addHandler(document,"keydown",g)},a.disable=function(){PLAYER.EventUtil.removeHandler(document,"mousewheel",g),PLAYER.EventUtil.removeHandler(document,"keydown",g)},a}()},u}(),PLAYER.EventUtil={addHandler:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeHandler:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent?a.detachEvent("on"+b,c):null==a["on"+b]},getEvent:function(a){return a?a:window.event},getTarget:function(a){return a.target||a.srcElement},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},getPageX:function(a){var b=0;return b=void 0===a.pageX?a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft):a.pageX},getPageY:function(a){var b=0;return b=void 0===a.pageY?a.clientY+(document.documentElement.scrollTop||document.body.scrollTop):a.pageY},getRelatedTarget:function(a){return a.relatedTarget?a.relatedTarget:a.toElement?a.toElement:a.fromElement?a.fromElement:null},getButton:function(a){if(document.implementation.hasFeature("MouseEvent","2.0"))return a.button;switch(a.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}},getWheelDelta:function(a){return a.wheelDelta?client.engine.opera&&client.engine.opera<9.5?-a.wheelDelta:a.wheelDelta:40*-a.detail},getKeyCode:function(a){return a.keyCode||a.which||a.charCode},getCharCode:function(a){return"number"==typeof a.charCode?a.charCode:a.keyCode},getClipboardText:function(a){var b=a.clipboardData||window.clipboardData;return b.getData("text")},setClipboardText:function(a,b){return a.clipboardData?a.clipboardData.setData("text/plain",b):window.clipboardData?window.clipboardData.setData("text",b):void 0}},PLAYER.documentEvent=function(){function c(c){c=PLAYER.EventUtil.getEvent(c);var d=PLAYER.EventUtil.getTarget(c);switch(c.type){case"keydown":b=d,a.fire({type:"keydown",target:b,code:c.keyCode,shift:c.shiftKey,ctrl:c.ctrlKey})}}var a=new PLAYER.EventTarget,b=null;return a.enable=function(){PLAYER.EventUtil.addHandler(document,"keydown",c)},a.disable=function(){PLAYER.EventUtil.removeHandler(document,"keydown",c)},a}(),PLAYER.$millisecondsToTimeFrame=function(a){var f,b=parseInt(a/36e5),c=parseInt((a-1e3*60*60*b)/6e4),d=parseInt((a-1e3*60*60*b-1e3*60*c)/1e3),e=Math.round((a-1e3*60*60*b-1e3*60*c-1e3*d)/40);return 25==e&&(d+=1,e=0),10>b&&(b="0"+b),10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),f=b+":"+c+":"+d+":"+e},PLAYER.checkPlaying=function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","播放"))},PLAYER.showSubititleEdit=function(){$("#js_carve").removeClass("col-md-6").addClass("col-md-4"),$("#js_carve_edit").show(),$("#js_carve_edit .list li").eq(0).trigger("click")},PLAYER.hideSubititleEdit=function(){$("#js_carve").removeClass("col-md-4").addClass("col-md-6"),$("#js_carve_edit").hide(),$("#js_subtitle_h_form").empty()},PLAYER.hideEffectEdit=function(){$("#js_carve_edit").hide(),$("#js_carve").removeClass("col-md-4").addClass("col-md-6"),$("#js_effect_h_form").empty(),$("#move_box").remove(),$(".edit_box").removeClass("onselected")},PLAYER.genNonDuplicateID=function(a){return Number(Math.random().toString().substr(3,a)+Date.now()).toString(36)},PLAYER.getDurationToString=function(a){var d,e,f,g,h,i,b=parseInt(a/9e4),c=b+"";return 10>b&&(c="0"+b),a-=25*3600*b,d=parseInt(a/1500),e=d+"",10>d&&(e="0"+d),a-=25*60*d,f=parseInt(a/25),g=f+"",10>f&&(g="0"+f),a-=25*f,h=a,i=h+"",10>h&&(i="0"+h),c+":"+e+":"+g+":"+i},PLAYER.getLocalTime=function(a){function b(a){return 10>a?"0"+a:a}var c=new Date(a),d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate(),g=c.getHours(),h=c.getMinutes(),i=c.getSeconds();return d+"-"+b(e)+"-"+b(f)+" "+b(g)+":"+b(h)+":"+b(i)},PLAYER.ffToNm=function(a){return 40*a},PLAYER.nmToFf=function(a){return a/40},PLAYER.singelton=function(a){var b;return function(){return b||(b=a.apply(this,arguments))}},PLAYER.observer=function(){var b,c,d,a={};return b=function(b,c){a[b]||(a[b]=[]),a[b].push(c)},d=function(){var e,d,b=Array.prototype.shift.call(arguments),c=a[b];if(!c||0===c.length)return!1;for(d=0;e=c[d++];)e.apply(this,arguments)},c=function(b,c){var e,f,d=a[b];if(!d)return!1;if(c)for(e=d.length-1;e>=0;e--)f=d[e],f===c&&d.splice(e,1);else d&&(d.length=0)},{listen:b,remove:c,trigger:d}}();