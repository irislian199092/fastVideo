PLAYER.playerFunction=function(){function c(){this.config={targetObj:"time_ruler",hasTrack:true};this.playerConfig={targetObj:"player_time_ruler",hasTrack:false,rulerHeight:35,trimHeight:15};PLAYER.TR=new PLAYER.timeRuler(this.config);PLAYER.PTR=new PLAYER.timeRuler2(this.playerConfig);PLAYER.OCX=new PLAYER.ocxFunction();PLAYER.documentEvent.addHandler("keydown",a);setInterval(function(){var g=PLAYER.TR.config.seekComandTimesMonitor.length;if(g!==0){var f=PLAYER.TR.config.seekComandTimesMonitor[g-1];PLAYER.TR.config.seekComandTimesMonitor=[];PLAYER.TR.currTime=f;PLAYER.TR.fixArrowCurrentTime(f);PLAYER.OCX.seek(f);if(f>=PLAYER.PTR.config.maxTime){f=PLAYER.PTR.config.maxTime}PLAYER.PTR.currTime=f;PLAYER.PTR.fixArrowCurrentTime(f)}},10);setInterval(function(){var g=PLAYER.PTR.config.seekComandTimesMonitor.length;if(g!==0){var f=PLAYER.PTR.config.seekComandTimesMonitor[g-1];PLAYER.PTR.config.seekComandTimesMonitor=[];if(!PLAYER.dbClick){PLAYER.TR.currTime=f;PLAYER.TR.fixArrowCurrentTime(f);if(f>=PLAYER.PTR.config.maxTime){f=PLAYER.PTR.config.maxTime}}PLAYER.OCX.seek(f);PLAYER.PTR.currTime=f;PLAYER.PTR.fixArrowCurrentTime(f)}},10)}c.prototype={play:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();$("#js_play").removeClass("stop");$("#js_play").attr("title","播放");PLAYER.isPlaying=false}else{PLAYER.OCX.doPlay(40*parseInt(PLAYER.PTR.currTime),100000000000);$("#js_play").addClass("stop");$("#js_play").attr("title","停止");PLAYER.isPlaying=true;b();d()}},setIntervalPlay:function(){var h=parseInt(PLAYER.TR.trimInCurrTime);var f=parseInt(PLAYER.TR.trimOutCurrTime);var g=$("#js_setInterval").parent("li").hasClass("active");if(PLAYER.isPlaying){PLAYER.OCX.doPause();$("#js_play").removeClass("stop");$("#js_play").attr("title","播放");PLAYER.isPlaying=false}else{PLAYER.OCX.seek(h);PLAYER.OCX.doPlay();$("#js_play").addClass("stop");$("#js_play").attr("title","停止");PLAYER.isPlaying=true;setTimeout(function(){var i=PLAYER.OCX.getPosition();console.log("s",i);PLAYER.TR.fixArrowCurrentTime(i);PLAYER.TR.currTime=i;PLAYER.PTR.fixArrowCurrentTime(i);PLAYER.PTR.currTime=i;$("#js_player_nowTime").html(PLAYER.getDurationToString(i));$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(i));if(PLAYER.loadState&&PLAYER.isPlaying){console.log("trimoutFrame",f);if(i!==f){console.log("没有到出点");setTimeout(arguments.callee,40)}else{console.log("到出点",h);PLAYER.OCX.doPause();PLAYER.OCX.seek(h);PLAYER.OCX.doPlay();PLAYER.isPlaying=true;$("#js_play").addClass("stop");$("#js_play").attr("title","停止");setTimeout(arguments.callee,40)}}},40)}},setTrimIn:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if(!PLAYER.dbClick){PLAYER.TR.fixTrimInByCurrentTime(parseInt(PLAYER.TR.currTime))}PLAYER.PTR.fixTrimInByCurrentTime(parseInt(PLAYER.PTR.currTime))},setTrimOut:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if(!PLAYER.dbClick){PLAYER.TR.fixTrimOutByCurrentTime(parseInt(PLAYER.TR.currTime))}PLAYER.PTR.fixTrimOutByCurrentTime(parseInt(PLAYER.PTR.currTime))},moveTrimIn:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if($(".time_ruler_trimInOut").width()){if(!PLAYER.dbClick){PLAYER.TR.fixArrowCurrentTime(parseInt(PLAYER.TR.trimInCurrTime))}PLAYER.PTR.fixArrowCurrentTime(parseInt(PLAYER.PTR.trimInCurrTime));PLAYER.OCX.seek(parseInt(PLAYER.PTR.trimInCurrTime))}else{return false}},moveTrimOut:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if($(".time_ruler_trimInOut").width()){if(!PLAYER.dbClick){PLAYER.TR.fixArrowCurrentTime(parseInt(PLAYER.TR.trimOutCurrTime))}PLAYER.PTR.fixArrowCurrentTime(parseInt(PLAYER.PTR.trimOutCurrTime));PLAYER.OCX.seek(parseInt(PLAYER.PTR.trimOutCurrTime))}else{return false}},prevFrame:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if(!PLAYER.dbClick){PLAYER.TR.moveToPrevFrame()}PLAYER.PTR.moveToPrevFrame();PLAYER.OCX.seek(parseInt(PLAYER.PTR.currTime))},nextFrame:function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if(!PLAYER.dbClick){PLAYER.TR.moveToNextFrame()}PLAYER.PTR.moveToNextFrame();PLAYER.OCX.seek(parseInt(PLAYER.PTR.currTime))},toFirstFrame:function(){if(!PLAYER.dbClick){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}var f=PLAYER.operateJson.getFirstFrame();console.log("time",f);PLAYER.TR.fixArrowCurrentTime(f);PLAYER.PTR.fixArrowCurrentTime(f);PLAYER.OCX.seek(parseInt(f))}else{return false}},toLastFrame:function(){if(!PLAYER.dbClick){if(PLAYER.isPlaying){PLAYER.OCX.doPause();
PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if($(".time_ruler_bar").children().length){var f=PLAYER.operateJson.getLastFrame();PLAYER.TR.fixArrowCurrentTime(f);PLAYER.PTR.fixArrowCurrentTime(f);PLAYER.OCX.seek(f)}}else{return false}},toolbar_choose:function(){if(!PLAYER.dbClick){PLAYER.keyNum=86;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_select").addClass("active");PLAYER.TR.config.$clipTrackBar.css({cursor:"default"})}},toolbar_preSelect:function(){if(!PLAYER.dbClick){console.log("向前选择","A");PLAYER.keyNum=71;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_select_pre").addClass("active");PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/select_back.cur),default"})}},toolbar_nextSelect:function(){if(!PLAYER.dbClick){console.log("向后选择","shift+A");PLAYER.keyNum=7100;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_select_back").addClass("active");PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/select_pre.cur),default"})}},toolbar_cut:function(){if(!PLAYER.dbClick){PLAYER.keyNum=85;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_cut").addClass("active");PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/cut_disable.cur),default"});PLAYER.TR.config.$clipTrackBar.find(".edit_box").css({cursor:"url(images/cur/cut.cur),default"})}},toolbar_uCut:function(){if(!PLAYER.dbClick){PLAYER.keyNum=8500;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_uCut").addClass("active");if(PLAYER.TR.currTime===0){return}PLAYER.TR.cutArrowCurrentTime()}},toolbar_zoom_plus:function(){if(!PLAYER.dbClick){PLAYER.keyNum=187;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_zoom_plus").addClass("active");PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/zoom_plus.cur),default"})}},toolbar_zoom_minus:function(){if(!PLAYER.dbClick){PLAYER.keyNum=189;$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_zoom_minus").addClass("active");PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/zoom_minus.cur),default"})}},toolbar_ungroup:function(){var f=$("#js_time_ruler_bar_box .onselected").length;if(f===0){return false}else{$("#js_time_ruler_bar_box .onselected").each(function(h,k){$(k).attr("data-interleaved",false);var j=$(k).attr("data-time");var g={interleaved:false};PLAYER.operateJson.updateClipAttr(g,j)})}console.log("解组",PLAYER.jsonObj.rootBin.sequence[0].tracks)},toolbar_group:function(){var f=$("#js_time_ruler_bar_box .onselected").length;if(f===0){return false}else{var g=$(".edit_box_v.onselected").attr("data");$(".edit_box_v.onselected").each(function(l,p){var m=$(p).attr("data-time");var h={interleaved:true};PLAYER.operateJson.updateClipAttr(h,m);$(p).attr("data-interleaved",true);var o=$(p).attr("data-intid");var k=$(p).parent().siblings().children('.edit_box_a[data-intid="'+o+'"]');var j=k.attr("data-time");PLAYER.operateJson.updateClipAttr(h,j);k.attr("data-interleaved",true)})}console.log("编组",PLAYER.jsonObj.rootBin.sequence[0].tracks)}};function b(){var f=setInterval(function(){var h=PLAYER.operateJson.getLastFrame();if(PLAYER.loadState&&PLAYER.isPlaying){var g=PLAYER.OCX.getPosition();if(g>h){g=0}if(g===h){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放");clearInterval(f)}PLAYER.TR.fixArrowCurrentTime(g);PLAYER.TR.currTime=g;PLAYER.PTR.fixArrowCurrentTime(g);PLAYER.PTR.currTime=g;$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(PLAYER.TR.currTime))}},40)}function d(){setTimeout(function(){var g=PLAYER.OCX.getVUMeterInfo();if(g){f(g.split(","),true)}if(PLAYER.loadState&&PLAYER.isPlaying){if(g!=""){setTimeout(arguments.callee,100)}else{f("",false)}}},100);function f(l,g){var j=document.getElementById("js_voCanvas");var h=$("#js_time_ruler_voiceBox").height()-21;if(j.getContext("2d")){var p=j.getContext("2d");p.clearRect(0,0,100,500);if(g){var k=0;var o=h;var n=3;for(var k=0;k<parseInt(l[0]);k++){var m=parseFloat(l[k+1]/100)+0.99;canvasGradient=p.createLinearGradient(n,o,n,0);canvasGradient.addColorStop(0,"#33FF00");canvasGradient.addColorStop(0.4,"#33FF00");canvasGradient.addColorStop(1,"red");p.fillStyle=canvasGradient;p.fillRect(n,o*(1-m),30,o*m);p.fillRect(n,o*(1-m),30,o*m);n=n+35}}}}}function a(i){var f=i.code;var h=i.target;if(h.nodeName!=="INPUT"&&h.nodeName!=="input"&&h.nodeName!=="TEXTAREA"&&h.nodeName!=="textarea"){if(f===16&&i.shift){PLAYER.keyNum=1600}else{if(f===86&&!i.shift){PLAYER.player.toolbar_choose()}else{if(f===71&&!i.shift){PLAYER.player.toolbar_preSelect()}else{if(f===71&&i.shift){PLAYER.player.toolbar_nextSelect()}else{if(f===85&&!i.shift){PLAYER.player.toolbar_cut()}else{if(f===85&&i.shift){PLAYER.player.toolbar_uCut()}else{if(f===73&&i.shift){PLAYER.player.moveTrimIn()}else{if(f===79&&i.shift){PLAYER.player.moveTrimOut()}else{if(f===32&&!i.shift){var g=PLAYER.operateJson.getLastFrame();
if(PLAYER.TR.currTime>=g){return false}else{PLAYER.player.play()}}else{if(f===36&&!i.shift){PLAYER.player.toFirstFrame()}else{if(f===35&&!i.shift){PLAYER.player.toLastFrame()}else{if(f===39&&!i.shift){PLAYER.player.nextFrame()}else{if(f===37&&!i.shift){PLAYER.player.prevFrame()}else{if(f===73&&!i.shift){PLAYER.keyNum=73;PLAYER.player.setTrimIn()}else{if(f===79&&!i.shift){PLAYER.keyNum=79;PLAYER.player.setTrimOut()}else{if(f===49&&i.shift){PLAYER.keyNum=4900;PLAYER.player.toolbar_group()}else{if(f===50&&i.shift){PLAYER.keyNum=5000;PLAYER.player.toolbar_ungroup()}}}}}}}}}}}}}}}}}}}return c}();PLAYER.ocxFunction=function(){function a(){var b=this;b.positionValue=0}a.prototype={updateProjectJson:function(c){var f=PLAYER.operateJson.translateFfpToMS(JSON.stringify(c));try{var g={command:"updateproject",params:{projectInfo:f}};var b=JSON.stringify(g);webrtc.sendDataChannelMessageToPeer(targetId,b);PLAYER.loadState=true}catch(d){console.log("拖拽轨道更新json文件失败",d);return false}},adjustEffect:function(c){var d={command:"adjustEffect",params:c};var b=JSON.stringify(d);webrtc.sendDataChannelMessageToPeer(targetId,b)},updateFileJson:function(b){var d=JSON.stringify(b);try{form1.TestActiveX.UpdateFileJson(d);PLAYER.loadState=true;console.log("双击素材更新json文件成功",b)}catch(c){console.log("双击素材更新json文件失败",c);return false}},unloadPlayer:function(){try{var c=form1.TestActiveX.Close()}catch(b){console.log("关闭播放器时出错！")}},doPlay:function(c,d){try{var g={command:"play",params:{from:c,to:d}};var b=JSON.stringify(g);webrtc.sendDataChannelMessageToPeer(targetId,b)}catch(f){console.log("播放失败！",f);return false}},doPause:function(){var c=PLAYER.ffToNm(PLAYER.TR.currTime);try{var f={command:"pause",params:{pos:c}};var b=JSON.stringify(f);webrtc.sendDataChannelMessageToPeer(targetId,b)}catch(d){console.log("暂停失败！");return false}},doStop:function(){try{form1.TestActiveX.Seek(0)}catch(b){console.log("停止失败！");return}},getPosition:function(){try{return PLAYER.nmToFf(PLAYER.currentTime)}catch(b){console.log("获取当前时码时出错！")}},seek:function(c){try{console.log("seek-point",c);var c=PLAYER.ffToNm(c);var f={command:"seek",params:{pos:c}};var b=JSON.stringify(f);webrtc.sendDataChannelMessageToPeer(targetId,b)}catch(d){console.log("seek当前时码时出错！")}},getVUMeterInfo:function(){try{return PLAYER.VUMeterInfo}catch(b){return}},coverStationLogo:function(c){try{console.log("提交声音",c);var b=form1.TestActiveX.CoverStationLogo(JSON.stringify(c));console.log("s1",b);return b}catch(d){console.log("error");return}},clearWindow:function(){try{form1.TestActiveX.ClearWindow()}catch(b){console.log("error","ClearWindow");return}},getImageBase64:function(){try{var b=form1.TestActiveX.GetImageBase64(4);console.log("获取画面成功！",b);return b}catch(c){console.log("error","获取画面失败");return}},sendProType:function(c){try{var f={command:"setProjectType",params:{type:c}};console.log("--------",JSON.stringify(f));var b=JSON.stringify(f);webrtc.sendDataChannelMessageToPeer(targetId,b)}catch(d){console.log("播放失败！",d);return false}}};return a}();PLAYER.operateJson={sendJson:function(){PLAYER.operateJson.sortClipAttr();PLAYER.operateJson.updateRulerMaxTime();PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]);PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime))},translateFfpToMS:function(g){var g=JSON.parse(g);var b;g.rootBin.sequence[0].maxDuration=40*g.rootBin.sequence[0].maxDuration;for(var f=0;f<g.rootBin.sequence[0].tracks.length;f++){var d=g.rootBin.sequence[0].tracks[f];$.each(d.subclip,function(k,l){if(l){l.trimIn=40*l.trimIn;l.trimOut=40*l.trimOut;l.sequenceTrimIn=40*l.sequenceTrimIn;l.sequenceTrimOut=40*l.sequenceTrimOut;if(l.effect&&l.effect.length!==0){$.each(l.effect,function(i,m){m.trimIn=40*m.trimIn;m.trimOut=40*m.trimOut;m.duration=40*m.duration})}}})}for(var f=0;f<g.reference.material.length;f++){var h=g.reference.material[f];h.duration=40*h.duration}var j=document.getElementById("ocx");var c=j.currentStyle?j.currentStyle:window.getComputedStyle(j,null);var a=parseFloat(c.height);if(g.height==="576"&&g.width==="720"){b=parseFloat(1.25*a)}else{b=parseFloat((16*a/9))}g.pHeight=a;g.pWidth=b;return g},translateMsToFfp:function(c){var c=JSON.parse(c);c.rootBin.sequence[0].maxDuration=c.rootBin.sequence[0].maxDuration/40;for(var b=0;b<c.rootBin.sequence[0].tracks.length;b++){var a=c.rootBin.sequence[0].tracks[b];$.each(a.subclip,function(f,g){if(g){g.trimIn=g.trimIn/40;g.trimOut=g.trimOut/40;g.sequenceTrimIn=g.sequenceTrimIn/40;g.sequenceTrimOut=g.sequenceTrimOut/40;if(g.effect&&g.effect.length!==0){$.each(g.effect,function(h,i){i.trimIn=i.trimIn/40;i.trimOut=i.trimOut/40;i.duration=i.duration/40})}}})}for(var b=0;b<c.reference.material.length;b++){var d=c.reference.material[b];d.duration=d.duration/40}return c},addVideoClipAttr:function(c,d){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];if(a.type==="v"&&a.index===d){a.subclip.push(c)}}},addAudioClipAttr:function(c,d){for(var b=0;
b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];if(a.type==="a"&&a.index===d){a.subclip.push(c)}}},getdAudioClipAttr:function(d,f){var a=null;for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var b=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];if(b.type==="a"&&b.index===f){$.each(b.subclip,function(g,h){if(h&&h.createTime===d){a=h}})}}console.log("arr---",a);return JSON.stringify(a)},updateAudioClipVolume:function(d,c){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];$.each(a.subclip,function(f,g){if(g){if(g.createTime===d){$.extend(a.subclip[f],{volume:c})}}})}},addSubtitleClipAttr:function(c,d){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];if(a.type==="t"&&a.index===d){a.subclip.push(c)}}},getSubtitleClip:function(d,f){var a=null;for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var b=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];if(b.type==="t"&&b.index===f){$.each(b.subclip,function(g,h){if(h&&h.createTime===d){a=h}})}}return JSON.stringify(a)},updateSubtitleClip:function(h,d,c){var g=h.trackIndex;var f=h.subClipId;for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];if(a.type==="t"&&a.index===g){$.each(a.subclip,function(j,k){if(k&&k.createTime===f){k.abs.left_value=d;k.abs.top_value=c;$.extend(k.pixel,h.attr);$.extend(k.pixel,h.attr)}})}}console.log("更新字幕",PLAYER.jsonObj.rootBin.sequence[0].tracks)},sortClipAttr:function(){function c(d){return function(i,h){var g=i[d];var f=h[d];if(g<f){return -1}else{if(g>f){return 1}else{return 0}}}}for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];a.subclip.sort(c("sequenceTrimIn"))}},addProjectMaterial:function(a){if(PLAYER.jsonObj.reference.material.length===0){PLAYER.jsonObj.reference.material.push(a)}else{$.each(PLAYER.jsonObj.reference.material,function(b,c){if(a.assetId===c.assetId){return}else{PLAYER.jsonObj.reference.material.push(a)}})}},pushCancelArray:function(a){var b=JSON.stringify(a);PLAYER.goBackJson.push(b)},updateClipAttr:function(c,f,d){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];$.each(a.subclip,function(g,h){if(h){if(h.createTime===f){$.extend(a.subclip[g],c||{});if(d){a.subclip[g].effect=d}}}})}console.log("更新切片",PLAYER.jsonObj.rootBin.sequence[0].tracks)},changeIndexClipAttr:function(d,b,g){var f=null;for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];$.each(a.subclip,function(h,j){if(j){if(j.createTime===g){f=JSON.stringify(a.subclip[h]);a.subclip.splice(h,1)}}})}for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];if(a.type===d&&a.index===b){a.subclip.push(JSON.parse(f))}}},deleteClipAttr:function(c){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];$.each(a.subclip,function(d,f){if(f){if(f.createTime===c){a.subclip.splice(d,1)}}})}console.log("删除切片",PLAYER.jsonObj.rootBin.sequence[0])},checkCoverEvent:function(i,d){var a=PLAYER.TR.config;var j;var k;var h=parseInt(i.attr("data-sequencetrimin"));var f=parseInt(i.attr("data-sequencetrimout"));var g=parseInt(i.attr("data-trimin"));var l=parseInt(i.attr("data-trimout"));var b=i.attr("data-time");var c=[];$.each(i.siblings(),function(m,o){if(!$(o).hasClass("onselected")&&!$(o).hasClass("changeHelp")){c.push($(o))}});$.each(c,function(w,r){var A=parseInt($(r).attr("data-sequencetrimin"));var u=parseInt($(r).attr("data-sequencetrimout"));var x=parseInt($(r).attr("data-trimin"));var z=parseInt($(r).attr("data-trimout"));if(h<=A&&f>A){if(f<u){var s=$(r).attr("data-time");$(r).attr("data-sequencetrimin",f);$(r).attr("data-sequencetrimout",u);$(r).attr("data-trimout",z);$(r).attr("data-trimin",z-u+f);$(r).css("left",f/a.framePerPixel);$(r).width((u-f)/a.framePerPixel);if($(r).find(".effect_box_l")){$(r).find(".effect_box_l").remove()}subClipAttr={sequenceTrimIn:f,sequenceTrimOut:u,trimIn:z-u+f,trimOut:z,};var C=PLAYER.operateJson.getCoverOldEffectClip(s,z-u+f,z);PLAYER.operateJson.updateClipAttr(subClipAttr,s,C)}else{var s=$(r).attr("data-time");PLAYER.operateJson.deleteClipAttr(s);$(r).remove()}PLAYER.operateJson.sortClipAttr()}else{if(h>=A&&u>h){$(r).attr("data-sequencetrimin",A);$(r).attr("data-sequencetrimout",h);$(r).attr("data-trimout",x+h-A);$(r).attr("data-trimin",x);$(r).width((h-A)/a.framePerPixel);var B=$(r).attr("data-id");var p=$(r).attr("data-time");var o=$(r).attr("data-interleaved");var y=$(r).attr("data-type");var D=parseInt($(r).parent(".time_ruler_bar").attr("data-index"));if($(r).find(".effect_box_r")){$(r).find(".effect_box_r").remove()}if($(r).find(".effect_box_all")){$(r).find(".effect_box_all").attr("data-trimin",x);
$(r).find(".effect_box_all").attr("data-trimout",x+h-A);$(r).find(".effect_box_all").attr("data-duration",h-A)}subClipAttr={trimIn:x,trimOut:x+h-A,sequenceTrimIn:A,sequenceTrimOut:h};var C=PLAYER.operateJson.getCutOldEffectClip(p,x,x+h-A);PLAYER.operateJson.updateClipAttr(subClipAttr,p,C);if(f<u){var m=y+"_"+PLAYER.genNonDuplicateID(12);vcut_sequenceTrimIn=f;vcut_sequenceTrimOut=u;vcut_trimIn=z-u+f;vcut_trimOut=z;vcut_width=(u-f)/a.framePerPixel;vcut_left=f/a.framePerPixel;j=$(r).clone();if(j.find(".effect_box_l")){j.find(".effect_box_l").remove()}if(j.find(".effect_box_all")){j.find(".effect_box_all").attr("data-trimin",vcut_trimIn);j.find(".effect_box_all").attr("data-trimout",vcut_trimOut);j.find(".effect_box_all").attr("data-duration",vcut_trimOut-vcut_trimIn)}j.removeClass("onselected");j.attr("data-trimin",vcut_trimIn);j.attr("data-trimout",vcut_trimOut);j.attr("data-sequencetrimin",vcut_sequenceTrimIn);j.attr("data-sequencetrimout",vcut_sequenceTrimOut);j.attr("data-time",m);j.attr("data-intid",d);j.attr("width",vcut_width);j.attr("left",vcut_left);$(r).parent(".time_ruler_bar").append(j);if($(r).parent(".time_ruler_bar").hasClass("bar_v")){var v=PLAYER.operateJson.getCutNewEffectClip(p,vcut_trimIn,vcut_trimOut);if(v.length!==0){$.each(v,function(E,F){if($(F).type==="mosaic"){$(F).trimIn=vcut_trimIn;$(F).trimOut=vcut_trimOut}})}k={"assetID":B,"trimIn":vcut_trimIn,"trimOut":vcut_trimOut,"sequenceTrimIn":vcut_sequenceTrimIn,"sequenceTrimOut":vcut_sequenceTrimOut,"effect":v,"type":y,"createTime":m,"interleaved_id":d};if(i.attr("data-interleaved")==="true"&&o==="true"){k.interleaved=true}else{k.interleaved=false}PLAYER.operateJson.addVideoClipAttr(k,D)}else{if($(r).parent(".time_ruler_bar").hasClass("bar_a")){k={"assetID":B,"trimIn":vcut_trimIn,"trimOut":vcut_trimOut,"sequenceTrimIn":vcut_sequenceTrimIn,"sequenceTrimOut":vcut_sequenceTrimOut,"volume":100,"type":y,"createTime":m,"interleaved_id":d};if(i.attr("data-interleaved")==="true"&&o==="true"){k.interleaved=true}else{k.interleaved=false}PLAYER.operateJson.addAudioClipAttr(k,D)}else{if($(r).parent(".time_ruler_bar").hasClass("bar_t")){var q=JSON.parse(PLAYER.operateJson.getSubtitleClip(p,D));var t={"trimIn":vcut_trimIn,"trimOut":vcut_trimOut,"sequenceTrimIn":vcut_sequenceTrimIn,"sequenceTrimOut":vcut_sequenceTrimOut,"type":y,"createTime":m,"interleaved":false,"interleaved_id":d};$.extend(q,t);PLAYER.operateJson.addSubtitleClipAttr(q,D)}}}}}else{console.log("不重合")}}})},getAllsequenceTrimIn:function(d,g,c){var f;var b;if(c){b=c}else{b=parseInt(d.attr("data-sequencetrimin"))}var a=d.siblings();if(g){$.each(a,function(h,j){if($(j).attr("data-time")===g){a.splice(h,1)}})}a.each(function(){var i=Math.abs(b-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel;var h=Math.abs(b-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;if(i<=10){f=parseInt($(this).attr("data-sequencetrimin"))}if(h<=10){f=parseInt($(this).attr("data-sequencetrimout"))}});return f},showAdhere:function(b,a){if(b.find(".point")){b.find(".point").remove()}var c=$('<div class="point"></div>');if(a==="forward"){c.css("left",-5)}if(a==="backward"){c.css("left",(b.width()-5))}c.appendTo(b);console.log("point",b.find(".point").length)},hideAdhere:function(a){if(a.find(".point")){a.find(".point").remove()}},chooseInterleavedElem:function(c){var b=null;var d=c.attr("data-time");var a=c.attr("data-intid");$.each(c.parent(".time_ruler_bar").siblings().children(".edit_box"),function(f,g){if($(g).attr("data-interleaved")==="true"&&$(g).attr("data-intid")===a&&!$(g).hasClass("changeHelp")){b=$(g)}});return b},chooseGroupElem:function(d){var c=null;var a=[];var f=d.attr("data-time");var b=d.attr("data-group");$.each($(".edit_box"),function(g,h){if($(this).attr("data-group")===b){c=$(this);a.push(c)}});a.forEach(function(h,g){if(a[g].attr("data-time")===f){a.splice(g,1)}});return a},chooseSelectedElem:function(c){var b=null;var a=[];var d=c.attr("data-time");$.each($("#js_time_ruler_bar_box .onselected"),function(f,g){a.push($(this))});a.forEach(function(g,f){if(a[f].attr("data-time")===d){a.splice(f,1)}});return a},mouseDownState:function(d){if(PLAYER.keyNum!==17&&PLAYER.keyNum!==71&&PLAYER.keyNum!==7100){$("#js_time_ruler_bar_box .draggable").removeClass("onselected")}d.addClass("onselected");if(d.attr("data-interleaved")==="true"){PLAYER.operateJson.chooseInterleavedElem(d).addClass("onselected")}if(d.hasClass("edit_box_a")){var f=d.attr("data-time");var a=parseInt(d.parent().attr("data-index"));var c=JSON.parse(PLAYER.operateJson.getdAudioClipAttr(f,a));var b=c.volume;$("#js_toolbar_icon_volume_track").val(b);$("#js_toolbar_icon_volume_track").attr("title",b)}else{if(PLAYER.operateJson.chooseInterleavedElem(d).hasClass("edit_box_a")){var f=PLAYER.operateJson.chooseInterleavedElem(d).attr("data-time");var a=parseInt(d.parent().attr("data-index"));var c=JSON.parse(PLAYER.operateJson.getdAudioClipAttr(f,a));var b=c.volume;$("#js_toolbar_icon_volume_track").val(b);
$("#js_toolbar_icon_volume_track").attr("title",b)}}},mouseMoveState:function(b,a){b.css("z-index",50);if(a==="middle"){b.css("cursor","url(images/cur/resize.cur),default");b.css("boxShadow","4px 4px 2px #888888");b.removeClass("onselected");b.css("opacity","0.6")}else{if(a==="left"){b.addClass("zoomLeft")}else{if(a==="right"){b.addClass("zoomRight")}}}},checkCorsorhasClip:function(c){var b=false;for(var d=0;d<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;d++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[d];if(a.type==="a"&&(a.subclip.length>0)){$.each(a.subclip,function(f,g){console.log("currTime",c);if(g.sequenceTrimIn<c&&g.sequenceTrimOut>c){return b=true}})}}return b},checkNoClip:function(){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];if(a.subclip.length===0){return true}else{return false}}},checkPrevSubClip:function(a){var b=null;$("#js_time_ruler_bar_box .edit_box_v").each(function(c,d){if(parseInt($(d).attr("data-sequencetrimout"))===a){b=$(d)}});return b},checkNextSubClip:function(a){var b=null;$(".edit_box_v").each(function(c,d){if(parseInt($(d).attr("data-sequencetrimin"))===a){b=$(d)}});return b},addEffectClip:function(d,c){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];if(a.type==="v"){$.each(a.subclip,function(f,g){if(g){if(g.createTime===d){a.subclip[f].effect.push(c)}}})}}},getEffectClip:function(d){var a=null;for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var b=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];$.each(b.subclip,function(f,g){if(g&&g.createTime===d&&g.effect){a=JSON.stringify(g.effect)}})}return a},getCutNewEffectClip:function(c,g,b){var f=JSON.parse(PLAYER.operateJson.getEffectClip(c));if(f&&f.length!==0){var d=f.filter(function(h){return(h.pos!=="header"&&h.pos!=="header-middle")});for(var a=0;a<d.length;a++){if(d[a].pos==="all"){d[a].trimIn=g;d[a].trimOut=b;d[a].duration=b-g}}f=d}console.log("cut后新加切片特技",f);return f},getCutOldEffectClip:function(c,a,f){var g=JSON.parse(PLAYER.operateJson.getEffectClip(c));if(g&&g.length!==0){var d=g.filter(function(h){return(h.pos!=="footer"&&h.pos!=="footer-middle")});for(var b=0;b<d.length;b++){if(d[b].pos==="all"){d[b].trimIn=a;d[b].trimOut=f;d[b].duration=f-a}}g=d}if(g){return g}},getCoverOldEffectClip:function(c,a,f){var g=JSON.parse(PLAYER.operateJson.getEffectClip(c));if(g&&g.length!==0){var d=g.filter(function(h){return(h.pos!=="header"&&h.pos!=="header-middle")});for(var b=0;b<d.length;b++){if(d[b].pos==="all"){d[b].trimIn=a;d[b].trimOut=f;d[b].duration=f-a}}g=d}if(g){return g}},updateEffectClip:function(d,a){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var b=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];$.each(b.subclip,function(f,g){if(g&&g.createTime===d&&g.effect){$.each(g.effect,function(h,j){if(j.type==="mosaic"){$.extend(j.attr,a)}else{if(j.type==="2D"){$.extend(j.attr,a)}}})}})}console.log("更新特技",PLAYER.jsonObj.rootBin.sequence[0].tracks)},removeOtherEffectClip:function(d,c,f){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var a=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];$.each(a.subclip,function(g,h){if(h&&h.createTime===d&&h.effect){h.effect.forEach(function(k,j){if(k.type===c&&k.pos===f){h.effect.splice(j,1)}})}})}console.log("删除淡入淡出等的切片",PLAYER.jsonObj.rootBin.sequence[0].tracks)},emptyTrack:function(b,a){$.each($(".time_ruler_bar"),function(c,d){if($(d).attr("data-type")===b&&parseInt($(d).attr("data-index"))===a){$(d).empty()}})},getTrack:function(c,a){var b;$.each($(".time_ruler_bar"),function(d,f){if($(f).attr("data-type")===c&&parseInt($(f).attr("data-index"))===a){return b=$(f)}});return b},getMaterialDuration:function(b,a){$.ajax({url:serverUrl+"program/info",data:{assetId:b,jobId:PLAYER.jobId},async:false,success:function(c){if(c.code===0&&c.data!==null){a(c.data)}else{console.log("error")}}})},getSubtitleDuration:function(c,b){var a=PLAYER.subJsonTem[c];b(a)},getFirstFrame:function(){var a=[];for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var b=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];$.each(b.subclip,function(f,g){if(g){a.push(b.subclip[f].sequenceTrimIn)}})}if(a.length===0){return 0}else{var d=Math.min.apply(null,a);return d}},getLastFrame:function(){var a=[];for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var b=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];if(b.subclip.length!==0){$.each(b.subclip,function(d,f){a.push(f.sequenceTrimOut)})}}if(a.length!==0){return(Math.max.apply(null,a))}},updateMaxDuration:function(a){PLAYER.jsonObj.rootBin.sequence[0].maxDuration=a},updateRulerMaxTime:function(){var a=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15000||1000);PLAYER.TR.updateEvent(a);PLAYER.TR.fixClipWidth();PLAYER.operateJson.updateMaxDuration(a);PLAYER.PTR.config.maxTime=(PLAYER.operateJson.getLastFrame()||1000);$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||1000));
PLAYER.PTR.updateEvent(PLAYER.PTR.config)},getAudioIndex:function(a){var b=0;$.each(PLAYER.jsonObj.rootBin.sequence[0].track[1].subclip,function(c,d){if(d.createTime===a){b=c}});return b},addDraggingInfo:function(c,b){var g=c.attr("data-time");var f="helpElem_"+PLAYER.genNonDuplicateID(12);var a=c.clone().addClass("changeHelp");a.removeClass("onselected");a.attr("data-time",f);c.parent().append(a);a.hide();var d={id:g,initAttr:b,helpElem:a};PLAYER.storeDraggingInfo.push(d)},getDraggingAttr:function(b){var a=null;$.each(PLAYER.storeDraggingInfo,function(c,d){if(d.id===b){a=d.initAttr}});return a},getDraggingHelp:function(b){var a=null;$.each(PLAYER.storeDraggingInfo,function(c,d){if(d.id===b){a=d.helpElem}});return a},removeDraggingInfo:function(c){var b=null;for(var a=0;a<PLAYER.storeDraggingInfo.length;a++){if(PLAYER.storeDraggingInfo[a].id===c){PLAYER.storeDraggingInfo.splice(a,1)}}console.log("删除help",PLAYER.storeDraggingInfo)},checkNewWindow:function(f,a,d){var f=JSON.parse(f);var k=f.pHeight;var b=f.pWidth;var h=a/k;var j=d/b;for(var g=0;g<f.rootBin.sequence[0].tracks.length;g++){var c=f.rootBin.sequence[0].tracks[g];$.each(c.subclip,function(i,l){if(l&&l.effect){$.each(l.effect,function(m,o){if(o.type==="mosaic"){o.attr.x1*=j;o.attr.y1*=h;o.attr.width*=j;o.attr.height*=j}})}})}return f},getSubtitleTemp:function(f){var b=$("#ocx").width();var d=$("#ocx").height();var a=PLAYER.jsonObj.width;var c=PLAYER.jsonObj.height;PLAYER.subJsonTem={"subtitle_01":{"id":"subtitle_01","name":"subtitle_01","duration":2000,"trimIn":0,"trimOut":2000,"abs":{left_value:parseInt(1400/a*b),top_value:parseInt(40/c*d)},"pixel":[{"x1":parseInt(1400/a*b),"y1":parseInt(40/c*d),"width":parseInt(300/a*b),"height":parseInt(285/c*d),"attr":{"type":"images","url":"http://112.126.71.150:82/FastCarve/s1_01.png"},"attrID":"attrID_"+PLAYER.genNonDuplicateID(12)},{"x1":parseInt(1400/a*b),"y1":parseInt(360/c*d),"attr":{"type":"fade","text":"NAME","fontFamily":"PingFang Heavy","fontSize":parseInt(54/c*d),"fillStyle":"#ffffff","textAlign":"left","fadeInTime":1000,"fadeOutTime":1000},"attrID":"attrID_"+PLAYER.genNonDuplicateID(12)},{"x1":parseInt(1400/a*b),"y1":parseInt(410/c*d),"attr":{"type":"fade","text":"hellp","fontFamily":"PingFang Regular","fontSize":parseInt(40/c*d),"fillStyle":"#ffffff","textAlign":"left","fadeInTime":1000,"fadeOutTime":1000},"attrID":"attrID_"+PLAYER.genNonDuplicateID(12)}]}};return JSON.stringify(PLAYER.subJsonTem[f])}};PLAYER.EventTarget=function(){function a(){this.handlers={}}a.prototype={addHandler:function(c,b){if(typeof this.handlers[c]=="undefined"){this.handlers[c]=[]}this.handlers[c].push(b)},fire:function(f){if(!f.target){f.target=this}if(this.handlers[f.type] instanceof Array){var c=this.handlers[f.type];for(var d=0,b=c.length;d<b;d++){c[d](f)}}},removeHandler:function(g,f){if(this.handlers[g] instanceof Array){var c=this.handlers[g];for(var d=0,b=c.length;d<b;d++){if(c[d]===f){break}}c.splice(d,1)}}};return a}();PLAYER.timeRuler=function(){var m=0;var b=0;var J=0;var M=0;var an=0;var U=0;var n=0;var O;var T;var d;var g=0;var o=0;var p=0;var ag=0;var N=0;var ae;var y=this;var w=0;var Z=0;var u=0;var ai=0;var V=null;var P=null;var al=null;var s=0;var W=[{smallScaleFrame:1,smallScaleNumsPerLargeScale:1},{smallScaleFrame:1,smallScaleNumsPerLargeScale:2},{smallScaleFrame:1,smallScaleNumsPerLargeScale:5},{smallScaleFrame:1,smallScaleNumsPerLargeScale:10},{smallScaleFrame:5,smallScaleNumsPerLargeScale:5},{smallScaleFrame:5,smallScaleNumsPerLargeScale:10},{smallScaleFrame:10,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*6,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*12,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*30,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*6,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*30,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*60,smallScaleNumsPerLargeScale:10}];var aq={hasTrack:true,maxTime:1000,min_largeScaleWidth:80,framePerPixel:0,max_fpp:0,min_fpp:0.125,smallScaleNumsPerLargeScale:10,smallScaleFrame:0,smallScaleWidth:0,largeScaleWidth:0,largeScaleMillisecondInterval:0,seekComandTimesMonitor:[],largeScaleHeight:30,smallScaleHeight:12.5,backgroundColor:"#262626",trimHeight:67,scaleColor:"#929293",fontColor:"#929293",fontSize:12,fontFamily:"微软雅黑",$container:null,$ruler:null,$cursor:null,$trimInOut:null,$trimIn:null,$trimOut:null,$sliderTrack:null,$sliderBar:null,$sliderBarLeft:null,$sliderBarMiddle:null,$sliderBarRight:null,$clipTrackContainer:null,$clipTrack:null,$clipVideo:null,$clipAudio1:null,$clipAudio2:null,$clipSubTitle:null,$clipEffect:null,targetObj:"time_rule"};function i(at){y=this;y.config=$.extend(aq,at);y.targetObj=y.config.targetObj;y.trimInCurrTime=0;y.trimOutCurrTime=0;y.currTime=0;r();C();this.config.$rulerWrap.addEventListener("mousedown",B);
this.config.$rulerWrap.addEventListener("mousemove",v);this.config.$trimIn.addEventListener("mousemove",aa);this.config.$trimOut.addEventListener("mousemove",ak);this.DragDrop.addHandler("clipDragstart",l);this.DragDrop.addHandler("clipDrag",G);this.DragDrop.addHandler("clipDragend",R);this.DragDrop.addHandler("clipClick",I);this.DragDrop.addHandler("clipCheckDir",a);this.DragDrop.addHandler("clipDblclick",A);this.DragDrop.addHandler("sequenceClick",ao);this.DragDrop.addHandler("effectClick",ah);this.DragDrop.addHandler("keydown",X);window.addEventListener("resize",q);PLAYER.EventUtil.addHandler($(".time_ruler_edit_box")[0],"click",h)}i.prototype={updateRuler:function(av){var at=y.config;var au=y.targetObj;at.framePerPixel=av.framePerPixel;at.smallScaleFrame=av.smallScaleFrame;at.smallScaleNumsPerLargeScale=av.smallScaleNumsPerLargeScale;at.smallScaleWidth=at.smallScaleFrame/at.framePerPixel;at.largeScaleWidth=at.smallScaleWidth*at.smallScaleNumsPerLargeScale;at.largeScaleMillisecondInterval=at.smallScaleFrame*at.smallScaleNumsPerLargeScale*40;at.max_fpp=Math.min(at.maxTime/$("."+y.targetObj).width(),25*60*60*10/80)},updateEvent:function(au,ax){var at=y.config;var av=y.targetObj;at.maxTime=au;at.max_fpp=Math.min(at.maxTime/at.$headerRight.width(),25*60*60*10/80);if(ax){N=2*at.$headerRight.width();at.framePerPixel=at.maxTime/N;var aw=S(at.framePerPixel);af(at.framePerPixel);ab(aw.smallScaleFrame,aw.smallScaleNumsPerLargeScale,at.framePerPixel);O=0.5*at.$sliderTrack.width();n=0;ag=0;at.$rulerWrap.width(N);at.$sliderBar.css("width",O);at.$sliderBar.css("left",n);at.$sliderBarMiddle.css("width",O-2*o);at.$sliderBarMiddle.css("left",o);at.$sliderBarLeft.css("left",0);at.$sliderBarRight.css("left",O-o)}else{N=at.maxTime/at.framePerPixel;ag=Math.abs(parseInt(at.$rulerWrap.css("marginLeft")));O=at.$sliderBar.width();if(O===at.$sliderTrack.width()){O=at.$headerRight.width()*at.$sliderTrack.width()/N}T=parseInt(at.$sliderTrack.width()-O);d=parseInt(N-at.$headerRight.width());n=ag*T/d;at.$rulerWrap.width(N);at.$sliderBar.css("width",O);at.$sliderBar.css("left",n);at.$sliderBarMiddle.css("width",O-2*o);at.$sliderBarMiddle.css("left",o);at.$sliderBarLeft.css("left",0);at.$sliderBarRight.css("left",O-o)}y.fixArrowCurrentTime(y.currTime);y.fixTrimInByCurrentTime(y.trimInCurrTime);y.fixTrimOutByCurrentTime(y.trimOutCurrTime);am(ag)},fixArrowCurrentTime:function(aw){var au=this.config;var av=this.targetObj;U=aw/au.framePerPixel;var ax=Math.abs(parseFloat(au.$rulerWrap.css("margin-left")));var at=au.$headerRight.width();if(U<=0){U=0}if(U>=au.$rulerWrap.width()){U=au.$rulerWrap.width()}if(U-ax>at){ag=U-at;T=parseFloat(au.$sliderTrack.width()-au.$sliderBar.width());d=parseFloat(au.$rulerWrap.width()-at);n=ag*T/d;au.$sliderBar.css("left",n);au.$rulerWrap.css("margin-left",-ag);au.$ruler.css("left",ag);au.$clipTrackBar.css("margin-left",-ag);au.$line.css("margin-left",-ag);am(ag)}y.currTime=aw;$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(y.currTime));au.$cursor.css("left",U);au.$line.css("left",U)},fixTrimInByCurrentTime:function(av){var at=this.config;this.trimInCurrTime=av;J=this.trimInCurrTime/at.framePerPixel;M=this.trimOutCurrTime/at.framePerPixel;if(J>M){M=at.maxTime/at.framePerPixel;this.trimOutCurrTime=at.maxTime;M=parseInt(M*at.framePerPixel)/at.framePerPixel}at.$trimInOut.css("left",J);at.$trimInOut.css("width",M+2-J);var au=PLAYER.getDurationToString((parseInt(y.trimOutCurrTime)-parseInt(y.trimInCurrTime)));$("#js_player_trimInOutTime").html(au)},initTime:function(){var at=this.config;var au=this.targetObj;at.$sliderBar.css("left",0);at.$sliderBarMiddle.css("width",O-g-o);at.$sliderBarMiddle.css("left",g);at.$sliderBarLeft.css("left",0);at.$sliderBarRight.css("left",O-o);at.$rulerWrap.css("margin-left",0);at.$ruler.css("left",0);at.$clipTrackBar.css("margin-left",0);am(0);y.fixArrowCurrentTime(0)},fixTrimOutByCurrentTime:function(av){var at=this.config;this.trimOutCurrTime=av;J=this.trimInCurrTime/at.framePerPixel;M=this.trimOutCurrTime/at.framePerPixel;if(M<J){J=0;this.trimInCurrTime=0}at.$trimInOut.css("left",J);at.$trimInOut.css("width",M+2-J);var au=PLAYER.getDurationToString((parseInt(y.trimOutCurrTime)-parseInt(y.trimInCurrTime)));$("#js_player_trimInOutTime").html(au)},cutArrowCurrentTime:function(){var au=y.config;var aw=y.targetObj;var av=y.currTime;var at="interleaved_id_"+PLAYER.genNonDuplicateID(12);PLAYER.checkPlaying();PLAYER.cutIndex++;$.each($(".onselected"),function(ay,az){v0_sequenceTrimIn=parseInt($(az).attr("data-sequencetrimin"));v0_sequenceTrimOut=parseInt($(az).attr("data-sequencetrimout"));if(v0_sequenceTrimIn<av&&v0_sequenceTrimOut>av){ax($(az));function ax(aH){var aS=0;var aT=0;var aD=0;var aU=0;var a0=0;var aQ=0;var aE=0;var a1=0;var aA=aH.attr("data-id");var aX=aH.attr("data-name");var aI=aH.attr("data-time");var aF=parseInt(aH.attr("data-duration"));var aW=aH.attr("data-interleaved");var aK=aH.attr("data-intid");var aR=parseInt(aH.parent(".time_ruler_bar").attr("data-index"));
var aZ=aH.attr("class");var aJ=aH.attr("data-type");var aV=parseInt(aH.offset().left);var aM;var aO;var aY=aJ+"_"+PLAYER.genNonDuplicateID(12);PLAYER.checkPlaying();aH.css("cursor","url(images/cur/cut.cur),default");aH.removeClass("onselected");aS=parseInt(aH.attr("data-sequencetrimin"));aT=parseInt(av);aD=parseInt(aH.attr("data-trimin"));aU=aD+aT-aS;aE=aU;a0=av;aQ=parseInt(aH.attr("data-sequencetrimout"));a1=parseInt(aH.attr("data-trimout"));aM=aH.clone();if(aM.find(".effect_box_l")){aM.find(".effect_box_l").remove()}if(aM.find(".effect_box_r")){aH.find(".effect_box_r").remove()}var aB=aK+"_"+PLAYER.cutIndex;aM.removeClass("onselected");aM.attr("data-trimin",aE);aM.attr("data-trimout",a1);aM.attr("data-sequencetrimin",a0);aM.attr("data-sequencetrimout",aQ);aM.attr("data-time",aY);aM.attr("data-intid",aB);aM.css("width",(aQ-a0)/au.framePerPixel);aM.css("left",a0/au.framePerPixel);aH.parent(".time_ruler_bar").append(aM);if(aH.parent(".time_ruler_bar").hasClass("bar_v")){var aP=PLAYER.operateJson.getCutNewEffectClip(aI,aE,a1);aO={"assetID":aA,"trimIn":aE,"trimOut":a1,"sequenceTrimIn":a0,"sequenceTrimOut":aQ,"effect":aP,"createTime":aY,"type":aJ,"interleaved_id":aB};if(aW==="true"){aO.interleaved=true}else{aO.interleaved=false}PLAYER.operateJson.addVideoClipAttr(aO,aR)}else{if(aH.parent(".time_ruler_bar").hasClass("bar_a")){aO={"assetID":aA,"trimIn":aE,"trimOut":a1,"sequenceTrimIn":a0,"sequenceTrimOut":aQ,"volume":100,"createTime":aY,"type":aJ,"interleaved_id":aB};if(aW==="true"){aO.interleaved=true}else{aO.interleaved=false}PLAYER.operateJson.addAudioClipAttr(aO,aR)}else{if(aH.parent(".time_ruler_bar").hasClass("bar_t")){var aG=JSON.parse(PLAYER.operateJson.getSubtitleClip(aI,aR));var aL={"trimIn":aE,"trimOut":a1,"sequenceTrimIn":a0,"sequenceTrimOut":aQ,"createTime":aY,"type":aJ,"interleaved_id":aB};$.extend(aG,aL);PLAYER.operateJson.addSubtitleClipAttr(aG,aR)}}}aH.attr("data-trimout",aU);aH.attr("data-sequencetrimout",aT);aH.width((aT-aS)/au.framePerPixel);var aN={trimIn:aD,trimOut:aU,sequenceTrimIn:aS,sequenceTrimOut:aT};var aC=PLAYER.operateJson.getCutOldEffectClip(aI,aD,aU);PLAYER.operateJson.updateClipAttr(aN,aI,aC)}}});PLAYER.operateJson.sendJson()},fixEffectWidth:function(at){if(at.children(".effect_box")){$.each(at.children(".effect_box"),function(au,aw){var av=($(aw).attr("data-trimout")-$(aw).attr("data-trimin"))/PLAYER.TR.config.framePerPixel;$(aw).width(av)})}},fixClipWidth:function(){var at=y.config;$.each($(".edit_box_v"),function(au,aw){var av=($(aw).attr("data-trimout")-$(aw).attr("data-trimin"))/at.framePerPixel;newLeft=(parseInt($(aw).attr("data-sequencetrimin")))/at.framePerPixel;$(aw).width(av);$(aw).css("left",newLeft);y.fixEffectWidth($(aw))});$.each($(".edit_box_a"),function(au,aw){var av=($(aw).attr("data-trimout")-$(aw).attr("data-trimin"))/at.framePerPixel;newLeft=(parseInt($(aw).attr("data-sequencetrimin")))/at.framePerPixel;$(aw).width(av);$(aw).css("left",newLeft)});$.each($(".edit_box_t"),function(au,aw){var av=($(aw).attr("data-trimout")-$(aw).attr("data-trimin"))/at.framePerPixel;newLeft=(parseInt($(aw).attr("data-sequencetrimin")))/at.framePerPixel;$(aw).width(av);$(aw).css("left",newLeft)})},moveToNextFrame:function(){PLAYER.keyNum=39;var at=y.config;y.currTime+=1;if(y.currTime>=at.maxTime){y.currTime=at.maxTime}y.fixArrowCurrentTime(y.currTime);y.fixTrimInByCurrentTime(y.trimInCurrTime);y.fixTrimOutByCurrentTime(y.trimOutCurrTime)},moveToPrevFrame:function(){PLAYER.keyNum=37;var at=y.config;y.currTime-=1;if(y.currTime<=0){y.currTime=0}y.fixArrowCurrentTime(y.currTime);y.fixTrimInByCurrentTime(y.trimInCurrTime);y.fixTrimOutByCurrentTime(y.trimOutCurrTime)},DragDrop:function(){var aE=this.targetObj;var aA=new PLAYER.EventTarget(),aL=null,aC=null,aB=null,aK=null,aH=null;var aP=0;var au=null;var aQ=0;var aF=[];var ax=[];var av=[];var aU=[];var aI=0;var aM=0;var aJ=0;var ay=0;var aS;var az;var aD;function aR(aX,aV){var aW=D(JSON.parse(aV));aX.attr("data-clipdir",aW);return aW}function aw(aV){var aW=JSON.parse(aV).clipInitLeft;return aW}function aO(aV){var aW=JSON.parse(aV).clipInitLeft+JSON.parse(aV).clipInitWidth;return aW}function aT(aV){var aW=JSON.parse(aV).clipInitSequenceTrimIn;return aW}function at(aV){var aW=JSON.parse(aV).clipInitSequenceTrimOut;return aW}function aN(a1,a0){var aZ=JSON.parse(a1).clipInitType;var aY=JSON.parse(a1).clipInitOffsetTop;var aX=JSON.parse(a1).clipInitIndex;var aW=JSON.parse(a1).clipInitClientY;var aV;if(aZ==="v"){if(aX>=1&&a0-aW<-10){aV=aX+Math.ceil((aY-a0)/70)}else{if(aX>=2&&a0-aW>10){aV=aX-Math.ceil((a0-aW)/70)}else{if(Math.abs(a0-aW)<5){aV=aX}}}}else{if(aZ==="t"||aZ==="a"){if(aX>=1&&a0-aW>10){aV=aX+Math.ceil((a0-aY)/70)}else{if(aX>=2&&a0-aW<-10){aV=aX-Math.ceil((aW-a0)/70)}else{if(Math.abs(a0-aW)<5){aV=aX}}}}}if(aV){return aV}}function aG(aX){aX=PLAYER.EventUtil.getEvent(aX);var a2=PLAYER.EventUtil.getTarget(aX);switch(aX.type){case"mousedown":if(a2.className.indexOf("draggable")>-1){PLAYER.EventUtil.preventDefault(aX);PLAYER.clickOrMove=false;
aL=$(a2);aP=aX.clientX;PLAYER.operateJson.mouseDownState(aL);az=ad(aL,aX);aS=aR(aL,az);PLAYER.operateJson.addDraggingInfo(aL,az);aF.push(aw(az));ax.push(aO(az));av.push(aT(az));aU.push(at(az));aA.fire({type:"clipDragstart",target:aL,x:aX.clientX,y:aX.clientY});if(aS==="middle"){var aW=PLAYER.operateJson.chooseSelectedElem(aL);if(aW.length!==0){for(var a0=0;a0<aW.length;a0++){var a4=aW[a0];aD=ad(a4,aX);a4.attr("data-clipdir",aS);PLAYER.operateJson.addDraggingInfo(a4,aD);aF.push(aw(aD));ax.push(aO(aD));av.push(aT(aD));aU.push(at(aD));aA.fire({type:"clipDragstart",target:a4,x:aX.clientX,y:aX.clientY})}}}else{if(aS==="left"||aS==="right"){var a4=PLAYER.operateJson.chooseInterleavedElem(aL);if(a4){aD=ad(a4,aX);a4.attr("data-clipdir",aS);PLAYER.operateJson.addDraggingInfo(a4,aD);aF.push(aw(aD));ax.push(aO(aD));av.push(aT(aD));aU.push(at(aD));aA.fire({type:"clipDragstart",target:a4,x:aX.clientX,y:aX.clientY})}}}aI=Math.min.apply(null,aF);aM=Math.max.apply(null,ax);aJ=Math.min.apply(null,av);ay=Math.max.apply(null,aU)}break;case"mousemove":if(aL!==null){var a5=Math.abs(aX.clientX-aP);if(a5<=1){PLAYER.clickOrMove=false}else{PLAYER.clickOrMove=true;var a3=aN(az,aX.clientY);aA.fire({type:"clipDrag",target:aL,x:aX.clientX,y:aX.clientY,min_left:aI,max_right:aM,min_in:aJ,max_out:ay,cal_index:a3});if(aS==="middle"){var aW=PLAYER.operateJson.chooseSelectedElem(aL);if(aW.length!==0){for(var a0=0;a0<aW.length;a0++){var a4=aW[a0];aA.fire({type:"clipDrag",target:a4,x:aX.clientX,y:aX.clientY,min_left:aI,max_right:aM,min_in:aJ,max_out:ay,cal_index:a3})}}}else{if(aS==="left"||aS==="right"){var a4=PLAYER.operateJson.chooseInterleavedElem(aL);if(a4){aA.fire({type:"clipDrag",target:a4,x:aX.clientX,y:aX.clientY,min_left:aI,max_right:aM,min_in:aJ,max_out:ay,cal_index:a3})}}}}}if(a2.className.indexOf("draggable")>-1){aK=$(a2);aK.css({cursor:"default"});aA.fire({type:"clipCheckDir",target:aK,x:aX.clientX,y:aX.clientY});aK=null}break;case"mouseup":var a5=Math.abs(aX.clientX-aP);if(a5<=3){PLAYER.clickOrMove=false}else{PLAYER.clickOrMove=true}if(PLAYER.clickOrMove&&aL){if(aL.hasClass("draggable")||aL.hasClass("time_ruler_bar")){aA.fire({type:"clipDragend",target:aL,x:aX.clientX,y:aX.clientY});if(aS==="middle"){var aW=PLAYER.operateJson.chooseSelectedElem(aL);if(aW.length!==0){for(var a0=0;a0<aW.length;a0++){var a4=aW[a0];aA.fire({type:"clipDragend",target:a4,x:aX.clientX,y:aX.clientY})}}}else{if(aS==="left"||aS==="right"){var a4=PLAYER.operateJson.chooseInterleavedElem(aL);if(a4){aA.fire({type:"clipDragend",target:a4,x:aX.clientX,y:aX.clientY})}}}PLAYER.operateJson.sendJson()}}if(!PLAYER.clickOrMove&&aL&&aL.hasClass("draggable")){var aY="interleaved_id"+PLAYER.genNonDuplicateID(12);aA.fire({type:"clipClick",target:aL,x:aX.clientX,y:aX.clientY,intId:aY});if(aS==="middle"){var aW=PLAYER.operateJson.chooseSelectedElem(aL);if(aW.length!==0){for(var a0=0;a0<aW.length;a0++){var a4=aW[a0];aA.fire({type:"clipClick",target:a4,x:aX.clientX,y:aX.clientY,intId:aY})}}}else{if(aS==="left"||aS==="right"){var a4=PLAYER.operateJson.chooseInterleavedElem(aL);if(a4){aA.fire({type:"clipClick",target:a4,x:aX.clientX,y:aX.clientY,intId:aY})}}}if(PLAYER.keyNum===85){PLAYER.operateJson.sendJson()}}aL=null;a4=null;aI=0;aM=0;aJ=0;ay=0;aF=[];ax=[];av=[];aU=[];break;case"click":if(a2.className.indexOf("effect_box_l")>-1||a2.className.indexOf("effect_box_r")>-1){var a1=$(a2);aA.fire({type:"effectClick",target:a1,x:aX.clientX,y:aX.clientY})}break;case"dblclick":if(a2.className.indexOf("time_ruler_bar")>-1){var a1=$(a2);aA.fire({type:"sequenceClick",target:a1,x:aX.clientX,y:aX.clientY})}if(a2.className.indexOf("edit_box_t")>-1){aK=$(a2);aA.fire({type:"clipDblclick",target:aK,x:aX.clientX,y:aX.clientY})}break;case"mousewheel":var aV=$(a2);aA.fire({type:"mousewheel",target:aV,wheelDelta:aX.wheelDelta});break;case"keydown":var aZ=$(a2);PLAYER.EventUtil.preventDefault(aX);aA.fire({type:"keydown",target:aZ,code:aX.keyCode,shift:aX.shiftKey,ctrl:aX.ctrlKey});break}}aA.enable=function(){PLAYER.EventUtil.addHandler(document,"mousedown",aG);PLAYER.EventUtil.addHandler(document,"mousemove",aG);PLAYER.EventUtil.addHandler(document,"mouseup",aG);PLAYER.EventUtil.addHandler(document,"click",aG);PLAYER.EventUtil.addHandler(document,"dblclick",aG);PLAYER.EventUtil.addHandler(document,"mousewheel",aG);PLAYER.EventUtil.addHandler(document,"keydown",aG)};aA.disable=function(){PLAYER.EventUtil.removeHandler(document,"mousedown",aG);PLAYER.EventUtil.removeHandler(document,"mousemove",aG);PLAYER.EventUtil.removeHandler(document,"mouseup",aG);PLAYER.EventUtil.removeHandler(document,"click",aG);PLAYER.EventUtil.removeHandler(document,"dblclick",aG);PLAYER.EventUtil.removeHandler(document,"mouseover",aG);PLAYER.EventUtil.removeHandler(document,"mouseout",aG);PLAYER.EventUtil.removeHandler(document,"mousewheel",aG);PLAYER.EventUtil.removeHandler(document,"keydown",aG)};return aA}()};function r(){var at=y.config;var au=y.targetObj;at.$header=$('<div class="'+au+'_header"></div>');at.$headerLeft=$('<div class="'+au+'_header_left fl">'+'<div class="time_ruler_title_nowTime" id="js_time_ruler_title_nowTime">00:00:00:00</div>'+'<div class="time_ruler_title_toolbar">'+'<span class="toolbar_insert_model add_audio_track" title="添加音频轨道" id="js_add_audio_track">'+'<a class="fa fa-plus"></a>'+"</span>"+"</div>"+"</div>");
at.$headerRight=$('<div class="'+au+'_header_right fr"></div>');at.$rulerWrap=$('<div class="'+au+'_canvas_wrap"></div>');at.$ruler=$('<canvas class="'+au+'_canvas"></canvas>');at.$ruler.attr("width",at.$headerRight.width());at.$rulerWrap.append(at.$ruler);at.$headerRight.append(at.$rulerWrap);at.$header.append(at.$headerLeft);at.$header.append(at.$headerRight);N=at.$headerRight.width();at.$trimInOut=$('<div class="'+au+'_trimInOut"></div>');at.$trimInOut.css("height",at.trimHeight-2);at.$trimInOut.css("width","0px");at.$trimInOut.appendTo(at.$rulerWrap);at.$trimIn=$('<div class="'+au+'_trimIn"></div>');at.$trimIn.css("height",at.trimHeight-2);at.$trimIn.appendTo(at.$trimInOut);at.$trimOut=$('<div class="'+au+'_trimOut"></div>');at.$trimOut.css("height",at.trimHeight-2);at.$trimOut.appendTo(at.$trimInOut);at.$cursor=$('<div class="'+au+'_cursor"></div>');at.$cursor.css("height",$("."+au).height()-70);at.$cursor.appendTo(at.$rulerWrap);var av=$('<div class="'+au+'_cursor_top"></div>');av.appendTo(at.$cursor);at.$header.appendTo($("."+au));at.$body=$('<div class="'+au+'_body"></div>');at.$clipTrackContainer=$('<div class="'+au+'_track_box" id="js_'+au+'_track_box">');at.$clipTrackLeft=$('<div class="time_ruler_title_box fl" id="js_time_ruler_title_box"></div>');at.$clipTrackLeft.html('<div class="time_ruler_title_list" data-type="t1">T1</div>'+'<div class="time_ruler_title_list" data-type="t2">T2</div>'+'<div class="time_ruler_title_list" data-type="v2">V2</div>'+'<div class="time_ruler_title_list" data-type="v1">V1</div>'+'<div class="time_ruler_title_list" data-type="a1">A1</div>'+'<div class="time_ruler_title_list" data-type="a2">A2</div>');at.$clipTrackLeftRight=$('<div class="time_ruler_edit_box fr"></div>');at.$clipTrackBar=$('<div class="time_ruler_bar_box" id="js_time_ruler_bar_box"></div>');at.$clipTrackBar.html('<div class="'+au+'_bar bar_t"data-type="t" data-index="1"></div>'+'<div class="'+au+'_bar bar_t"data-type="t" data-index="2"></div>'+'<div class="'+au+'_bar bar_v"data-type="v" data-index="2"></div>'+'<div class="'+au+'_bar bar_v"data-type="v" data-index="1"></div>'+'<div class="'+au+'_bar bar_a"data-type="a" data-index="1"></div>'+'<div class="'+au+'_bar bar_a"data-type="a" data-index="2"></div>');at.$line=$('<div class="'+au+'_line">');at.$clipTrackLeftRight.append(at.$clipTrackBar);at.$clipTrackLeftRight.append(at.$line);at.$clipTrackContainer.append(at.$clipTrackLeft);at.$clipTrackContainer.append(at.$clipTrackLeftRight);at.$scrollBar=$('<div class="'+au+'_track">'+'<div class="'+au+'_scroll"></div>'+"</div>");at.$body.append(at.$clipTrackContainer);at.$body.append(at.$scrollBar);at.$footer=$('<div class="'+au+'_footer">');at.$sliderTrack=$('<div class="'+au+'_slider_track">');at.$sliderBar=$('<div class="'+au+'_slider_scroll_total">');at.$sliderBarLeft=$('<div class="'+au+'_slider_scroll_left">');at.$sliderBarMiddle=$('<div class="'+au+'_slider_scroll_middle">');at.$sliderBarRight=$('<div class="'+au+'_slider_scroll_right">');at.$sliderBarLeft.appendTo(at.$sliderBar);at.$sliderBarMiddle.appendTo(at.$sliderBar);at.$sliderBarRight.appendTo(at.$sliderBar);at.$sliderBar.appendTo(at.$sliderTrack);at.$footer.append(at.$sliderTrack);$("."+au).append(at.$header);$("."+au).append(at.$body);$("."+au).append(at.$footer);c();am(0);K()}function c(){var at=y.config;var au=y.targetObj;ae=at.$headerRight.width();at.framePerPixel=at.maxTime/ae;at.smallScaleFrame=S(at.framePerPixel).smallScaleFrame;at.smallScaleNumsPerLargeScale=S(at.framePerPixel).smallScaleNumsPerLargeScale;at.smallScaleWidth=at.smallScaleFrame/at.framePerPixel;at.largeScaleWidth=at.smallScaleWidth*at.smallScaleNumsPerLargeScale;at.largeScaleMillisecondInterval=at.smallScaleFrame*at.smallScaleNumsPerLargeScale*40;at.max_fpp=Math.min(at.maxTime/ae,25*60*60*10/80)}function S(av){var au=y.config;var at=[];var ax={};for(var aw=0;aw<W.length;aw++){var ay=(W[aw].smallScaleFrame*W[aw].smallScaleNumsPerLargeScale)/80;if(av<=ay){at.push(aw)}}ax.smallScaleFrame=W[at[0]].smallScaleFrame;ax.smallScaleNumsPerLargeScale=W[at[0]].smallScaleNumsPerLargeScale;return ax}function K(){var at=y.config;var au=y.targetObj;var av;g=at.$sliderBarLeft.width();o=at.$sliderBarRight.width();av=(at.$headerRight.width()*at.$sliderTrack.width()/at.$rulerWrap.width());T=parseInt(at.$sliderTrack.width()-av);d=parseInt(at.$rulerWrap.width()-at.$headerRight.width());if(av>=at.$sliderTrack.width()){av=at.$sliderTrack.width()}at.$sliderBar.css("width",av);at.$sliderBar.css("left",0);at.$sliderBarMiddle.css("width",av-g-o);at.$sliderBarMiddle.css("left",g);at.$sliderBarLeft.css("left",0);at.$sliderBarRight.css("left",av-o)}function am(az){var ax=y.config;var aC=y.targetObj;az=parseInt(az);var aF=ax.$headerRight.width();var aE=ax.$headerRight.height();ax.$ruler.attr("width",aF);ax.$ruler.attr("height",aE);var aG=ax.$ruler[0].getContext("2d");aG.clearRect(0,0,aF,aE);aG.fillStyle=ax.backgroundColor;aG.fillRect(0,0,aF,aE);var av=aE;aG.lineWidth=1;aG.strokeStyle=ax.scaleColor;aG.fillStyle=ax.fontColor;
aG.font=ax.fontSize+"px "+ax.fontFamily;aG.textAlign="center";aG.beginPath();var au=parseInt(az/ax.largeScaleWidth)*ax.largeScaleMillisecondInterval;var aD=parseInt(az/ax.smallScaleWidth)+1;var ay=aD*ax.smallScaleWidth-az;var aA=aD%ax.smallScaleNumsPerLargeScale;var aw=0;var aB=0;while(aw<aF){aw=aB*ax.smallScaleWidth+0.3+ay;if(aA%ax.smallScaleNumsPerLargeScale==0){aG.moveTo(aw,av-1);aG.lineTo(aw,av-ax.largeScaleHeight);au+=ax.largeScaleMillisecondInterval;var at=PLAYER.$millisecondsToTimeFrame(au);aG.fillText(at,aw,av-ax.largeScaleHeight-3)}else{aG.moveTo(aw,av-1);aG.lineTo(aw,av-ax.smallScaleHeight)}aB++;aA++}aG.stroke()}function C(){E();L();z()}function q(){var at=y.config;var au=y.targetObj;at.$headerRight.width(at.$headerRight.parent().width()-151);y.updateEvent(y.config.maxTime,true)}function E(){var at=y.config;at.$rulerWrap.addEventListener=function(au,av){if(au=="mousedown"){at.$rulerWrap.mousedown(function(ax){ax.stopPropagation();Q(ax.clientX,ax.clientY,av);document.onmousemove=ay;document.onmouseup=aw;function ay(az){Q(az.clientX,az.clientY,av)}function aw(az){this.onmousemove=null;this.onmouseup=null}})}else{if(au=="click"){e.stopPropagation();if($(this)!=at.$ruler){return}Q(e.clientX,e.clientY,av)}else{if(au=="mousemove"){t(at.$cursor,av)}}}}}function t(ax,aA){var au,az,av,aw;ax.mousedown(function(aB){aB.stopPropagation();aB=aB||event;au=aB.clientX;az=aB.clientY;av=ax.offsetLeft;aw=ax.offsetTop;this.ondragstart=function(){return false};document.onmousemove=ay;document.onmouseup=at});function ay(aB){aB=aB||event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();Q(aB.clientX,aB.clientY,aA)}function at(aB){this.onmousemove=null;this.onmouseup=null}}function Q(av,au,aB){PLAYER.checkPlaying();var at=y.config;var az=y.targetObj;var aA=ae;var aw=av-at.$headerRight.offset().left;var ax=Math.abs(parseFloat(at.$rulerWrap.css("margin-left")));U=aw+ax;U=parseFloat(U*at.framePerPixel)/at.framePerPixel;if(U<=0){U=0}if(U>=at.$rulerWrap.width()){U=at.$rulerWrap.width()}if(U-ax>aA){ag=U-aA;T=parseFloat(at.$sliderTrack.width()-at.$sliderBar.width());d=parseFloat(at.$rulerWrap.width()-aA);n=ag*T/d;at.$sliderBar.css("left",n);at.$rulerWrap.css("margin-left",-ag);at.$ruler.css("left",ag);am(ag);at.$sliderBar.css("left",n);at.$rulerWrap.css("margin-left",-ag);at.$ruler.css("left",ag);at.$clipTrackBar.css("margin-left",-ag);am(ag)}if(U<ax){ag=U;n=ag*at.$sliderTrack.width()/at.$rulerWrap.width();at.$sliderBar.css("left",n);at.$rulerWrap.css("margin-left",-ag);at.$ruler.css("left",ag);am(ag);at.$sliderBar.css("left",n);at.$rulerWrap.css("margin-left",-ag);at.$ruler.css("left",ag);at.$clipTrackBar.css("margin-left",-ag);am(ag)}at.$cursor.css("left",U);at.$line.css("left",U);var ay=y.currTime;y.currTime=Math.round(U*at.framePerPixel);if(aB!==null&&ay!==y.currTime){aB(y.currTime)}}function B(aw){PLAYER.checkPlaying();y.currTime=aw;y.fixArrowCurrentTime(aw);PLAYER.OCX.seek(aw);if(aw>=PLAYER.PTR.config.maxTime){aw=PLAYER.PTR.config.maxTime}PLAYER.PTR.currTime=aw;PLAYER.PTR.fixArrowCurrentTime(aw);var av=PLAYER.operateJson.checkCorsorhasClip(y.currTime);if(!av){var au=document.getElementById("js_voCanvas");var at=au.getContext("2d");at.clearRect(0,0,100,500)}}function v(au){PLAYER.checkPlaying();var at=y.config;at.seekComandTimesMonitor.push(au)}function ad(av,au){var at={};at.clipInitTime=av.attr("data-time");at.clipInitWidth=parseInt(av.outerWidth());at.clipInitLeft=parseInt(av.position().left);at.clipInitClientX=au.x;at.clipInitOffsetLeft=parseInt(av.parent().offset().left);at.clipInitTop=parseInt(av.position().top);at.clipInitClientY=au.y;at.clipInitOffsetTop=parseInt(av.parent().offset().top);at.clipInitIndex=parseInt(av.parent().attr("data-index"));at.clipInitType=av.parent().attr("data-type");at.clipInitTrimIn=parseInt(av.attr("data-trimin"));at.clipInitTrimOut=parseInt(av.attr("data-trimout"));at.clipInitSequenceTrimIn=parseInt(av.attr("data-sequencetrimin"));at.clipInitSequenceTrimOut=parseInt(av.attr("data-sequencetrimout"));at.clipMaxFrame=parseInt(av.attr("data-duration"))||0;if(av.find(".effect_box_r").length>=1&&PLAYER.operateJson.checkNextSubClip(at.clipInitSequenceTrimOut)){at.nextClip=PLAYER.operateJson.checkNextSubClip(at.clipInitSequenceTrimOut).attr("data-time")}if(av.find(".effect_box_l").length>=1&&PLAYER.operateJson.checkPrevSubClip(at.clipInitSequenceTrimIn)){at.prevClip=PLAYER.operateJson.checkPrevSubClip(at.clipInitSequenceTrimIn).attr("data-time")}return JSON.stringify(at)}function D(at){var av=at.clipInitWidth;var ax=at.clipInitLeft;var au=at.clipInitClientX;var ay=at.clipInitOffsetLeft;var aw="";if(au<=ax+ay+8){aw="left"}else{if(au>=ax+ay+av-8){aw="right"}else{aw="middle"}}return aw}function l(au){var at=y.config;dragging=au.target;PLAYER.checkPlaying();if($(".space").size()!==0){$(".space").remove()}}var ar;function G(aG){var aJ=y.config;var aL=$(aG.target);var ax=aJ.$header.width();var ay=aL.attr("data-time");var aK;var aF=PLAYER.operateJson.getDraggingHelp(ay);
aF.show();var az=JSON.parse(PLAYER.operateJson.getDraggingAttr(ay));clipInitWidth=az.clipInitWidth;clipInitLeft=az.clipInitLeft;clipInitClientX=az.clipInitClientX;clipInitOffsetLeft=az.clipInitOffsetLeft;clipInitTop=az.clipInitTop;clipInitClientY=az.clipInitClientY;clipInitOffsetTop=az.clipInitOffsetTop;clipInitIndex=az.clipInitIndex;clipInitType=az.clipInitType;clipInitTrimIn=az.clipInitTrimIn;clipInitTrimOut=az.clipInitTrimOut;clipInitSequenceTrimIn=az.clipInitSequenceTrimIn;clipInitSequenceTrimOut=az.clipInitSequenceTrimOut;clipMaxFrame=az.clipMaxFrame;var aC=aL.attr("data-clipdir");PLAYER.operateJson.mouseMoveState(aF,aC);if(aC==="middle"){var aB=(aG.x-clipInitClientX);var aH=Math.floor((aG.x-clipInitClientX)*aJ.framePerPixel);u=clipInitSequenceTrimIn+aH;if(aG.min_in+aH<=0){aH=-aG.min_in;u=clipInitSequenceTrimIn-aG.min_in}if(u<=0){u=0}ai=u+(aF.attr("data-trimout")-aF.attr("data-trimin"));aI=u/aJ.framePerPixel;aw(aF,aH);PLAYER.help_index=aG.cal_index;if(PLAYER.help_index&&PLAYER.help_index>=1){k(aF,clipInitType,PLAYER.help_index)}aF.attr("data-sequencetrimin",u);aF.attr("data-sequencetrimout",ai);aF.css("left",aI)}else{if(aC==="left"){var aD=clipInitWidth-(aG.x-clipInitClientX);var aI=clipInitLeft+(aG.x-clipInitClientX);var aA=(aG.x-clipInitClientX)*aJ.framePerPixel/aJ.framePerPixel;var aH=Math.round(aA*aJ.framePerPixel);w=clipInitTrimIn+aH;u=clipInitSequenceTrimOut-clipInitTrimOut+w;if(aL.attr("data-type")!=="subtitle"&&aL.attr("data-type")!=="video"){if(w<=0){w=0;u=clipInitSequenceTrimOut-clipInitTrimOut;aH=w-clipInitTrimIn;aA=aH/aJ.framePerPixel;aI=clipInitLeft+aA;aD=clipInitWidth-aA}}if(w>=clipInitTrimOut-1){w=clipInitTrimOut-1;u=clipInitSequenceTrimOut-1;aH=w-clipInitTrimIn;aA=aH/aJ.framePerPixel;aI=clipInitLeft+aA;aD=clipInitWidth-aA}if(aI<=0){aI=0;u=0;w=clipInitTrimOut-clipInitSequenceTrimOut;aD=clipInitWidth+clipInitLeft}aE(aF,aH);aF.attr("data-trimin",w);aF.attr("data-sequencetrimin",u);aF.css("width",aD);aF.css("left",aI)}else{if(aC==="right"){var aD=clipInitWidth+(aG.x-clipInitClientX);var aA=(aG.x-clipInitClientX)*aJ.framePerPixel/aJ.framePerPixel;var aH=Math.round(aA*aJ.framePerPixel);Z=clipInitTrimOut+aH;ai=clipInitSequenceTrimIn+Z-clipInitTrimIn;if(aL.attr("data-type")!=="subtitle"&&aL.attr("data-type")!=="video"){if(Z>=clipMaxFrame){Z=clipMaxFrame;ai=clipInitSequenceTrimIn+Z-clipInitTrimIn;aH=Z-clipInitTrimOut;aA=aH/aJ.framePerPixel;aD=clipInitWidth+aA}}if(Z<=clipInitTrimIn+1){Z=clipInitTrimIn+1;ai=clipInitSequenceTrimIn+Z-clipInitTrimIn;aH=Z-clipInitTrimOut;aA=aH/aJ.framePerPixel;aD=clipInitWidth+aA}if(aD+clipInitLeft>=aJ.$rulerWrap.width()){aD=aJ.$rulerWrap.width()-clipInitLeft;aA=aD-clipInitWidth;aH=Math.round(aA*aJ.framePerPixel);Z=clipInitTrimOut+aH;ai=clipInitSequenceTrimIn+Z-clipInitTrimIn}av(aF,aH);aF.attr("data-trimout",Z);aF.attr("data-sequencetrimout",ai);aF.css("width",aD)}}}function at(aN){var aP;$.each(aF.siblings(),function(aQ,aT){if(!$(aT).hasClass("onselected")&&!$(aT).hasClass("changeHelp")){var aS=Math.abs(aN-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel;var aR=Math.abs(aN-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;if(Math.abs(aS)<=10){aP=parseInt($(this).attr("data-sequencetrimin"))}if(Math.abs(aR)<=10){aP=parseInt($(this).attr("data-sequencetrimout"))}}});if(!aP){var aM=aF.attr("data-intid");var aO;$.each(aF.parent().siblings().children(".changeHelp"),function(aQ,aR){if($(aR).attr("data-intid")===aM){aO=$(aR);$.each(aO.siblings(),function(aS,aV){if(!$(aV).hasClass("onselected")&&!$(aV).hasClass("changeHelp")){var aU=Math.abs(aN-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel;var aT=Math.abs(aN-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;if(Math.abs(aU)<=10){aP=parseInt($(this).attr("data-sequencetrimin"))}if(Math.abs(aT)<=10){aP=parseInt($(this).attr("data-sequencetrimout"))}}})}})}return aP}function au(aN){var aP;$.each(aF.siblings(),function(aQ,aT){if(!$(aT).hasClass("onselected")&&!$(aT).hasClass("changeHelp")){var aS=Math.abs(aN-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel;var aR=Math.abs(aN-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;if(Math.abs(aS)<=10){aP=parseInt($(this).attr("data-sequencetrimin"))}if(Math.abs(aR)<=10){aP=parseInt($(this).attr("data-sequencetrimout"))}}});if(!aP){var aM=aF.attr("data-intid");var aO;$.each(aF.parent().siblings().children(".changeHelp"),function(aQ,aR){if($(aR).attr("data-intid")===aM){aO=$(aR);$.each(aO.siblings(),function(aS,aV){if(!$(aV).hasClass("onselected")&&!$(aV).hasClass("changeHelp")){var aU=Math.abs(aN-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel;var aT=Math.abs(aN-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;if(Math.abs(aU)<=10){aP=parseInt($(this).attr("data-sequencetrimin"))}if(Math.abs(aT)<=10){aP=parseInt($(this).attr("data-sequencetrimout"))}}})}})}return aP
}function aw(aO,aN){if(aB>0){var aP=aG.max_out+aN;var aQ=at(aP);var aR=Math.abs(aP-aQ)/aJ.framePerPixel;if(Math.abs(aR)<=10){aP=aQ;ai=clipInitSequenceTrimOut+aP-aG.max_out;u=ai-(aO.attr("data-trimout")-aO.attr("data-trimin"));aI=Math.round(u/aJ.framePerPixel);PLAYER.operateJson.showAdhere(aO,"backward")}else{PLAYER.operateJson.hideAdhere(aO)}}else{var aM=aG.min_in+aN;var aQ=au(aM);console.log("adhere_point",aQ);var aR=Math.abs(aM-aQ)/aJ.framePerPixel;if(Math.abs(aR)<=10){aM=aQ;u=clipInitSequenceTrimIn+aM-aG.min_in;ai=u+(aO.attr("data-trimout")-aO.attr("data-trimin"));aI=Math.round(u/aJ.framePerPixel);PLAYER.operateJson.showAdhere(aO,"forward")}else{PLAYER.operateJson.hideAdhere(aO)}}}function aE(aO,aN){var aM=aG.min_in+aN;var aP=au(aM);var aQ=Math.abs(aM-aP)/aJ.framePerPixel;if(Math.abs(aQ)<=10){aM=aP;u=clipInitSequenceTrimIn+aM-aG.min_in;w=clipInitTrimIn+aM-aG.min_in;aI=Math.round(u/aJ.framePerPixel);aD=(clipInitSequenceTrimOut-u)/aJ.framePerPixel;PLAYER.operateJson.showAdhere(aO,"forward")}else{PLAYER.operateJson.hideAdhere(aO)}}function av(aN,aM){var aO=aG.max_out+aM;var aP=at(aO);var aQ=(aO-aP)/aJ.framePerPixel;if(Math.abs(aQ)<=10){aO=aP;ai=clipInitSequenceTrimOut+aO-aG.max_out;Z=clipInitTrimOut+(ai-clipInitSequenceTrimOut);aD=Math.round((ai-clipInitSequenceTrimIn)/aJ.framePerPixel);PLAYER.operateJson.showAdhere(aN,"backward")}else{PLAYER.operateJson.hideAdhere(aN)}}}function k(av,au,at){$.each($('.time_ruler_bar[data-type="'+au+'"]'),function(aw,ax){if(parseInt($(ax).attr("data-index"))===at){$(this).append(av)}});return av}function R(aI){var aK=y.config;var aM=aI.target;var aA=aM.attr("data-time");var aC=JSON.parse(PLAYER.operateJson.getDraggingAttr(aA));var aB=aM.attr("data-clipdir");var aH=PLAYER.operateJson.getDraggingHelp(aA);var at=parseInt(aH.attr("data-sequencetrimin"));var aE=parseInt(aH.attr("data-sequencetrimout"));var av=parseInt(aH.attr("data-trimin"));var az=parseInt(aH.attr("data-trimout"));var aw=aH.css("left");var aD=aH.width();var ax={sequenceTrimIn:at,sequenceTrimOut:aE,trimIn:av,trimOut:az};aM.attr("data-sequencetrimin",at);aM.attr("data-sequencetrimout",aE);aM.attr("data-trimin",av);aM.attr("data-trimout",az);aM.css("left",aw);aM.css("width",aD);if(aB!=="left"&&aC.nextClip){var aF=aM.find(".effect_box_r").attr("data-type");var ay=aM.find(".effect_box_r").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(aA,aF,ay);$(".edit_box_v").each(function(aP,aQ){if($(aQ).attr("data-time")===aC.nextClip){var aO=$(aQ).find(".effect_box_l").attr("data-type");var aN=$(aQ).find(".effect_box_l").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(aC.nextClip,aO,aN);$(aQ).find(".effect_box_l").remove()}});aM.find(".effect_box_r").remove()}else{if(aB!=="right"&&aC.prevClip){var aF=aM.find(".effect_box_l").attr("data-type");var ay=aM.find(".effect_box_l").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(aA,aF,ay);$(".edit_box_v").each(function(aP,aQ){if($(aQ).attr("data-time")===aC.prevClip){var aO=$(aQ).find(".effect_box_r").attr("data-type");var aN=$(aQ).find(".effect_box_r").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(aC.prevClip,aO,aN);$(aQ).find(".effect_box_r").remove()}});aM.find(".effect_box_l").remove()}}var aG=aH.parent().attr("data-type");var aL=parseInt(aH.parent().attr("data-index"));k(aM,aG,aL);var au=[];$.each(aH.siblings(),function(aN,aO){if(!$(aO).hasClass("onselected")&&!$(aO).hasClass("changeHelp")){au.push($(aO))}});if(au.length>=1){PLAYER.operateJson.checkCoverEvent(aH,aH.attr("data-intid"))}var aJ=parseInt(aH.parent().attr("data-index"));var aF=aH.parent().attr("data-type");PLAYER.operateJson.updateClipAttr(ax,aA);PLAYER.operateJson.changeIndexClipAttr(aF,aJ,aA);PLAYER.operateJson.removeDraggingInfo(aA);aH.remove()}function I(ax){var aw=y.config;var av=ax.target;var ay=av.attr("data-time");var au=PLAYER.operateJson.getDraggingHelp(ay);PLAYER.operateJson.removeDraggingInfo(ay);au.remove();if(PLAYER.keyNum===85){PLAYER.checkPlaying();av.removeClass("onselected");av.css("cursor","url(images/cur/cut.cur),default");at(av,ax)}function at(aG,aU){var aS=0;var aT=0;var aC=0;var aV=0;var aZ=0;var aO=0;var aD=0;var a0=0;var az=aG.attr("data-id");var aH=aG.attr("data-time");var aX=aG.attr("data-interleaved");var aP=parseInt(aG.parent(".time_ruler_bar").attr("data-index"));var aI=aG.attr("data-type");var aY=aI+"_"+PLAYER.genNonDuplicateID(12);var aW=parseInt(aG.offset().left);var aB=parseInt(aG.width());var aK;var aM;if(aU.x<=aW){return false}if(aU.x>=aW+aB){return false}var aQ=parseInt((aU.x-aW)*aw.framePerPixel)/aw.framePerPixel;aC=parseInt(aG.attr("data-trimin"));aV=parseInt(aC+Math.round(aQ*aw.framePerPixel));aS=parseInt(aG.attr("data-sequencetrimin"));aT=parseInt(aS+Math.round(aQ*aw.framePerPixel));aD=aV;a0=parseInt(aG.attr("data-trimout"));aZ=aT;aO=parseInt(aG.attr("data-sequencetrimout"));aK=aG.clone();if(aK.find(".effect_box_l")){aK.find(".effect_box_l").remove()}if(aK.find(".effect_box_r")){aG.find(".effect_box_r").remove()}aK.removeClass("onselected");
aK.attr("data-trimin",aD);aK.attr("data-trimout",a0);aK.attr("data-sequencetrimin",aZ);aK.attr("data-sequencetrimout",aO);aK.attr("data-time",aY);aK.attr("data-intid",aU.intId);var aR=aU.x-aG.parent().offset().left;var aE=aG.outerWidth()-(aU.x-aW);aK.css("left",aR);aK.css("width",aE);aG.parent(".time_ruler_bar").append(aK);if(aG.parent(".time_ruler_bar").hasClass("bar_v")){var aN=PLAYER.operateJson.getCutNewEffectClip(aH,aD,a0);aM={"assetID":az,"trimIn":aD,"trimOut":a0,"sequenceTrimIn":aZ,"sequenceTrimOut":aO,"effect":aN,"createTime":aY,"type":aI,"interleaved_id":aU.intId};if(aX==="true"){aM.interleaved=true}else{aM.interleaved=false}PLAYER.operateJson.addVideoClipAttr(aM,aP)}else{if(aG.parent(".time_ruler_bar").hasClass("bar_a")){aM={"assetID":az,"trimIn":aD,"trimOut":a0,"sequenceTrimIn":aZ,"sequenceTrimOut":aO,"volume":100,"createTime":aY,"type":aI,"interleaved_id":aU.intId};if(aX==="true"){aM.interleaved=true}else{aM.interleaved=false}PLAYER.operateJson.addAudioClipAttr(aM,aP)}else{if(aG.parent(".time_ruler_bar").hasClass("bar_t")){var aF=JSON.parse(PLAYER.operateJson.getSubtitleClip(aH,aP));var aJ={"trimIn":aD,"trimOut":a0,"sequenceTrimIn":aZ,"sequenceTrimOut":aO,"createTime":aY,"type":aI,"interleaved_id":aU.intId};$.extend(aF,aJ);PLAYER.operateJson.addSubtitleClipAttr(aF,aP)}}}aG.attr("data-trimout",aV);aG.attr("data-sequencetrimout",aT);aG.width(aU.x-aW);var aL={trimIn:aC,trimOut:aV,sequenceTrimIn:aS,sequenceTrimOut:aT};var aA=PLAYER.operateJson.getCutOldEffectClip(aH,aC,aV);PLAYER.operateJson.updateClipAttr(aL,aH,aA)}}function a(aw){var ay=aw.target;var av=parseInt(ay.position().left);var au=parseInt(ay.outerWidth());var ax=ay.parent(".time_ruler_bar").offset().left;var at=aw.x;var az=at-ax-av;if(PLAYER.keyNum===85){ay.css({cursor:"url(images/cur/cut.cur),default"})}else{if(PLAYER.keyNum===71){ay.css({cursor:"url(images/cur/select_back.cur),default"})}else{if(PLAYER.keyNum===7100){ay.css({cursor:"url(images/cur/select_pre.cur),default"})}else{if(PLAYER.keyNum===187){ay.css({cursor:"url(images/cur/zoom_plus.cur),default"})}else{if(PLAYER.keyNum===189){ay.css({cursor:"url(images/cur/zoom_minus.cur),default"})}else{if(Math.abs(ax+av-at)<=8){ay.css({cursor:"url(images/cur/cursor1.cur),default"})}else{if(Math.abs(ax+av+au-at)<=8){ay.css({cursor:"url(images/cur/cursor2.cur),default"})}else{ay.css({cursor:"default"})}}}}}}}}function ao(aJ){var aL=y.config;var aA=y.targetObj;var aE=aJ.target.children().length;if(aE!==0){if($(".space").size()!==0){$(".space").remove()}var at=aJ.x-aJ.target.parent().offset().left;var au=parseInt(at*aL.framePerPixel)/aL.framePerPixel;var aN=Math.round(au*aL.framePerPixel);var az=[];var aB=[];var aF=[];var av=[];var aC;var aw;var aI=$('<div class="space"></div>');$.each(aJ.target.children(".edit_box"),function(aO,aP){if(parseInt($(aP).attr("data-sequencetrimin"))>aN){aB.push(parseInt($(aP).attr("data-sequencetrimin")))}if($(aP).attr("data-sequencetrimout")<aN){az.push(parseInt($(aP).attr("data-sequencetrimout")))}});if(aB.length===0){return false}if(az.length===0){az.push(0)}aC=Math.min.apply(null,aB);aw=Math.max.apply(null,az);var ay=aJ.target.children('.edit_box[data-sequencetrimin="'+aC+'"]');var aK=aJ.target.children('.edit_box[data-sequencetrimout="'+aw+'"]');aI.attr("data-sequencetrimin",aw);aI.attr("data-sequencetrimout",aC);aI.css("left",aw/aL.framePerPixel);aI.css("width",(aC-aw)/aL.framePerPixel);aI.insertBefore(ay);if(ay.attr("data-interleaved")==="true"){var aG=PLAYER.operateJson.chooseInterleavedElem(ay);av.push(parseInt(aG.attr("data-sequencetrimin")));if(parseInt(aG.siblings().attr("data-sequencetrimout"))<=parseInt(aG.attr("data-sequencetrimin"))){aF.push(parseInt(aG.siblings().attr("data-sequencetrimout")))}}var ax;var aH;if(aF.length===0){ax=0}else{ax=Math.max.apply(null,aF)}if(av.length===0){return false}else{aH=Math.min.apply(null,av)}var aM=aH-ax;var aD=aC-aw;if(aD>=aM){aI.attr("data-offset",aM)}}}function ah(ax){var av=y.config;var aw=y.targetObj;var ay=ax.target;ay.toggleClass("onEffect");if(ay.attr("data-pos")==="footer-middle"){var az=parseInt(ay.parent().attr("data-sequencetrimout"));var at=PLAYER.operateJson.checkNextSubClip(az);at.children(".effect_box_l").toggleClass("onEffect")}if(ay.attr("data-pos")==="header-middle"){var au=parseInt(ay.parent().attr("data-sequencetrimin"));var at=PLAYER.operateJson.checkPrevSubClip(au);at.children(".effect_box_r").toggleClass("onEffect")}}function A(aA){PLAYER.hideSubititleEdit();var au=y.config;var ay=y.targetObj;var ax=aA.target;var av=ax.attr("data-time");var aB=parseInt(ax.attr("data-sequencetrimin"));var aw=parseInt(ax.parent().attr("data-index"));var az=ax.parent().attr("data-type");var at=JSON.parse(PLAYER.operateJson.getSubtitleClip(av,aw));PLAYER.showSubititleEdit();ap(at);aj(at,at.id,az);ac(at,av,aw,az,"subtitle");if(ax.hasClass&&ax.hasClass("draggable")){PLAYER.operateJson.mouseUpState(ax)}}function ap(at){$("#js_subtitle_h_form").empty();var ay=at.id;var ax;ax=$('<div class="form-group">'+'<label class="col-md-4 control-label" for="fontsize">左边距</label>'+'<div class="col-md-8">'+'<input type="range" class="form-control" id="js_subtitle_left" step="0.5">'+"</div>"+"</div>"+'<div class="form-group">'+'<label class="col-md-4 control-label" for="name" ></label>'+'<div class="col-md-8">'+'<input type="text" class="form-control" id="js_subtitle_left_value" disabled="disabled">'+"</div>"+"</div>"+'<div class="form-group">'+'<label class="col-md-4 control-label" for="fontsize">上边距</label>'+'<div class="col-md-8">'+'<input type="range" class="form-control" id="js_subtitle_top" step="0.5">'+"</div>"+"</div>"+'<div class="form-group">'+'<label class="col-md-4 control-label" for="name" ></label>'+'<div class="col-md-8">'+'<input type="text" class="form-control" id="js_subtitle_top_value" disabled="disabled">'+"</div>"+"</div>");
$("#js_subtitle_h_form").append(ax);var aw=at.pixel.filter(function(az){return az.attr.type!=="images"});var au=at.pixel.filter(function(az){return az.attr.type==="images"});$.each(aw,function(aC,aD){var aA=$('<div class="form-group">'+'<label class="col-md-4 control-label" for="name" >字体'+(aC+1)+"</label>"+'<div class="col-md-8">'+'<input type="text" class="form-control subtitle_text" id="js_subtitle_text'+(aC+1)+'" placeholder="字体'+(aC+1)+'" data-id="'+aD.attrID+'">'+"</div>"+"</div>");var az=$('<div class="form-group">'+'<label class="col-md-4 control-label" for="fontcolor">字体'+(aC+1)+"颜色</label>"+'<div class="col-md-8">'+'<input type="text" class="form-control subtitle_color" id="js_subtitle_color'+(aC+1)+'" data-control="hue" value="#ffffff" data-id="'+aD.attrID+'">'+"</div>"+"</div>");var aB=$('<div class="form-group">'+'<label class="col-md-4 control-label" for="fontsize">字体'+(aC+1)+"字号</label>"+'<div class="col-md-8">'+'<input type="number" class="form-control subtitle_fontsize" id="js_subtitle_fontsize'+(aC+1)+'" data-id="'+aD.attrID+'">'+"</div>"+"</div>");$("#js_subtitle_h_form").append(aA);$("#js_subtitle_h_form").append(az);$("#js_subtitle_h_form").append(aB)});var av=$('<div class="form-group">'+'<label class="col-md-4 control-label" for="name" ></label>'+'<div class="col-md-8">'+'<button type="button" class="btn btn-sm pull-right" id="js_subtitle_btn">关闭</button>'+"</div>"+"</div>");$("#js_subtitle_h_form").append(av)}function aj(aw,ax,av){var at=aw.pixel.filter(function(ay){return ay.attr.type!=="images"});if($("#js_subtitle_h_form").height()>$(".subtitle_h_form_wrap").height()){$(".subtitle_edit_track").show();var au=new Scrollbar({dirSelector:"y",contSelector:$(".subtitle_h_form_wrap"),barSelector:$(".subtitle_edit_track"),sliderSelector:$(".subtitle_edit_scroll")})}if(ax==="subtitle_01"||ax==="subtitle_02"||ax==="subtitle_03"||ax==="subtitle_05"||ax==="subtitle_06"||ax==="subtitle_07"){$("#js_subtitle_left").attr("max",$("#ocx").width());$("#js_subtitle_top").attr("max",$("#ocx").height());$("#js_subtitle_left").attr("min",0);$("#js_subtitle_top").attr("min",0);$("#js_subtitle_left,#js_subtitle_left_value").val(aw.abs.left_value);$("#js_subtitle_top,#js_subtitle_top_value").val(aw.abs.top_value);$("#js_subtitle_text1").val(at[0].attr.text);$("#js_subtitle_text2").val(at[1].attr.text);$("#js_subtitle_fontsize1").val(at[0].attr.fontSize);$("#js_subtitle_fontsize2").val(at[1].attr.fontSize);$("#js_subtitle_color1").val(at[0].attr.fillStyle);$("#js_subtitle_color2").val(at[1].attr.fillStyle);$("#js_subtitle_color1").minicolors({control:$(this).attr("data-control")||"hue",defaultValue:$(this).attr("data-defaultValue")||"",inline:$(this).attr("data-inline")==="true",letterCase:$(this).attr("data-letterCase")||"lowercase",opacity:$(this).attr("data-opacity"),position:$(this).attr("data-position")||"bottom left",change:function(az,ay){if(!az){return}if(ay){az+=", "+ay}try{$("#js_subtitle_color1").val(az)}catch(aA){console.log(aA)}},theme:"bootstrap"});$("#js_subtitle_color2").minicolors({control:$(this).attr("data-control")||"hue",defaultValue:$(this).attr("data-defaultValue")||"",inline:$(this).attr("data-inline")==="true",letterCase:$(this).attr("data-letterCase")||"lowercase",opacity:$(this).attr("data-opacity"),position:$(this).attr("data-position")||"bottom left",change:function(az,ay){if(!az){return}if(ay){az+=", "+ay}try{$("#js_subtitle_color2").val(az)}catch(aA){console.log(aA)}},theme:"bootstrap"})}}function ac(aA,aw,aC,aE,ay){var aD=JSON.stringify(aA.pixel);var aF=JSON.parse(JSON.stringify(aA.pixel));var ax=[];var av=[];for(var az=0;az<aF.length;az++){ax[az]=aF[az].x1-JSON.parse(JSON.stringify(aA.abs.left_value))}for(var az=0;az<aF.length;az++){av[az]=aF[az].y1-JSON.parse(JSON.stringify(aA.abs.top_value))}var aH={trackType:aE,trackIndex:aC,subClipId:aw,name:ay,attr:JSON.parse(aD)};var aG=[];$("#js_subtitle_left")[0].oninput=function(aJ){$("#js_subtitle_left_value").val($(aJ.target).val());for(var aI=0;aI<aH.attr.length;aI++){aH.attr[aI].x1=ax[aI]+parseInt($(aJ.target).val())}au(aH)};$("#js_subtitle_top")[0].oninput=function(aJ){$("#js_subtitle_top_value").val($(aJ.target).val());for(var aI=0;aI<aH.attr.length;aI++){aH.attr[aI].y1=av[aI]+parseInt($(aJ.target).val())}au(aH)};function aB(aJ){for(var aI=0;aI<aH.attr.length;aI++){aH.attr[aI].x1+=parseInt($(e.target).val())-initL}}$("#js_subtitle_h_form .subtitle_text").on("change",function(aJ){var aK=$(aJ.target).attr("data-id");var aI={text:$(aJ.target).val()};at(aH,aK,aI);au(aH)});$("#js_subtitle_h_form .subtitle_color").on("change",function(aJ){var aK=$(aJ.target).attr("data-id");var aI={fillStyle:$(aJ.target).val()};at(aH,aK,aI);au(aH)});$("#js_subtitle_h_form .subtitle_fontsize").on("change",function(aJ){var aK=$(aJ.target).attr("data-id");var aI={fontSize:$(aJ.target).val()};at(aH,aK,aI);au(aH)});$("#js_subtitle_btn").on("click",function(aI){PLAYER.hideSubititleEdit()});function at(aK,aJ,aI){$.each(aK.attr,function(aL,aM){if(aM.attrID===aJ){$.extend(aM.attr,aI)
}})}function au(aK){PLAYER.OCX.adjustEffect(aK);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime));var aI=parseInt($("#js_subtitle_left_value").val());var aJ=parseInt($("#js_subtitle_top_value").val());PLAYER.operateJson.updateSubtitleClip(aK,aI,aJ)}}function f(at){}function H(at){$("#js_volume_form_name").val("200");$("#js_volume_form_range").mouseup(function(au){$("#js_volume_form_name").val($("#js_volume_form_range").val())});$("#js_volume_save").on("click",function(){var ax=parseInt($("#js_volume_form_name").val());var av=PLAYER.operateJson.getAudioIndex(parseInt(at.attr("data-time")));var au={"type":1,"trackIndex":1,"subClipIndex":av,"volume":ax};var aw=PLAYER.OCX.coverStationLogo(au);if(aw===0){console.log("声音成功");$("#js_createVolumeModal").hide();$("#js_pageCover").hide()}});$("#js_volume_cancel").on("click",function(){$("#js_createVolumeModal").hide();$("#js_pageCover").hide()});$("#js_createVolumeModal .icojam_delete").on("click",function(){$("#js_createVolumeModal").hide();$("#js_pageCover").hide()})}function X(aV){var aX=y.config;var aG=y.targetObj;var aS=aX.$sliderBar.width();var aO=aX.$sliderBar.position().left;var ax=Math.abs(parseFloat(aX.$rulerWrap.css("marginLeft")));var aw=aX.framePerPixel;var a1=aV.code;var au=[];var aL=0;var aA=0;var aK=0;var at=0;var aP=0;var aD=0;var aF=null;var aW=0;if(a1===189){if(aS===aX.$headerRight.width()){return}Y(10,aw,aS,aO,ax)}else{if(a1===187){if(aS===(2*o+8)){return}Y(-10,aw,aS,aO,ax)}else{if(a1===46||a1===8){a1=0;aV.returnValue=false;PLAYER.checkPlaying();if(!aV.target.hasClass("form-control")){if($("#js_time_ruler_bar_box .onselected").length>0){$.each($(".onselected"),function(a8,a4){var a6=$(a4).attr("data-time");var a3=parseInt($(a4).attr("data-sequencetrimin"));var a5=parseInt($(a4).attr("data-sequencetrimout"));if($(a4).find(".effect_box_r").length>=1&&PLAYER.operateJson.checkNextSubClip(a5)){var a7=PLAYER.operateJson.checkNextSubClip(a5).attr("data-time");var a9=$('.edit_box_v[data-time="'+a7+'"]').find(".effect_box_l").attr("data-type");var ba=$('.edit_box_v[data-time="'+a7+'"]').find(".effect_box_l").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(a7,a9,ba);$('.edit_box_v[data-time="'+a7+'"]').find(".effect_box_l").remove()}if($(a4).find(".effect_box_l").length>=1&&PLAYER.operateJson.checkPrevSubClip(a3)){var a2=PLAYER.operateJson.checkPrevSubClip(a3).attr("data-time");var a9=$('.edit_box_v[data-time="'+a2+'"]').find(".effect_box_r").attr("data-type");var ba=$('.edit_box_v[data-time="'+a2+'"]').find(".effect_box_r").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(a2,a9,ba);$('.edit_box_v[data-time="'+a2+'"]').find(".effect_box_r").remove()}PLAYER.operateJson.deleteClipAttr(a6);$(a4).remove()});PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]);PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(y.currTime));PLAYER.PTR.config.maxTime=(PLAYER.operateJson.getLastFrame()||1000);$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||0));PLAYER.PTR.updateEvent(PLAYER.PTR.config)}if($("#js_time_ruler_bar_box .space").length>0){var aX=y.config;var aG=y.targetObj;var az=$(".space").siblings(".draggable");var aY=parseInt($(".space").attr("data-sequencetrimin"));var av;var aU=0;var a0=0;var aZ=0;var aQ=0;if($(".space").attr("data-offset")){av=parseInt($(".space").attr("data-offset"))}else{av=parseInt($(".space").attr("data-sequencetrimout"))-parseInt($(".space").attr("data-sequencetrimin"))}$.each(az,function(a2,a4){if($(a4).attr("data-sequencetrimin")>=aY){aN($(a4));if($(a4).attr("data-interleaved")==="true"){var a3=PLAYER.operateJson.chooseInterleavedElem($(a4));aN(a3)}}});function aN(a3){var a2=a3.attr("data-time");aU=parseInt(a3.attr("data-sequencetrimin"));a0=parseInt(a3.attr("data-sequencetrimout"));console.log("spaceFrame",av);console.log("v0_sequencetrimin",aU);aZ=aU-av;aQ=a0-av;a3.attr("data-sequencetrimin",aZ);a3.attr("data-sequencetrimout",aQ);a3.css("left",aZ/aX.framePerPixel);aF={"sequenceTrimIn":aZ,"sequenceTrimOut":aQ};PLAYER.operateJson.updateClipAttr(aF,a2)}$(".space").remove();PLAYER.operateJson.sendJson()}if($("#js_time_ruler_bar_box .onEffect").length>0){$.each($(".onEffect"),function(a4,a6){var a5=$(a6).parent(".edit_box_v").attr("data-time");var a3=$(a6).attr("data-type");var a2=$(a6).attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(a5,a3,a2);$(a6).remove()});PLAYER.operateJson.sendJson()}}}else{if(aV.ctrl&&a1===65){if($("#js_time_ruler_bar_box").find(".draggable").length!==0){$("#js_time_ruler_bar_box").find(".draggable").addClass("onselected")}}else{if(aV.ctrl&&a1===17){PLAYER.keyNum=17}else{if(aV.ctrl&&a1===67){PLAYER.copyOrcut="copy"}else{if(aV.ctrl&&a1===88){PLAYER.checkPlaying();PLAYER.copyOrcut="cut";var aE=[];$.each($(".onselected"),function(a2,a4){aE.push(parseInt($(this).attr("data-sequencetrimin")));PLAYER.clipboard.push($(this));PLAYER.clipboard.parent.push($(this).parent(".time_ruler_bar"));$(a4).remove();var a3=$(a4).attr("data-time");
PLAYER.operateJson.deleteClipAttr(a3)});PLAYER.cut_min_sIn=Math.min.apply(null,aE);PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]);PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(y.currTime));PLAYER.PTR.config.maxTime=(PLAYER.operateJson.getLastFrame()||1000);$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||0));PLAYER.PTR.updateEvent(PLAYER.PTR.config)}else{if(aV.ctrl&&a1===86&&PLAYER.copyOrcut==="copy"){PLAYER.checkPlaying();var aX=y.config;var aG=y.targetObj;var aY=y.currTime;var aT="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);var aE=[];var aH;$(".onselected").each(function(a2,a3){aE.push(parseInt($(a3).attr("data-sequencetrimin")))});aH=Math.min.apply(null,aE);$(".onselected").each(function(a2,a3){aM($(a3),$(a3).parent(".time_ruler_bar"),aT,aH)});PLAYER.operateJson.sendJson()}else{if(aV.ctrl&&a1===86&&PLAYER.copyOrcut==="cut"){PLAYER.checkPlaying();var aX=y.config;var aG=y.targetObj;var aY=y.currTime;var aT="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);if(PLAYER.clipboard){for(var aR=0;aR<PLAYER.clipboard.length;aR++){aM(PLAYER.clipboard[aR],PLAYER.clipboard.parent[aR],aT,PLAYER.cut_min_sIn)}PLAYER.operateJson.sendJson()}PLAYER.clipboard=[];PLAYER.clipboard.parent=[]}else{if(aV.ctrl&&a1===90){if((PLAYER.goBackJson.length-1)<=0){$(".time_ruler_bar").empty();PLAYER.goBackJson=[];$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(a3,a4){var a2={type:$(a4).attr("data-type"),index:parseInt($(a4).attr("data-index")),subclip:[]};PLAYER.jsonObj.rootBin.sequence[0].tracks.push(a2)});if(PLAYER.operateJson.checkNoClip()){PLAYER.OCX.clearWindow()}return false}else{var aI=PLAYER.goBackJson[PLAYER.goBackJson.length-2];PLAYER.jsonObj.rootBin.sequence[0]=JSON.parse(aI);$(".time_ruler_bar").empty();for(var aR=0;aR<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;aR++){var aJ=PLAYER.jsonObj.rootBin.sequence[0].tracks[aR];var ay=aJ.type;var aC=aJ.index;if(aJ.subclip.length===0){PLAYER.operateJson.emptyTrack(ay,aC)}else{var aB=PLAYER.operateJson.getTrack(ay,aC);$.each(aJ.subclip,function(a9,a6){var a7;var a4;var bd=a6.assetID;var a3=a6.id;if(bd){PLAYER.operateJson.getMaterialDuration(bd,function(bf){a7=bf.duration;a4=bf.name})}if(a3){PLAYER.operateJson.getSubtitleDuration(a3,function(bf){a7=bf.duration;a4=bf.name})}var a2=(a6.trimOut-a6.trimIn)/PLAYER.TR.config.framePerPixel;var be=a6.sequenceTrimIn/PLAYER.TR.config.framePerPixel;var a5=$('<div class="edit_box draggable" data-trimin="'+a6.trimIn+'" data-trimout="'+a6.trimOut+'" data-sequencetrimin="'+a6.sequenceTrimIn+'" data-sequencetrimout="'+a6.sequenceTrimOut+'">'+a4+"</div>");a5.attr("data-duration",a7||2000);a5.attr("data-name",a4);a5.attr("data-id",a6.assetID||a6.id);a5.attr("data-type",a6.type);a5.attr("data-interleaved",a6.interleaved);a5.attr("data-time",a6.createTime);a5.attr("data-intid",a6.interleaved_id);a5.css("width",a2);a5.css("left",be);var bb="edit_box_"+aB.attr("data-type");a5.addClass(bb);if(a6.effect&&a6.effect.length!==0){var ba;var a8;var bc;$.each(a6.effect,function(bf,bg){a8=$('<div class="effect_box"></div>');a8.attr("data-duration",bg.duration);a8.attr("data-trimin",bg.trimIn);a8.attr("data-trimout",bg.trimOut);a8.attr("data-pos",bg.pos);a8.attr("data-type",bg.type);bc=(bg.trimOut-bg.trimIn)/PLAYER.TR.config.framePerPixel;a8.width(bc);if(bg.type==="mosaic"){a8.addClass("effect_box_all")}else{if(bg.trimOut===a6.trimOut){a8.addClass("effect_box_r")}else{if(bg.trimIn===a6.trimIn){a8.addClass("effect_box_l")}}}a5.append(a8)})}aB.append(a5)});$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()));PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame();PLAYER.PTR.updateEvent(PLAYER.PTR.config)}}PLAYER.goBackJson.pop();PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);console.log("PLAYER.jsonObj",PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime))}}}}}}}}}}}function aM(a6,bd,bi,ba){var be;var bb,a2,a8,bm,bg,bj,bk,a3,bl;var bp,bf,a4,bo;v_initId=a6.attr("data-intid");intId=v_initId+1;a2=a6.attr("data-id");a8=a6.attr("data-type");bm=a6.attr("data-interleaved");bg=parseInt(bd.attr("data-index"));var bn=a8+"_"+PLAYER.genNonDuplicateID(12);a3=parseInt(a6.attr("data-trimin"));bl=parseInt(a6.attr("data-trimout"));bj=parseInt(a6.attr("data-sequencetrimin"));bk=parseInt(a6.attr("data-sequencetrimout"));a4=a3;bo=bl;bp=bj-ba+aY;bf=bp+bl-a3;be=a6.clone();be.css("left",bp/aX.framePerPixel);be.attr("data-sequencetrimin",bp);be.attr("data-sequencetrimout",bf);be.attr("data-time",bn);be.attr("data-intid",intId);bd.append(be);PLAYER.operateJson.checkCoverEvent(be,bi);if(bd.hasClass("bar_v")){var a7=a6.attr("data-time");var bc=JSON.parse(PLAYER.operateJson.getEffectClip(a7));if(bc&&bc.length!==0){$.each(bc,function(bq,br){if($(this).pos==="all"){$(this).trimIn=a4;$(this).trimOut=bo}})}else{bc=[]}bb={"assetID":a2,"trimIn":a4,"trimOut":bo,"sequenceTrimIn":bp,"sequenceTrimOut":bf,"effect":bc,"createTime":bn,"type":a8};
if(bm==="true"){bb.interleaved=true;bb.interleaved_id=intId}else{bb.interleaved=false;var bh="interleaved_id_"+PLAYER.genNonDuplicateID(12);bb.interleaved_id=bh}PLAYER.operateJson.addVideoClipAttr(bb,bg)}else{if(bd.hasClass("bar_a")){bb={"assetID":a2,"trimIn":a4,"trimOut":bo,"sequenceTrimIn":bp,"sequenceTrimOut":bf,"volume":100,"createTime":bn,"type":a8,"interleaved_id":intId};if(bm==="true"){bb.interleaved=true;bb.interleaved_id=intId}else{bb.interleaved=false;var bh="interleaved_id_"+PLAYER.genNonDuplicateID(12);bb.interleaved_id=bh}PLAYER.operateJson.addAudioClipAttr(bb,bg)}else{if(bd.hasClass("bar_t")){add_subclip.css("background","pink");var a5=JSON.parse(PLAYER.subtitleAttr[a2]);var bh="interleaved_id_"+PLAYER.genNonDuplicateID(12);var a9={"trimIn":a4,"trimOut":bo,"sequenceTrimIn":bp,"sequenceTrimOut":bf,"createTime":bn,"type":a8,"interleaved_id":bh};$.extend(a5,a9);PLAYER.operateJson.addSubtitleClipAttr(a5,bg)}}}}}function h(az){var az=PLAYER.EventUtil.getEvent(az);PLAYER.EventUtil.preventDefault(az);var aw=y.config;var ax=y.targetObj;var av=aw.$sliderBar.width();var au=aw.$sliderBar.position().left;var at=Math.abs(parseFloat(aw.$rulerWrap.css("marginLeft")));var ay=aw.framePerPixel;if(PLAYER.keyNum===187){$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_zoom_plus").addClass("active");if(av===(2*o+8)){return}Y(-10,ay,av,au,at)}if(PLAYER.keyNum===189){$(".time_ruler_toolbar").children("span").removeClass("active");$("#js_toolbar_zoom_minus").addClass("active");if(av===aw.$headerRight.width()){return}Y(10,ay,av,au,at)}}function x(aw){var av=y.targetObj;var au=y.config;var ax=parseFloat(au.$sliderBar.position().left);var at=2;T=parseFloat(au.$sliderTrack.width()-au.$sliderBar.width());d=parseFloat(au.$rulerWrap.width()-au.$headerRight.width());if(Math.floor(au.$sliderBar.width())===Math.floor(au.$sliderTrack.width())){return false}if(aw.wheelDelta===-120){n=ax+at;if(n>=T){n=T;ag=d}else{ag=n*d/T}au.$sliderBar.css("left",n);au.$rulerWrap.css("margin-left",-ag);au.$ruler.css("left",ag);au.$clipTrackBar.css("margin-left",-ag);am(ag);return false}else{if(aw.wheelDelta===120){n=ax-at;if(n<=0){n=0;ag=0}else{ag=n*d/T}au.$sliderBar.css("left",n);au.$rulerWrap.css("margin-left",-ag);au.$ruler.css("left",ag);au.$clipTrackBar.css("margin-left",-ag);am(ag);return false}}return false}function L(){var at=y.config;at.$trimIn.addEventListener=function(av,ax){if(av=="mousemove"){at.$trimIn.mousedown(function(ay){ay.stopPropagation();an=ay.clientX;m=J;document.onmousemove=aw;document.onmouseup=au});function aw(ay){F(ay.clientX,ay.clientY,ax)}function au(){this.onmousemove=null}}};at.$trimOut.addEventListener=function(av,ax){if(av=="mousemove"){at.$trimOut.mousedown(function(ay){ay.stopPropagation();an=ay.clientX;b=M;document.onmousemove=aw;document.onmouseup=au});function aw(ay){j(ay.clientX,ay.clientY,ax)}function au(){this.onmousemove=null}}}}function F(aw,au,aA){var av=y.targetObj;var at=y.config;if(aw<$("."+av).offset().left){aw=$("."+av).offset().left}var az=aw-an;if(m+az>M-3){return}if(m+az<0){J=0}else{J=m+az}J=parseInt(J*at.framePerPixel)/at.framePerPixel;y.trimInCurrTime=Math.round(J*at.framePerPixel);var ay=M-J;at.$trimInOut.css("left",J);at.$trimInOut.css("width",ay);if(aA!=null){var ax=y.trimInCurrTime;aA(ax)}}function j(aw,au,aA){var av=y.targetObj;var at=y.config;if(aw<at.$headerRight.offset().left){aw=at.$headerRight.offset().left}var az=aw-an;if(b+az<J+3){return}if(b+az>at.maxTime*at.perMsecWidth){M=at.maxTime*at.perMsecWidth}else{M=b+az}M=parseInt(M*at.framePerPixel)/at.framePerPixel;y.trimOutCurrTime=Math.round(M*at.framePerPixel);var ay=M-J;at.$trimInOut.css("width",ay);if(aA!=null){var ax=y.trimOutCurrTime;aA(ax)}}function aa(at){y.trimInCurrTime=at;PLAYER.PTR.trimInCurrTime=at;PLAYER.PTR.fixTrimInByCurrentTime(at)}function ak(at){y.trimOutCurrTime=at;PLAYER.PTR.trimOutCurrTime=at;PLAYER.PTR.fixTrimOutByCurrentTime(at)}function z(){var ay=y.targetObj;var av=y.config;var aC;var at;var aA;var au;var aD;var aB;var az;var aw;var ax;av.$sliderBarLeft.mousedown(function(aE){var aE=aE||window.event;av.$sliderBarMiddle.addClass("now");au=aE.clientX;at=av.$sliderBar.width();aC=parseInt(av.$sliderBar.position().left);aD=Math.abs(parseInt(av.$rulerWrap.css("marginLeft")));aw=av.framePerPixel;$(document)[0].onmousemove=function(aF){var aF=aF||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var aG;aF.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});diff_move=au-aF.clientX;Y(diff_move,aw,at,aC,aD)};$(document)[0].onmouseup=function(aF){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});av.$sliderBarRight.mousedown(function(aE){var aE=aE||window.event;av.$sliderBarMiddle.addClass("now");au=aE.clientX;at=av.$sliderBar.width();aC=parseInt(av.$sliderBar.position().left);aD=Math.abs(parseInt(av.$rulerWrap.css("marginLeft")));aw=av.framePerPixel;$(document)[0].onmousemove=function(aF){var aF=aF||window.event;
window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var aG;aF.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});diff_move=aF.clientX-au;Y(diff_move,aw,at,aC,aD)};$(document)[0].onmouseup=function(aF){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});av.$sliderBarMiddle.mousedown(function(aE){var aE=aE||window.event;av.$sliderBarMiddle.addClass("now");au=aE.clientX;at=av.$sliderBar.width();aC=parseInt(av.$sliderBar.position().left);$(document)[0].onmousemove=function(aF){$("body").css({cursor:"move"});aA=aF.clientX-au;n=aC+aA;O=at;if(n<0){n=0}if(n>T){n=T}av.$sliderBar.css("left",n);av.$sliderBarMiddle.addClass("now");if(O!=av.$sliderTrack.width()){T=parseInt(av.$sliderTrack.width()-O);d=parseInt(av.$rulerWrap.width()-ae);ag=Math.floor(parseInt(d*n/T))}else{ag=0}av.$rulerWrap.css("margin-left",parseInt(-ag));av.$ruler.css("left",ag);av.$clipTrackBar.css("margin-left",parseInt(-ag));av.$line.css("margin-left",parseInt(-ag)+1);am(ag);return false};$(document)[0].onmouseup=function(aF){av.$sliderBarMiddle.removeClass("now");$("body").css({cursor:"default"});$(document)[0].onmousemove=null}})}function Y(aD,av,at,aA,aB){var au=y.config;var az=y.targetObj;var ax=(au.$headerRight.width()/2);var aw;var ay;if(aD>0){if(au.max_fpp===av){ay=0}else{aw=(au.$sliderTrack.width()-at)/((au.max_fpp/av)-1);ay=aD/aw}n=aA-aD;O=at+2*aD;au.framePerPixel=av*(ay+1);if(n<=0){n=0}if(aA+at+aD>=au.$headerRight.width()){n=aA-aD;O=au.$sliderTrack.width()-n}if(O>=au.$sliderTrack.width()){O=au.$sliderTrack.width();au.framePerPixel=au.maxTime/au.$headerRight.width()}af(au.framePerPixel)}else{if(aD<0){if(au.min_fpp===av){ay=0}else{aw=(at-(2*o+8))/((av/au.min_fpp)-1);ay=aD/aw}n=aA-aD;O=at+2*aD;au.framePerPixel=av/(-ay+1);if(O<=(2*o+8)){O=(2*o+8);ay=0;n=aA-((2*o+8)-at/2);au.framePerPixel=au.min_fpp}af(au.framePerPixel)}else{au.framePerPixel=av;af(au.framePerPixel)}}var ax=Math.floor(au.$headerRight.width()/2);var aC=S(au.framePerPixel);ab(aC.smallScaleFrame,aC.smallScaleNumsPerLargeScale,au.framePerPixel);N=Math.floor(au.maxTime/au.framePerPixel);if(N<=au.$headerRight.width()){N=au.$headerRight.width()}T=parseInt(au.$sliderTrack.width()-O);d=parseInt(N-au.$headerRight.width());if(y.currTime!=0){U=Math.floor(parseInt(y.currTime/au.framePerPixel));ag=U-ax;n=ag*T/d;if(n>=T){n=T;ag=d}if(isNaN(n)){ag=0;n=0}}else{ag=Math.floor(d*n/T)}if(isNaN(ag)||ag<=0){ag=0;n=0}au.$sliderBar.css("width",O);au.$sliderBar.css("left",n);au.$sliderBarMiddle.css("width",O-2*o);au.$sliderBarRight.css("left",O-o);au.$rulerWrap.css("margin-left",-ag);au.$rulerWrap.css("width",N);au.$ruler.css("left",ag);au.$clipTrackBar.css("margin-left",-ag);au.$line.css("margin-left",parseInt(-ag)+1);am(ag);y.fixArrowCurrentTime(y.currTime);y.fixTrimInByCurrentTime(y.trimInCurrTime);y.fixTrimOutByCurrentTime(y.trimOutCurrTime);y.fixClipWidth()}function af(au){var ax=y.config;var ay=y.targetObj;var aw=25*60*60*10/80;var at=ax.maxTime/$("."+y.targetObj).width();var av=Math.min(aw,at);if(au<ax.min_fpp){au=ax.min_fpp}else{if(au>av){au=av}}}function ab(av,aw,at){var au=y.config;au.smallScaleFrame=av;au.smallScaleNumsPerLargeScale=aw;au.framePerPixel=at;y.updateRuler(au)}return i}();PLAYER.timeRuler2=function(){var h=0;var a=0;var w=0;var z=0;var Q=0;var F=0;var i=0;var B;var E;var c;var d=0;var j=0;var k=0;var N=0;var A=0;var L;var q=this;var G=[{smallScaleFrame:1,smallScaleNumsPerLargeScale:1},{smallScaleFrame:1,smallScaleNumsPerLargeScale:2},{smallScaleFrame:1,smallScaleNumsPerLargeScale:5},{smallScaleFrame:1,smallScaleNumsPerLargeScale:10},{smallScaleFrame:5,smallScaleNumsPerLargeScale:5},{smallScaleFrame:5,smallScaleNumsPerLargeScale:10},{smallScaleFrame:10,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*6,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*12,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*30,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*6,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*30,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25*60*60,smallScaleNumsPerLargeScale:10}];var R={hasTrack:true,maxTime:1000,min_largeScaleWidth:80,framePerPixel:0,max_fpp:0,min_fpp:0.125,smallScaleNumsPerLargeScale:10,smallScaleFrame:0,smallScaleWidth:0,largeScaleWidth:0,largeScaleMillisecondInterval:0,seekComandTimesMonitor:[],largeScaleHeight:20,smallScaleHeight:12.5,backgroundColor:"#262626",rulerHeight:35,trimHeight:45,scaleColor:"#929293",fontColor:"#929293",fontSize:12,fontFamily:"微软雅黑",$header:null,$ruler:null,$cursor:null,$trimInOut:null,$trimIn:null,$trimOut:null,$sliderTrack:null,$sliderBar:null,$sliderBarLeft:null,$sliderBarMiddle:null,$sliderBarRight:null,targetObj:"player_time_ruler"};function f(S){q=this;q.config=$.extend(R,S);q.targetObj=q.config.targetObj;
q.trimInCurrTime=0;q.trimOutCurrTime=0;q.currTime=0;L=$("."+this.targetObj).width();b();t();this.config.$container.addEventListener("mousedown",s);this.config.$container.addEventListener("mousemove",o);this.config.$trimIn.addEventListener("mousemove",J);this.config.$trimOut.addEventListener("mousemove",O);this.DragDrop.addHandler("mousewheel",p);this.DragDrop.addHandler("keydown",H);window.addEventListener("resize",l)}f.prototype={updateRuler:function(U){var S=q.config;var T=q.targetObj;S.framePerPixel=U.framePerPixel;S.smallScaleFrame=U.smallScaleFrame;S.smallScaleNumsPerLargeScale=U.smallScaleNumsPerLargeScale;S.smallScaleWidth=S.smallScaleFrame/S.framePerPixel;S.largeScaleWidth=S.smallScaleWidth*S.smallScaleNumsPerLargeScale;S.largeScaleMillisecondInterval=S.smallScaleFrame*S.smallScaleNumsPerLargeScale*40;S.max_fpp=Math.min(S.maxTime/$("."+q.targetObj).width(),25*60*60*10/80)},updateEvent:function(U,W){var S=$.extend(q.config,U);var T=q.targetObj;S.max_fpp=Math.min(S.maxTime/$("."+q.targetObj).width(),25*60*60*10/80);B=parseInt(S.$sliderTrack.width());A=$("."+q.targetObj).width();S.framePerPixel=S.maxTime/A;var V=D(S.framePerPixel);K(V.smallScaleFrame,V.smallScaleNumsPerLargeScale,S.framePerPixel);S.$container.width(A);S.$sliderBar.css("width",B);S.$sliderBar.css("left",0);S.$sliderBarMiddle.css("width",B-2*j);S.$sliderBarMiddle.css("left",j);S.$sliderBarLeft.css("left",0);S.$sliderBarRight.css("left",B-j);q.fixArrowCurrentTime(q.currTime);q.fixTrimInByCurrentTime(q.trimInCurrTime);q.fixTrimOutByCurrentTime(q.trimOutCurrTime);P(0)},fixArrowCurrentTime:function(V){var T=this.config;var U=this.targetObj;F=V/T.framePerPixel;var W=Math.abs(parseFloat(T.$container.css("margin-left")));var S=$("."+U).width();if(F<=0){F=0}if(F>=T.$container.width()){F=T.$container.width()}if(F-W>S){N=F-S;E=parseFloat(T.$sliderTrack.width()-T.$sliderBar.width());c=parseFloat(T.$container.width()-S);i=N*E/c;T.$sliderBar.css("left",i);T.$container.css("margin-left",-N);T.$ruler.css("left",N);P(N);T.$sliderBar.css("left",i);T.$container.css("margin-left",-N);T.$ruler.css("left",N);P(N)}if(F<W){N=F;i=N*T.$sliderTrack.width()/T.$container.width();T.$sliderBar.css("left",i);T.$container.css("margin-left",-N);T.$ruler.css("left",N);P(N);T.$sliderBar.css("left",i);T.$container.css("margin-left",-N);T.$ruler.css("left",N);P(N)}if(V>=T.maxTime){V=T.maxTime}q.currTime=V;T.$cursor.css("left",F)},fixTrimInByCurrentTime:function(T){var S=this.config;this.trimInCurrTime=T;w=this.trimInCurrTime/S.framePerPixel;z=this.trimOutCurrTime/S.framePerPixel;if(w>z){z=S.maxTime/S.framePerPixel;this.trimOutCurrTime=S.maxTime;z=parseInt(z*S.framePerPixel)/S.framePerPixel}S.$trimInOut.css("left",w);S.$trimInOut.css("width",z+2-w)},fixTrimOutByCurrentTime:function(T){var S=this.config;this.trimOutCurrTime=T;w=this.trimInCurrTime/S.framePerPixel;z=this.trimOutCurrTime/S.framePerPixel;if(z<w){w=0;this.trimInCurrTime=0}S.$trimInOut.css("left",w);S.$trimInOut.css("width",z+2-w)},initTime:function(){var S=this.config;var T=this.targetObj;S.$sliderBar.css("left",0);S.$sliderBarMiddle.css("width",B-d-j);S.$sliderBarMiddle.css("left",d);S.$sliderBarLeft.css("left",0);S.$sliderBarRight.css("left",B-j);S.$container.css("margin-left",0);S.$ruler.css("left",0);P(0);q.fixArrowCurrentTime(0)},moveToNextFrame:function(){PLAYER.keyNum=39;var S=q.config;q.currTime+=1;if(q.currTime>=S.maxTime){q.currTime=S.maxTime}q.fixArrowCurrentTime(q.currTime);q.fixTrimInByCurrentTime(q.trimInCurrTime);q.fixTrimOutByCurrentTime(q.trimOutCurrTime)},moveToPrevFrame:function(){PLAYER.keyNum=37;var S=q.config;q.currTime-=1;if(q.currTime<=0){q.currTime=0}q.fixArrowCurrentTime(q.currTime);q.fixTrimInByCurrentTime(q.trimInCurrTime);q.fixTrimOutByCurrentTime(q.trimOutCurrTime)},DragDrop:function(){var W=new PLAYER.EventTarget(),V=null,U=null,X=null,Y=null;var T=this.targetObj;function S(aa){aa=PLAYER.EventUtil.getEvent(aa);var ac=PLAYER.EventUtil.getTarget(aa);switch(aa.type){case"mousewheel":var Z=$(ac);W.fire({type:"mousewheel",target:Z,wheelDelta:aa.wheelDelta});case"keydown":var ab=$(ac);W.fire({type:"keydown",target:ab,code:aa.keyCode,shift:aa.shiftKey,ctrl:aa.ctrlKey});break}}W.enable=function(){PLAYER.EventUtil.addHandler(document,"mousewheel",S);PLAYER.EventUtil.addHandler(document,"keydown",S)};W.disable=function(){PLAYER.EventUtil.removeHandler(document,"mousewheel",S);PLAYER.EventUtil.removeHandler(document,"keydown",S)};return W}()};function b(){var S=q.config;var T=q.targetObj;S.framePerPixel=S.maxTime/$("."+T).width();S.smallScaleFrame=D(S.framePerPixel).smallScaleFrame;S.smallScaleNumsPerLargeScale=D(S.framePerPixel).smallScaleNumsPerLargeScale;S.smallScaleWidth=S.smallScaleFrame/S.framePerPixel;S.largeScaleWidth=S.smallScaleWidth*S.smallScaleNumsPerLargeScale;S.largeScaleMillisecondInterval=S.smallScaleFrame*S.smallScaleNumsPerLargeScale*40;S.max_fpp=Math.min(S.maxTime/$("."+T).width(),25*60*60*10/80);A=$("."+T).width();m()}function D(U){var T=q.config;var S=[];var W={};for(var V=0;
V<G.length;V++){var X=(G[V].smallScaleFrame*G[V].smallScaleNumsPerLargeScale)/80;if(U<=X){S.push(V)}}W.smallScaleFrame=G[S[0]].smallScaleFrame;W.smallScaleNumsPerLargeScale=G[S[0]].smallScaleNumsPerLargeScale;return W}function m(){var S=q.config;var T=q.targetObj;S.$container=$('<div class="'+T+'_container"></div>');S.$container.css("width",A);S.$container.css("height",S.rulerHeight);S.$ruler=$('<canvas class="'+T+'_canvas"></canvas>');S.$ruler.attr("width",$("."+T).width());S.$ruler.attr("height",S.rulerHeight-2);S.$ruler.css("height",S.rulerHeight-2);S.$ruler.appendTo(S.$container);S.$trimInOut=$('<div class="'+T+'_trimInOut"></div>');S.$trimInOut.css("height",S.trimHeight-2);S.$trimInOut.css("width","0px");S.$trimInOut.appendTo(S.$container);S.$trimIn=$('<div class="'+T+'_trimIn"></div>');S.$trimIn.css("height",S.trimHeight-2);S.$trimIn.appendTo(S.$trimInOut);S.$trimOut=$('<div class="'+T+'_trimOut"></div>');S.$trimOut.css("height",S.trimHeight-2);S.$trimOut.appendTo(S.$trimInOut);S.$cursor=$('<div class="'+T+'_cursor"></div>');S.$cursor.css("height",$("."+T).height()-66);S.$cursor.appendTo(S.$container);var U=$('<div class="'+T+'_cursor_top"></div>');U.appendTo(S.$cursor);S.$container.appendTo($("."+T));S.$sliderTrack=$('<div class="'+T+'_slider_track">');S.$sliderBar=$('<div class="'+T+'_slider_scroll_total">');S.$sliderBarLeft=$('<div class="'+T+'_slider_scroll_left">');S.$sliderBarMiddle=$('<div class="'+T+'_slider_scroll_middle">');S.$sliderBarRight=$('<div class="'+T+'_slider_scroll_right">');S.$sliderBarLeft.appendTo(S.$sliderBar);S.$sliderBarMiddle.appendTo(S.$sliderBar);S.$sliderBarRight.appendTo(S.$sliderBar);S.$sliderBar.appendTo(S.$sliderTrack);S.$sliderTrack.appendTo($("."+T));P(0);x()}function x(){var S=q.config;var T=q.targetObj;var U;d=S.$sliderBarLeft.width();j=S.$sliderBarRight.width();U=($("."+T).width()*S.$sliderTrack.width()/S.$container.width());E=parseInt(S.$sliderTrack.width()-U);c=parseInt(S.$container.width()-$("."+q.targetObj).width());if(U>=S.$sliderTrack.width()){U=S.$sliderTrack.width()}S.$sliderBar.css("width",U);S.$sliderBar.css("left",0);S.$sliderBarMiddle.css("width",U-d-j);S.$sliderBarMiddle.css("left",d);S.$sliderBarLeft.css("left",0);S.$sliderBarRight.css("left",U-j)}function P(Y){var W=q.config;var ab=q.targetObj;Y=parseInt(Y);var ad=$("."+ab).width();W.$ruler.attr("width",ad);var ae=W.$ruler[0].getContext("2d");ae.clearRect(0,0,ad,W.$ruler.height());ae.fillStyle=W.backgroundColor;ae.fillRect(0,0,ad,W.$ruler.height());var U=W.rulerHeight;ae.lineWidth=1;ae.strokeStyle=W.scaleColor;ae.fillStyle=W.fontColor;ae.font=W.fontSize+"px "+W.fontFamily;ae.textAlign="center";ae.beginPath();ae.moveTo(0,U);ae.lineTo(ad,U);var T=parseInt(Y/W.largeScaleWidth)*W.largeScaleMillisecondInterval;var ac=parseInt(Y/W.smallScaleWidth)+1;var X=ac*W.smallScaleWidth-Y;var Z=ac%W.smallScaleNumsPerLargeScale;var V=0;var aa=0;while(V<ad){V=aa*W.smallScaleWidth+0.3+X;if(Z%W.smallScaleNumsPerLargeScale==0){ae.moveTo(V,U-1);ae.lineTo(V,U-W.largeScaleHeight);T+=W.largeScaleMillisecondInterval;var S=PLAYER.$millisecondsToTimeFrame(T);ae.fillText(S,V,U-W.largeScaleHeight-3)}else{ae.moveTo(V,U-1);ae.lineTo(V,U-W.smallScaleHeight)}aa++;Z++}ae.stroke()}function t(){u();y();r()}function l(){var S=q.config;var T=q.targetObj;$("."+q.targetObj).width($("."+q.targetObj).parent().width());q.updateEvent(q.config)}function u(){var S=q.config;S.$container.addEventListener=function(T,U){if(T=="mousedown"){S.$container.mousedown(function(W){W.stopPropagation();C(W.clientX,W.clientY,U);document.onmousemove=X;document.onmouseup=V;function X(Y){C(Y.clientX,Y.clientY,U)}function V(Y){this.onmousemove=null;this.onmouseup=null}})}else{if(T=="click"){e.stopPropagation();if($(this)!=S.$ruler){return}C(e.clientX,e.clientY,U)}else{if(T=="mousemove"){n(S.$cursor,U)}}}}}function n(W,Z){var T,Y,U,V;W.mousedown(function(aa){aa.stopPropagation();aa=aa||event;T=aa.clientX;Y=aa.clientY;U=W.offsetLeft;V=W.offsetTop;this.ondragstart=function(){return false};document.onmousemove=X;document.onmouseup=S});function X(aa){aa=aa||event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();C(aa.clientX,aa.clientY,Z)}function S(aa){this.onmousemove=null;this.onmouseup=null}}function C(U,T,aa){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}var S=q.config;var Y=q.targetObj;var Z=$("."+Y).width();var V=U-$("."+Y).offset().left;var W=Math.abs(parseFloat(S.$container.css("margin-left")));F=V+W;F=parseFloat(F*S.framePerPixel)/S.framePerPixel;if(F<=0){F=0}if(F>=S.$container.width()){F=S.$container.width()}if(F-W>Z){N=F-Z;E=parseFloat(S.$sliderTrack.width()-S.$sliderBar.width());c=parseFloat(S.$container.width()-Z);i=N*E/c;S.$sliderBar.css("left",i);S.$container.css("margin-left",-N);S.$ruler.css("left",N);P(N);S.$sliderBar.css("left",i);S.$container.css("margin-left",-N);S.$ruler.css("left",N);P(N)}if(F<W){N=F;i=N*S.$sliderTrack.width()/S.$container.width();
S.$sliderBar.css("left",i);S.$container.css("margin-left",-N);S.$ruler.css("left",N);P(N);S.$sliderBar.css("left",i);S.$container.css("margin-left",-N);S.$ruler.css("left",N);P(N)}S.$cursor.css("left",F);var X=q.currTime;q.currTime=Math.round(F*S.framePerPixel);if(aa!==null&&X!==q.currTime){aa(q.currTime)}}function s(S){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}if(S>=q.config.maxTime){S=q.config.maxTime}q.currTime=S;q.fixArrowCurrentTime(S);if(!PLAYER.dbClick){PLAYER.TR.currTime=S;PLAYER.TR.fixArrowCurrentTime(S)}PLAYER.OCX.seek(S)}function o(T){var S=q.config;console.log("time",T);S.seekComandTimesMonitor.push(T)}function H(ad){var T=q.config;var ae=q.targetObj;var ac=T.$sliderBar.width();var af=T.$sliderBar.position().left;var ai=Math.abs(parseInt(T.$container.css("marginLeft")));var X=T.framePerPixel;var ah=ad.code;var ab=[];var Z=0;var Y=0;var ag=0;var S=0;var W=0;var V=0;var aa=null;var U=0;if(ah===189){PLAYER.keyNum===189;if(ac===$("."+q.targetObj).width()){return}I(10,X,ac,af,ai)}else{if(ah===187){PLAYER.keyNum===187;if(ac===(2*j+8)){return}I(-10,X,ac,af,ai)}}}function p(V){var U=q.targetObj;var T=q.config;var W=parseInt(T.$sliderBar.position().left);var S=2;E=parseInt(T.$sliderTrack.width()-T.$sliderBar.width());c=parseInt(T.$container.width()-$("."+q.targetObj).width());if(Math.floor(T.$sliderBar.width())===Math.floor(T.$sliderTrack.width())){return false}if(V.wheelDelta===-120){i=W+S;if(i>=E){i=E;N=c;console.log("乡下滚动",N)}else{N=i*c/E}T.$sliderBar.css("left",i);T.$container.css("margin-left",-N);T.$ruler.css("left",N);P(N);return false}else{if(V.wheelDelta===120){i=W-S;if(i<=0){i=0;N=0}else{N=i*c/E}T.$sliderBar.css("left",i);T.$container.css("margin-left",-N);T.$ruler.css("left",N);P(N);return false}}return false}function y(){var S=q.config;S.$trimIn.addEventListener=function(U,W){if(U=="mousemove"){S.$trimIn.mousedown(function(X){X.stopPropagation();Q=X.clientX;h=w;document.onmousemove=V;document.onmouseup=T});function V(X){v(X.clientX,X.clientY,W)}function T(){this.onmousemove=null}}};S.$trimOut.addEventListener=function(U,W){if(U=="mousemove"){S.$trimOut.mousedown(function(X){X.stopPropagation();Q=X.clientX;a=z;document.onmousemove=V;document.onmouseup=T});function V(X){g(X.clientX,X.clientY,W)}function T(){this.onmousemove=null}}}}function v(V,T,Z){var U=q.targetObj;var S=q.config;console.log("trimInOrginPos",h);if(V<$("."+U).offset().left){V=$("."+U).offset().left}var Y=V-Q;if(h+Y>z-3){return}if(h+Y<0){w=0}else{w=h+Y}w=parseInt(w*S.framePerPixel)/S.framePerPixel;q.trimInCurrTime=Math.round(F*S.framePerPixel);var X=z-w;S.$trimInOut.css("left",w);S.$trimInOut.css("width",X);if(Z!=null){var W=q.trimInCurrTime;Z(W)}}function g(V,T,Z){var U=q.targetObj;var S=q.config;if(V<$("."+U).offset().left){V=$("."+U).offset().left}var Y=V-Q;if(a+Y<w+3){return}if(a+Y>S.maxTime*S.perMsecWidth){z=S.maxTime*S.perMsecWidth}else{z=a+Y}z=parseInt(z*S.framePerPixel)/S.framePerPixel;q.trimOutCurrTime=Math.round(z*S.framePerPixel);var X=z-w;S.$trimInOut.css("width",X);if(Z!=null){var W=q.trimOutCurrTime;Z(W)}}function J(S){q.trimInCurrTime=S;PLAYER.TR.trimInCurrTime=S;PLAYER.TR.fixTrimInByCurrentTime(S)}function O(S){q.trimOutCurrTime=S;PLAYER.TR.trimOutCurrTime=S;PLAYER.TR.fixTrimOutByCurrentTime(S)}function r(){var X=q.targetObj;var U=q.config;var ab;var S;var Z;var T;var ac;var aa;var Y;var V;var W;U.$sliderBarLeft.mousedown(function(ad){var ad=ad||window.event;U.$sliderBarMiddle.addClass("now");T=ad.clientX;S=U.$sliderBar.width();ab=parseInt(U.$sliderBar.position().left);ac=Math.abs(parseInt(U.$container.css("marginLeft")));V=U.framePerPixel;$(document)[0].onmousemove=function(ae){var ae=ae||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var af;ae.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});diff_move=T-ae.clientX;I(diff_move,V,S,ab,ac)};$(document)[0].onmouseup=function(ae){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});U.$sliderBarRight.mousedown(function(ad){var ad=ad||window.event;U.$sliderBarMiddle.addClass("now");T=ad.clientX;S=U.$sliderBar.width();ab=parseInt(U.$sliderBar.position().left);ac=Math.abs(parseInt(U.$container.css("marginLeft")));V=U.framePerPixel;$(document)[0].onmousemove=function(ae){var ae=ae||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var af;ae.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});diff_move=ae.clientX-T;I(diff_move,V,S,ab,ac)};$(document)[0].onmouseup=function(ae){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});U.$sliderBarMiddle.mousedown(function(ad){var ad=ad||window.event;U.$sliderBarMiddle.addClass("now");T=ad.clientX;S=U.$sliderBar.width();ab=parseInt(U.$sliderBar.position().left);$(document)[0].onmousemove=function(ae){$("body").css({cursor:"move"});Z=ae.clientX-T;i=ab+Z;
B=S;if(i<0){i=0}if(i>E){i=E}U.$sliderBar.css("left",i);U.$sliderBarMiddle.addClass("now");if(B!=U.$sliderTrack.width()){E=parseInt(U.$sliderTrack.width()-B);c=parseInt(U.$container.width()-$("."+q.targetObj).width());N=Math.floor(parseInt(c*i/E))}else{N=0}U.$container.css("margin-left",parseInt(-N));U.$ruler.css("left",N);P(N);return false};$(document)[0].onmouseup=function(ae){U.$sliderBarMiddle.removeClass("now");$("body").css({cursor:"default"});$(document)[0].onmousemove=null}})}function I(ac,U,S,Z,aa){var T=q.config;var Y=q.targetObj;var W=($("."+q.targetObj).width()/2);var V;var X;if(ac>0){if(T.max_fpp===U){X=0}else{V=(T.$sliderTrack.width()-S)/((T.max_fpp/U)-1);X=ac/V}i=Z-ac;B=S+2*ac;T.framePerPixel=U*(X+1);if(i<=0){i=0}if(Z+S+ac>=$("."+q.targetObj).width()){i=Z-ac;B=T.$sliderTrack.width()-i}if(B>=T.$sliderTrack.width()){B=T.$sliderTrack.width();T.framePerPixel=T.max_fpp}M(T.framePerPixel)}else{if(ac<0){if(T.min_fpp===U){X=0}else{V=(S-(2*j+8))/((U/T.min_fpp)-1);X=ac/V}i=Z-ac;B=S+2*ac;T.framePerPixel=U/(-X+1);if(B<=(2*j+8)){B=(2*j+8);X=0;i=Z-((2*j+8)-S/2);T.framePerPixel=T.min_fpp}M(T.framePerPixel)}else{T.framePerPixel=U;M(T.framePerPixel)}}var W=Math.floor($("."+q.targetObj).width()/2);var ab=D(T.framePerPixel);K(ab.smallScaleFrame,ab.smallScaleNumsPerLargeScale,T.framePerPixel);A=Math.floor(T.maxTime/T.framePerPixel);if(A<=$("."+q.targetObj).width()){A=$("."+q.targetObj).width()}if(q.currTime!=0){F=Math.floor(parseInt(q.currTime/T.framePerPixel));N=F-W;i=N*E/c;if(i>=E){i=E;N=c}if(isNaN(i)){N=0;i=0}}else{N=Math.floor(c*i/E)}if(isNaN(N)||N<=0){N=0;i=0}T.$sliderBar.css("width",B);T.$sliderBar.css("left",i);T.$sliderBarMiddle.css("width",B-2*j);T.$sliderBarRight.css("left",B-j);T.$container.css("margin-left",-N);T.$container.css("width",A);T.$ruler.css("left",N);P(N);q.fixArrowCurrentTime(q.currTime);q.fixTrimInByCurrentTime(q.trimInCurrTime);q.fixTrimOutByCurrentTime(q.trimOutCurrTime)}function M(T){var W=q.config;var X=q.targetObj;var V=25*60*60*10/80;var S=W.maxTime/$("."+q.targetObj).width();var U=Math.min(V,S);if(T<W.min_fpp){T=W.min_fpp}else{if(T>U){T=U}}}function K(U,V,S){var T=q.config;T.smallScaleFrame=U;T.smallScaleNumsPerLargeScale=V;T.framePerPixel=S;q.updateRuler(T)}return f}();PLAYER.EventUtil={addHandler:function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}else{a["on"+c]=b}}},removeHandler:function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b)}else{if(a.detachEvent){a.detachEvent("on"+c,b)}else{a["on"+c]==null}}},getEvent:function(a){return a?a:window.event},getTarget:function(a){return a.target||a.srcElement},preventDefault:function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}},stopPropagation:function(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}},getPageX:function(b){var a=0;if(b.pageX===undefined){a=b.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)}else{a=b.pageX}return a},getPageY:function(b){var a=0;if(b.pageY===undefined){a=b.clientY+(document.documentElement.scrollTop||document.body.scrollTop)}else{a=b.pageY}return a},getRelatedTarget:function(a){if(a.relatedTarget){return a.relatedTarget}else{if(a.toElement){return a.toElement}else{if(a.fromElement){return a.fromElement}else{return null}}}},getButton:function(a){if(document.implementation.hasFeature("MouseEvent","2.0")){return a.button}else{switch(a.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}}},getWheelDelta:function(a){if(a.wheelDelta){return(client.engine.opera&&client.engine.opera<9.5)?-a.wheelDelta:a.wheelDelta}else{return -a.detail*40}},getKeyCode:function(a){return a.keyCode||a.which||a.charCode},getCharCode:function(a){if(typeof a.charCode=="number"){return a.charCode}else{return a.keyCode}},getClipboardText:function(a){var b=(a.clipboardData||window.clipboardData);return b.getData("text")},setClipboardText:function(a,b){if(a.clipboardData){return a.clipboardData.setData("text/plain",b)}else{if(window.clipboardData){return window.clipboardData.setData("text",b)}}}};PLAYER.documentEvent=function(){var b=new PLAYER.EventTarget();var c=null;function a(d){d=PLAYER.EventUtil.getEvent(d);var f=PLAYER.EventUtil.getTarget(d);switch(d.type){case"keydown":c=f;b.fire({type:"keydown",target:c,code:d.keyCode,shift:d.shiftKey,ctrl:d.ctrlKey});break}}b.enable=function(d){PLAYER.EventUtil.addHandler(document,"keydown",a)};b.disable=function(){PLAYER.EventUtil.removeHandler(document,"keydown",a)};return b}();PLAYER.$millisecondsToTimeFrame=function(d){var b=parseInt(d/(60*60*1000));var f=parseInt((d-b*60*60*1000)/(60*1000));var c=parseInt((d-b*60*60*1000-f*60*1000)/1000);var g=Math.round((d-b*60*60*1000-f*60*1000-c*1000)/(1000/25));if(g==25){c+=1;g=0}if(b<10){b="0"+b}if(f<10){f="0"+f}if(c<10){c="0"+c}if(g<10){g="0"+g}var a=b+":"+f+":"+c+":"+g;return a};PLAYER.checkPlaying=function(){if(PLAYER.isPlaying){PLAYER.OCX.doPause();PLAYER.isPlaying=false;
$("#js_play").removeClass("stop");$("#js_play").attr("title","播放")}};PLAYER.showSubititleEdit=function(){$("#js_carve").removeClass("col-md-6").addClass("col-md-4");$("#js_carve_edit").show();$("#js_carve_edit .list li").eq(0).trigger("click")};PLAYER.hideSubititleEdit=function(){$("#js_carve").removeClass("col-md-4").addClass("col-md-6");$("#js_carve_edit").hide();$("#js_subtitle_h_form").empty()};PLAYER.hideEffectEdit=function(){$("#js_carve_edit").hide();$("#js_carve").removeClass("col-md-4").addClass("col-md-6");$("#js_effect_h_form").empty();$("#move_box").remove();$(".edit_box").removeClass("onselected")};PLAYER.genNonDuplicateID=function(a){return Number(Math.random().toString().substr(3,a)+Date.now()).toString(36)};PLAYER.getDurationToString=function(f){var g=parseInt(f/(3600*25));var d=g+"";if(g<10){d="0"+g}f=f-g*3600*25;var j=parseInt(f/(60*25));var i=j+"";if(j<10){i="0"+j}f=f-j*60*25;var b=parseInt(f/25);var h=b+"";if(b<10){h="0"+b}f=f-b*25;var a=f;var c=a+"";if(a<10){c="0"+a}return d+":"+i+":"+h+":"+c};PLAYER.getLocalTime=function(a){function i(d){return d<10?"0"+d:d}var b=new Date(a);var k=b.getFullYear();var c=b.getMonth()+1;var j=b.getDate();var g=b.getHours();var f=b.getMinutes();var l=b.getSeconds();return k+"-"+i(c)+"-"+i(j)+" "+i(g)+":"+i(f)+":"+i(l)};PLAYER.ffToNm=function(a){return a*40};PLAYER.nmToFf=function(a){return(a/40)};PLAYER.singelton=function(b){var a;return function(){return a||(a=b.apply(this,arguments))}};