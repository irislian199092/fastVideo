PLAYER.playerFunction=function(){function a(){this.config={targetObj:"time_ruler",hasTrack:!0};this.playerConfig={targetObj:"player_time_ruler",hasTrack:!1,rulerHeight:35,trimHeight:15};PLAYER.TR=new PLAYER.timeRuler(this.config);PLAYER.PTR=new PLAYER.timeRuler2(this.playerConfig);PLAYER.OCX=new PLAYER.ocxFunction;PLAYER.documentEvent.addHandler("keydown",d);setInterval(function(){var a=PLAYER.TR.config.seekComandTimesMonitor.length;0!==a&&(a=PLAYER.TR.config.seekComandTimesMonitor[a-1],PLAYER.TR.config.seekComandTimesMonitor=
[],PLAYER.TR.currTime=a,PLAYER.TR.fixArrowCurrentTime(a),PLAYER.OCX.seek(a),a>=PLAYER.PTR.config.maxTime&&(a=PLAYER.PTR.config.maxTime),PLAYER.PTR.currTime=a,PLAYER.PTR.fixArrowCurrentTime(a))},10);setInterval(function(){var a=PLAYER.PTR.config.seekComandTimesMonitor.length;0!==a&&(a=PLAYER.PTR.config.seekComandTimesMonitor[a-1],PLAYER.PTR.config.seekComandTimesMonitor=[],PLAYER.dbClick||(PLAYER.TR.currTime=a,PLAYER.TR.fixArrowCurrentTime(a),a>=PLAYER.PTR.config.maxTime&&(a=PLAYER.PTR.config.maxTime)),
PLAYER.OCX.seek(a),PLAYER.PTR.currTime=a,PLAYER.PTR.fixArrowCurrentTime(a))},10)}function b(){var a=setInterval(function(){var b=PLAYER.operateJson.getLastFrame();if(PLAYER.loadState&&PLAYER.isPlaying){var c=PLAYER.OCX.getPosition();c>b&&(c=0);c===b&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"),clearInterval(a));PLAYER.TR.fixArrowCurrentTime(c);PLAYER.TR.currTime=c;PLAYER.PTR.fixArrowCurrentTime(c);PLAYER.PTR.currTime=c;$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(PLAYER.TR.currTime))}},
40)}function c(){function a(a,b){var c=document.getElementById("js_voCanvas"),d=$("#js_time_ruler_voiceBox").height()-21;if(c.getContext("2d")&&(c=c.getContext("2d"),c.clearRect(0,0,100,500),b)){var g=3;for(b=0;b<parseInt(a[0]);b++){var m=parseFloat(a[b+1]/100)+.99;canvasGradient=c.createLinearGradient(g,d,g,0);canvasGradient.addColorStop(0,"#33FF00");canvasGradient.addColorStop(.4,"#33FF00");canvasGradient.addColorStop(1,"red");c.fillStyle=canvasGradient;c.fillRect(g,d*(1-m),30,d*m);c.fillRect(g,
d*(1-m),30,d*m);g+=35}}}setTimeout(function(){var b=PLAYER.OCX.getVUMeterInfo();b&&a(b.split(","),!0);PLAYER.loadState&&PLAYER.isPlaying&&(""!=b?setTimeout(arguments.callee,100):a("",!1))},100)}function d(a){var b=a.code,c=a.target;if("INPUT"!==c.nodeName&&"input"!==c.nodeName&&"TEXTAREA"!==c.nodeName&&"textarea"!==c.nodeName)if(16===b&&a.shift)PLAYER.keyNum=1600;else if(86!==b||a.shift)if(71!==b||a.shift)if(71===b&&a.shift)PLAYER.player.toolbar_nextSelect();else if(85!==b||a.shift)if(85===b&&a.shift)PLAYER.player.toolbar_uCut();
else if(73===b&&a.shift)PLAYER.player.moveTrimIn();else if(79===b&&a.shift)PLAYER.player.moveTrimOut();else if(32!==b||a.shift)36!==b||a.shift?35!==b||a.shift?39!==b||a.shift?37!==b||a.shift?73!==b||a.shift?79!==b||a.shift?49===b&&a.shift?(PLAYER.keyNum=4900,PLAYER.player.toolbar_group()):50===b&&a.shift&&(PLAYER.keyNum=5E3,PLAYER.player.toolbar_ungroup()):(PLAYER.keyNum=79,PLAYER.player.setTrimOut()):(PLAYER.keyNum=73,PLAYER.player.setTrimIn()):PLAYER.player.prevFrame():PLAYER.player.nextFrame():
PLAYER.player.toLastFrame():PLAYER.player.toFirstFrame();else{a=PLAYER.operateJson.getLastFrame();if(PLAYER.TR.currTime>=a)return!1;PLAYER.player.play()}else PLAYER.player.toolbar_cut();else PLAYER.player.toolbar_preSelect();else PLAYER.player.toolbar_choose()}a.prototype={play:function(){PLAYER.isPlaying?(PLAYER.OCX.doPause(),$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"),PLAYER.isPlaying=!1):(PLAYER.OCX.doPlay(40*parseInt(PLAYER.PTR.currTime),1E11),$("#js_play").addClass("stop"),
$("#js_play").attr("title","\u505c\u6b62"),PLAYER.isPlaying=!0,b(),c())},setIntervalPlay:function(){var a=parseInt(PLAYER.TR.trimInCurrTime),b=parseInt(PLAYER.TR.trimOutCurrTime);$("#js_setInterval").parent("li").hasClass("active");PLAYER.isPlaying?(PLAYER.OCX.doPause(),$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"),PLAYER.isPlaying=!1):(PLAYER.OCX.seek(a),PLAYER.OCX.doPlay(),$("#js_play").addClass("stop"),$("#js_play").attr("title","\u505c\u6b62"),PLAYER.isPlaying=!0,
setTimeout(function(){var c=PLAYER.OCX.getPosition();console.log("s",c);PLAYER.TR.fixArrowCurrentTime(c);PLAYER.TR.currTime=c;PLAYER.PTR.fixArrowCurrentTime(c);PLAYER.PTR.currTime=c;$("#js_player_nowTime").html(PLAYER.getDurationToString(c));$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(c));PLAYER.loadState&&PLAYER.isPlaying&&(console.log("trimoutFrame",b),c!==b?console.log("\u6ca1\u6709\u5230\u51fa\u70b9"):(console.log("\u5230\u51fa\u70b9",a),PLAYER.OCX.doPause(),PLAYER.OCX.seek(a),
PLAYER.OCX.doPlay(),PLAYER.isPlaying=!0,$("#js_play").addClass("stop"),$("#js_play").attr("title","\u505c\u6b62")),setTimeout(arguments.callee,40))},40))},setTrimIn:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));PLAYER.dbClick||PLAYER.TR.fixTrimInByCurrentTime(parseInt(PLAYER.TR.currTime));PLAYER.PTR.fixTrimInByCurrentTime(parseInt(PLAYER.PTR.currTime))},setTrimOut:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),
PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));PLAYER.dbClick||PLAYER.TR.fixTrimOutByCurrentTime(parseInt(PLAYER.TR.currTime));PLAYER.PTR.fixTrimOutByCurrentTime(parseInt(PLAYER.PTR.currTime))},moveTrimIn:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));if($(".time_ruler_trimInOut").width())PLAYER.dbClick||PLAYER.TR.fixArrowCurrentTime(parseInt(PLAYER.TR.trimInCurrTime)),
PLAYER.PTR.fixArrowCurrentTime(parseInt(PLAYER.PTR.trimInCurrTime)),PLAYER.OCX.seek(parseInt(PLAYER.PTR.trimInCurrTime));else return!1},moveTrimOut:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));if($(".time_ruler_trimInOut").width())PLAYER.dbClick||PLAYER.TR.fixArrowCurrentTime(parseInt(PLAYER.TR.trimOutCurrTime)),PLAYER.PTR.fixArrowCurrentTime(parseInt(PLAYER.PTR.trimOutCurrTime)),PLAYER.OCX.seek(parseInt(PLAYER.PTR.trimOutCurrTime));
else return!1},prevFrame:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));PLAYER.dbClick||PLAYER.TR.moveToPrevFrame();PLAYER.PTR.moveToPrevFrame();PLAYER.OCX.seek(parseInt(PLAYER.PTR.currTime))},nextFrame:function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));PLAYER.dbClick||PLAYER.TR.moveToNextFrame();PLAYER.PTR.moveToNextFrame();
PLAYER.OCX.seek(parseInt(PLAYER.PTR.currTime))},toFirstFrame:function(){if(PLAYER.dbClick)return!1;PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));var a=PLAYER.operateJson.getFirstFrame();console.log("time",a);PLAYER.TR.fixArrowCurrentTime(a);PLAYER.PTR.fixArrowCurrentTime(a);PLAYER.OCX.seek(parseInt(a))},toLastFrame:function(){if(PLAYER.dbClick)return!1;PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=
!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"));if($(".time_ruler_bar").children().length){var a=PLAYER.operateJson.getLastFrame();PLAYER.TR.fixArrowCurrentTime(a);PLAYER.PTR.fixArrowCurrentTime(a);PLAYER.OCX.seek(a)}},toolbar_choose:function(){PLAYER.dbClick||(PLAYER.keyNum=86,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_select").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"default"}))},toolbar_preSelect:function(){PLAYER.dbClick||
(console.log("\u5411\u524d\u9009\u62e9","A"),PLAYER.keyNum=71,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_select_pre").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/select_back.cur),default"}))},toolbar_nextSelect:function(){PLAYER.dbClick||(console.log("\u5411\u540e\u9009\u62e9","shift+A"),PLAYER.keyNum=7100,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_select_back").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/select_pre.cur),default"}))},
toolbar_cut:function(){PLAYER.dbClick||(PLAYER.keyNum=85,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_cut").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/cut_disable.cur),default"}),PLAYER.TR.config.$clipTrackBar.find(".edit_box").css({cursor:"url(images/cur/cut.cur),default"}))},toolbar_uCut:function(){PLAYER.dbClick||(PLAYER.keyNum=8500,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_uCut").addClass("active"),
0!==PLAYER.TR.currTime&&PLAYER.TR.cutArrowCurrentTime())},toolbar_zoom_plus:function(){PLAYER.dbClick||(PLAYER.keyNum=187,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_plus").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/zoom_plus.cur),default"}))},toolbar_zoom_minus:function(){PLAYER.dbClick||(PLAYER.keyNum=189,$(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_minus").addClass("active"),PLAYER.TR.config.$clipTrackBar.css({cursor:"url(images/cur/zoom_minus.cur),default"}))},
toolbar_ungroup:function(){if(0===$("#js_time_ruler_bar_box .onselected").length)return!1;$("#js_time_ruler_bar_box .onselected").each(function(a,b){$(b).attr("data-interleaved",!1);a=$(b).attr("data-time");PLAYER.operateJson.updateClipAttr({interleaved:!1},a)});console.log("\u89e3\u7ec4",PLAYER.jsonObj.rootBin.sequence[0].tracks)},toolbar_group:function(){if(0===$("#js_time_ruler_bar_box .onselected").length)return!1;$(".edit_box_v.onselected").attr("data");$(".edit_box_v.onselected").each(function(a,
b){var c=$(b).attr("data-time");a={interleaved:!0};PLAYER.operateJson.updateClipAttr(a,c);$(b).attr("data-interleaved",!0);c=$(b).attr("data-intid");b=$(b).parent().siblings().children('.edit_box_a[data-intid="'+c+'"]');c=b.attr("data-time");PLAYER.operateJson.updateClipAttr(a,c);b.attr("data-interleaved",!0)});console.log("\u7f16\u7ec4",PLAYER.jsonObj.rootBin.sequence[0].tracks)}};return a}();
PLAYER.ocxFunction=function(){function a(){this.positionValue=0}a.prototype={updateProjectJson:function(a){a=PLAYER.operateJson.translateFfpToMS(JSON.stringify(a));try{var b=JSON.stringify({command:"updateproject",params:{projectInfo:a}});webrtc.sendDataChannelMessageToPeer(targetId,b);PLAYER.loadState=!0}catch(d){return console.log("\u62d6\u62fd\u8f68\u9053\u66f4\u65b0json\u6587\u4ef6\u5931\u8d25",d),!1}},adjustEffect:function(a){a=JSON.stringify({command:"adjustEffect",params:a});webrtc.sendDataChannelMessageToPeer(targetId,
a)},updateFileJson:function(a){var b=JSON.stringify(a);try{form1.TestActiveX.UpdateFileJson(b),PLAYER.loadState=!0,console.log("\u53cc\u51fb\u7d20\u6750\u66f4\u65b0json\u6587\u4ef6\u6210\u529f",a)}catch(d){return console.log("\u53cc\u51fb\u7d20\u6750\u66f4\u65b0json\u6587\u4ef6\u5931\u8d25",d),!1}},unloadPlayer:function(){try{form1.TestActiveX.Close()}catch(b){console.log("\u5173\u95ed\u64ad\u653e\u5668\u65f6\u51fa\u9519\uff01")}},doPlay:function(a,c){try{var b=JSON.stringify({command:"play",params:{from:a,
to:c}});webrtc.sendDataChannelMessageToPeer(targetId,b)}catch(g){return console.log("\u64ad\u653e\u5931\u8d25\uff01",g),!1}},doPause:function(){var a=PLAYER.ffToNm(PLAYER.TR.currTime);try{var c=JSON.stringify({command:"pause",params:{pos:a}});webrtc.sendDataChannelMessageToPeer(targetId,c)}catch(d){return console.log("\u6682\u505c\u5931\u8d25\uff01"),!1}},doStop:function(){try{form1.TestActiveX.Seek(0)}catch(b){console.log("\u505c\u6b62\u5931\u8d25\uff01")}},getPosition:function(){try{return PLAYER.nmToFf(PLAYER.currentTime)}catch(b){console.log("\u83b7\u53d6\u5f53\u524d\u65f6\u7801\u65f6\u51fa\u9519\uff01")}},
seek:function(a){try{console.log("seek-point",a);a=PLAYER.ffToNm(a);var b=JSON.stringify({command:"seek",params:{pos:a}});webrtc.sendDataChannelMessageToPeer(targetId,b)}catch(d){console.log("seek\u5f53\u524d\u65f6\u7801\u65f6\u51fa\u9519\uff01")}},getVUMeterInfo:function(){try{return PLAYER.VUMeterInfo}catch(b){}},coverStationLogo:function(a){try{console.log("\u63d0\u4ea4\u58f0\u97f3",a);var b=form1.TestActiveX.CoverStationLogo(JSON.stringify(a));console.log("s1",b);return b}catch(d){console.log("error")}},
clearWindow:function(){try{form1.TestActiveX.ClearWindow()}catch(b){console.log("error","ClearWindow")}},getImageBase64:function(){try{var a=form1.TestActiveX.GetImageBase64(4);console.log("\u83b7\u53d6\u753b\u9762\u6210\u529f\uff01",a);return a}catch(c){console.log("error","\u83b7\u53d6\u753b\u9762\u5931\u8d25")}},sendProType:function(a){try{a={command:"setProjectType",params:{type:a}};console.log("--------",JSON.stringify(a));var b=JSON.stringify(a);webrtc.sendDataChannelMessageToPeer(targetId,
b)}catch(d){return console.log("\u64ad\u653e\u5931\u8d25\uff01",d),!1}}};return a}();
PLAYER.operateJson={sendJson:function(){PLAYER.operateJson.sortClipAttr();PLAYER.operateJson.updateRulerMaxTime();PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]);PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime))},translateFfpToMS:function(a){a=JSON.parse(a);var b;a.rootBin.sequence[0].maxDuration*=40;for(b=0;b<a.rootBin.sequence[0].tracks.length;b++)$.each(a.rootBin.sequence[0].tracks[b].subclip,function(a,b){b&&(b.trimIn*=40,b.trimOut*=
40,b.sequenceTrimIn*=40,b.sequenceTrimOut*=40,b.effect&&0!==b.effect.length&&$.each(b.effect,function(a,b){b.trimIn*=40;b.trimOut*=40;b.duration*=40}))});for(b=0;b<a.reference.material.length;b++){var c=a.reference.material[b];c.duration*=40}b=document.getElementById("ocx");b=b.currentStyle?b.currentStyle:window.getComputedStyle(b,null);c=parseFloat(b.height);b="576"===a.height&&"720"===a.width?parseFloat(1.25*c):parseFloat(16*c/9);a.pHeight=c;a.pWidth=b;return a},translateMsToFfp:function(a){a=JSON.parse(a);
a.rootBin.sequence[0].maxDuration/=40;for(var b=0;b<a.rootBin.sequence[0].tracks.length;b++)$.each(a.rootBin.sequence[0].tracks[b].subclip,function(a,b){b&&(b.trimIn/=40,b.trimOut/=40,b.sequenceTrimIn/=40,b.sequenceTrimOut/=40,b.effect&&0!==b.effect.length&&$.each(b.effect,function(a,b){b.trimIn/=40;b.trimOut/=40;b.duration/=40}))});for(b=0;b<a.reference.material.length;b++)a.reference.material[b].duration/=40;return a},addVideoClipAttr:function(a,b){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var d=
PLAYER.jsonObj.rootBin.sequence[0].tracks[c];"v"===d.type&&d.index===b&&d.subclip.push(a)}},addAudioClipAttr:function(a,b){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];"a"===d.type&&d.index===b&&d.subclip.push(a)}},getdAudioClipAttr:function(a,b){for(var c=null,d=0;d<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;d++){var g=PLAYER.jsonObj.rootBin.sequence[0].tracks[d];"a"===g.type&&g.index===b&&$.each(g.subclip,function(b,
d){d&&d.createTime===a&&(c=d)})}console.log("arr---",c);return JSON.stringify(c)},updateAudioClipVolume:function(a,b){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];$.each(d.subclip,function(c,m){m&&m.createTime===a&&$.extend(d.subclip[c],{volume:b})})}},addSubtitleClipAttr:function(a,b){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];"t"===d.type&&d.index===
b&&d.subclip.push(a)}},getSubtitleClip:function(a,b){for(var c=null,d=0;d<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;d++){var g=PLAYER.jsonObj.rootBin.sequence[0].tracks[d];"t"===g.type&&g.index===b&&$.each(g.subclip,function(b,d){d&&d.createTime===a&&(c=d)})}return JSON.stringify(c)},updateSubtitleClip:function(a,b,c){for(var d=a.trackIndex,g=a.subClipId,m=0;m<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;m++){var v=PLAYER.jsonObj.rootBin.sequence[0].tracks[m];"t"===v.type&&v.index===d&&
$.each(v.subclip,function(d,m){m&&m.createTime===g&&(m.abs.left_value=b,m.abs.top_value=c,$.extend(m.pixel,a.attr),$.extend(m.pixel,a.attr))})}console.log("\u66f4\u65b0\u5b57\u5e55",PLAYER.jsonObj.rootBin.sequence[0].tracks)},sortClipAttr:function(){function a(a){return function(b,c){b=b[a];c=c[a];return b<c?-1:b>c?1:0}}for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++)PLAYER.jsonObj.rootBin.sequence[0].tracks[b].subclip.sort(a("sequenceTrimIn"))},addProjectMaterial:function(a){0===
PLAYER.jsonObj.reference.material.length?PLAYER.jsonObj.reference.material.push(a):$.each(PLAYER.jsonObj.reference.material,function(b,c){a.assetId!==c.assetId&&PLAYER.jsonObj.reference.material.push(a)})},pushCancelArray:function(a){a=JSON.stringify(a);PLAYER.goBackJson.push(a)},updateClipAttr:function(a,b,c){for(var d=0;d<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;d++){var g=PLAYER.jsonObj.rootBin.sequence[0].tracks[d];$.each(g.subclip,function(d,v){v&&v.createTime===b&&($.extend(g.subclip[d],
a||{}),c&&(g.subclip[d].effect=c))})}console.log("\u66f4\u65b0\u5207\u7247",PLAYER.jsonObj.rootBin.sequence[0].tracks)},changeIndexClipAttr:function(a,b,c){for(var d=null,g=0;g<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;g++){var m=PLAYER.jsonObj.rootBin.sequence[0].tracks[g];$.each(m.subclip,function(a,b){b&&b.createTime===c&&(d=JSON.stringify(m.subclip[a]),m.subclip.splice(a,1))})}for(g=0;g<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;g++)m=PLAYER.jsonObj.rootBin.sequence[0].tracks[g],
m.type===a&&m.index===b&&m.subclip.push(JSON.parse(d))},deleteClipAttr:function(a){for(var b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];$.each(c.subclip,function(b,g){g&&g.createTime===a&&c.subclip.splice(b,1)})}console.log("\u5220\u9664\u5207\u7247",PLAYER.jsonObj.rootBin.sequence[0])},checkCoverEvent:function(a,b){var c=PLAYER.TR.config,d,g,m=parseInt(a.attr("data-sequencetrimin")),v=parseInt(a.attr("data-sequencetrimout"));parseInt(a.attr("data-trimin"));
parseInt(a.attr("data-trimout"));a.attr("data-time");var J=[];$.each(a.siblings(),function(a,b){$(b).hasClass("onselected")||$(b).hasClass("changeHelp")||J.push($(b))});$.each(J,function(Q,w){var A=parseInt($(w).attr("data-sequencetrimin")),J=parseInt($(w).attr("data-sequencetrimout")),T=parseInt($(w).attr("data-trimin")),V=parseInt($(w).attr("data-trimout"));if(m<=A&&v>A)v<J?(Q=$(w).attr("data-time"),$(w).attr("data-sequencetrimin",v),$(w).attr("data-sequencetrimout",J),$(w).attr("data-trimout",
V),$(w).attr("data-trimin",V-J+v),$(w).css("left",v/c.framePerPixel),$(w).width((J-v)/c.framePerPixel),$(w).find(".effect_box_l")&&$(w).find(".effect_box_l").remove(),subClipAttr={sequenceTrimIn:v,sequenceTrimOut:J,trimIn:V-J+v,trimOut:V},A=PLAYER.operateJson.getCoverOldEffectClip(Q,V-J+v,V),PLAYER.operateJson.updateClipAttr(subClipAttr,Q,A)):(Q=$(w).attr("data-time"),PLAYER.operateJson.deleteClipAttr(Q),$(w).remove()),PLAYER.operateJson.sortClipAttr();else if(m>=A&&J>m){$(w).attr("data-sequencetrimin",
A);$(w).attr("data-sequencetrimout",m);$(w).attr("data-trimout",T+m-A);$(w).attr("data-trimin",T);$(w).width((m-A)/c.framePerPixel);var ca=$(w).attr("data-id"),Y=$(w).attr("data-time"),aa=$(w).attr("data-interleaved");Q=$(w).attr("data-type");var W=parseInt($(w).parent(".time_ruler_bar").attr("data-index"));$(w).find(".effect_box_r")&&$(w).find(".effect_box_r").remove();$(w).find(".effect_box_all")&&($(w).find(".effect_box_all").attr("data-trimin",T),$(w).find(".effect_box_all").attr("data-trimout",
T+m-A),$(w).find(".effect_box_all").attr("data-duration",m-A));subClipAttr={trimIn:T,trimOut:T+m-A,sequenceTrimIn:A,sequenceTrimOut:m};A=PLAYER.operateJson.getCutOldEffectClip(Y,T,T+m-A);PLAYER.operateJson.updateClipAttr(subClipAttr,Y,A);v<J&&(A=Q+"_"+PLAYER.genNonDuplicateID(12),vcut_sequenceTrimIn=v,vcut_sequenceTrimOut=J,vcut_trimIn=V-J+v,vcut_trimOut=V,vcut_width=(J-v)/c.framePerPixel,vcut_left=v/c.framePerPixel,d=$(w).clone(),d.find(".effect_box_l")&&d.find(".effect_box_l").remove(),d.find(".effect_box_all")&&
(d.find(".effect_box_all").attr("data-trimin",vcut_trimIn),d.find(".effect_box_all").attr("data-trimout",vcut_trimOut),d.find(".effect_box_all").attr("data-duration",vcut_trimOut-vcut_trimIn)),d.removeClass("onselected"),d.attr("data-trimin",vcut_trimIn),d.attr("data-trimout",vcut_trimOut),d.attr("data-sequencetrimin",vcut_sequenceTrimIn),d.attr("data-sequencetrimout",vcut_sequenceTrimOut),d.attr("data-time",A),d.attr("data-intid",b),d.attr("width",vcut_width),d.attr("left",vcut_left),$(w).parent(".time_ruler_bar").append(d),
$(w).parent(".time_ruler_bar").hasClass("bar_v")?(w=PLAYER.operateJson.getCutNewEffectClip(Y,vcut_trimIn,vcut_trimOut),0!==w.length&&$.each(w,function(a,b){"mosaic"===$(b).type&&($(b).trimIn=vcut_trimIn,$(b).trimOut=vcut_trimOut)}),g={assetID:ca,trimIn:vcut_trimIn,trimOut:vcut_trimOut,sequenceTrimIn:vcut_sequenceTrimIn,sequenceTrimOut:vcut_sequenceTrimOut,effect:w,type:Q,createTime:A,interleaved_id:b},"true"===a.attr("data-interleaved")&&"true"===aa?g.interleaved=!0:g.interleaved=!1,PLAYER.operateJson.addVideoClipAttr(g,
W)):$(w).parent(".time_ruler_bar").hasClass("bar_a")?(g={assetID:ca,trimIn:vcut_trimIn,trimOut:vcut_trimOut,sequenceTrimIn:vcut_sequenceTrimIn,sequenceTrimOut:vcut_sequenceTrimOut,volume:100,type:Q,createTime:A,interleaved_id:b},"true"===a.attr("data-interleaved")&&"true"===aa?g.interleaved=!0:g.interleaved=!1,PLAYER.operateJson.addAudioClipAttr(g,W)):$(w).parent(".time_ruler_bar").hasClass("bar_t")&&(w=JSON.parse(PLAYER.operateJson.getSubtitleClip(Y,W)),$.extend(w,{trimIn:vcut_trimIn,trimOut:vcut_trimOut,
sequenceTrimIn:vcut_sequenceTrimIn,sequenceTrimOut:vcut_sequenceTrimOut,type:Q,createTime:A,interleaved:!1,interleaved_id:b}),PLAYER.operateJson.addSubtitleClipAttr(w,W)))}else console.log("\u4e0d\u91cd\u5408")})},getAllsequenceTrimIn:function(a,b,c){var d,g;g=c?c:parseInt(a.attr("data-sequencetrimin"));var m=a.siblings();b&&$.each(m,function(a,c){$(c).attr("data-time")===b&&m.splice(a,1)});m.each(function(){var a=Math.abs(g-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,
b=Math.abs(g-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel;10>=a&&(d=parseInt($(this).attr("data-sequencetrimin")));10>=b&&(d=parseInt($(this).attr("data-sequencetrimout")))});return d},showAdhere:function(a,b){a.find(".point")&&a.find(".point").remove();var c=$('<div class="point"></div>');"forward"===b&&c.css("left",-5);"backward"===b&&c.css("left",a.width()-5);c.appendTo(a);console.log("point",a.find(".point").length)},hideAdhere:function(a){a.find(".point")&&a.find(".point").remove()},
chooseInterleavedElem:function(a){var b=null;a.attr("data-time");var c=a.attr("data-intid");$.each(a.parent(".time_ruler_bar").siblings().children(".edit_box"),function(a,g){"true"!==$(g).attr("data-interleaved")||$(g).attr("data-intid")!==c||$(g).hasClass("changeHelp")||(b=$(g))});return b},chooseGroupElem:function(a){var b=null,c=[],d=a.attr("data-time"),g=a.attr("data-group");$.each($(".edit_box"),function(a,d){$(this).attr("data-group")===g&&(b=$(this),c.push(b))});c.forEach(function(a,b){c[b].attr("data-time")===
d&&c.splice(b,1)});return c},chooseSelectedElem:function(a){var b=[],c=a.attr("data-time");$.each($("#js_time_ruler_bar_box .onselected"),function(a,c){b.push($(this))});b.forEach(function(a,g){b[g].attr("data-time")===c&&b.splice(g,1)});return b},mouseDownState:function(a){17!==PLAYER.keyNum&&71!==PLAYER.keyNum&&7100!==PLAYER.keyNum&&$("#js_time_ruler_bar_box .draggable").removeClass("onselected");a.addClass("onselected");"true"===a.attr("data-interleaved")&&PLAYER.operateJson.chooseInterleavedElem(a).addClass("onselected");
if(a.hasClass("edit_box_a")){var b=a.attr("data-time");a=parseInt(a.parent().attr("data-index"));b=JSON.parse(PLAYER.operateJson.getdAudioClipAttr(b,a));b=b.volume;$("#js_toolbar_icon_volume_track").val(b);$("#js_toolbar_icon_volume_track").attr("title",b)}else PLAYER.operateJson.chooseInterleavedElem(a).hasClass("edit_box_a")&&(b=PLAYER.operateJson.chooseInterleavedElem(a).attr("data-time"),a=parseInt(a.parent().attr("data-index")),b=JSON.parse(PLAYER.operateJson.getdAudioClipAttr(b,a)),b=b.volume,
$("#js_toolbar_icon_volume_track").val(b),$("#js_toolbar_icon_volume_track").attr("title",b))},mouseMoveState:function(a,b){a.css("z-index",50);"middle"===b?(a.css("cursor","url(images/cur/resize.cur),default"),a.css("boxShadow","4px 4px 2px #888888"),a.removeClass("onselected"),a.css("opacity","0.6")):"left"===b?a.addClass("zoomLeft"):"right"===b&&a.addClass("zoomRight")},checkCorsorhasClip:function(a){for(var b=!1,c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];
"a"===d.type&&0<d.subclip.length&&$.each(d.subclip,function(c,d){console.log("currTime",a);if(d.sequenceTrimIn<a&&d.sequenceTrimOut>a)return b=!0})}return b},checkNoClip:function(){for(;0<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;)return 0===PLAYER.jsonObj.rootBin.sequence[0].tracks[0].subclip.length?!0:!1},checkPrevSubClip:function(a){var b=null;$("#js_time_ruler_bar_box .edit_box_v").each(function(c,d){parseInt($(d).attr("data-sequencetrimout"))===a&&(b=$(d))});return b},checkNextSubClip:function(a){var b=
null;$(".edit_box_v").each(function(c,d){parseInt($(d).attr("data-sequencetrimin"))===a&&(b=$(d))});return b},addEffectClip:function(a,b){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++){var d=PLAYER.jsonObj.rootBin.sequence[0].tracks[c];"v"===d.type&&$.each(d.subclip,function(c,m){m&&m.createTime===a&&d.subclip[c].effect.push(b)})}},getEffectClip:function(a){for(var b=null,c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++)$.each(PLAYER.jsonObj.rootBin.sequence[0].tracks[c].subclip,
function(c,g){g&&g.createTime===a&&g.effect&&(b=JSON.stringify(g.effect))});return b},getCutNewEffectClip:function(a,b,c){if((a=JSON.parse(PLAYER.operateJson.getEffectClip(a)))&&0!==a.length){a=a.filter(function(a){return"header"!==a.pos&&"header-middle"!==a.pos});for(var d=0;d<a.length;d++)"all"===a[d].pos&&(a[d].trimIn=b,a[d].trimOut=c,a[d].duration=c-b)}console.log("cut\u540e\u65b0\u52a0\u5207\u7247\u7279\u6280",a);return a},getCutOldEffectClip:function(a,b,c){if((a=JSON.parse(PLAYER.operateJson.getEffectClip(a)))&&
0!==a.length){a=a.filter(function(a){return"footer"!==a.pos&&"footer-middle"!==a.pos});for(var d=0;d<a.length;d++)"all"===a[d].pos&&(a[d].trimIn=b,a[d].trimOut=c,a[d].duration=c-b)}if(a)return a},getCoverOldEffectClip:function(a,b,c){if((a=JSON.parse(PLAYER.operateJson.getEffectClip(a)))&&0!==a.length){a=a.filter(function(a){return"header"!==a.pos&&"header-middle"!==a.pos});for(var d=0;d<a.length;d++)"all"===a[d].pos&&(a[d].trimIn=b,a[d].trimOut=c,a[d].duration=c-b)}if(a)return a},updateEffectClip:function(a,
b){for(var c=0;c<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;c++)$.each(PLAYER.jsonObj.rootBin.sequence[0].tracks[c].subclip,function(c,g){g&&g.createTime===a&&g.effect&&$.each(g.effect,function(a,c){"mosaic"===c.type?$.extend(c.attr,b):"2D"===c.type&&$.extend(c.attr,b)})});console.log("\u66f4\u65b0\u7279\u6280",PLAYER.jsonObj.rootBin.sequence[0].tracks)},removeOtherEffectClip:function(a,b,c){for(var d=0;d<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;d++)$.each(PLAYER.jsonObj.rootBin.sequence[0].tracks[d].subclip,
function(d,m){m&&m.createTime===a&&m.effect&&m.effect.forEach(function(a,d){a.type===b&&a.pos===c&&m.effect.splice(d,1)})});console.log("\u5220\u9664\u6de1\u5165\u6de1\u51fa\u7b49\u7684\u5207\u7247",PLAYER.jsonObj.rootBin.sequence[0].tracks)},emptyTrack:function(a,b){$.each($(".time_ruler_bar"),function(c,d){$(d).attr("data-type")===a&&parseInt($(d).attr("data-index"))===b&&$(d).empty()})},getTrack:function(a,b){var c;$.each($(".time_ruler_bar"),function(d,g){if($(g).attr("data-type")===a&&parseInt($(g).attr("data-index"))===
b)return c=$(g)});return c},getMaterialDuration:function(a,b){$.ajax({url:serverUrl+"program/info",data:{assetId:a,jobId:PLAYER.jobId},async:!1,success:function(a){0===a.code&&null!==a.data?b(a.data):console.log("error")}})},getSubtitleDuration:function(a,b){b(PLAYER.subJsonTem[a])},getFirstFrame:function(){for(var a=[],b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];$.each(c.subclip,function(b,g){g&&a.push(c.subclip[b].sequenceTrimIn)})}return 0===
a.length?0:Math.min.apply(null,a)},getLastFrame:function(){for(var a=[],b=0;b<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;b++){var c=PLAYER.jsonObj.rootBin.sequence[0].tracks[b];0!==c.subclip.length&&$.each(c.subclip,function(b,c){a.push(c.sequenceTrimOut)})}if(0!==a.length)return Math.max.apply(null,a)},updateMaxDuration:function(a){PLAYER.jsonObj.rootBin.sequence[0].maxDuration=a},updateRulerMaxTime:function(){var a=Math.max(PLAYER.TR.config.maxTime,PLAYER.operateJson.getLastFrame()+15E3||
1E3);PLAYER.TR.updateEvent(a);PLAYER.TR.fixClipWidth();PLAYER.operateJson.updateMaxDuration(a);PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame()||1E3;$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||1E3));PLAYER.PTR.updateEvent(PLAYER.PTR.config)},getAudioIndex:function(a){var b=0;$.each(PLAYER.jsonObj.rootBin.sequence[0].track[1].subclip,function(c,d){d.createTime===a&&(b=c)});return b},addDraggingInfo:function(a,b){var c=a.attr("data-time"),
d="helpElem_"+PLAYER.genNonDuplicateID(12),g=a.clone().addClass("changeHelp");g.removeClass("onselected");g.attr("data-time",d);a.parent().append(g);g.hide();PLAYER.storeDraggingInfo.push({id:c,initAttr:b,helpElem:g})},getDraggingAttr:function(a){var b=null;$.each(PLAYER.storeDraggingInfo,function(c,d){d.id===a&&(b=d.initAttr)});return b},getDraggingHelp:function(a){var b=null;$.each(PLAYER.storeDraggingInfo,function(c,d){d.id===a&&(b=d.helpElem)});return b},removeDraggingInfo:function(a){for(var b=
0;b<PLAYER.storeDraggingInfo.length;b++)PLAYER.storeDraggingInfo[b].id===a&&PLAYER.storeDraggingInfo.splice(b,1);console.log("\u5220\u9664help",PLAYER.storeDraggingInfo)},checkNewWindow:function(a,b,c){a=JSON.parse(a);var d=b/a.pHeight,g=c/a.pWidth;for(b=0;b<a.rootBin.sequence[0].tracks.length;b++)$.each(a.rootBin.sequence[0].tracks[b].subclip,function(a,b){b&&b.effect&&$.each(b.effect,function(a,b){"mosaic"===b.type&&(b.attr.x1*=g,b.attr.y1*=d,b.attr.width*=g,b.attr.height*=g)})});return a},getSubtitleTemp:function(a){var b=
$("#ocx").width(),c=$("#ocx").height(),d=PLAYER.jsonObj.width,g=PLAYER.jsonObj.height;PLAYER.subJsonTem={subtitle_01:{id:"subtitle_01",name:"subtitle_01",duration:2E3,trimIn:0,trimOut:2E3,abs:{left_value:parseInt(1400/d*b),top_value:parseInt(40/g*c)},pixel:[{x1:parseInt(1400/d*b),y1:parseInt(40/g*c),width:parseInt(300/d*b),height:parseInt(285/g*c),attr:{type:"images",url:"http://112.126.71.150:82/FastCarve/s1_01.png"},attrID:"attrID_"+PLAYER.genNonDuplicateID(12)},{x1:parseInt(1400/d*b),y1:parseInt(360/
g*c),attr:{type:"fade",text:"NAME",fontFamily:"PingFang Heavy",fontSize:parseInt(54/g*c),fillStyle:"#ffffff",textAlign:"left",fadeInTime:1E3,fadeOutTime:1E3},attrID:"attrID_"+PLAYER.genNonDuplicateID(12)},{x1:parseInt(1400/d*b),y1:parseInt(410/g*c),attr:{type:"fade",text:"hellp",fontFamily:"PingFang Regular",fontSize:parseInt(40/g*c),fillStyle:"#ffffff",textAlign:"left",fadeInTime:1E3,fadeOutTime:1E3},attrID:"attrID_"+PLAYER.genNonDuplicateID(12)}]}};return JSON.stringify(PLAYER.subJsonTem[a])}};
PLAYER.EventTarget=function(){function a(){this.handlers={}}a.prototype={addHandler:function(a,c){"undefined"==typeof this.handlers[a]&&(this.handlers[a]=[]);this.handlers[a].push(c)},fire:function(a){a.target||(a.target=this);if(this.handlers[a.type]instanceof Array)for(var b=this.handlers[a.type],d=0,g=b.length;d<g;d++)b[d](a)},removeHandler:function(a,c){if(this.handlers[a]instanceof Array){a=this.handlers[a];for(var b=0,g=a.length;b<g&&a[b]!==c;b++);a.splice(b,1)}}};return a}();
PLAYER.timeRuler=function(){function a(a){l=this;l.config=$.extend(ma,a);l.targetObj=l.config.targetObj;l.trimInCurrTime=0;l.trimOutCurrTime=0;l.currTime=0;a=l.config;var n=l.targetObj;a.$header=$('<div class="'+n+'_header"></div>');a.$headerLeft=$('<div class="'+n+'_header_left fl"><div class="time_ruler_title_nowTime" id="js_time_ruler_title_nowTime">00:00:00:00</div><div class="time_ruler_title_toolbar"><span class="toolbar_insert_model add_audio_track" title="\u6dfb\u52a0\u97f3\u9891\u8f68\u9053" id="js_add_audio_track"><a class="fa fa-plus"></a></span></div></div>');
a.$headerRight=$('<div class="'+n+'_header_right fr"></div>');a.$rulerWrap=$('<div class="'+n+'_canvas_wrap"></div>');a.$ruler=$('<canvas class="'+n+'_canvas"></canvas>');a.$ruler.attr("width",a.$headerRight.width());a.$rulerWrap.append(a.$ruler);a.$headerRight.append(a.$rulerWrap);a.$header.append(a.$headerLeft);a.$header.append(a.$headerRight);X=a.$headerRight.width();a.$trimInOut=$('<div class="'+n+'_trimInOut"></div>');a.$trimInOut.css("height",a.trimHeight-2);a.$trimInOut.css("width","0px");
a.$trimInOut.appendTo(a.$rulerWrap);a.$trimIn=$('<div class="'+n+'_trimIn"></div>');a.$trimIn.css("height",a.trimHeight-2);a.$trimIn.appendTo(a.$trimInOut);a.$trimOut=$('<div class="'+n+'_trimOut"></div>');a.$trimOut.css("height",a.trimHeight-2);a.$trimOut.appendTo(a.$trimInOut);a.$cursor=$('<div class="'+n+'_cursor"></div>');a.$cursor.css("height",$("."+n).height()-70);a.$cursor.appendTo(a.$rulerWrap);$('<div class="'+n+'_cursor_top"></div>').appendTo(a.$cursor);a.$header.appendTo($("."+n));a.$body=
$('<div class="'+n+'_body"></div>');a.$clipTrackContainer=$('<div class="'+n+'_track_box" id="js_'+n+'_track_box">');a.$clipTrackLeft=$('<div class="time_ruler_title_box fl" id="js_time_ruler_title_box"></div>');a.$clipTrackLeft.html('<div class="time_ruler_title_list" data-type="t1">T1</div><div class="time_ruler_title_list" data-type="t2">T2</div><div class="time_ruler_title_list" data-type="v2">V2</div><div class="time_ruler_title_list" data-type="v1">V1</div><div class="time_ruler_title_list" data-type="a1">A1</div><div class="time_ruler_title_list" data-type="a2">A2</div>');
a.$clipTrackLeftRight=$('<div class="time_ruler_edit_box fr"></div>');a.$clipTrackBar=$('<div class="time_ruler_bar_box" id="js_time_ruler_bar_box"></div>');a.$clipTrackBar.html('<div class="'+n+'_bar bar_t"data-type="t" data-index="1"></div><div class="'+n+'_bar bar_t"data-type="t" data-index="2"></div><div class="'+n+'_bar bar_v"data-type="v" data-index="2"></div><div class="'+n+'_bar bar_v"data-type="v" data-index="1"></div><div class="'+n+'_bar bar_a"data-type="a" data-index="1"></div><div class="'+
n+'_bar bar_a"data-type="a" data-index="2"></div>');a.$line=$('<div class="'+n+'_line">');a.$clipTrackLeftRight.append(a.$clipTrackBar);a.$clipTrackLeftRight.append(a.$line);a.$clipTrackContainer.append(a.$clipTrackLeft);a.$clipTrackContainer.append(a.$clipTrackLeftRight);a.$scrollBar=$('<div class="'+n+'_track"><div class="'+n+'_scroll"></div></div>');a.$body.append(a.$clipTrackContainer);a.$body.append(a.$scrollBar);a.$footer=$('<div class="'+n+'_footer">');a.$sliderTrack=$('<div class="'+n+'_slider_track">');
a.$sliderBar=$('<div class="'+n+'_slider_scroll_total">');a.$sliderBarLeft=$('<div class="'+n+'_slider_scroll_left">');a.$sliderBarMiddle=$('<div class="'+n+'_slider_scroll_middle">');a.$sliderBarRight=$('<div class="'+n+'_slider_scroll_right">');a.$sliderBarLeft.appendTo(a.$sliderBar);a.$sliderBarMiddle.appendTo(a.$sliderBar);a.$sliderBarRight.appendTo(a.$sliderBar);a.$sliderBar.appendTo(a.$sliderTrack);a.$footer.append(a.$sliderTrack);$("."+n).append(a.$header);$("."+n).append(a.$body);$("."+n).append(a.$footer);
a=l.config;fa=a.$headerRight.width();a.framePerPixel=a.maxTime/fa;a.smallScaleFrame=b(a.framePerPixel).smallScaleFrame;a.smallScaleNumsPerLargeScale=b(a.framePerPixel).smallScaleNumsPerLargeScale;a.smallScaleWidth=a.smallScaleFrame/a.framePerPixel;a.largeScaleWidth=a.smallScaleWidth*a.smallScaleNumsPerLargeScale;a.largeScaleMillisecondInterval=a.smallScaleFrame*a.smallScaleNumsPerLargeScale*40;a.max_fpp=Math.min(a.maxTime/fa,11250);c(0);a=l.config;B=a.$sliderBarLeft.width();D=a.$sliderBarRight.width();
n=a.$headerRight.width()*a.$sliderTrack.width()/a.$rulerWrap.width();t=parseInt(a.$sliderTrack.width()-n);C=parseInt(a.$rulerWrap.width()-a.$headerRight.width());n>=a.$sliderTrack.width()&&(n=a.$sliderTrack.width());a.$sliderBar.css("width",n);a.$sliderBar.css("left",0);a.$sliderBarMiddle.css("width",n-B-D);a.$sliderBarMiddle.css("left",B);a.$sliderBarLeft.css("left",0);a.$sliderBarRight.css("left",n-D);g();G();ba();this.config.$rulerWrap.addEventListener("mousedown",J);this.config.$rulerWrap.addEventListener("mousemove",
Q);this.config.$trimIn.addEventListener("mousemove",H);this.config.$trimOut.addEventListener("mousemove",O);this.DragDrop.addHandler("clipDragstart",A);this.DragDrop.addHandler("clipDrag",ia);this.DragDrop.addHandler("clipDragend",V);this.DragDrop.addHandler("clipClick",ca);this.DragDrop.addHandler("clipCheckDir",Y);this.DragDrop.addHandler("clipDblclick",da);this.DragDrop.addHandler("sequenceClick",aa);this.DragDrop.addHandler("effectClick",W);this.DragDrop.addHandler("keydown",z);window.addEventListener("resize",
d);PLAYER.EventUtil.addHandler($(".time_ruler_edit_box")[0],"click",x)}function b(a){for(var b=[],k={},c=0;c<ga.length;c++)a<=ga[c].smallScaleFrame*ga[c].smallScaleNumsPerLargeScale/80&&b.push(c);k.smallScaleFrame=ga[b[0]].smallScaleFrame;k.smallScaleNumsPerLargeScale=ga[b[0]].smallScaleNumsPerLargeScale;return k}function c(a){var b=l.config;a=parseInt(a);var k=b.$headerRight.width(),c=b.$headerRight.height();b.$ruler.attr("width",k);b.$ruler.attr("height",c);var f=b.$ruler[0].getContext("2d");f.clearRect(0,
0,k,c);f.fillStyle=b.backgroundColor;f.fillRect(0,0,k,c);f.lineWidth=1;f.strokeStyle=b.scaleColor;f.fillStyle=b.fontColor;f.font=b.fontSize+"px "+b.fontFamily;f.textAlign="center";f.beginPath();var r=parseInt(a/b.largeScaleWidth)*b.largeScaleMillisecondInterval,d=parseInt(a/b.smallScaleWidth)+1;a=d*b.smallScaleWidth-a;for(var d=d%b.smallScaleNumsPerLargeScale,g=0,ka=0;g<k;){g=ka*b.smallScaleWidth+.3+a;if(0==d%b.smallScaleNumsPerLargeScale){f.moveTo(g,c-1);f.lineTo(g,c-b.largeScaleHeight);var r=r+
b.largeScaleMillisecondInterval,h=PLAYER.$millisecondsToTimeFrame(r);f.fillText(h,g,c-b.largeScaleHeight-3)}else f.moveTo(g,c-1),f.lineTo(g,c-b.smallScaleHeight);ka++;d++}f.stroke()}function d(){var a=l.config;a.$headerRight.width(a.$headerRight.parent().width()-151);l.updateEvent(l.config.maxTime,!0)}function g(){var a=l.config;a.$rulerWrap.addEventListener=function(b,k){"mousedown"==b?a.$rulerWrap.mousedown(function(a){a.stopPropagation();v(a.clientX,a.clientY,k);document.onmousemove=function(a){v(a.clientX,
a.clientY,k)};document.onmouseup=function(a){this.onmouseup=this.onmousemove=null}}):"click"==b?(e.stopPropagation(),$(this)==a.$ruler&&v(e.clientX,e.clientY,k)):"mousemove"==b&&m(a.$cursor,k)}}function m(a,b){function k(a){a=a||event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();v(a.clientX,a.clientY,b)}function n(a){this.onmouseup=this.onmousemove=null}a.mousedown(function(a){a.stopPropagation();a=a||event;this.ondragstart=function(){return!1};document.onmousemove=
k;document.onmouseup=n})}function v(a,b,f){PLAYER.checkPlaying();b=l.config;var k=fa;a-=b.$headerRight.offset().left;var n=Math.abs(parseFloat(b.$rulerWrap.css("margin-left")));r=a+n;r=parseFloat(r*b.framePerPixel)/b.framePerPixel;0>=r&&(r=0);r>=b.$rulerWrap.width()&&(r=b.$rulerWrap.width());r-n>k&&(u=r-k,t=parseFloat(b.$sliderTrack.width()-b.$sliderBar.width()),C=parseFloat(b.$rulerWrap.width()-k),q=u*t/C,b.$sliderBar.css("left",q),b.$rulerWrap.css("margin-left",-u),b.$ruler.css("left",u),c(u),b.$sliderBar.css("left",
q),b.$rulerWrap.css("margin-left",-u),b.$ruler.css("left",u),b.$clipTrackBar.css("margin-left",-u),c(u));r<n&&(u=r,q=u*b.$sliderTrack.width()/b.$rulerWrap.width(),b.$sliderBar.css("left",q),b.$rulerWrap.css("margin-left",-u),b.$ruler.css("left",u),c(u),b.$sliderBar.css("left",q),b.$rulerWrap.css("margin-left",-u),b.$ruler.css("left",u),b.$clipTrackBar.css("margin-left",-u),c(u));b.$cursor.css("left",r);b.$line.css("left",r);k=l.currTime;l.currTime=Math.round(r*b.framePerPixel);null!==f&&k!==l.currTime&&
f(l.currTime)}function J(a){PLAYER.checkPlaying();l.currTime=a;l.fixArrowCurrentTime(a);PLAYER.OCX.seek(a);a>=PLAYER.PTR.config.maxTime&&(a=PLAYER.PTR.config.maxTime);PLAYER.PTR.currTime=a;PLAYER.PTR.fixArrowCurrentTime(a);PLAYER.operateJson.checkCorsorhasClip(l.currTime)||document.getElementById("js_voCanvas").getContext("2d").clearRect(0,0,100,500)}function Q(a){PLAYER.checkPlaying();l.config.seekComandTimesMonitor.push(a)}function w(a,b){var k={};k.clipInitTime=a.attr("data-time");k.clipInitWidth=
parseInt(a.outerWidth());k.clipInitLeft=parseInt(a.position().left);k.clipInitClientX=b.x;k.clipInitOffsetLeft=parseInt(a.parent().offset().left);k.clipInitTop=parseInt(a.position().top);k.clipInitClientY=b.y;k.clipInitOffsetTop=parseInt(a.parent().offset().top);k.clipInitIndex=parseInt(a.parent().attr("data-index"));k.clipInitType=a.parent().attr("data-type");k.clipInitTrimIn=parseInt(a.attr("data-trimin"));k.clipInitTrimOut=parseInt(a.attr("data-trimout"));k.clipInitSequenceTrimIn=parseInt(a.attr("data-sequencetrimin"));
k.clipInitSequenceTrimOut=parseInt(a.attr("data-sequencetrimout"));k.clipMaxFrame=parseInt(a.attr("data-duration"))||0;1<=a.find(".effect_box_r").length&&PLAYER.operateJson.checkNextSubClip(k.clipInitSequenceTrimOut)&&(k.nextClip=PLAYER.operateJson.checkNextSubClip(k.clipInitSequenceTrimOut).attr("data-time"));1<=a.find(".effect_box_l").length&&PLAYER.operateJson.checkPrevSubClip(k.clipInitSequenceTrimIn)&&(k.prevClip=PLAYER.operateJson.checkPrevSubClip(k.clipInitSequenceTrimIn).attr("data-time"));
return JSON.stringify(k)}function A(a){dragging=a.target;PLAYER.checkPlaying();0!==$(".space").size()&&$(".space").remove()}function ia(a){function b(a){var b;$.each(q.siblings(),function(k,c){$(c).hasClass("onselected")||$(c).hasClass("changeHelp")||(k=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,c=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,10>=Math.abs(k)&&(b=parseInt($(this).attr("data-sequencetrimin"))),
10>=Math.abs(c)&&(b=parseInt($(this).attr("data-sequencetrimout"))))});if(!b){var k=q.attr("data-intid"),c;$.each(q.parent().siblings().children(".changeHelp"),function(f,n){$(n).attr("data-intid")===k&&(c=$(n),$.each(c.siblings(),function(k,c){$(c).hasClass("onselected")||$(c).hasClass("changeHelp")||(k=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,c=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,10>=Math.abs(k)&&
(b=parseInt($(this).attr("data-sequencetrimin"))),10>=Math.abs(c)&&(b=parseInt($(this).attr("data-sequencetrimout"))))}))})}return b}function k(a){var b;$.each(q.siblings(),function(c,k){$(k).hasClass("onselected")||$(k).hasClass("changeHelp")||(c=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,k=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,10>=Math.abs(c)&&(b=parseInt($(this).attr("data-sequencetrimin"))),10>=Math.abs(k)&&
(b=parseInt($(this).attr("data-sequencetrimout"))))});if(!b){var k=q.attr("data-intid"),c;$.each(q.parent().siblings().children(".changeHelp"),function(f,n){$(n).attr("data-intid")===k&&(c=$(n),$.each(c.siblings(),function(k,c){$(c).hasClass("onselected")||$(c).hasClass("changeHelp")||(k=Math.abs(a-parseInt($(this).attr("data-sequencetrimin")))/PLAYER.TR.config.framePerPixel,c=Math.abs(a-parseInt($(this).attr("data-sequencetrimout")))/PLAYER.TR.config.framePerPixel,10>=Math.abs(k)&&(b=parseInt($(this).attr("data-sequencetrimin"))),
10>=Math.abs(c)&&(b=parseInt($(this).attr("data-sequencetrimout"))))}))})}return b}function c(c,f){if(0<y){var n=a.max_out+f;f=b(n);n=Math.abs(n-f)/d.framePerPixel;10>=Math.abs(n)?(U=clipInitSequenceTrimOut+f-a.max_out,I=U-(c.attr("data-trimout")-c.attr("data-trimin")),u=Math.round(I/d.framePerPixel),PLAYER.operateJson.showAdhere(c,"backward")):PLAYER.operateJson.hideAdhere(c)}else n=a.min_in+f,f=k(n),console.log("adhere_point",f),n=Math.abs(n-f)/d.framePerPixel,10>=Math.abs(n)?(I=clipInitSequenceTrimIn+
f-a.min_in,U=I+(c.attr("data-trimout")-c.attr("data-trimin")),u=Math.round(I/d.framePerPixel),PLAYER.operateJson.showAdhere(c,"forward")):PLAYER.operateJson.hideAdhere(c)}function f(b,c){c=a.min_in+c;var f=k(c);10>=Math.abs(Math.abs(c-f)/d.framePerPixel)?(c=f,I=clipInitSequenceTrimIn+c-a.min_in,Z=clipInitTrimIn+c-a.min_in,u=Math.round(I/d.framePerPixel),t=(clipInitSequenceTrimOut-I)/d.framePerPixel,PLAYER.operateJson.showAdhere(b,"forward")):PLAYER.operateJson.hideAdhere(b)}function r(c,k){k=a.max_out+
k;var f=b(k);10>=Math.abs((k-f)/d.framePerPixel)?(U=clipInitSequenceTrimOut+f-a.max_out,R=clipInitTrimOut+(U-clipInitSequenceTrimOut),t=Math.round((U-clipInitSequenceTrimIn)/d.framePerPixel),PLAYER.operateJson.showAdhere(c,"backward")):PLAYER.operateJson.hideAdhere(c)}var d=l.config,g=$(a.target);d.$header.width();var h=g.attr("data-time"),q=PLAYER.operateJson.getDraggingHelp(h);q.show();h=JSON.parse(PLAYER.operateJson.getDraggingAttr(h));clipInitWidth=h.clipInitWidth;clipInitLeft=h.clipInitLeft;
clipInitClientX=h.clipInitClientX;clipInitOffsetLeft=h.clipInitOffsetLeft;clipInitTop=h.clipInitTop;clipInitClientY=h.clipInitClientY;clipInitOffsetTop=h.clipInitOffsetTop;clipInitIndex=h.clipInitIndex;clipInitType=h.clipInitType;clipInitTrimIn=h.clipInitTrimIn;clipInitTrimOut=h.clipInitTrimOut;clipInitSequenceTrimIn=h.clipInitSequenceTrimIn;clipInitSequenceTrimOut=h.clipInitSequenceTrimOut;clipMaxFrame=h.clipMaxFrame;h=g.attr("data-clipdir");PLAYER.operateJson.mouseMoveState(q,h);if("middle"===h){var y=
a.x-clipInitClientX,h=Math.floor((a.x-clipInitClientX)*d.framePerPixel);I=clipInitSequenceTrimIn+h;0>=a.min_in+h&&(h=-a.min_in,I=clipInitSequenceTrimIn-a.min_in);0>=I&&(I=0);U=I+(q.attr("data-trimout")-q.attr("data-trimin"));u=I/d.framePerPixel;c(q,h);PLAYER.help_index=a.cal_index;PLAYER.help_index&&1<=PLAYER.help_index&&T(q,clipInitType,PLAYER.help_index);q.attr("data-sequencetrimin",I);q.attr("data-sequencetrimout",U);q.css("left",u)}else if("left"===h){var t=clipInitWidth-(a.x-clipInitClientX),
u=clipInitLeft+(a.x-clipInitClientX),P=(a.x-clipInitClientX)*d.framePerPixel/d.framePerPixel,h=Math.round(P*d.framePerPixel);Z=clipInitTrimIn+h;I=clipInitSequenceTrimOut-clipInitTrimOut+Z;"subtitle"!==g.attr("data-type")&&"video"!==g.attr("data-type")&&0>=Z&&(Z=0,I=clipInitSequenceTrimOut-clipInitTrimOut,h=Z-clipInitTrimIn,P=h/d.framePerPixel,u=clipInitLeft+P,t=clipInitWidth-P);Z>=clipInitTrimOut-1&&(Z=clipInitTrimOut-1,I=clipInitSequenceTrimOut-1,h=Z-clipInitTrimIn,P=h/d.framePerPixel,u=clipInitLeft+
P,t=clipInitWidth-P);0>=u&&(I=u=0,Z=clipInitTrimOut-clipInitSequenceTrimOut,t=clipInitWidth+clipInitLeft);f(q,h);q.attr("data-trimin",Z);q.attr("data-sequencetrimin",I);q.css("width",t);q.css("left",u)}else"right"===h&&(t=clipInitWidth+(a.x-clipInitClientX),P=(a.x-clipInitClientX)*d.framePerPixel/d.framePerPixel,h=Math.round(P*d.framePerPixel),R=clipInitTrimOut+h,U=clipInitSequenceTrimIn+R-clipInitTrimIn,"subtitle"!==g.attr("data-type")&&"video"!==g.attr("data-type")&&R>=clipMaxFrame&&(R=clipMaxFrame,
U=clipInitSequenceTrimIn+R-clipInitTrimIn,h=R-clipInitTrimOut,P=h/d.framePerPixel,t=clipInitWidth+P),R<=clipInitTrimIn+1&&(R=clipInitTrimIn+1,U=clipInitSequenceTrimIn+R-clipInitTrimIn,h=R-clipInitTrimOut,P=h/d.framePerPixel,t=clipInitWidth+P),t+clipInitLeft>=d.$rulerWrap.width()&&(t=d.$rulerWrap.width()-clipInitLeft,P=t-clipInitWidth,h=Math.round(P*d.framePerPixel),R=clipInitTrimOut+h,U=clipInitSequenceTrimIn+R-clipInitTrimIn),r(q,h),q.attr("data-trimout",R),q.attr("data-sequencetrimout",U),q.css("width",
t))}function T(a,b,c){$.each($('.time_ruler_bar[data-type="'+b+'"]'),function(b,k){parseInt($(k).attr("data-index"))===c&&$(this).append(a)});return a}function V(a){var b=a.target;a=b.attr("data-time");var c=JSON.parse(PLAYER.operateJson.getDraggingAttr(a)),k=b.attr("data-clipdir"),f=PLAYER.operateJson.getDraggingHelp(a),r=parseInt(f.attr("data-sequencetrimin")),d=parseInt(f.attr("data-sequencetrimout")),h=parseInt(f.attr("data-trimin")),q=parseInt(f.attr("data-trimout")),g=f.css("left"),t=f.width(),
l={sequenceTrimIn:r,sequenceTrimOut:d,trimIn:h,trimOut:q};b.attr("data-sequencetrimin",r);b.attr("data-sequencetrimout",d);b.attr("data-trimin",h);b.attr("data-trimout",q);b.css("left",g);b.css("width",t);"left"!==k&&c.nextClip?(k=b.find(".effect_box_r").attr("data-type"),r=b.find(".effect_box_r").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(a,k,r),$(".edit_box_v").each(function(a,b){if($(b).attr("data-time")===c.nextClip){a=$(b).find(".effect_box_l").attr("data-type");var k=$(b).find(".effect_box_l").attr("data-pos");
PLAYER.operateJson.removeOtherEffectClip(c.nextClip,a,k);$(b).find(".effect_box_l").remove()}}),b.find(".effect_box_r").remove()):"right"!==k&&c.prevClip&&(k=b.find(".effect_box_l").attr("data-type"),r=b.find(".effect_box_l").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(a,k,r),$(".edit_box_v").each(function(a,b){if($(b).attr("data-time")===c.prevClip){a=$(b).find(".effect_box_r").attr("data-type");var k=$(b).find(".effect_box_r").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(c.prevClip,
a,k);$(b).find(".effect_box_r").remove()}}),b.find(".effect_box_l").remove());k=f.parent().attr("data-type");r=parseInt(f.parent().attr("data-index"));T(b,k,r);var y=[];$.each(f.siblings(),function(a,b){$(b).hasClass("onselected")||$(b).hasClass("changeHelp")||y.push($(b))});1<=y.length&&PLAYER.operateJson.checkCoverEvent(f,f.attr("data-intid"));b=parseInt(f.parent().attr("data-index"));k=f.parent().attr("data-type");PLAYER.operateJson.updateClipAttr(l,a);PLAYER.operateJson.changeIndexClipAttr(k,
b,a);PLAYER.operateJson.removeDraggingInfo(a);f.remove()}function ca(a){var b=l.config,c=a.target,k=c.attr("data-time"),f=PLAYER.operateJson.getDraggingHelp(k);PLAYER.operateJson.removeDraggingInfo(k);f.remove();if(85===PLAYER.keyNum){PLAYER.checkPlaying();c.removeClass("onselected");c.css("cursor","url(images/cur/cut.cur),default");var r,d,h,q,g=c.attr("data-id"),k=c.attr("data-time"),t=c.attr("data-interleaved"),y=parseInt(c.parent(".time_ruler_bar").attr("data-index")),u=c.attr("data-type"),p=
u+"_"+PLAYER.genNonDuplicateID(12),C=parseInt(c.offset().left),f=parseInt(c.width()),m;if(!(a.x<=C||a.x>=C+f)){h=parseInt((a.x-C)*b.framePerPixel)/b.framePerPixel;f=parseInt(c.attr("data-trimin"));d=parseInt(f+Math.round(h*b.framePerPixel));r=parseInt(c.attr("data-sequencetrimin"));b=parseInt(r+Math.round(h*b.framePerPixel));q=parseInt(c.attr("data-trimout"));h=parseInt(c.attr("data-sequencetrimout"));m=c.clone();m.find(".effect_box_l")&&m.find(".effect_box_l").remove();m.find(".effect_box_r")&&c.find(".effect_box_r").remove();
m.removeClass("onselected");m.attr("data-trimin",d);m.attr("data-trimout",q);m.attr("data-sequencetrimin",b);m.attr("data-sequencetrimout",h);m.attr("data-time",p);m.attr("data-intid",a.intId);var w=a.x-c.parent().offset().left,ha=c.outerWidth()-(a.x-C);m.css("left",w);m.css("width",ha);c.parent(".time_ruler_bar").append(m);c.parent(".time_ruler_bar").hasClass("bar_v")?(m=PLAYER.operateJson.getCutNewEffectClip(k,d,q),u={assetID:g,trimIn:d,trimOut:q,sequenceTrimIn:b,sequenceTrimOut:h,effect:m,createTime:p,
type:u,interleaved_id:a.intId},u.interleaved="true"===t?!0:!1,PLAYER.operateJson.addVideoClipAttr(u,y)):c.parent(".time_ruler_bar").hasClass("bar_a")?(u={assetID:g,trimIn:d,trimOut:q,sequenceTrimIn:b,sequenceTrimOut:h,volume:100,createTime:p,type:u,interleaved_id:a.intId},u.interleaved="true"===t?!0:!1,PLAYER.operateJson.addAudioClipAttr(u,y)):c.parent(".time_ruler_bar").hasClass("bar_t")&&(t=JSON.parse(PLAYER.operateJson.getSubtitleClip(k,y)),$.extend(t,{trimIn:d,trimOut:q,sequenceTrimIn:b,sequenceTrimOut:h,
createTime:p,type:u,interleaved_id:a.intId}),PLAYER.operateJson.addSubtitleClipAttr(t,y));c.attr("data-trimout",d);c.attr("data-sequencetrimout",b);c.width(a.x-C);a={trimIn:f,trimOut:d,sequenceTrimIn:r,sequenceTrimOut:b};c=PLAYER.operateJson.getCutOldEffectClip(k,f,d);PLAYER.operateJson.updateClipAttr(a,k,c)}}}function Y(a){var b=a.target,c=parseInt(b.position().left),f=parseInt(b.outerWidth()),k=b.parent(".time_ruler_bar").offset().left;a=a.x;85===PLAYER.keyNum?b.css({cursor:"url(images/cur/cut.cur),default"}):
71===PLAYER.keyNum?b.css({cursor:"url(images/cur/select_back.cur),default"}):7100===PLAYER.keyNum?b.css({cursor:"url(images/cur/select_pre.cur),default"}):187===PLAYER.keyNum?b.css({cursor:"url(images/cur/zoom_plus.cur),default"}):189===PLAYER.keyNum?b.css({cursor:"url(images/cur/zoom_minus.cur),default"}):8>=Math.abs(k+c-a)?b.css({cursor:"url(images/cur/cursor1.cur),default"}):8>=Math.abs(k+c+f-a)?b.css({cursor:"url(images/cur/cursor2.cur),default"}):b.css({cursor:"default"})}function aa(a){var b=
l.config;if(0!==a.target.children().length){0!==$(".space").size()&&$(".space").remove();var c=a.x-a.target.parent().offset().left,c=parseInt(c*b.framePerPixel)/b.framePerPixel,f=Math.round(c*b.framePerPixel),k=[],r=[],d=[],h=[],q,g=$('<div class="space"></div>');$.each(a.target.children(".edit_box"),function(a,b){parseInt($(b).attr("data-sequencetrimin"))>f&&r.push(parseInt($(b).attr("data-sequencetrimin")));$(b).attr("data-sequencetrimout")<f&&k.push(parseInt($(b).attr("data-sequencetrimout")))});
if(0===r.length)return!1;0===k.length&&k.push(0);c=Math.min.apply(null,r);q=Math.max.apply(null,k);var t=a.target.children('.edit_box[data-sequencetrimin="'+c+'"]');a.target.children('.edit_box[data-sequencetrimout="'+q+'"]');g.attr("data-sequencetrimin",q);g.attr("data-sequencetrimout",c);g.css("left",q/b.framePerPixel);g.css("width",(c-q)/b.framePerPixel);g.insertBefore(t);"true"===t.attr("data-interleaved")&&(a=PLAYER.operateJson.chooseInterleavedElem(t),h.push(parseInt(a.attr("data-sequencetrimin"))),
parseInt(a.siblings().attr("data-sequencetrimout"))<=parseInt(a.attr("data-sequencetrimin"))&&d.push(parseInt(a.siblings().attr("data-sequencetrimout"))));a=0===d.length?0:Math.max.apply(null,d);if(0===h.length)return!1;a=Math.min.apply(null,h)-a;c-q>=a&&g.attr("data-offset",a)}}function W(a){a=a.target;a.toggleClass("onEffect");if("footer-middle"===a.attr("data-pos")){var b=parseInt(a.parent().attr("data-sequencetrimout")),b=PLAYER.operateJson.checkNextSubClip(b);b.children(".effect_box_l").toggleClass("onEffect")}"header-middle"===
a.attr("data-pos")&&(a=parseInt(a.parent().attr("data-sequencetrimin")),b=PLAYER.operateJson.checkPrevSubClip(a),b.children(".effect_box_r").toggleClass("onEffect"))}function da(a){PLAYER.hideSubititleEdit();a=a.target;var b=a.attr("data-time");parseInt(a.attr("data-sequencetrimin"));var c=parseInt(a.parent().attr("data-index")),f=a.parent().attr("data-type"),k=JSON.parse(PLAYER.operateJson.getSubtitleClip(b,c));PLAYER.showSubititleEdit();K(k);M(k,k.id,f);ea(k,b,c,f,"subtitle");a.hasClass&&a.hasClass("draggable")&&
PLAYER.operateJson.mouseUpState(a)}function K(a){$("#js_subtitle_h_form").empty();var b;b=$('<div class="form-group"><label class="col-md-4 control-label" for="fontsize">\u5de6\u8fb9\u8ddd</label><div class="col-md-8"><input type="range" class="form-control" id="js_subtitle_left" step="0.5"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_subtitle_left_value" disabled="disabled"></div></div><div class="form-group"><label class="col-md-4 control-label" for="fontsize">\u4e0a\u8fb9\u8ddd</label><div class="col-md-8"><input type="range" class="form-control" id="js_subtitle_top" step="0.5"></div></div><div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><input type="text" class="form-control" id="js_subtitle_top_value" disabled="disabled"></div></div>');
$("#js_subtitle_h_form").append(b);b=a.pixel.filter(function(a){return"images"!==a.attr.type});a.pixel.filter(function(a){return"images"===a.attr.type});$.each(b,function(a,b){var c=$('<div class="form-group"><label class="col-md-4 control-label" for="name" >\u5b57\u4f53'+(a+1)+'</label><div class="col-md-8"><input type="text" class="form-control subtitle_text" id="js_subtitle_text'+(a+1)+'" placeholder="\u5b57\u4f53'+(a+1)+'" data-id="'+b.attrID+'"></div></div>'),f=$('<div class="form-group"><label class="col-md-4 control-label" for="fontcolor">\u5b57\u4f53'+
(a+1)+'\u989c\u8272</label><div class="col-md-8"><input type="text" class="form-control subtitle_color" id="js_subtitle_color'+(a+1)+'" data-control="hue" value="#ffffff" data-id="'+b.attrID+'"></div></div>');a=$('<div class="form-group"><label class="col-md-4 control-label" for="fontsize">\u5b57\u4f53'+(a+1)+'\u5b57\u53f7</label><div class="col-md-8"><input type="number" class="form-control subtitle_fontsize" id="js_subtitle_fontsize'+(a+1)+'" data-id="'+b.attrID+'"></div></div>');$("#js_subtitle_h_form").append(c);
$("#js_subtitle_h_form").append(f);$("#js_subtitle_h_form").append(a)});a=$('<div class="form-group"><label class="col-md-4 control-label" for="name" ></label><div class="col-md-8"><button type="button" class="btn btn-sm pull-right" id="js_subtitle_btn">\u5173\u95ed</button></div></div>');$("#js_subtitle_h_form").append(a)}function M(a,b,c){c=a.pixel.filter(function(a){return"images"!==a.attr.type});$("#js_subtitle_h_form").height()>$(".subtitle_h_form_wrap").height()&&($(".subtitle_edit_track").show(),
new Scrollbar({dirSelector:"y",contSelector:$(".subtitle_h_form_wrap"),barSelector:$(".subtitle_edit_track"),sliderSelector:$(".subtitle_edit_scroll")}));if("subtitle_01"===b||"subtitle_02"===b||"subtitle_03"===b||"subtitle_05"===b||"subtitle_06"===b||"subtitle_07"===b)$("#js_subtitle_left").attr("max",$("#ocx").width()),$("#js_subtitle_top").attr("max",$("#ocx").height()),$("#js_subtitle_left").attr("min",0),$("#js_subtitle_top").attr("min",0),$("#js_subtitle_left,#js_subtitle_left_value").val(a.abs.left_value),
$("#js_subtitle_top,#js_subtitle_top_value").val(a.abs.top_value),$("#js_subtitle_text1").val(c[0].attr.text),$("#js_subtitle_text2").val(c[1].attr.text),$("#js_subtitle_fontsize1").val(c[0].attr.fontSize),$("#js_subtitle_fontsize2").val(c[1].attr.fontSize),$("#js_subtitle_color1").val(c[0].attr.fillStyle),$("#js_subtitle_color2").val(c[1].attr.fillStyle),$("#js_subtitle_color1").minicolors({control:$(this).attr("data-control")||"hue",defaultValue:$(this).attr("data-defaultValue")||"",inline:"true"===
$(this).attr("data-inline"),letterCase:$(this).attr("data-letterCase")||"lowercase",opacity:$(this).attr("data-opacity"),position:$(this).attr("data-position")||"bottom left",change:function(a,b){if(a){b&&(a+=", "+b);try{$("#js_subtitle_color1").val(a)}catch(ja){console.log(ja)}}},theme:"bootstrap"}),$("#js_subtitle_color2").minicolors({control:$(this).attr("data-control")||"hue",defaultValue:$(this).attr("data-defaultValue")||"",inline:"true"===$(this).attr("data-inline"),letterCase:$(this).attr("data-letterCase")||
"lowercase",opacity:$(this).attr("data-opacity"),position:$(this).attr("data-position")||"bottom left",change:function(a,b){if(a){b&&(a+=", "+b);try{$("#js_subtitle_color2").val(a)}catch(ja){console.log(ja)}}},theme:"bootstrap"})}function ea(a,b,c,f,r){function k(a,b,c){$.each(a.attr,function(a,f){f.attrID===b&&$.extend(f.attr,c)})}function d(a){PLAYER.OCX.adjustEffect(a);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime));var b=parseInt($("#js_subtitle_left_value").val()),c=parseInt($("#js_subtitle_top_value").val());
PLAYER.operateJson.updateSubtitleClip(a,b,c)}for(var n=JSON.stringify(a.pixel),h=JSON.parse(JSON.stringify(a.pixel)),q=[],g=[],t=0;t<h.length;t++)q[t]=h[t].x1-JSON.parse(JSON.stringify(a.abs.left_value));for(t=0;t<h.length;t++)g[t]=h[t].y1-JSON.parse(JSON.stringify(a.abs.top_value));var L={trackType:f,trackIndex:c,subClipId:b,name:r,attr:JSON.parse(n)};$("#js_subtitle_left")[0].oninput=function(a){$("#js_subtitle_left_value").val($(a.target).val());for(var b=0;b<L.attr.length;b++)L.attr[b].x1=q[b]+
parseInt($(a.target).val());d(L)};$("#js_subtitle_top")[0].oninput=function(a){$("#js_subtitle_top_value").val($(a.target).val());for(var b=0;b<L.attr.length;b++)L.attr[b].y1=g[b]+parseInt($(a.target).val());d(L)};$("#js_subtitle_h_form .subtitle_text").on("change",function(a){var b=$(a.target).attr("data-id");a={text:$(a.target).val()};k(L,b,a);d(L)});$("#js_subtitle_h_form .subtitle_color").on("change",function(a){var b=$(a.target).attr("data-id");a={fillStyle:$(a.target).val()};k(L,b,a);d(L)});
$("#js_subtitle_h_form .subtitle_fontsize").on("change",function(a){var b=$(a.target).attr("data-id");a={fontSize:$(a.target).val()};k(L,b,a);d(L)});$("#js_subtitle_btn").on("click",function(a){PLAYER.hideSubititleEdit()})}function z(a){function b(a,b,f,r){var d,k,h,n,q,g,L,y;v_initId=a.attr("data-intid");intId=v_initId+1;h=a.attr("data-id");k=a.attr("data-type");n=a.attr("data-interleaved");q=parseInt(b.attr("data-index"));var l=k+"_"+PLAYER.genNonDuplicateID(12);L=parseInt(a.attr("data-trimin"));
y=parseInt(a.attr("data-trimout"));g=parseInt(a.attr("data-sequencetrimin"));parseInt(a.attr("data-sequencetrimout"));r=g-r+t;g=r+y-L;d=a.clone();d.css("left",r/c.framePerPixel);d.attr("data-sequencetrimin",r);d.attr("data-sequencetrimout",g);d.attr("data-time",l);d.attr("data-intid",intId);b.append(d);PLAYER.operateJson.checkCoverEvent(d,f);b.hasClass("bar_v")?(a=a.attr("data-time"),(a=JSON.parse(PLAYER.operateJson.getEffectClip(a)))&&0!==a.length?$.each(a,function(a,b){"all"===$(this).pos&&($(this).trimIn=
L,$(this).trimOut=y)}):a=[],k={assetID:h,trimIn:L,trimOut:y,sequenceTrimIn:r,sequenceTrimOut:g,effect:a,createTime:l,type:k},"true"===n?(k.interleaved=!0,k.interleaved_id=intId):(k.interleaved=!1,n="interleaved_id_"+PLAYER.genNonDuplicateID(12),k.interleaved_id=n),PLAYER.operateJson.addVideoClipAttr(k,q)):b.hasClass("bar_a")?(k={assetID:h,trimIn:L,trimOut:y,sequenceTrimIn:r,sequenceTrimOut:g,volume:100,createTime:l,type:k,interleaved_id:intId},"true"===n?(k.interleaved=!0,k.interleaved_id=intId):
(k.interleaved=!1,n="interleaved_id_"+PLAYER.genNonDuplicateID(12),k.interleaved_id=n),PLAYER.operateJson.addAudioClipAttr(k,q)):b.hasClass("bar_t")&&(add_subclip.css("background","pink"),h=JSON.parse(PLAYER.subtitleAttr[h]),n="interleaved_id_"+PLAYER.genNonDuplicateID(12),$.extend(h,{trimIn:L,trimOut:y,sequenceTrimIn:r,sequenceTrimOut:g,createTime:l,type:k,interleaved_id:n}),PLAYER.operateJson.addSubtitleClipAttr(h,q))}var c=l.config,f=c.$sliderBar.width(),r=c.$sliderBar.position().left,d=Math.abs(parseFloat(c.$rulerWrap.css("marginLeft"))),
k=c.framePerPixel,h=a.code,q=null;if(189===h)f!==c.$headerRight.width()&&F(10,k,f,r,d);else if(187===h)f!==2*D+8&&F(-10,k,f,r,d);else if(46===h||8===h){if(h=0,a.returnValue=!1,PLAYER.checkPlaying(),!a.target.hasClass("form-control")){0<$("#js_time_ruler_bar_box .onselected").length&&($.each($(".onselected"),function(a,b){a=$(b).attr("data-time");var c=parseInt($(b).attr("data-sequencetrimin")),f=parseInt($(b).attr("data-sequencetrimout"));if(1<=$(b).find(".effect_box_r").length&&PLAYER.operateJson.checkNextSubClip(f)){var r=
PLAYER.operateJson.checkNextSubClip(f).attr("data-time"),f=$('.edit_box_v[data-time="'+r+'"]').find(".effect_box_l").attr("data-type"),d=$('.edit_box_v[data-time="'+r+'"]').find(".effect_box_l").attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(r,f,d);$('.edit_box_v[data-time="'+r+'"]').find(".effect_box_l").remove()}1<=$(b).find(".effect_box_l").length&&PLAYER.operateJson.checkPrevSubClip(c)&&(c=PLAYER.operateJson.checkPrevSubClip(c).attr("data-time"),f=$('.edit_box_v[data-time="'+c+'"]').find(".effect_box_r").attr("data-type"),
d=$('.edit_box_v[data-time="'+c+'"]').find(".effect_box_r").attr("data-pos"),PLAYER.operateJson.removeOtherEffectClip(c,f,d),$('.edit_box_v[data-time="'+c+'"]').find(".effect_box_r").remove());PLAYER.operateJson.deleteClipAttr(a);$(b).remove()}),PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]),PLAYER.OCX.updateProjectJson(PLAYER.jsonObj),PLAYER.OCX.seek(parseInt(l.currTime)),PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame()||1E3,$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||
0)),PLAYER.PTR.updateEvent(PLAYER.PTR.config));if(0<$("#js_time_ruler_bar_box .space").length){var g=function(a){var b=a.attr("data-time");u=parseInt(a.attr("data-sequencetrimin"));m=parseInt(a.attr("data-sequencetrimout"));console.log("spaceFrame",y);console.log("v0_sequencetrimin",u);p=u-y;C=m-y;a.attr("data-sequencetrimin",p);a.attr("data-sequencetrimout",C);a.css("left",p/c.framePerPixel);q={sequenceTrimIn:p,sequenceTrimOut:C};PLAYER.operateJson.updateClipAttr(q,b)},c=l.config;a=$(".space").siblings(".draggable");
var t=parseInt($(".space").attr("data-sequencetrimin")),y,u=0,m=0,p=0,C=0;y=$(".space").attr("data-offset")?parseInt($(".space").attr("data-offset")):parseInt($(".space").attr("data-sequencetrimout"))-parseInt($(".space").attr("data-sequencetrimin"));$.each(a,function(a,b){$(b).attr("data-sequencetrimin")>=t&&(g($(b)),"true"===$(b).attr("data-interleaved")&&(a=PLAYER.operateJson.chooseInterleavedElem($(b)),g(a)))});$(".space").remove();PLAYER.operateJson.sendJson()}0<$("#js_time_ruler_bar_box .onEffect").length&&
($.each($(".onEffect"),function(a,b){a=$(b).parent(".edit_box_v").attr("data-time");var c=$(b).attr("data-type"),f=$(b).attr("data-pos");PLAYER.operateJson.removeOtherEffectClip(a,c,f);$(b).remove()}),PLAYER.operateJson.sendJson())}}else if(a.ctrl&&65===h)0!==$("#js_time_ruler_bar_box").find(".draggable").length&&$("#js_time_ruler_bar_box").find(".draggable").addClass("onselected");else if(a.ctrl&&17===h)PLAYER.keyNum=17;else if(a.ctrl&&67===h)PLAYER.copyOrcut="copy";else if(a.ctrl&&88===h){PLAYER.checkPlaying();
PLAYER.copyOrcut="cut";var w=[];$.each($(".onselected"),function(a,b){w.push(parseInt($(this).attr("data-sequencetrimin")));PLAYER.clipboard.push($(this));PLAYER.clipboard.parent.push($(this).parent(".time_ruler_bar"));$(b).remove();a=$(b).attr("data-time");PLAYER.operateJson.deleteClipAttr(a)});PLAYER.cut_min_sIn=Math.min.apply(null,w);PLAYER.operateJson.pushCancelArray(PLAYER.jsonObj.rootBin.sequence[0]);PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(l.currTime));PLAYER.PTR.config.maxTime=
PLAYER.operateJson.getLastFrame()||1E3;$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()||0));PLAYER.PTR.updateEvent(PLAYER.PTR.config)}else if(a.ctrl&&86===h&&"copy"===PLAYER.copyOrcut){PLAYER.checkPlaying();var c=l.config,t=l.currTime,ha="check_interleaved_id_"+PLAYER.genNonDuplicateID(12),w=[],x;$(".onselected").each(function(a,b){w.push(parseInt($(b).attr("data-sequencetrimin")))});x=Math.min.apply(null,w);$(".onselected").each(function(a,c){b($(c),$(c).parent(".time_ruler_bar"),
ha,x)});PLAYER.operateJson.sendJson()}else if(a.ctrl&&86===h&&"cut"===PLAYER.copyOrcut){PLAYER.checkPlaying();c=l.config;t=l.currTime;ha="check_interleaved_id_"+PLAYER.genNonDuplicateID(12);if(PLAYER.clipboard){for(a=0;a<PLAYER.clipboard.length;a++)b(PLAYER.clipboard[a],PLAYER.clipboard.parent[a],ha,PLAYER.cut_min_sIn);PLAYER.operateJson.sendJson()}PLAYER.clipboard=[];PLAYER.clipboard.parent=[]}else if(a.ctrl&&90===h){if(0>=PLAYER.goBackJson.length-1)return $(".time_ruler_bar").empty(),PLAYER.goBackJson=
[],$.each($("#js_time_ruler_bar_box .time_ruler_bar"),function(a,b){a={type:$(b).attr("data-type"),index:parseInt($(b).attr("data-index")),subclip:[]};PLAYER.jsonObj.rootBin.sequence[0].tracks.push(a)}),PLAYER.operateJson.checkNoClip()&&PLAYER.OCX.clearWindow(),!1;PLAYER.jsonObj.rootBin.sequence[0]=JSON.parse(PLAYER.goBackJson[PLAYER.goBackJson.length-2]);$(".time_ruler_bar").empty();for(a=0;a<PLAYER.jsonObj.rootBin.sequence[0].tracks.length;a++)if(f=PLAYER.jsonObj.rootBin.sequence[0].tracks[a],r=
f.type,d=f.index,0===f.subclip.length)PLAYER.operateJson.emptyTrack(r,d);else{var la=PLAYER.operateJson.getTrack(r,d);$.each(f.subclip,function(a,b){var c,f;a=b.assetID;var r=b.id;a&&PLAYER.operateJson.getMaterialDuration(a,function(a){c=a.duration;f=a.name});r&&PLAYER.operateJson.getSubtitleDuration(r,function(a){c=a.duration;f=a.name});a=(b.trimOut-b.trimIn)/PLAYER.TR.config.framePerPixel;var r=b.sequenceTrimIn/PLAYER.TR.config.framePerPixel,d=$('<div class="edit_box draggable" data-trimin="'+b.trimIn+
'" data-trimout="'+b.trimOut+'" data-sequencetrimin="'+b.sequenceTrimIn+'" data-sequencetrimout="'+b.sequenceTrimOut+'">'+f+"</div>");d.attr("data-duration",c||2E3);d.attr("data-name",f);d.attr("data-id",b.assetID||b.id);d.attr("data-type",b.type);d.attr("data-interleaved",b.interleaved);d.attr("data-time",b.createTime);d.attr("data-intid",b.interleaved_id);d.css("width",a);d.css("left",r);a="edit_box_"+la.attr("data-type");d.addClass(a);if(b.effect&&0!==b.effect.length){var k,h;$.each(b.effect,function(a,
c){k=$('<div class="effect_box"></div>');k.attr("data-duration",c.duration);k.attr("data-trimin",c.trimIn);k.attr("data-trimout",c.trimOut);k.attr("data-pos",c.pos);k.attr("data-type",c.type);h=(c.trimOut-c.trimIn)/PLAYER.TR.config.framePerPixel;k.width(h);"mosaic"===c.type?k.addClass("effect_box_all"):c.trimOut===b.trimOut?k.addClass("effect_box_r"):c.trimIn===b.trimIn&&k.addClass("effect_box_l");d.append(k)})}la.append(d)});$("#js_player_totalTime").html(PLAYER.getDurationToString(PLAYER.operateJson.getLastFrame()));
PLAYER.PTR.config.maxTime=PLAYER.operateJson.getLastFrame();PLAYER.PTR.updateEvent(PLAYER.PTR.config)}PLAYER.goBackJson.pop();PLAYER.OCX.updateProjectJson(PLAYER.jsonObj);console.log("PLAYER.jsonObj",PLAYER.jsonObj);PLAYER.OCX.seek(parseInt(PLAYER.TR.currTime))}}function x(a){a=PLAYER.EventUtil.getEvent(a);PLAYER.EventUtil.preventDefault(a);a=l.config;var b=a.$sliderBar.width(),c=a.$sliderBar.position().left,f=Math.abs(parseFloat(a.$rulerWrap.css("marginLeft"))),r=a.framePerPixel;if(187===PLAYER.keyNum){$(".time_ruler_toolbar").children("span").removeClass("active");
$("#js_toolbar_zoom_plus").addClass("active");if(b===2*D+8)return;F(-10,r,b,c,f)}189===PLAYER.keyNum&&($(".time_ruler_toolbar").children("span").removeClass("active"),$("#js_toolbar_zoom_minus").addClass("active"),b!==a.$headerRight.width()&&F(10,r,b,c,f))}function G(){var a=l.config;a.$trimIn.addEventListener=function(b,c){if("mousemove"==b){var r=function(){this.onmousemove=null},d=function(a){var b=a.clientX,r=l.targetObj;a=l.config;b<$("."+r).offset().left&&(b=$("."+r).offset().left);b-=f;S+b>
N-3||(E=0>S+b?0:S+b,E=parseInt(E*a.framePerPixel)/a.framePerPixel,l.trimInCurrTime=Math.round(E*a.framePerPixel),b=N-E,a.$trimInOut.css("left",E),a.$trimInOut.css("width",b),null!=c&&c(l.trimInCurrTime))};a.$trimIn.mousedown(function(a){a.stopPropagation();f=a.clientX;S=E;document.onmousemove=d;document.onmouseup=r})}};a.$trimOut.addEventListener=function(b,c){if("mousemove"==b){var r=function(){this.onmousemove=null},d=function(a){var b=a.clientX;a=l.config;b<a.$headerRight.offset().left&&(b=a.$headerRight.offset().left);
b-=f;h+b<E+3||(N=h+b>a.maxTime*a.perMsecWidth?a.maxTime*a.perMsecWidth:h+b,N=parseInt(N*a.framePerPixel)/a.framePerPixel,l.trimOutCurrTime=Math.round(N*a.framePerPixel),a.$trimInOut.css("width",N-E),null!=c&&c(l.trimOutCurrTime))};a.$trimOut.mousedown(function(a){a.stopPropagation();f=a.clientX;h=N;document.onmousemove=d;document.onmouseup=r})}}}function H(a){l.trimInCurrTime=a;PLAYER.PTR.trimInCurrTime=a;PLAYER.PTR.fixTrimInByCurrentTime(a)}function O(a){l.trimOutCurrTime=a;PLAYER.PTR.trimOutCurrTime=
a;PLAYER.PTR.fixTrimOutByCurrentTime(a)}function ba(){var a=l.config,b,f,r,d,h,g;a.$sliderBarLeft.mousedown(function(c){c=c||window.event;a.$sliderBarMiddle.addClass("now");d=c.clientX;f=a.$sliderBar.width();b=parseInt(a.$sliderBar.position().left);h=Math.abs(parseInt(a.$rulerWrap.css("marginLeft")));g=a.framePerPixel;$(document)[0].onmousemove=function(a){a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();a.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});
diff_move=d-a.clientX;F(diff_move,g,f,b,h)};$(document)[0].onmouseup=function(a){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});a.$sliderBarRight.mousedown(function(c){c=c||window.event;a.$sliderBarMiddle.addClass("now");d=c.clientX;f=a.$sliderBar.width();b=parseInt(a.$sliderBar.position().left);h=Math.abs(parseInt(a.$rulerWrap.css("marginLeft")));g=a.framePerPixel;$(document)[0].onmousemove=function(a){a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():
document.selection.empty();a.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});diff_move=a.clientX-d;F(diff_move,g,f,b,h)};$(document)[0].onmouseup=function(a){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});a.$sliderBarMiddle.mousedown(function(k){k=k||window.event;a.$sliderBarMiddle.addClass("now");d=k.clientX;f=a.$sliderBar.width();b=parseInt(a.$sliderBar.position().left);$(document)[0].onmousemove=function(k){$("body").css({cursor:"move"});r=
k.clientX-d;q=b+r;y=f;0>q&&(q=0);q>t&&(q=t);a.$sliderBar.css("left",q);a.$sliderBarMiddle.addClass("now");y!=a.$sliderTrack.width()?(t=parseInt(a.$sliderTrack.width()-y),C=parseInt(a.$rulerWrap.width()-fa),u=Math.floor(parseInt(C*q/t))):u=0;a.$rulerWrap.css("margin-left",parseInt(-u));a.$ruler.css("left",u);a.$clipTrackBar.css("margin-left",parseInt(-u));a.$line.css("margin-left",parseInt(-u)+1);c(u);return!1};$(document)[0].onmouseup=function(b){a.$sliderBarMiddle.removeClass("now");$("body").css({cursor:"default"});
$(document)[0].onmousemove=null}})}function F(a,f,d,h,g){g=l.config;g.$headerRight.width();var k;0<a?(g.max_fpp===f?k=0:(k=(g.$sliderTrack.width()-d)/(g.max_fpp/f-1),k=a/k),q=h-a,y=d+2*a,g.framePerPixel=f*(k+1),0>=q&&(q=0),h+d+a>=g.$headerRight.width()&&(q=h-a,y=g.$sliderTrack.width()-q),y>=g.$sliderTrack.width()&&(y=g.$sliderTrack.width(),g.framePerPixel=g.maxTime/g.$headerRight.width())):0>a?(g.min_fpp===f?k=0:(k=(d-(2*D+8))/(f/g.min_fpp-1),k=a/k),q=h-a,y=d+2*a,g.framePerPixel=f/(-k+1),y<=2*D+8&&
(y=2*D+8,q=h-(2*D+8-d/2),g.framePerPixel=g.min_fpp)):g.framePerPixel=f;$("."+l.targetObj).width();a=Math.floor(g.$headerRight.width()/2);f=b(g.framePerPixel);p(f.smallScaleFrame,f.smallScaleNumsPerLargeScale,g.framePerPixel);X=Math.floor(g.maxTime/g.framePerPixel);X<=g.$headerRight.width()&&(X=g.$headerRight.width());t=parseInt(g.$sliderTrack.width()-y);C=parseInt(X-g.$headerRight.width());0!=l.currTime?(r=Math.floor(parseInt(l.currTime/g.framePerPixel)),u=r-a,q=u*t/C,q>=t&&(q=t,u=C),isNaN(q)&&(q=
u=0)):u=Math.floor(C*q/t);if(isNaN(u)||0>=u)q=u=0;g.$sliderBar.css("width",y);g.$sliderBar.css("left",q);g.$sliderBarMiddle.css("width",y-2*D);g.$sliderBarRight.css("left",y-D);g.$rulerWrap.css("margin-left",-u);g.$rulerWrap.css("width",X);g.$ruler.css("left",u);g.$clipTrackBar.css("margin-left",-u);g.$line.css("margin-left",parseInt(-u)+1);c(u);l.fixArrowCurrentTime(l.currTime);l.fixTrimInByCurrentTime(l.trimInCurrTime);l.fixTrimOutByCurrentTime(l.trimOutCurrTime);l.fixClipWidth()}function p(a,b,
c){var f=l.config;f.smallScaleFrame=a;f.smallScaleNumsPerLargeScale=b;f.framePerPixel=c;l.updateRuler(f)}var S=0,h=0,E=0,N=0,f=0,r=0,q=0,y,t,C,B=0,D=0,u=0,X=0,fa,l=this,Z=0,R=0,I=0,U=0,ga=[{smallScaleFrame:1,smallScaleNumsPerLargeScale:1},{smallScaleFrame:1,smallScaleNumsPerLargeScale:2},{smallScaleFrame:1,smallScaleNumsPerLargeScale:5},{smallScaleFrame:1,smallScaleNumsPerLargeScale:10},{smallScaleFrame:5,smallScaleNumsPerLargeScale:5},{smallScaleFrame:5,smallScaleNumsPerLargeScale:10},{smallScaleFrame:10,
smallScaleNumsPerLargeScale:10},{smallScaleFrame:25,smallScaleNumsPerLargeScale:10},{smallScaleFrame:75,smallScaleNumsPerLargeScale:10},{smallScaleFrame:150,smallScaleNumsPerLargeScale:10},{smallScaleFrame:300,smallScaleNumsPerLargeScale:10},{smallScaleFrame:750,smallScaleNumsPerLargeScale:10},{smallScaleFrame:1500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:4500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9E3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:45E3,smallScaleNumsPerLargeScale:10},
{smallScaleFrame:9E4,smallScaleNumsPerLargeScale:10}],ma={hasTrack:!0,maxTime:1E3,min_largeScaleWidth:80,framePerPixel:0,max_fpp:0,min_fpp:.125,smallScaleNumsPerLargeScale:10,smallScaleFrame:0,smallScaleWidth:0,largeScaleWidth:0,largeScaleMillisecondInterval:0,seekComandTimesMonitor:[],largeScaleHeight:30,smallScaleHeight:12.5,backgroundColor:"#262626",trimHeight:67,scaleColor:"#929293",fontColor:"#929293",fontSize:12,fontFamily:"\u5fae\u8f6f\u96c5\u9ed1",$container:null,$ruler:null,$cursor:null,
$trimInOut:null,$trimIn:null,$trimOut:null,$sliderTrack:null,$sliderBar:null,$sliderBarLeft:null,$sliderBarMiddle:null,$sliderBarRight:null,$clipTrackContainer:null,$clipTrack:null,$clipVideo:null,$clipAudio1:null,$clipAudio2:null,$clipSubTitle:null,$clipEffect:null,targetObj:"time_rule"};a.prototype={updateRuler:function(a){var b=l.config;b.framePerPixel=a.framePerPixel;b.smallScaleFrame=a.smallScaleFrame;b.smallScaleNumsPerLargeScale=a.smallScaleNumsPerLargeScale;b.smallScaleWidth=b.smallScaleFrame/
b.framePerPixel;b.largeScaleWidth=b.smallScaleWidth*b.smallScaleNumsPerLargeScale;b.largeScaleMillisecondInterval=b.smallScaleFrame*b.smallScaleNumsPerLargeScale*40;b.max_fpp=Math.min(b.maxTime/$("."+l.targetObj).width(),11250)},updateEvent:function(a,f){var d=l.config;d.maxTime=a;d.max_fpp=Math.min(d.maxTime/d.$headerRight.width(),11250);f?(X=2*d.$headerRight.width(),d.framePerPixel=d.maxTime/X,a=b(d.framePerPixel),$("."+l.targetObj).width(),p(a.smallScaleFrame,a.smallScaleNumsPerLargeScale,d.framePerPixel),
y=.5*d.$sliderTrack.width(),u=q=0):(X=d.maxTime/d.framePerPixel,u=Math.abs(parseInt(d.$rulerWrap.css("marginLeft"))),y=d.$sliderBar.width(),y===d.$sliderTrack.width()&&(y=d.$headerRight.width()*d.$sliderTrack.width()/X),t=parseInt(d.$sliderTrack.width()-y),C=parseInt(X-d.$headerRight.width()),q=u*t/C);d.$rulerWrap.width(X);d.$sliderBar.css("width",y);d.$sliderBar.css("left",q);d.$sliderBarMiddle.css("width",y-2*D);d.$sliderBarMiddle.css("left",D);d.$sliderBarLeft.css("left",0);d.$sliderBarRight.css("left",
y-D);l.fixArrowCurrentTime(l.currTime);l.fixTrimInByCurrentTime(l.trimInCurrTime);l.fixTrimOutByCurrentTime(l.trimOutCurrTime);c(u)},fixArrowCurrentTime:function(a){var b=this.config;r=a/b.framePerPixel;var f=Math.abs(parseFloat(b.$rulerWrap.css("margin-left"))),d=b.$headerRight.width();0>=r&&(r=0);r>=b.$rulerWrap.width()&&(r=b.$rulerWrap.width());r-f>d&&(u=r-d,t=parseFloat(b.$sliderTrack.width()-b.$sliderBar.width()),C=parseFloat(b.$rulerWrap.width()-d),q=u*t/C,b.$sliderBar.css("left",q),b.$rulerWrap.css("margin-left",
-u),b.$ruler.css("left",u),b.$clipTrackBar.css("margin-left",-u),b.$line.css("margin-left",-u),c(u));l.currTime=a;$("#js_time_ruler_title_nowTime").html(PLAYER.getDurationToString(l.currTime));b.$cursor.css("left",r);b.$line.css("left",r)},fixTrimInByCurrentTime:function(a){var b=this.config;this.trimInCurrTime=a;E=this.trimInCurrTime/b.framePerPixel;N=this.trimOutCurrTime/b.framePerPixel;E>N&&(N=b.maxTime/b.framePerPixel,this.trimOutCurrTime=b.maxTime,N=parseInt(N*b.framePerPixel)/b.framePerPixel);
b.$trimInOut.css("left",E);b.$trimInOut.css("width",N+2-E);a=PLAYER.getDurationToString(parseInt(l.trimOutCurrTime)-parseInt(l.trimInCurrTime));$("#js_player_trimInOutTime").html(a)},initTime:function(){var a=this.config;a.$sliderBar.css("left",0);a.$sliderBarMiddle.css("width",y-B-D);a.$sliderBarMiddle.css("left",B);a.$sliderBarLeft.css("left",0);a.$sliderBarRight.css("left",y-D);a.$rulerWrap.css("margin-left",0);a.$ruler.css("left",0);a.$clipTrackBar.css("margin-left",0);c(0);l.fixArrowCurrentTime(0)},
fixTrimOutByCurrentTime:function(a){var b=this.config;this.trimOutCurrTime=a;E=this.trimInCurrTime/b.framePerPixel;N=this.trimOutCurrTime/b.framePerPixel;N<E&&(this.trimInCurrTime=E=0);b.$trimInOut.css("left",E);b.$trimInOut.css("width",N+2-E);a=PLAYER.getDurationToString(parseInt(l.trimOutCurrTime)-parseInt(l.trimInCurrTime));$("#js_player_trimInOutTime").html(a)},cutArrowCurrentTime:function(){var a=l.config,b=l.currTime;PLAYER.genNonDuplicateID(12);PLAYER.checkPlaying();PLAYER.cutIndex++;$.each($(".onselected"),
function(c,f){v0_sequenceTrimIn=parseInt($(f).attr("data-sequencetrimin"));v0_sequenceTrimOut=parseInt($(f).attr("data-sequencetrimout"));if(v0_sequenceTrimIn<b&&v0_sequenceTrimOut>b){var d=$(f),r,h,g,k,q,t=d.attr("data-id");d.attr("data-name");c=d.attr("data-time");parseInt(d.attr("data-duration"));var y=d.attr("data-interleaved"),l=d.attr("data-intid"),n=parseInt(d.parent(".time_ruler_bar").attr("data-index"));d.attr("class");var u=d.attr("data-type");parseInt(d.offset().left);var m,p=u+"_"+PLAYER.genNonDuplicateID(12);
PLAYER.checkPlaying();d.css("cursor","url(images/cur/cut.cur),default");d.removeClass("onselected");r=parseInt(d.attr("data-sequencetrimin"));h=parseInt(b);f=parseInt(d.attr("data-trimin"));g=f+h-r;k=parseInt(d.attr("data-sequencetrimout"));q=parseInt(d.attr("data-trimout"));m=d.clone();m.find(".effect_box_l")&&m.find(".effect_box_l").remove();m.find(".effect_box_r")&&d.find(".effect_box_r").remove();l=l+"_"+PLAYER.cutIndex;m.removeClass("onselected");m.attr("data-trimin",g);m.attr("data-trimout",
q);m.attr("data-sequencetrimin",b);m.attr("data-sequencetrimout",k);m.attr("data-time",p);m.attr("data-intid",l);m.css("width",(k-b)/a.framePerPixel);m.css("left",b/a.framePerPixel);d.parent(".time_ruler_bar").append(m);d.parent(".time_ruler_bar").hasClass("bar_v")?(m=PLAYER.operateJson.getCutNewEffectClip(c,g,q),k={assetID:t,trimIn:g,trimOut:q,sequenceTrimIn:b,sequenceTrimOut:k,effect:m,createTime:p,type:u,interleaved_id:l},k.interleaved="true"===y?!0:!1,PLAYER.operateJson.addVideoClipAttr(k,n)):
d.parent(".time_ruler_bar").hasClass("bar_a")?(k={assetID:t,trimIn:g,trimOut:q,sequenceTrimIn:b,sequenceTrimOut:k,volume:100,createTime:p,type:u,interleaved_id:l},k.interleaved="true"===y?!0:!1,PLAYER.operateJson.addAudioClipAttr(k,n)):d.parent(".time_ruler_bar").hasClass("bar_t")&&(y=JSON.parse(PLAYER.operateJson.getSubtitleClip(c,n)),$.extend(y,{trimIn:g,trimOut:q,sequenceTrimIn:b,sequenceTrimOut:k,createTime:p,type:u,interleaved_id:l}),PLAYER.operateJson.addSubtitleClipAttr(y,n));d.attr("data-trimout",
g);d.attr("data-sequencetrimout",h);d.width((h-r)/a.framePerPixel);d={trimIn:f,trimOut:g,sequenceTrimIn:r,sequenceTrimOut:h};f=PLAYER.operateJson.getCutOldEffectClip(c,f,g);PLAYER.operateJson.updateClipAttr(d,c,f)}});PLAYER.operateJson.sendJson()},fixEffectWidth:function(a){a.children(".effect_box")&&$.each(a.children(".effect_box"),function(a,b){a=($(b).attr("data-trimout")-$(b).attr("data-trimin"))/PLAYER.TR.config.framePerPixel;$(b).width(a)})},fixClipWidth:function(){var a=l.config;$.each($(".edit_box_v"),
function(b,c){b=($(c).attr("data-trimout")-$(c).attr("data-trimin"))/a.framePerPixel;newLeft=parseInt($(c).attr("data-sequencetrimin"))/a.framePerPixel;$(c).width(b);$(c).css("left",newLeft);l.fixEffectWidth($(c))});$.each($(".edit_box_a"),function(b,c){b=($(c).attr("data-trimout")-$(c).attr("data-trimin"))/a.framePerPixel;newLeft=parseInt($(c).attr("data-sequencetrimin"))/a.framePerPixel;$(c).width(b);$(c).css("left",newLeft)});$.each($(".edit_box_t"),function(b,c){b=($(c).attr("data-trimout")-$(c).attr("data-trimin"))/
a.framePerPixel;newLeft=parseInt($(c).attr("data-sequencetrimin"))/a.framePerPixel;$(c).width(b);$(c).css("left",newLeft)})},moveToNextFrame:function(){PLAYER.keyNum=39;var a=l.config;l.currTime+=1;l.currTime>=a.maxTime&&(l.currTime=a.maxTime);l.fixArrowCurrentTime(l.currTime);l.fixTrimInByCurrentTime(l.trimInCurrTime);l.fixTrimOutByCurrentTime(l.trimOutCurrTime)},moveToPrevFrame:function(){PLAYER.keyNum=37;--l.currTime;0>=l.currTime&&(l.currTime=0);l.fixArrowCurrentTime(l.currTime);l.fixTrimInByCurrentTime(l.trimInCurrTime);
l.fixTrimOutByCurrentTime(l.trimOutCurrTime)},DragDrop:function(){function a(a){return JSON.parse(a).clipInitLeft+JSON.parse(a).clipInitWidth}function b(b){b=PLAYER.EventUtil.getEvent(b);var k=PLAYER.EventUtil.getTarget(b);switch(b.type){case "mousedown":if(-1<k.className.indexOf("draggable")){PLAYER.EventUtil.preventDefault(b);PLAYER.clickOrMove=!1;f=$(k);r=b.clientX;PLAYER.operateJson.mouseDownState(f);C=w(f,b);var k=f,n,D=JSON.parse(C);n=D.clipInitWidth;var v=D.clipInitLeft,B=D.clipInitClientX,
D=D.clipInitOffsetLeft;n=B<=v+D+8?"left":B>=v+D+n-8?"right":"middle";k.attr("data-clipdir",n);p=n;PLAYER.operateJson.addDraggingInfo(f,C);h.push(JSON.parse(C).clipInitLeft);g.push(a(C));q.push(JSON.parse(C).clipInitSequenceTrimIn);t.push(JSON.parse(C).clipInitSequenceTrimOut);c.fire({type:"clipDragstart",target:f,x:b.clientX,y:b.clientY});if("middle"===p){if(n=PLAYER.operateJson.chooseSelectedElem(f),0!==n.length)for(v=0;v<n.length;v++)B=n[v],x=w(B,b),B.attr("data-clipdir",p),PLAYER.operateJson.addDraggingInfo(B,
x),h.push(JSON.parse(x).clipInitLeft),g.push(a(x)),q.push(JSON.parse(x).clipInitSequenceTrimIn),t.push(JSON.parse(x).clipInitSequenceTrimOut),c.fire({type:"clipDragstart",target:B,x:b.clientX,y:b.clientY})}else if("left"===p||"right"===p)if(B=PLAYER.operateJson.chooseInterleavedElem(f))x=w(B,b),B.attr("data-clipdir",p),PLAYER.operateJson.addDraggingInfo(B,x),h.push(JSON.parse(x).clipInitLeft),g.push(a(x)),q.push(JSON.parse(x).clipInitSequenceTrimIn),t.push(JSON.parse(x).clipInitSequenceTrimOut),c.fire({type:"clipDragstart",
target:B,x:b.clientX,y:b.clientY});y=Math.min.apply(null,h);l=Math.max.apply(null,g);u=Math.min.apply(null,q);m=Math.max.apply(null,t)}break;case "mousemove":if(null!==f)if(v=Math.abs(b.clientX-r),1>=v)PLAYER.clickOrMove=!1;else{PLAYER.clickOrMove=!0;var z=C,v=b.clientY,B=JSON.parse(z).clipInitType,D=JSON.parse(z).clipInitOffsetTop,A=JSON.parse(z).clipInitIndex,z=JSON.parse(z).clipInitClientY;if("v"===B)1<=A&&-10>v-z?n=A+Math.ceil((D-v)/70):2<=A&&10<v-z?n=A-Math.ceil((v-z)/70):5>Math.abs(v-z)&&(n=
A);else if("t"===B||"a"===B)1<=A&&10<v-z?n=A+Math.ceil((v-D)/70):2<=A&&-10>v-z?n=A-Math.ceil((z-v)/70):5>Math.abs(v-z)&&(n=A);D=n?n:void 0;c.fire({type:"clipDrag",target:f,x:b.clientX,y:b.clientY,min_left:y,max_right:l,min_in:u,max_out:m,cal_index:D});if("middle"===p){if(n=PLAYER.operateJson.chooseSelectedElem(f),0!==n.length)for(v=0;v<n.length;v++)B=n[v],c.fire({type:"clipDrag",target:B,x:b.clientX,y:b.clientY,min_left:y,max_right:l,min_in:u,max_out:m,cal_index:D})}else("left"===p||"right"===p)&&
(B=PLAYER.operateJson.chooseInterleavedElem(f))&&c.fire({type:"clipDrag",target:B,x:b.clientX,y:b.clientY,min_left:y,max_right:l,min_in:u,max_out:m,cal_index:D})}-1<k.className.indexOf("draggable")&&(d=$(k),d.css({cursor:"default"}),c.fire({type:"clipCheckDir",target:d,x:b.clientX,y:b.clientY}),d=null);break;case "mouseup":v=Math.abs(b.clientX-r);PLAYER.clickOrMove=3>=v?!1:!0;if(PLAYER.clickOrMove&&f&&(f.hasClass("draggable")||f.hasClass("time_ruler_bar"))){c.fire({type:"clipDragend",target:f,x:b.clientX,
y:b.clientY});if("middle"===p){if(n=PLAYER.operateJson.chooseSelectedElem(f),0!==n.length)for(v=0;v<n.length;v++)B=n[v],c.fire({type:"clipDragend",target:B,x:b.clientX,y:b.clientY})}else("left"===p||"right"===p)&&(B=PLAYER.operateJson.chooseInterleavedElem(f))&&c.fire({type:"clipDragend",target:B,x:b.clientX,y:b.clientY});PLAYER.operateJson.sendJson()}if(!PLAYER.clickOrMove&&f&&f.hasClass("draggable")){k="interleaved_id"+PLAYER.genNonDuplicateID(12);c.fire({type:"clipClick",target:f,x:b.clientX,y:b.clientY,
intId:k});if("middle"===p){if(n=PLAYER.operateJson.chooseSelectedElem(f),0!==n.length)for(v=0;v<n.length;v++)B=n[v],c.fire({type:"clipClick",target:B,x:b.clientX,y:b.clientY,intId:k})}else("left"===p||"right"===p)&&(B=PLAYER.operateJson.chooseInterleavedElem(f))&&c.fire({type:"clipClick",target:B,x:b.clientX,y:b.clientY,intId:k});85===PLAYER.keyNum&&PLAYER.operateJson.sendJson()}f=null;m=u=l=y=0;h=[];g=[];q=[];t=[];break;case "click":if(-1<k.className.indexOf("effect_box_l")||-1<k.className.indexOf("effect_box_r"))n=
$(k),c.fire({type:"effectClick",target:n,x:b.clientX,y:b.clientY});break;case "dblclick":-1<k.className.indexOf("time_ruler_bar")&&(n=$(k),c.fire({type:"sequenceClick",target:n,x:b.clientX,y:b.clientY}));-1<k.className.indexOf("edit_box_t")&&(d=$(k),c.fire({type:"clipDblclick",target:d,x:b.clientX,y:b.clientY}));break;case "mousewheel":k=$(k);c.fire({type:"mousewheel",target:k,wheelDelta:b.wheelDelta});break;case "keydown":k=$(k),PLAYER.EventUtil.preventDefault(b),c.fire({type:"keydown",target:k,
code:b.keyCode,shift:b.shiftKey,ctrl:b.ctrlKey})}}var c=new PLAYER.EventTarget,f=null,d=null,r=0,h=[],g=[],q=[],t=[],y=0,l=0,u=0,m=0,p,C,x;c.enable=function(){PLAYER.EventUtil.addHandler(document,"mousedown",b);PLAYER.EventUtil.addHandler(document,"mousemove",b);PLAYER.EventUtil.addHandler(document,"mouseup",b);PLAYER.EventUtil.addHandler(document,"click",b);PLAYER.EventUtil.addHandler(document,"dblclick",b);PLAYER.EventUtil.addHandler(document,"mousewheel",b);PLAYER.EventUtil.addHandler(document,
"keydown",b)};c.disable=function(){PLAYER.EventUtil.removeHandler(document,"mousedown",b);PLAYER.EventUtil.removeHandler(document,"mousemove",b);PLAYER.EventUtil.removeHandler(document,"mouseup",b);PLAYER.EventUtil.removeHandler(document,"click",b);PLAYER.EventUtil.removeHandler(document,"dblclick",b);PLAYER.EventUtil.removeHandler(document,"mouseover",b);PLAYER.EventUtil.removeHandler(document,"mouseout",b);PLAYER.EventUtil.removeHandler(document,"mousewheel",b);PLAYER.EventUtil.removeHandler(document,
"keydown",b)};return c}()};return a}();
PLAYER.timeRuler2=function(){function a(a){h=this;h.config=$.extend(N,a);h.targetObj=h.config.targetObj;h.trimInCurrTime=0;h.trimOutCurrTime=0;h.currTime=0;$("."+this.targetObj).width();a=h.config;var f=h.targetObj;a.framePerPixel=a.maxTime/$("."+f).width();a.smallScaleFrame=b(a.framePerPixel).smallScaleFrame;a.smallScaleNumsPerLargeScale=b(a.framePerPixel).smallScaleNumsPerLargeScale;a.smallScaleWidth=a.smallScaleFrame/a.framePerPixel;a.largeScaleWidth=a.smallScaleWidth*a.smallScaleNumsPerLargeScale;
a.largeScaleMillisecondInterval=a.smallScaleFrame*a.smallScaleNumsPerLargeScale*40;a.max_fpp=Math.min(a.maxTime/$("."+f).width(),11250);S=$("."+f).width();a=h.config;f=h.targetObj;a.$container=$('<div class="'+f+'_container"></div>');a.$container.css("width",S);a.$container.css("height",a.rulerHeight);a.$ruler=$('<canvas class="'+f+'_canvas"></canvas>');a.$ruler.attr("width",$("."+f).width());a.$ruler.attr("height",a.rulerHeight-2);a.$ruler.css("height",a.rulerHeight-2);a.$ruler.appendTo(a.$container);
a.$trimInOut=$('<div class="'+f+'_trimInOut"></div>');a.$trimInOut.css("height",a.trimHeight-2);a.$trimInOut.css("width","0px");a.$trimInOut.appendTo(a.$container);a.$trimIn=$('<div class="'+f+'_trimIn"></div>');a.$trimIn.css("height",a.trimHeight-2);a.$trimIn.appendTo(a.$trimInOut);a.$trimOut=$('<div class="'+f+'_trimOut"></div>');a.$trimOut.css("height",a.trimHeight-2);a.$trimOut.appendTo(a.$trimInOut);a.$cursor=$('<div class="'+f+'_cursor"></div>');a.$cursor.css("height",$("."+f).height()-66);
a.$cursor.appendTo(a.$container);$('<div class="'+f+'_cursor_top"></div>').appendTo(a.$cursor);a.$container.appendTo($("."+f));a.$sliderTrack=$('<div class="'+f+'_slider_track">');a.$sliderBar=$('<div class="'+f+'_slider_scroll_total">');a.$sliderBarLeft=$('<div class="'+f+'_slider_scroll_left">');a.$sliderBarMiddle=$('<div class="'+f+'_slider_scroll_middle">');a.$sliderBarRight=$('<div class="'+f+'_slider_scroll_right">');a.$sliderBarLeft.appendTo(a.$sliderBar);a.$sliderBarMiddle.appendTo(a.$sliderBar);
a.$sliderBarRight.appendTo(a.$sliderBar);a.$sliderBar.appendTo(a.$sliderTrack);a.$sliderTrack.appendTo($("."+f));c(0);a=h.config;f=h.targetObj;ba=a.$sliderBarLeft.width();F=a.$sliderBarRight.width();f=$("."+f).width()*a.$sliderTrack.width()/a.$container.width();H=parseInt(a.$sliderTrack.width()-f);O=parseInt(a.$container.width()-$("."+h.targetObj).width());f>=a.$sliderTrack.width()&&(f=a.$sliderTrack.width());a.$sliderBar.css("width",f);a.$sliderBar.css("left",0);a.$sliderBarMiddle.css("width",f-
ba-F);a.$sliderBarMiddle.css("left",ba);a.$sliderBarLeft.css("left",0);a.$sliderBarRight.css("left",f-F);g();ia();ca();this.config.$container.addEventListener("mousedown",J);this.config.$container.addEventListener("mousemove",Q);this.config.$trimIn.addEventListener("mousemove",T);this.config.$trimOut.addEventListener("mousemove",V);this.DragDrop.addHandler("mousewheel",A);this.DragDrop.addHandler("keydown",w);window.addEventListener("resize",d)}function b(a){for(var b=[],c={},d=0;d<E.length;d++)a<=
E[d].smallScaleFrame*E[d].smallScaleNumsPerLargeScale/80&&b.push(d);c.smallScaleFrame=E[b[0]].smallScaleFrame;c.smallScaleNumsPerLargeScale=E[b[0]].smallScaleNumsPerLargeScale;return c}function c(a){var b=h.config,c=h.targetObj;a=parseInt(a);c=$("."+c).width();b.$ruler.attr("width",c);var d=b.$ruler[0].getContext("2d");d.clearRect(0,0,c,b.$ruler.height());d.fillStyle=b.backgroundColor;d.fillRect(0,0,c,b.$ruler.height());var f=b.rulerHeight;d.lineWidth=1;d.strokeStyle=b.scaleColor;d.fillStyle=b.fontColor;
d.font=b.fontSize+"px "+b.fontFamily;d.textAlign="center";d.beginPath();d.moveTo(0,f);d.lineTo(c,f);var g=parseInt(a/b.largeScaleWidth)*b.largeScaleMillisecondInterval,m=parseInt(a/b.smallScaleWidth)+1;a=m*b.smallScaleWidth-a;for(var m=m%b.smallScaleNumsPerLargeScale,p=0,u=0;p<c;){p=u*b.smallScaleWidth+.3+a;if(0==m%b.smallScaleNumsPerLargeScale){d.moveTo(p,f-1);d.lineTo(p,f-b.largeScaleHeight);var g=g+b.largeScaleMillisecondInterval,v=PLAYER.$millisecondsToTimeFrame(g);d.fillText(v,p,f-b.largeScaleHeight-
3)}else d.moveTo(p,f-1),d.lineTo(p,f-b.smallScaleHeight);u++;m++}d.stroke()}function d(){$("."+h.targetObj).width($("."+h.targetObj).parent().width());h.updateEvent(h.config)}function g(){var a=h.config;a.$container.addEventListener=function(b,c){"mousedown"==b?a.$container.mousedown(function(a){a.stopPropagation();v(a.clientX,a.clientY,c);document.onmousemove=function(a){v(a.clientX,a.clientY,c)};document.onmouseup=function(a){this.onmouseup=this.onmousemove=null}}):"click"==b?(e.stopPropagation(),
$(this)==a.$ruler&&v(e.clientX,e.clientY,c)):"mousemove"==b&&m(a.$cursor,c)}}function m(a,b){function c(a){a=a||event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();v(a.clientX,a.clientY,b)}function d(a){this.onmouseup=this.onmousemove=null}a.mousedown(function(a){a.stopPropagation();a=a||event;this.ondragstart=function(){return!1};document.onmousemove=c;document.onmouseup=d})}function v(a,b,d){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),
$("#js_play").attr("title","\u64ad\u653e"));b=h.config;var f=h.targetObj,g=$("."+f).width();a-=$("."+f).offset().left;f=Math.abs(parseFloat(b.$container.css("margin-left")));z=a+f;z=parseFloat(z*b.framePerPixel)/b.framePerPixel;0>=z&&(z=0);z>=b.$container.width()&&(z=b.$container.width());z-f>g&&(p=z-g,H=parseFloat(b.$sliderTrack.width()-b.$sliderBar.width()),O=parseFloat(b.$container.width()-g),x=p*H/O,b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p),b.$sliderBar.css("left",
x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p));z<f&&(p=z,x=p*b.$sliderTrack.width()/b.$container.width(),b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p),b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p));b.$cursor.css("left",z);g=h.currTime;h.currTime=Math.round(z*b.framePerPixel);null!==d&&g!==h.currTime&&d(h.currTime)}function J(a){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),
$("#js_play").attr("title","\u64ad\u653e"));a>=h.config.maxTime&&(a=h.config.maxTime);h.currTime=a;h.fixArrowCurrentTime(a);PLAYER.dbClick||(PLAYER.TR.currTime=a,PLAYER.TR.fixArrowCurrentTime(a));PLAYER.OCX.seek(a)}function Q(a){var b=h.config;console.log("time",a);b.seekComandTimesMonitor.push(a)}function w(a){var b=h.config,c=b.$sliderBar.width(),d=b.$sliderBar.position().left,f=Math.abs(parseInt(b.$container.css("marginLeft"))),b=b.framePerPixel;a=a.code;189===a?(189===PLAYER.keyNum,c!==$("."+
h.targetObj).width()&&Y(10,b,c,d,f)):187===a&&(187===PLAYER.keyNum,c!==2*F+8&&Y(-10,b,c,d,f))}function A(a){var b=h.config,d=parseInt(b.$sliderBar.position().left);H=parseInt(b.$sliderTrack.width()-b.$sliderBar.width());O=parseInt(b.$container.width()-$("."+h.targetObj).width());if(Math.floor(b.$sliderBar.width())===Math.floor(b.$sliderTrack.width()))return!1;-120===a.wheelDelta?(x=d+2,x>=H?(x=H,p=O,console.log("\u4e61\u4e0b\u6eda\u52a8",p)):p=x*O/H,b.$sliderBar.css("left",x),b.$container.css("margin-left",
-p),b.$ruler.css("left",p),c(p)):120===a.wheelDelta&&(x=d-2,p=0>=x?x=0:x*O/H,b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p));return!1}function ia(){var a=h.config;a.$trimIn.addEventListener=function(b,c){if("mousemove"==b){var d=function(){this.onmousemove=null},f=function(a){var b=a.clientX,d=h.targetObj;a=h.config;console.log("trimInOrginPos",W);b<$("."+d).offset().left&&(b=$("."+d).offset().left);b-=ea;W+b>M-3||(K=0>W+b?0:W+b,K=parseInt(K*a.framePerPixel)/
a.framePerPixel,h.trimInCurrTime=Math.round(z*a.framePerPixel),b=M-K,a.$trimInOut.css("left",K),a.$trimInOut.css("width",b),null!=c&&c(h.trimInCurrTime))};a.$trimIn.mousedown(function(a){a.stopPropagation();ea=a.clientX;W=K;document.onmousemove=f;document.onmouseup=d})}};a.$trimOut.addEventListener=function(b,c){if("mousemove"==b){var d=function(){this.onmousemove=null},f=function(a){var b=a.clientX,d=h.targetObj;a=h.config;b<$("."+d).offset().left&&(b=$("."+d).offset().left);b-=ea;da+b<K+3||(M=da+
b>a.maxTime*a.perMsecWidth?a.maxTime*a.perMsecWidth:da+b,M=parseInt(M*a.framePerPixel)/a.framePerPixel,h.trimOutCurrTime=Math.round(M*a.framePerPixel),a.$trimInOut.css("width",M-K),null!=c&&c(h.trimOutCurrTime))};a.$trimOut.mousedown(function(a){a.stopPropagation();ea=a.clientX;da=M;document.onmousemove=f;document.onmouseup=d})}}}function T(a){h.trimInCurrTime=a;PLAYER.TR.trimInCurrTime=a;PLAYER.TR.fixTrimInByCurrentTime(a)}function V(a){h.trimOutCurrTime=a;PLAYER.TR.trimOutCurrTime=a;PLAYER.TR.fixTrimOutByCurrentTime(a)}
function ca(){var a=h.config,b,d,g,m,v,w;a.$sliderBarLeft.mousedown(function(c){c=c||window.event;a.$sliderBarMiddle.addClass("now");m=c.clientX;d=a.$sliderBar.width();b=parseInt(a.$sliderBar.position().left);v=Math.abs(parseInt(a.$container.css("marginLeft")));w=a.framePerPixel;$(document)[0].onmousemove=function(a){a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();a.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});
diff_move=m-a.clientX;Y(diff_move,w,d,b,v)};$(document)[0].onmouseup=function(a){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});a.$sliderBarRight.mousedown(function(c){c=c||window.event;a.$sliderBarMiddle.addClass("now");m=c.clientX;d=a.$sliderBar.width();b=parseInt(a.$sliderBar.position().left);v=Math.abs(parseInt(a.$container.css("marginLeft")));w=a.framePerPixel;$(document)[0].onmousemove=function(a){a=a||window.event;window.getSelection?window.getSelection().removeAllRanges():
document.selection.empty();a.preventDefault();$("body").css({cursor:"url(images/cur/hand_move.cur),default"});diff_move=a.clientX-m;Y(diff_move,w,d,b,v)};$(document)[0].onmouseup=function(a){$("body").css({cursor:"default"});$(document)[0].onmousemove=null}});a.$sliderBarMiddle.mousedown(function(f){f=f||window.event;a.$sliderBarMiddle.addClass("now");m=f.clientX;d=a.$sliderBar.width();b=parseInt(a.$sliderBar.position().left);$(document)[0].onmousemove=function(f){$("body").css({cursor:"move"});g=
f.clientX-m;x=b+g;G=d;0>x&&(x=0);x>H&&(x=H);a.$sliderBar.css("left",x);a.$sliderBarMiddle.addClass("now");G!=a.$sliderTrack.width()?(H=parseInt(a.$sliderTrack.width()-G),O=parseInt(a.$container.width()-$("."+h.targetObj).width()),p=Math.floor(parseInt(O*x/H))):p=0;a.$container.css("margin-left",parseInt(-p));a.$ruler.css("left",p);c(p);return!1};$(document)[0].onmouseup=function(b){a.$sliderBarMiddle.removeClass("now");$("body").css({cursor:"default"});$(document)[0].onmousemove=null}})}function Y(a,
d,g,m,t){t=h.config;$("."+h.targetObj).width();var f;0<a?(t.max_fpp===d?f=0:(f=(t.$sliderTrack.width()-g)/(t.max_fpp/d-1),f=a/f),x=m-a,G=g+2*a,t.framePerPixel=d*(f+1),0>=x&&(x=0),m+g+a>=$("."+h.targetObj).width()&&(x=m-a,G=t.$sliderTrack.width()-x),G>=t.$sliderTrack.width()&&(G=t.$sliderTrack.width(),t.framePerPixel=t.max_fpp)):0>a?(t.min_fpp===d?f=0:(f=(g-(2*F+8))/(d/t.min_fpp-1),f=a/f),x=m-a,G=g+2*a,t.framePerPixel=d/(-f+1),G<=2*F+8&&(G=2*F+8,x=m-(2*F+8-g/2),t.framePerPixel=t.min_fpp)):t.framePerPixel=
d;$("."+h.targetObj).width();a=Math.floor($("."+h.targetObj).width()/2);d=b(t.framePerPixel);aa(d.smallScaleFrame,d.smallScaleNumsPerLargeScale,t.framePerPixel);S=Math.floor(t.maxTime/t.framePerPixel);S<=$("."+h.targetObj).width()&&(S=$("."+h.targetObj).width());0!=h.currTime?(z=Math.floor(parseInt(h.currTime/t.framePerPixel)),p=z-a,x=p*H/O,x>=H&&(x=H,p=O),isNaN(x)&&(x=p=0)):p=Math.floor(O*x/H);if(isNaN(p)||0>=p)x=p=0;t.$sliderBar.css("width",G);t.$sliderBar.css("left",x);t.$sliderBarMiddle.css("width",
G-2*F);t.$sliderBarRight.css("left",G-F);t.$container.css("margin-left",-p);t.$container.css("width",S);t.$ruler.css("left",p);c(p);h.fixArrowCurrentTime(h.currTime);h.fixTrimInByCurrentTime(h.trimInCurrTime);h.fixTrimOutByCurrentTime(h.trimOutCurrTime)}function aa(a,b,c){var d=h.config;d.smallScaleFrame=a;d.smallScaleNumsPerLargeScale=b;d.framePerPixel=c;h.updateRuler(d)}var W=0,da=0,K=0,M=0,ea=0,z=0,x=0,G,H,O,ba=0,F=0,p=0,S=0,h=this,E=[{smallScaleFrame:1,smallScaleNumsPerLargeScale:1},{smallScaleFrame:1,
smallScaleNumsPerLargeScale:2},{smallScaleFrame:1,smallScaleNumsPerLargeScale:5},{smallScaleFrame:1,smallScaleNumsPerLargeScale:10},{smallScaleFrame:5,smallScaleNumsPerLargeScale:5},{smallScaleFrame:5,smallScaleNumsPerLargeScale:10},{smallScaleFrame:10,smallScaleNumsPerLargeScale:10},{smallScaleFrame:25,smallScaleNumsPerLargeScale:10},{smallScaleFrame:75,smallScaleNumsPerLargeScale:10},{smallScaleFrame:150,smallScaleNumsPerLargeScale:10},{smallScaleFrame:300,smallScaleNumsPerLargeScale:10},{smallScaleFrame:750,
smallScaleNumsPerLargeScale:10},{smallScaleFrame:1500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:4500,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9E3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:45E3,smallScaleNumsPerLargeScale:10},{smallScaleFrame:9E4,smallScaleNumsPerLargeScale:10}],N={hasTrack:!0,maxTime:1E3,min_largeScaleWidth:80,framePerPixel:0,max_fpp:0,min_fpp:.125,smallScaleNumsPerLargeScale:10,smallScaleFrame:0,smallScaleWidth:0,largeScaleWidth:0,largeScaleMillisecondInterval:0,
seekComandTimesMonitor:[],largeScaleHeight:20,smallScaleHeight:12.5,backgroundColor:"#262626",rulerHeight:35,trimHeight:45,scaleColor:"#929293",fontColor:"#929293",fontSize:12,fontFamily:"\u5fae\u8f6f\u96c5\u9ed1",$header:null,$ruler:null,$cursor:null,$trimInOut:null,$trimIn:null,$trimOut:null,$sliderTrack:null,$sliderBar:null,$sliderBarLeft:null,$sliderBarMiddle:null,$sliderBarRight:null,targetObj:"player_time_ruler"};a.prototype={updateRuler:function(a){var b=h.config;b.framePerPixel=a.framePerPixel;
b.smallScaleFrame=a.smallScaleFrame;b.smallScaleNumsPerLargeScale=a.smallScaleNumsPerLargeScale;b.smallScaleWidth=b.smallScaleFrame/b.framePerPixel;b.largeScaleWidth=b.smallScaleWidth*b.smallScaleNumsPerLargeScale;b.largeScaleMillisecondInterval=b.smallScaleFrame*b.smallScaleNumsPerLargeScale*40;b.max_fpp=Math.min(b.maxTime/$("."+h.targetObj).width(),11250)},updateEvent:function(a,d){a=$.extend(h.config,a);a.max_fpp=Math.min(a.maxTime/$("."+h.targetObj).width(),11250);G=parseInt(a.$sliderTrack.width());
S=$("."+h.targetObj).width();a.framePerPixel=a.maxTime/S;d=b(a.framePerPixel);aa(d.smallScaleFrame,d.smallScaleNumsPerLargeScale,a.framePerPixel);a.$container.width(S);a.$sliderBar.css("width",G);a.$sliderBar.css("left",0);a.$sliderBarMiddle.css("width",G-2*F);a.$sliderBarMiddle.css("left",F);a.$sliderBarLeft.css("left",0);a.$sliderBarRight.css("left",G-F);h.fixArrowCurrentTime(h.currTime);h.fixTrimInByCurrentTime(h.trimInCurrTime);h.fixTrimOutByCurrentTime(h.trimOutCurrTime);c(0)},fixArrowCurrentTime:function(a){var b=
this.config,d=this.targetObj;z=a/b.framePerPixel;var f=Math.abs(parseFloat(b.$container.css("margin-left"))),d=$("."+d).width();0>=z&&(z=0);z>=b.$container.width()&&(z=b.$container.width());z-f>d&&(p=z-d,H=parseFloat(b.$sliderTrack.width()-b.$sliderBar.width()),O=parseFloat(b.$container.width()-d),x=p*H/O,b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p),b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p));z<f&&(p=z,x=p*
b.$sliderTrack.width()/b.$container.width(),b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p),b.$sliderBar.css("left",x),b.$container.css("margin-left",-p),b.$ruler.css("left",p),c(p));a>=b.maxTime&&(a=b.maxTime);h.currTime=a;b.$cursor.css("left",z)},fixTrimInByCurrentTime:function(a){var b=this.config;this.trimInCurrTime=a;K=this.trimInCurrTime/b.framePerPixel;M=this.trimOutCurrTime/b.framePerPixel;K>M&&(M=b.maxTime/b.framePerPixel,this.trimOutCurrTime=b.maxTime,
M=parseInt(M*b.framePerPixel)/b.framePerPixel);b.$trimInOut.css("left",K);b.$trimInOut.css("width",M+2-K)},fixTrimOutByCurrentTime:function(a){var b=this.config;this.trimOutCurrTime=a;K=this.trimInCurrTime/b.framePerPixel;M=this.trimOutCurrTime/b.framePerPixel;M<K&&(this.trimInCurrTime=K=0);b.$trimInOut.css("left",K);b.$trimInOut.css("width",M+2-K)},initTime:function(){var a=this.config;a.$sliderBar.css("left",0);a.$sliderBarMiddle.css("width",G-ba-F);a.$sliderBarMiddle.css("left",ba);a.$sliderBarLeft.css("left",
0);a.$sliderBarRight.css("left",G-F);a.$container.css("margin-left",0);a.$ruler.css("left",0);c(0);h.fixArrowCurrentTime(0)},moveToNextFrame:function(){PLAYER.keyNum=39;var a=h.config;h.currTime+=1;h.currTime>=a.maxTime&&(h.currTime=a.maxTime);h.fixArrowCurrentTime(h.currTime);h.fixTrimInByCurrentTime(h.trimInCurrTime);h.fixTrimOutByCurrentTime(h.trimOutCurrTime)},moveToPrevFrame:function(){PLAYER.keyNum=37;--h.currTime;0>=h.currTime&&(h.currTime=0);h.fixArrowCurrentTime(h.currTime);h.fixTrimInByCurrentTime(h.trimInCurrTime);
h.fixTrimOutByCurrentTime(h.trimOutCurrTime)},DragDrop:function(){function a(a){a=PLAYER.EventUtil.getEvent(a);var c=PLAYER.EventUtil.getTarget(a);switch(a.type){case "mousewheel":var d=$(c);b.fire({type:"mousewheel",target:d,wheelDelta:a.wheelDelta});case "keydown":c=$(c),b.fire({type:"keydown",target:c,code:a.keyCode,shift:a.shiftKey,ctrl:a.ctrlKey})}}var b=new PLAYER.EventTarget;b.enable=function(){PLAYER.EventUtil.addHandler(document,"mousewheel",a);PLAYER.EventUtil.addHandler(document,"keydown",
a)};b.disable=function(){PLAYER.EventUtil.removeHandler(document,"mousewheel",a);PLAYER.EventUtil.removeHandler(document,"keydown",a)};return b}()};return a}();
PLAYER.EventUtil={addHandler:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeHandler:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.detachEvent?a.detachEvent("on"+b,c):null==a["on"+b]},getEvent:function(a){return a?a:window.event},getTarget:function(a){return a.target||a.srcElement},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():a.cancelBubble=!0},getPageX:function(a){return void 0===a.pageX?a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft):a.pageX},getPageY:function(a){return void 0===a.pageY?a.clientY+(document.documentElement.scrollTop||document.body.scrollTop):a.pageY},getRelatedTarget:function(a){return a.relatedTarget?a.relatedTarget:a.toElement?a.toElement:a.fromElement?a.fromElement:null},getButton:function(a){if(document.implementation.hasFeature("MouseEvent","2.0"))return a.button;
switch(a.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}},getWheelDelta:function(a){return a.wheelDelta?client.engine.opera&&9.5>client.engine.opera?-a.wheelDelta:a.wheelDelta:40*-a.detail},getKeyCode:function(a){return a.keyCode||a.which||a.charCode},getCharCode:function(a){return"number"==typeof a.charCode?a.charCode:a.keyCode},getClipboardText:function(a){return(a.clipboardData||window.clipboardData).getData("text")},setClipboardText:function(a,b){if(a.clipboardData)return a.clipboardData.setData("text/plain",
b);if(window.clipboardData)return window.clipboardData.setData("text",b)}};PLAYER.documentEvent=function(){function a(a){a=PLAYER.EventUtil.getEvent(a);var d=PLAYER.EventUtil.getTarget(a);switch(a.type){case "keydown":c=d,b.fire({type:"keydown",target:c,code:a.keyCode,shift:a.shiftKey,ctrl:a.ctrlKey})}}var b=new PLAYER.EventTarget,c=null;b.enable=function(b){PLAYER.EventUtil.addHandler(document,"keydown",a)};b.disable=function(){PLAYER.EventUtil.removeHandler(document,"keydown",a)};return b}();
PLAYER.$millisecondsToTimeFrame=function(a){var b=parseInt(a/36E5),c=parseInt((a-36E5*b)/6E4),d=parseInt((a-36E5*b-6E4*c)/1E3);a=Math.round((a-36E5*b-6E4*c-1E3*d)/40);25==a&&(d+=1,a=0);10>b&&(b="0"+b);10>c&&(c="0"+c);10>d&&(d="0"+d);10>a&&(a="0"+a);return b+":"+c+":"+d+":"+a};PLAYER.checkPlaying=function(){PLAYER.isPlaying&&(PLAYER.OCX.doPause(),PLAYER.isPlaying=!1,$("#js_play").removeClass("stop"),$("#js_play").attr("title","\u64ad\u653e"))};
PLAYER.showSubititleEdit=function(){$("#js_carve").removeClass("col-md-6").addClass("col-md-4");$("#js_carve_edit").show();$("#js_carve_edit .list li").eq(0).trigger("click")};PLAYER.hideSubititleEdit=function(){$("#js_carve").removeClass("col-md-4").addClass("col-md-6");$("#js_carve_edit").hide();$("#js_subtitle_h_form").empty()};
PLAYER.hideEffectEdit=function(){$("#js_carve_edit").hide();$("#js_carve").removeClass("col-md-4").addClass("col-md-6");$("#js_effect_h_form").empty();$("#move_box").remove();$(".edit_box").removeClass("onselected")};PLAYER.genNonDuplicateID=function(a){return Number(Math.random().toString().substr(3,a)+Date.now()).toString(36)};
PLAYER.getDurationToString=function(a){var b=parseInt(a/9E4),c=b+"";10>b&&(c="0"+b);a-=9E4*b;var d=parseInt(a/1500),b=d+"";10>d&&(b="0"+d);a-=1500*d;var g=parseInt(a/25),d=g+"";10>g&&(d="0"+g);a-=25*g;g=a+"";10>a&&(g="0"+a);return c+":"+b+":"+d+":"+g};
PLAYER.getLocalTime=function(a){function b(a){return 10>a?"0"+a:a}if(!a)return"";var c=new Date(a);a=c.getFullYear();var d=c.getMonth()+1,g=c.getDate(),m=c.getHours(),v=c.getMinutes(),c=c.getSeconds();return a+"-"+b(d)+"-"+b(g)+" "+b(m)+":"+b(v)+":"+b(c)};PLAYER.ffToNm=function(a){return 40*a};PLAYER.nmToFf=function(a){return a/40};PLAYER.singelton=function(a){var b;return function(){return b||(b=a.apply(this,arguments))}};